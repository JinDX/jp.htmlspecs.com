

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-JP" lang="ja-JP">
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfchandler version 0.2" />
      <meta name="citation_author" content="M. Jones"/>
      <meta name="citation_author" content="J. Hildebrand"/>
      <meta name="citation_publication_date" content="May, 2015"/>
      <meta name="citation_title" content="JSON Web Encryption (JWE)"/>
      <meta name="citation_doi" content="10.17487/RFC7516"/>
      <meta name="citation_issn" content="2070-1721"/>
      <meta name="citation_technical_report_number" content="rfc7516"/>
      <meta name="citation_pdf_url" content="https://www.rfc-editor.org/rfc/pdfrfc/rfc7516.txt.pdf"/>
<title>RFC 7516: JSON Web Encryption（JWE）</title>
        

        <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
           /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->    <script type="text/javascript"><!--
    function addHeaderTags() {
        var spans = document.getElementsByTagName("span");
        for (var i=0; i < spans.length; i++) {
            var elem = spans[i];
            if (elem) {
                var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";               
                }
            }
        }
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script></head>
<body>
<span class="pre noprint docinfo">[<a href="https://www.rfc-editor.org" title="RFC Editor">RFC Home</a>] [<a href="/rfc/rfc7516.txt">TEXT</a>|<a href="/rfc/pdfrfc/rfc7516.txt.pdf">PDF</a>|<a href="/rfc/rfc7516.html">HTML</a>] [<a href='https://datatracker.ietf.org/doc/rfc7516' title='IETF Datatracker information for this document'>Tracker</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=7516&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>] [<a class="boldtext" href="/errata/rfc7516" target="_blank">Errata</a>] [<a href='https://www.rfc-editor.org/info/rfc7516' title='Info page'>Info page</a>]         </span><br/><span class="pre noprint docinfo">                                                                        </span><br /><span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br /><span class="pre noprint docinfo">                                                            <span style='color: #C00;'>Errata Exist</span></span><pre>Internet Engineering Task Force (IETF)                          M. Jones
Request for Comments: 7516                                     Microsoft
Category: Standards Track                                  J. Hildebrand
ISSN: 2070-1721                                                    Cisco
                                                                May 2015


                       <span class="h1">JSON Web Encryption (JWE)</span>

概要

   JSON Web Encryption (JWE) は、JSON ベースのデータ構造を使用して
   暗号化されたコンテンツを表現する。 本仕様で使用される暗号アルゴリズム
   および識別子については、別仕様である JSON Web Algorithms (JWA) 仕様書
   および当該仕様で定義されている IANA レジストリに記載されている。
   関連するデジタル署名およびメッセージ認証コード (MAC) の機能については、
   別仕様である JSON Web Signature (JWS) 仕様書に記載されている。

このメモの位置付け

   本文書は Internet Standards Track 文書である。

   本文書は Internet Engineering Task Force (IETF) の成果物である。
   IETF コミュニティの合意を反映している。 公開レビューを受け、
   Internet Engineering Steering Group (IESG) により
   公開が承認された。 Internet 標準に関する詳細については
   <a href="./rfc5741#section-2">RFC 5741 のセクション&nbsp;2</a> を参照されたい。

   本文書の現在の状態、正誤表、およびフィードバックの提供方法に関する情報は、
   <a href="https://www.rfc-editor.org/info/rfc7516">http://www.rfc-editor.org/info/rfc7516</a>
   から入手できる。


Copyright Notice

   Copyright (c) 2015 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.




<span class="grey">Jones &amp; Hildebrand           Standards Track                    [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


目次

   <a href="#section-1">1</a>.  はじめに  . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-1.1">1.1</a>.  表記上の規約  . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  用語  . . . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-3">3</a>.  JSON Web Encryption (JWE) の概要  . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-3.1">3.1</a>.  JWE コンパクト直列化の概要  . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-3.2">3.2</a>.  JWE JSON 直列化の概要 . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-3.3">3.3</a>.  JWE の例  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#section-4">4</a>.  JOSE ヘッダ  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-4.1">4.1</a>.  登録済みヘッダパラメータ名  . . . . . . . . . . . . . .  <a href="#page-11">11</a>
       <a href="#section-4.1.1">4.1.1</a>.  "alg"（アルゴリズム）ヘッダパラメータ  . . . . . . . .  <a href="#page-12">12</a>
       <a href="#section-4.1.2">4.1.2</a>.  "enc"（暗号化アルゴリズム）ヘッダパラメータ . . . .  <a href="#page-12">12</a>
       <a href="#section-4.1.3">4.1.3</a>.  "zip"（圧縮アルゴリズム）ヘッダパラメータ  . . . .  <a href="#page-12">12</a>
       <a href="#section-4.1.4">4.1.4</a>.  "jku"（JWK セット URL）ヘッダパラメータ  . . . . . .  <a href="#page-13">13</a>
       <a href="#section-4.1.5">4.1.5</a>.  "jwk"（JSON Web Key）ヘッダパラメータ . . . . . . . .  <a href="#page-13">13</a>
       <a href="#section-4.1.6">4.1.6</a>.  "kid"（キー ID）ヘッダパラメータ . . . . . . . . . . .  <a href="#page-13">13</a>
       <a href="#section-4.1.7">4.1.7</a>.  "x5u"（X.509 URL）ヘッダパラメータ  . . . . . . . . .  <a href="#page-13">13</a>
       <a href="#section-4.1.8">4.1.8</a>.  "x5c"（X.509 証明書チェーン）ヘッダパラメータ  . .  <a href="#page-13">13</a>
       4.1.9.  "x5t"（X.509 証明書 SHA-1 サムプリント）ヘッダ
               パラメータ . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
       4.1.10. "x5t#S256"（X.509 証明書 SHA-256 サムプリント）
               ヘッダパラメータ  . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
       <a href="#section-4.1.11">4.1.11</a>. "typ"（型）ヘッダパラメータ . . . . . . . . . . . .  <a href="#page-14">14</a>
       <a href="#section-4.1.12">4.1.12</a>. "cty"（コンテンツ型）ヘッダパラメータ . . . . . . .  <a href="#page-14">14</a>
       <a href="#section-4.1.13">4.1.13</a>. "crit"（クリティカル）ヘッダパラメータ  . . . . . .  <a href="#page-14">14</a>
     <a href="#section-4.2">4.2</a>.  公開ヘッダパラメータ名  . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-4.3">4.3</a>.  非公開ヘッダパラメータ名  . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   <a href="#section-5">5</a>.  JWE の生成および消費  . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-5.1">5.1</a>.  メッセージ暗号化  . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-5.2">5.2</a>.  メッセージ復号  . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
     <a href="#section-5.3">5.3</a>.  文字列比較規則  . . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
   <a href="#section-6">6</a>.  キー識別  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
   <a href="#section-7">7</a>.  直列化  . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
     <a href="#section-7.1">7.1</a>.  JWE コンパクト直列化 . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
     <a href="#section-7.2">7.2</a>.  JWE JSON 直列化  . . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
       <a href="#section-7.2.1">7.2.1</a>.  一般 JWE JSON 直列化構文 . . . . . . . . . . . . . .  <a href="#page-21">21</a>
       <a href="#section-7.2.2">7.2.2</a>.  フラット化 JWE JSON 直列化構文 . . . . . . . . . . .  <a href="#page-23">23</a>
   <a href="#section-8">8</a>.  TLS 要件  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-24">24</a>
   <a href="#section-9">9</a>.  JWS オブジェクトと JWE オブジェクトの識別  . . . . . . . .  <a href="#page-24">24</a>
   <a href="#section-10">10</a>. IANA に関する考慮事項 . . . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
     10.1.  JSON Web Signature および Encryption ヘッダパラメータの
            登録 . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
       <a href="#section-10.1.1">10.1.1</a>.  レジストリ内容  . . . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
   <a href="#section-11">11</a>. セキュリティに関する考慮事項 . . . . . . . . . . . . . . .  <a href="#page-27">27</a>
     <a href="#section-11.1">11.1</a>.  キーエントロピーおよび乱数値  . . . . . . . . . . . .  <a href="#page-27">27</a>
     <a href="#section-11.2">11.2</a>.  キー保護  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-27">27</a>
     <a href="#section-11.3">11.3</a>.  一致するアルゴリズム強度の使用  . . . . . . . . . . .  <a href="#page-28">28</a>



<span class="grey">Jones &amp; Hildebrand           Standards Track                    [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


     <a href="#section-11.4">11.4</a>.  適応的選択暗号文攻撃 . . . . . . . . . . . . . . . . .  <a href="#page-28">28</a>
     <a href="#section-11.5">11.5</a>.  タイミング攻撃 . . . . . . . . . . . . . . . . . . . .  <a href="#page-28">28</a>
   <a href="#section-12">12</a>.  参考文献  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-29">29</a>
     <a href="#section-12.1">12.1</a>.  規範的参照 . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-29">29</a>
     <a href="#section-12.2">12.2</a>.  参考情報的参照 . . . . . . . . . . . . . . . . . . . .  <a href="#page-30">30</a>
   <a href="#appendix-A">付録 A</a>.  JWE の例 . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-32">32</a>
     <a href="#appendix-A.1">A.1</a>.  RSAES-OAEP および AES GCM を用いた JWE の例  . . . . .  <a href="#page-32">32</a>
       <a href="#appendix-A.1.1">A.1.1</a>.  JOSE ヘッダ . . . . . . . . . . . . . . . . . . . . .  <a href="#page-32">32</a>
       <a href="#appendix-A.1.2">A.1.2</a>.  コンテンツ暗号化キー（CEK）  . . . . . . . . . . . .  <a href="#page-32">32</a>
       <a href="#appendix-A.1.3">A.1.3</a>.  キー暗号化  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-33">33</a>
       <a href="#appendix-A.1.4">A.1.4</a>.  初期化ベクトル . . . . . . . . . . . . . . . . . . .  <a href="#page-34">34</a>
       <a href="#appendix-A.1.5">A.1.5</a>.  追加認証データ . . . . . . . . . . . . . . . . . . .  <a href="#page-35">35</a>
       <a href="#appendix-A.1.6">A.1.6</a>.  コンテンツ暗号化  . . . . . . . . . . . . . . . . . .  <a href="#page-35">35</a>
       <a href="#appendix-A.1.7">A.1.7</a>.  完全な表現 . . . . . . . . . . . . . . . . . . . . .  <a href="#page-36">36</a>
       <a href="#appendix-A.1.8">A.1.8</a>.  検証  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-36">36</a>
     A.2.  RSAES-PKCS1-v1_5 および
           AES_128_CBC_HMAC_SHA_256 を用いた JWE の例  . . . . .  <a href="#page-36">36</a>
       <a href="#appendix-A.2.1">A.2.1</a>.  JOSE ヘッダ . . . . . . . . . . . . . . . . . . . . .  <a href="#page-37">37</a>
       <a href="#appendix-A.2.2">A.2.2</a>.  コンテンツ暗号化キー（CEK）  . . . . . . . . . . . .  <a href="#page-37">37</a>
       <a href="#appendix-A.2.3">A.2.3</a>.  キー暗号化  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-38">38</a>
       <a href="#appendix-A.2.4">A.2.4</a>.  初期化ベクトル . . . . . . . . . . . . . . . . . . .  <a href="#page-39">39</a>
       <a href="#appendix-A.2.5">A.2.5</a>.  追加認証データ . . . . . . . . . . . . . . . . . . .  <a href="#page-40">40</a>
       <a href="#appendix-A.2.6">A.2.6</a>.  コンテンツ暗号化  . . . . . . . . . . . . . . . . . .  <a href="#page-40">40</a>
       <a href="#appendix-A.2.7">A.2.7</a>.  完全な表現 . . . . . . . . . . . . . . . . . . . . .  <a href="#page-40">40</a>
       <a href="#appendix-A.2.8">A.2.8</a>.  検証  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-41">41</a>
     A.3.  AES キーラップおよび
           AES_128_CBC_HMAC_SHA_256 を用いた JWE の例  . . . . .  <a href="#page-41">41</a>
       <a href="#appendix-A.3.1">A.3.1</a>.  JOSE ヘッダ . . . . . . . . . . . . . . . . . . . . .  <a href="#page-41">41</a>
       <a href="#appendix-A.3.2">A.3.2</a>.  コンテンツ暗号化キー（CEK）  . . . . . . . . . . . .  <a href="#page-42">42</a>
       <a href="#appendix-A.3.3">A.3.3</a>.  キー暗号化  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-42">42</a>
       <a href="#appendix-A.3.4">A.3.4</a>.  初期化ベクトル . . . . . . . . . . . . . . . . . . .  <a href="#page-42">42</a>
       <a href="#appendix-A.3.5">A.3.5</a>.  追加認証データ . . . . . . . . . . . . . . . . . . .  <a href="#page-43">43</a>
       <a href="#appendix-A.3.6">A.3.6</a>.  コンテンツ暗号化  . . . . . . . . . . . . . . . . . .  <a href="#page-43">43</a>
       <a href="#appendix-A.3.7">A.3.7</a>.  完全な表現 . . . . . . . . . . . . . . . . . . . . .  <a href="#page-43">43</a>
       <a href="#appendix-A.3.8">A.3.8</a>.  検証  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-44">44</a>
     <a href="#appendix-A.4">A.4</a>.  一般 JWE JSON 直列化を用いた JWE の例  . . . . . . . .  <a href="#page-44">44</a>
       <a href="#appendix-A.4.1">A.4.1</a>.  受信者ごとの非保護ヘッダ . . . . . . . . . . . . .  <a href="#page-45">45</a>
       <a href="#appendix-A.4.2">A.4.2</a>.  JWE 保護ヘッダ  . . . . . . . . . . . . . . . . . . .  <a href="#page-45">45</a>
       <a href="#appendix-A.4.3">A.4.3</a>.  JWE 共有非保護ヘッダ . . . . . . . . . . . . . . . .  <a href="#page-45">45</a>
       <a href="#appendix-A.4.4">A.4.4</a>.  完全な JOSE ヘッダ値 . . . . . . . . . . . . . . . .  <a href="#page-45">45</a>
       <a href="#appendix-A.4.5">A.4.5</a>.  追加認証データ . . . . . . . . . . . . . . . . . . .  <a href="#page-46">46</a>
       <a href="#appendix-A.4.6">A.4.6</a>.  コンテンツ暗号化  . . . . . . . . . . . . . . . . . .  <a href="#page-46">46</a>
       <a href="#appendix-A.4.7">A.4.7</a>.  完全な JWE JSON 直列化表現  . . . . . . . . . . . .  <a href="#page-47">47</a>
     <a href="#appendix-A.5">A.5</a>.  フラット化 JWE JSON 直列化を用いた JWE の例  . . . . .  <a href="#page-47">47</a>
   <a href="#appendix-B">付録 B</a>.  AES_128_CBC_HMAC_SHA_256 の計算例 . . . . . . . . . . .  <a href="#page-48">48</a>
     <a href="#appendix-B.1">B.1</a>.  キーから MAC_KEY および ENC_KEY を抽出  . . . . . . .  <a href="#page-48">48</a>
     <a href="#appendix-B.2">B.2</a>.  平文を暗号化して暗号文を作成  . . . . . . . . . . . . .  <a href="#page-49">49</a>
     <a href="#appendix-B.3">B.3</a>.  AAD 長の 64 ビットビッグエンディアン表現  . . . . . .  <a href="#page-49">49</a>



<span class="grey">Jones &amp; Hildebrand           Standards Track                    [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


     <a href="#appendix-B.4">B.4</a>.  初期化ベクトル値 . . . . . . . . . . . . . . . . . . . .  <a href="#page-49">49</a>
     <a href="#appendix-B.5">B.5</a>.  HMAC 計算への入力を作成  . . . . . . . . . . . . . . . .  <a href="#page-50">50</a>
     <a href="#appendix-B.6">B.6</a>.  HMAC 値を計算  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-50">50</a>
     <a href="#appendix-B.7">B.7</a>.  HMAC 値を切り詰めて認証タグを作成  . . . . . . . . . .  <a href="#page-50">50</a>
   謝辞  . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-50">50</a>
   著者の連絡先  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-51">51</a>

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  はじめに</span>

   JSON Web Encryption (JWE) は、JSON ベースのデータ構造
   [<a href="./rfc7159" title="&quot;The JavaScript Object Notation (JSON) Data Interchange Format&quot;">RFC7159</a>] を用いて暗号化されたコンテンツを表現する。
   JWE の暗号化メカニズムは、任意のオクテット列に対して暗号化を行い、
   完全性保護を提供する。

   JWE には、密接に関連する 2 種類の直列化が定義されている。
   JWE コンパクト直列化は、HTTP Authorization ヘッダや URI
   クエリパラメータなどの空間制約のある環境を対象とした、
   コンパクトで URL セーフな表現である。
   JWE JSON 直列化は、JWE を JSON オブジェクトとして表現し、
   同一のコンテンツを複数の相手に対して暗号化できるようにする。
   いずれも同一の暗号学的基盤を共有している。

   本仕様で使用される暗号アルゴリズムおよび識別子は、別仕様である
   JSON Web Algorithms (JWA)
   [<a href="#ref-JWA" title="&quot;JSON Web Algorithms (JWA)&quot;">JWA</a>] に記述され、
   同仕様で定義される IANA レジストリに登録されている。
   関連するデジタル署名および MAC の機能については、
   別仕様である JSON Web Signature (JWS)
   [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] に記述されている。

   本仕様で定義される名前は、結果として得られる表現を
   コンパクトにするという中核的な目標のため、短く定義されている。

<span class="h3"><a class="selflink" id="section-1.1" href="#section-1.1">1.1</a>.  表記上の規約</span>

   本文書中のキーワード "MUST", "MUST NOT", "REQUIRED", "SHALL",
   "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",
   "NOT RECOMMENDED", "MAY", および "OPTIONAL" は、
   「RFC における要件レベルを示すためのキーワード」
   [<a href="./rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>] に記載されているとおりに解釈される。
   これらの解釈は、用語がすべて大文字で記載されている場合にのみ適用される。

   BASE64URL(OCTETS) は、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   セクション 2 に従った、OCTETS の base64url エンコードを表す。

   UTF8(STRING) は、STRING の UTF-8
   [<a href="./rfc3629" title="&quot;UTF-8, a transformation format of ISO 10646&quot;">RFC3629</a>] 表現の
   オクテット列を表す。ここで STRING は、0 個以上の Unicode
   [<a href="#ref-UNICODE" title="&quot;The Unicode Standard&quot;">UNICODE</a>] 文字からなる並びである。





<span class="grey">Jones &amp; Hildebrand           Standards Track                    [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   ASCII(STRING) は、STRING の ASCII
   [<a href="./rfc20" title="&quot;ASCII format for Network Interchange&quot;">RFC20</a>] 表現の
   オクテット列を表す。ここで STRING は、0 個以上の ASCII 文字からなる。

   2 つの値 A および B の連結は、A || B と表記する。

<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  用語</span>

   「JSON Web Signature (JWS)」、「Base64url Encoding」、
   「Collision-Resistant Name」、「Header Parameter」、
   「JOSE Header」、および「StringOrURI」は、
   JWS 仕様 [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] で定義されている。

   「Ciphertext」、「Digital Signature」、「Initialization Vector
   (IV)」、「Message Authentication Code (MAC)」、および「Plaintext」は、
   「Internet Security Glossary, Version 2」
   [<a href="./rfc4949" title="&quot;Internet Security Glossary, Version 2&quot;">RFC4949</a>] で定義されている。

   以下の用語は本仕様で定義される。

   JSON Web Encryption (JWE)
      暗号化され、完全性保護されたメッセージを表すデータ構造。

   追加認証データ付き認証暗号（AEAD）
      AEAD アルゴリズムは、平文を暗号化し、追加認証データを指定でき、
      暗号文および追加認証データに対する統合された完全性検査を提供する。
      AEAD アルゴリズムは、平文と追加認証データという 2 つの入力を受け取り、
      暗号文と認証タグ値という 2 つの出力を生成する。
      AES Galois/Counter Mode (GCM) は、そのようなアルゴリズムの 1 つである。

   追加認証データ（AAD）
      完全性保護はされるが暗号化はされない、AEAD 操作への入力。

   認証タグ
      AEAD 操作の出力であり、暗号文および追加認証データの完全性を保証する。
      なお、一部のアルゴリズムでは認証タグを使用しない場合があり、
      その場合、この値は空のオクテット列となる。

   コンテンツ暗号化キー（CEK）
      平文を暗号化して暗号文および認証タグを生成するために使用される
      AEAD アルゴリズム用の対称鍵。







<span class="grey">Jones &amp; Hildebrand           Standards Track                    [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   JWE 暗号化キー
      暗号化されたコンテンツ暗号化キーの値。
      一部のアルゴリズムでは、JWE 暗号化キー値は
      空のオクテット列として指定される点に注意すること。

   JWE 初期化ベクトル
      平文を暗号化する際に使用される初期化ベクトルの値。
      一部のアルゴリズムでは初期化ベクトルを使用しない場合があり、
      その場合、この値は空のオクテット列となる。

   JWE AAD
      認証暗号操作によって完全性保護される追加の値。
      これは JWE JSON 直列化を使用する場合にのみ存在できる。
      （なお、JWE コンパクト直列化または JWE JSON 直列化のいずれを
      使用する場合でも、AAD 値を完全性保護されたヘッダパラメータ値として
      含めることで同等のことは可能であるが、その場合、値は二重に
      base64url エンコードされるという代償がある。）

   JWE 暗号文
      追加認証データ付きで平文を認証暗号化した結果として得られる暗号文の値。

   JWE 認証タグ
      追加認証データ付きで平文を認証暗号化した結果として得られる
      認証タグの値。

   JWE 保護ヘッダ
      認証暗号操作によって完全性保護されるヘッダパラメータを含む JSON
      オブジェクト。これらのパラメータは、JWE のすべての受信者に適用される。
      JWE コンパクト直列化では、これは JOSE ヘッダ全体を構成する。
      JWE JSON 直列化では、これは JOSE ヘッダの 1 つの構成要素である。

   JWE 共有非保護ヘッダ
      JWE のすべての受信者に適用されるが、完全性保護されない
      ヘッダパラメータを含む JSON オブジェクト。
      これは JWE JSON 直列化を使用する場合にのみ存在できる。

   JWE 受信者ごとの非保護ヘッダ
      JWE の単一の受信者に適用されるヘッダパラメータを含む JSON
      オブジェクト。これらのヘッダパラメータ値は完全性保護されない。
      これは JWE JSON 直列化を使用する場合にのみ存在できる。

   JWE コンパクト直列化
      JWE をコンパクトで URL セーフな文字列として表現したもの。



<span class="grey">Jones &amp; Hildebrand           Standards Track                    [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   JWE JSON 直列化
      JWE を JSON オブジェクトとして表現したもの。
      JWE JSON 直列化は、同一のコンテンツを複数の相手に暗号化することを
      可能にする。この表現は、コンパクトさや URL セーフ性については
      最適化されていない。

   鍵管理モード
      使用するコンテンツ暗号化キー値を決定する方法。
      CEK 値を決定するために使用される各アルゴリズムは、
      特定の鍵管理モードを使用する。
      本仕様で用いられる鍵管理モードには、キー暗号化、
      キーラップ、直接鍵合意、キーラップ付き鍵合意、
      および直接暗号化がある。

   キー暗号化
      非対称暗号アルゴリズムを用いて、意図された受信者に対して
      CEK 値を暗号化する鍵管理モード。

   キーラップ
      対称鍵ラップアルゴリズムを用いて、意図された受信者に対して
      CEK 値を暗号化する鍵管理モード。

   直接鍵合意
      鍵合意アルゴリズムを用いて CEK 値について合意する鍵管理モード。

   キーラップ付き鍵合意
      鍵合意アルゴリズムを用いて対称鍵について合意し、
      その対称鍵を用いて CEK 値を暗号化する鍵管理モード。

   直接暗号化
      当事者間で共有される秘密の対称鍵値を CEK 値として使用する
      鍵管理モード。


















<span class="grey">Jones &amp; Hildebrand           Standards Track                    [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  JSON Web Encryption (JWE) の概要</span>

   JWE は、JSON データ構造および base64url エンコーディングを使用して
   暗号化されたコンテンツを表現する。これらの JSON データ構造は、
   <a href="./rfc7159#section-2">RFC 7159 の Section&nbsp;2</a>
   [<a href="./rfc7159" title="&quot;The JavaScript Object Notation (JSON) Data Interchange Format&quot;">RFC7159</a>] に従い、
   任意の JSON 値または構造文字の前後に空白および／または改行を
   含んでもよい。JWE は、以下の論理値（それぞれ
   <a href="#section-2">Section 2</a> で定義されている）を表す。

   o  JOSE ヘッダー
   o  JWE 暗号化キー
   o  JWE 初期化ベクトル
   o  JWE AAD
   o  JWE 暗号文
   o  JWE 認証タグ

   JWE において、JOSE ヘッダーのメンバーは、以下の値
   （それぞれ <a href="#section-2">Section 2</a> で定義されている）
   のメンバーの和集合である。

   o  JWE 保護ヘッダー
   o  JWE 共有非保護ヘッダー
   o  JWE 受信者別非保護ヘッダー

   JWE は、認証付き暗号化を利用して、平文の機密性および完全性、
   ならびに JWE 保護ヘッダーおよび JWE AAD の完全性を保証する。

   本文書では、JWE の 2 つのシリアライゼーションを定義する。1 つは、
   JWE コンパクトシリアライゼーションと呼ばれる、URL セーフな
   コンパクトなシリアライゼーションであり、もう 1 つは、
   JWE JSON シリアライゼーションと呼ばれる JSON シリアライゼーションである。
   いずれのシリアライゼーションにおいても、JWE 保護ヘッダー、
   JWE 暗号化キー、JWE 初期化ベクトル、JWE 暗号文、
   および JWE 認証タグは、JSON には任意のオクテット列を
   直接表現する方法がないため、base64url エンコードされる。
   存在する場合、JWE AAD も同様に base64url エンコードされる。

<span class="h3"><a class="selflink" id="section-3.1" href="#section-3.1">3.1</a>.  JWE コンパクトシリアライゼーションの概要</span>

   JWE コンパクトシリアライゼーションでは、JWE 共有非保護ヘッダー
   および JWE 受信者別非保護ヘッダーは使用されない。この場合、
   JOSE ヘッダーと JWE 保護ヘッダーは同一である。








<span class="grey">Jones &amp; Hildebrand           Standards Track                    [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   JWE コンパクトシリアライゼーションでは、JWE は次の連結として
   表現される。

      BASE64URL(UTF8(JWE 保護ヘッダー)) || '.' ||
      BASE64URL(JWE 暗号化キー) || '.' ||
      BASE64URL(JWE 初期化ベクトル) || '.' ||
      BASE64URL(JWE 暗号文) || '.' ||
      BASE64URL(JWE 認証タグ)

   JWE コンパクトシリアライゼーションの詳細については
   <a href="#section-7.1">Section 7.1</a> を参照のこと。

<span class="h3"><a class="selflink" id="section-3.2" href="#section-3.2">3.2</a>.  JWE JSON シリアライゼーションの概要</span>

   JWE JSON シリアライゼーションでは、JWE 保護ヘッダー、
   JWE 共有非保護ヘッダー、および JWE 受信者別非保護ヘッダーの
   うち 1 つ以上が存在しなければならない。この場合、JOSE ヘッダーの
   メンバーは、存在する JWE 保護ヘッダー、
   JWE 共有非保護ヘッダー、および
   JWE 受信者別非保護ヘッダーの値のメンバーの和集合である。

   JWE JSON シリアライゼーションでは、JWE は、以下の 8 つの
   メンバーの一部またはすべてを含む JSON オブジェクトとして
   表現される。

      "protected", BASE64URL(UTF8(JWE 保護ヘッダー)) の値
      "unprotected", JWE 共有非保護ヘッダーの値
      "header", JWE 受信者別非保護ヘッダーの値
      "encrypted_key", BASE64URL(JWE 暗号化キー) の値
      "iv", BASE64URL(JWE 初期化ベクトル) の値
      "ciphertext", BASE64URL(JWE 暗号文) の値
      "tag", BASE64URL(JWE 認証タグ) の値
      "aad", BASE64URL(JWE AAD) の値

   6 つの base64url エンコードされた結果文字列と、
   2 つの非保護 JSON オブジェクト値は、
   JSON オブジェクト内のメンバーとして表現される。
   これらの値の一部の包含は OPTIONAL である。
   JWE JSON シリアライゼーションは、
   平文を複数の受信者に対して暗号化することもできる。
   詳細については <a href="#section-7.2">Section 7.2</a> を参照のこと。












<span class="grey">Jones &amp; Hildebrand           Standards Track                    [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h3"><a class="selflink" id="section-3.3" href="#section-3.3">3.3</a>.  JWE の例</span>

   この例では、平文
   "The true sign of intelligence is not knowledge but imagination."
   を受信者向けに暗号化する。

   次の例の JWE 保護ヘッダーは、以下を宣言している。

   o  コンテンツ暗号化キーは、RSAES-OAEP
      [<a href="./rfc3447" title="&quot;Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1&quot;">RFC3447</a>]
      アルゴリズムを使用して受信者向けに暗号化され、
      JWE 暗号化キーが生成される。

   o  認証付き暗号化は、256 ビット鍵を用いた AES GCM
      [<a href="#ref-AES" title="&quot;Advanced Encryption Standard (AES)&quot;">AES</a>]
      [<a href="#ref-NIST.800-38D">NIST.800-38D</a>]
      アルゴリズムを使用して平文に対して実行され、
      暗号文および認証タグが生成される。

     {"alg":"RSA-OAEP","enc":"A256GCM"}

   この JWE 保護ヘッダーを
   BASE64URL(UTF8(JWE 保護ヘッダー)) としてエンコードすると、
   次の値が得られる。

     eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ

   この JWE を完成させるための残りの手順は次のとおりである。

   o  ランダムなコンテンツ暗号化キー (CEK) を生成する。

   o  RSAES-OAEP アルゴリズムを使用して、
      受信者の公開鍵で CEK を暗号化し、
      JWE 暗号化キーを生成する。

   o  JWE 暗号化キーを base64url エンコードする。

   o  ランダムな JWE 初期化ベクトルを生成する。

   o  JWE 初期化ベクトルを base64url エンコードする。

   o  追加認証データ暗号化パラメータを
      ASCII(BASE64URL(UTF8(JWE 保護ヘッダー))) とする。

   o  AES GCM アルゴリズムを使用し、CEK を暗号化キー、
      JWE 初期化ベクトルおよび追加認証データ値として、
      平文に対して認証付き暗号化を実行し、
      128 ビットの認証タグ出力を要求する。

   o  暗号文を base64url エンコードする。

   o  認証タグを base64url エンコードする。






<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   o  最終的な表現を組み立てる。この結果のコンパクト
      シリアライゼーションは、文字列
      BASE64URL(UTF8(JWE 保護ヘッダー)) ||
      '.' || BASE64URL(JWE 暗号化キー) ||
      '.' || BASE64URL(JWE 初期化ベクトル) ||
      '.' || BASE64URL(JWE 暗号文) ||
      '.' || BASE64URL(JWE 認証タグ)
      となる。

   この例における最終結果（表示目的のみの改行付き）は次のとおりである。

     eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.
     OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
     ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
     Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
     mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
     1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
     6UklfCpIMfIjf7iGdXKHzg.
     48V1_ALb6US04U3b.
     5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
     SdiwkIr3ajwQzaBtQD_A.
     XFBoMYUZodetZdvTiFvSkQ

   この JWE の計算に関する完全な詳細については
   <a href="#appendix-A.1">Appendix A.1</a> を参照のこと。
   JWE JSON シリアライゼーションを使用した例を含む追加の例については、
   Sections A.4 および A.5 を含む <a href="#appendix-A">Appendix A</a> を参照のこと。

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  JOSE ヘッダー</span>

   JWE において、JOSE ヘッダーを表す JSON オブジェクトの
   メンバーは、平文に適用される暗号化および、
   オプションで JWE の追加プロパティを記述する。
   JOSE ヘッダー内のヘッダーパラメータ名は、
   [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の Section 4 に記載されているとおり、
   一意でなければならない。
   実装が理解できないヘッダーパラメータの取り扱いに関する規則も同様である。
   ヘッダーパラメータ名のクラスも同様である。

<span class="h3"><a class="selflink" id="section-4.1" href="#section-4.1">4.1</a>.  登録済みヘッダーパラメータ名</span>

   JWE で使用する以下のヘッダーパラメータ名は、
   [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] により確立された
   IANA「JSON Web Signature and Encryption Header Parameters」
   レジストリに登録されており、その意味は以下に定義される。

   共通レジストリで示されているとおり、
   JWS と JWE は共通のヘッダーパラメータ空間を共有する。
   パラメータが両方の仕様で使用される場合、
   その使用方法は仕様間で互換でなければならない。






<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="section-4.1.1" href="#section-4.1.1">4.1.1</a>.  「alg」（アルゴリズム）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.1 で定義されている「alg」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   ヘッダーパラメータは、CEK の値を暗号化または決定するために
   使用される暗号アルゴリズムを識別する点が異なる。
   「alg」値がサポートされていないアルゴリズムを表す場合、
   または受信者がそのアルゴリズムで使用できる鍵を
   持っていない場合、暗号化されたコンテンツは使用できない。

   この用途のために定義された「alg」値の一覧は、
   [<a href="#ref-JWA" title="&quot;JSON Web Algorithms (JWA)&quot;">JWA</a>] により確立された
   IANA「JSON Web Signature and Encryption Algorithms」
   レジストリに掲載されている。このレジストリの初期内容は、
   [<a href="#ref-JWA" title="&quot;JSON Web Algorithms (JWA)&quot;">JWA</a>] の Section 4.1 で
   定義された値である。

<span class="h4"><a class="selflink" id="section-4.1.2" href="#section-4.1.2">4.1.2</a>.  「enc」（暗号化アルゴリズム）ヘッダーパラメータ</span>

   「enc」（暗号化アルゴリズム）ヘッダーパラメータは、
   平文に対して認証付き暗号化を実行し、
   暗号文および認証タグを生成するために使用される
   コンテンツ暗号化アルゴリズムを識別する。
   このアルゴリズムは、指定された鍵長を持つ
   AEAD アルゴリズムでなければならない。
   「enc」値がサポートされていないアルゴリズムを
   表す場合、暗号化されたコンテンツは使用できない。
   「enc」値は、[<a href="#ref-JWA" title="&quot;JSON Web Algorithms (JWA)&quot;">JWA</a>] により確立された
   IANA「JSON Web Signature and Encryption Algorithms」
   レジストリに登録されるか、または
   衝突耐性名を含む値であるべきである。
   「enc」値は、大文字小文字を区別する ASCII 文字列であり、
   StringOrURI 値を含む。
   このヘッダーパラメータは MUST で存在し、
   実装によって理解および処理されなければならない。

   この用途のために定義された「enc」値の一覧は、
   [<a href="#ref-JWA" title="&quot;JSON Web Algorithms (JWA)&quot;">JWA</a>] により確立された
   IANA「JSON Web Signature and Encryption Algorithms」
   レジストリに掲載されている。このレジストリの初期内容は、
   [<a href="#ref-JWA" title="&quot;JSON Web Algorithms (JWA)&quot;">JWA</a>] の Section 5.1 で
   定義された値である。

<span class="h4"><a class="selflink" id="section-4.1.3" href="#section-4.1.3">4.1.3</a>.  「zip」（圧縮アルゴリズム）ヘッダーパラメータ</span>

   暗号化前に平文へ適用される圧縮アルゴリズム（存在する場合）。
   本仕様で定義される「zip」値は次のとおりである。

   o  「DEF」 - DEFLATE
      [<a href="./rfc1951" title="&quot;DEFLATE Compressed Data Format Specification version 1.3&quot;">RFC1951</a>]
      アルゴリズムによる圧縮

   他の値も使用してよい。圧縮アルゴリズム値は、
   [<a href="#ref-JWA" title="&quot;JSON Web Algorithms (JWA)&quot;">JWA</a>] により確立された
   IANA「JSON Web Encryption Compression Algorithms」
   レジストリに登録できる。
   「zip」値は大文字小文字を区別する文字列である。
   「zip」パラメータが存在しない場合、
   暗号化前に平文へ圧縮は適用されない。
   使用される場合、このヘッダーパラメータは
   完全性保護されなければならない。
   したがって、これは JWE 保護ヘッダー内にのみ
   出現しなければならない。
   このヘッダーパラメータの使用は OPTIONAL である。
   このヘッダーパラメータは、
   実装によって理解および処理されなければならない。

<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 12]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-13" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="section-4.1.4" href="#section-4.1.4">4.1.4</a>.  「jku」（JWK セット URL）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.2 で定義されている「jku」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   JWK セットリソースが、JWE が暗号化された
   公開鍵を含む点が異なる。これにより、
   JWE を復号するために必要な秘密鍵を
   判断することができる。

<span class="h4"><a class="selflink" id="section-4.1.5" href="#section-4.1.5">4.1.5</a>.  「jwk」（JSON Web Key）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.3 で定義されている「jwk」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   鍵が、JWE が暗号化された公開鍵である点が異なる。
   これにより、JWE を復号するために必要な
   秘密鍵を判断することができる。

<span class="h4"><a class="selflink" id="section-4.1.6" href="#section-4.1.6">4.1.6</a>.  「kid」（キー ID）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.4 で定義されている「kid」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   キーのヒントが、JWE が暗号化された
   公開鍵を参照する点が異なる。
   これにより、JWE を復号するために必要な
   秘密鍵を判断することができる。
   このパラメータは、JWE の送信者が
   受信者に対して鍵の変更を明示的に通知することを可能にする。

<span class="h4"><a class="selflink" id="section-4.1.7" href="#section-4.1.7">4.1.7</a>.  「x5u」（X.509 URL）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.5 で定義されている「x5u」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   X.509 公開鍵証明書または証明書チェーン
   [<a href="./rfc5280" title="&quot;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile&quot;">RFC5280</a>]
   が、JWE が暗号化された公開鍵を含む点が異なる。
   これにより、JWE を復号するために必要な
   秘密鍵を判断することができる。

<span class="h4"><a class="selflink" id="section-4.1.8" href="#section-4.1.8">4.1.8</a>.  「x5c」（X.509 証明書チェーン）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.6 で定義されている「x5c」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   X.509 公開鍵証明書または証明書チェーン
   [<a href="./rfc5280" title="&quot;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile&quot;">RFC5280</a>]
   が、JWE が暗号化された公開鍵を含む点が異なる。
   これにより、JWE を復号するために必要な
   秘密鍵を判断することができる。

   「x5c」値の例については、
   [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   <a href="#appendix-B">Appendix B</a> を参照のこと。






<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 13]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-14" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="section-4.1.9" href="#section-4.1.9">4.1.9</a>.  「x5t」（X.509 証明書 SHA-1 サムプリント）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.7 で定義されている「x5t」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   サムプリントによって参照される証明書が、
   JWE が暗号化された公開鍵を含む点が異なる。
   これにより、JWE を復号するために必要な
   秘密鍵を判断することができる。
   証明書サムプリントは、
   証明書フィンガープリントと呼ばれることもある。

<span class="h4"><a class="selflink" id="section-4.1.10" href="#section-4.1.10">4.1.10</a>.  「x5t#S256」（X.509 証明書 SHA-256 サムプリント）ヘッダー</span>
<span class="h4">         パラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.8 で定義されている「x5t#S256」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   サムプリントによって参照される証明書が、
   JWE が暗号化された公開鍵を含む点が異なる。
   これにより、JWE を復号するために必要な
   秘密鍵を判断することができる。
   証明書サムプリントは、
   証明書フィンガープリントと呼ばれることもある。

<span class="h4"><a class="selflink" id="section-4.1.11" href="#section-4.1.11">4.1.11</a>.  「typ」（型）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.9 で定義されている「typ」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   型が、この完全な JWE のものである点が異なる。

<span class="h4"><a class="selflink" id="section-4.1.12" href="#section-4.1.12">4.1.12</a>.  「cty」（コンテンツ型）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.10 で定義されている「cty」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   型が、保護されるコンテンツ（平文）のものである点が異なる。

<span class="h4"><a class="selflink" id="section-4.1.13" href="#section-4.1.13">4.1.13</a>.  「crit」（重要）ヘッダーパラメータ</span>

   このパラメータは、[<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] の
   Section 4.1.11 で定義されている「crit」ヘッダーパラメータと
   同じ意味、構文、および処理規則を持つが、
   JWS のヘッダーパラメータではなく、
   JWE のヘッダーパラメータを参照する点が異なる。

<span class="h3"><a class="selflink" id="section-4.2" href="#section-4.2">4.2</a>.  公開ヘッダーパラメータ名</span>

   追加のヘッダーパラメータ名は、
   JWE を使用する者によって定義することができる。
   しかし、衝突を防止するために、
   新しいヘッダーパラメータ名は、
   [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] により確立された
   IANA「JSON Web Signature and Encryption Header Parameters」
   レジストリに登録されるか、
   または公開名、すなわち
   衝突耐性名を含む値であるべきである。
   いずれの場合においても、
   その名前または値の定義者は、
   合理的な配慮を行う必要がある。




<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 14]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-15" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               2015年5月</span>

   名前空間の一部を制御していることを確認するための予防措置。

   新しいヘッダーパラメータは慎重に導入する必要があり、これにより互換性のないJWEが生成される可能性があります。

<span class="h3"><a class="selflink" id="section-4.3" href="#section-4.3">4.3</a>.  プライベートヘッダーパラメータ名</span>

   JWEの生産者と消費者は、プライベート名を使用することに同意する場合があります。これは登録されたヘッダーパラメータ名（<a href="#section-4.1">セクション4.1</a>）
   や公開ヘッダーパラメータ名（<a href="#section-4.2">セクション4.2</a>）ではない名前です。
   公開ヘッダーパラメータ名とは異なり、プライベートヘッダーパラメータ名は衝突の可能性があるため、慎重に使用する必要があります。


<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  JWEsの生成と消費</span>

<span class="h3"><a class="selflink" id="section-5.1" href="#section-5.1">5.1</a>.  メッセージの暗号化</span>

   メッセージ暗号化のプロセスは以下の通りです。ステップ間に依存関係がない場合、ステップの順序は重要ではありません。

   1.   コンテンツ暗号化キー（CEK）値を決定するために使用されるアルゴリズムによって採用されたキー管理モードを決定します。
        （これは、結果として得られるJWEの「alg」（アルゴリズム）ヘッダーパラメータに記録されたアルゴリズムです。）

   2.   キーラッピング、キー暗号化、またはキーラッピングを伴うキー合意が使用される場合、ランダムなCEK値を生成します。
        ランダム値の生成に関する考慮事項については<a href="./rfc4086">RFC</a>
        <a href="./rfc4086">4086</a> [<a href="./rfc4086" title="&quot;Randomness Requirements for Security&quot;">RFC4086</a>]を参照してください。
        CEKの長さは、コンテンツ暗号化アルゴリズムに必要な長さと一致する必要があります。

   3.   直接的なキー合意またはキーラッピングを伴うキー合意が使用される場合、キー合意アルゴリズムを使用して合意されたキーの値を計算します。
        直接的なキー合意が使用される場合、CEKは合意されたキーとします。キーラッピングを伴うキー合意が使用される場合、合意されたキーはCEKをラップするために使用されます。

   4.   キーラッピング、キー暗号化、またはキーラッピングを伴うキー合意が使用される場合、CEKを受信者に暗号化し、その結果をJWE暗号化キーとします。

   5.   直接的なキー合意または直接的な暗号化が使用される場合、JWE暗号化キーは空のオクテットシーケンスとします。

<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 15]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-16" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               2015年5月</span>

   6.   直接暗号化が使用される場合、CEKは共有された対称鍵とします。

   7.   エンコードされたキー値BASE64URL（JWE暗号化キー）を計算します。

   8.   JWE JSONシリアル化が使用される場合、このプロセス（ステップ1～7）を各受信者に対して繰り返します。

   9.   コンテンツ暗号化アルゴリズムに対して正しいサイズのランダムなJWE初期化ベクトルを生成します（アルゴリズムで必要な場合）。
        それ以外の場合、JWE初期化ベクトルは空のオクテットシーケンスとします。

   10.  エンコードされた初期化ベクトル値BASE64URL（JWE初期化ベクトル）を計算します。

   11.  「zip」パラメータが含まれている場合、指定された圧縮アルゴリズムを使用してプレーンテキストを圧縮し、Mを圧縮されたプレーンテキストを表すオクテットシーケンスとします。
        それ以外の場合、Mをプレーンテキストを表すオクテットシーケンスとします。

   12.  必要なヘッダーパラメータのセットを含むJSONオブジェクトを作成し、これらがJOSEヘッダーを構成します。
        JWE保護ヘッダー、JWE共有されていないヘッダー、JWE受信者ごとの非保護ヘッダーの1つ以上です。

   13.  エンコードされた保護されたヘッダー値BASE64URL（UTF8（JWE保護ヘッダー））を計算します。
        JWE保護ヘッダーが存在しない場合（これはJWE JSONシリアル化を使用し、「protected」メンバーが存在しない場合にのみ発生する可能性があります）、
        この値は空の文字列とします。

   14.  追加認証データ暗号化パラメータをASCII（エンコードされた保護されたヘッダー）とします。
        ただし、JWE AAD値が存在する場合（これはJWE JSONシリアル化を使用する場合のみ可能です）、
        代わりに、追加認証データ暗号化パラメータはASCII（エンコードされた保護されたヘッダー || '.' || BASE64URL（JWE AAD））とします。

   15.  MをCEK、JWE初期化ベクトル、および追加認証データ値を使用して、指定されたコンテンツ暗号化アルゴリズムで暗号化し、JWE暗号文値とJWE認証タグ（これは暗号化操作からの認証タグ出力）を作成します。

   16.  エンコードされた暗号文値BASE64URL（JWE暗号文）を計算します。

<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 16]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-17" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               2015年5月</span>

   17.  エンコードされた認証タグ値BASE64URL（JWE認証タグ）を計算します。

   18.  JWE AAD値が存在する場合、エンコードされたAAD値BASE64URL（JWE AAD）を計算します。

   19.  必要なシリアライズされた出力を作成します。この結果のコンパクトシリアル化は文字列BASE64URL（UTF8（JWE保護ヘッダー）） || '.' || BASE64URL（JWE暗号化キー） || '.' ||
        BASE64URL（JWE初期化ベクトル） || '.' || BASE64URL（JWE暗号文） || '.' || BASE64URL（JWE認証タグ）です。
        JWE JSONシリアル化は<a href="#section-7.2">セクション7.2</a>で説明されています。


<span class="h3"><a class="selflink" id="section-5.2" href="#section-5.2">5.2</a>.  Message Decryption</span>

   The message decryption process is the reverse of the encryption
   process.  The order of the steps is not significant in cases where
   there are no dependencies between the inputs and outputs of the
   steps.  If any of these steps fail, the encrypted content cannot be
   validated.

   When there are multiple recipients, it is an application decision
   which of the recipients' encrypted content must successfully validate
   for the JWE to be accepted.  In some cases, encrypted content for all
   recipients must successfully validate or the JWE will be considered
   invalid.  In other cases, only the encrypted content for a single
   recipient needs to be successfully validated.  However, in all cases,
   the encrypted content for at least one recipient MUST successfully
   validate or the JWE MUST be considered invalid.

   1.   Parse the JWE representation to extract the serialized values
        for the components of the JWE.  When using the JWE Compact
        Serialization, these components are the base64url-encoded
        representations of the JWE Protected Header, the JWE Encrypted
        Key, the JWE Initialization Vector, the JWE Ciphertext, and the
        JWE Authentication Tag, and when using the JWE JSON
        Serialization, these components also include the base64url-
        encoded representation of the JWE AAD and the unencoded JWE
        Shared Unprotected Header and JWE Per-Recipient Unprotected
        Header values.  When using the JWE Compact Serialization, the
        JWE Protected Header, the JWE Encrypted Key, the JWE
        Initialization Vector, the JWE Ciphertext, and the JWE
        Authentication Tag are represented as base64url-encoded values
        in that order, with each value being separated from the next by
        a single period ('.') character, resulting in exactly four
        delimiting period characters being used.  The JWE JSON
        Serialization is described in <a href="#section-7.2">Section 7.2</a>.




<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 17]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-18" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   2.   Base64url decode the encoded representations of the JWE
        Protected Header, the JWE Encrypted Key, the JWE Initialization
        Vector, the JWE Ciphertext, the JWE Authentication Tag, and the
        JWE AAD, following the restriction that no line breaks,
        whitespace, or other additional characters have been used.

   3.   Verify that the octet sequence resulting from decoding the
        encoded JWE Protected Header is a UTF-8-encoded representation
        of a completely valid JSON object conforming to <a href="./rfc7159">RFC 7159</a>
        [<a href="./rfc7159" title="&quot;The JavaScript Object Notation (JSON) Data Interchange Format&quot;">RFC7159</a>]; let the JWE Protected Header be this JSON object.

   4.   If using the JWE Compact Serialization, let the JOSE Header be
        the JWE Protected Header.  Otherwise, when using the JWE JSON
        Serialization, let the JOSE Header be the union of the members
        of the JWE Protected Header, the JWE Shared Unprotected Header
        and the corresponding JWE Per-Recipient Unprotected Header, all
        of which must be completely valid JSON objects.  During this
        step, verify that the resulting JOSE Header does not contain
        duplicate Header Parameter names.  When using the JWE JSON
        Serialization, this restriction includes that the same Header
        Parameter name also MUST NOT occur in distinct JSON object
        values that together comprise the JOSE Header.

   5.   Verify that the implementation understands and can process all
        fields that it is required to support, whether required by this
        specification, by the algorithms being used, or by the "crit"
        Header Parameter value, and that the values of those parameters
        are also understood and supported.

   6.   Determine the Key Management Mode employed by the algorithm
        specified by the "alg" (algorithm) Header Parameter.

   7.   Verify that the JWE uses a key known to the recipient.

   8.   When Direct Key Agreement or Key Agreement with Key Wrapping are
        employed, use the key agreement algorithm to compute the value
        of the agreed upon key.  When Direct Key Agreement is employed,
        let the CEK be the agreed upon key.  When Key Agreement with Key
        Wrapping is employed, the agreed upon key will be used to
        decrypt the JWE Encrypted Key.

   9.   When Key Wrapping, Key Encryption, or Key Agreement with Key
        Wrapping are employed, decrypt the JWE Encrypted Key to produce
        the CEK.  The CEK MUST have a length equal to that required for
        the content encryption algorithm.  Note that when there are
        multiple recipients, each recipient will only be able to decrypt
        JWE Encrypted Key values that were encrypted to a key in that
        recipient's possession.  It is therefore normal to only be able



<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 18]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-19" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


        to decrypt one of the per-recipient JWE Encrypted Key values to
        obtain the CEK value.  Also, see <a href="#section-11.5">Section 11.5</a> for security
        considerations on mitigating timing attacks.

   10.  When Direct Key Agreement or Direct Encryption are employed,
        verify that the JWE Encrypted Key value is an empty octet
        sequence.

   11.  When Direct Encryption is employed, let the CEK be the shared
        symmetric key.

   12.  Record whether the CEK could be successfully determined for this
        recipient or not.

   13.  If the JWE JSON Serialization is being used, repeat this process
        (steps 4-12) for each recipient contained in the representation.

   14.  Compute the Encoded Protected Header value BASE64URL(UTF8(JWE
        Protected Header)).  If the JWE Protected Header is not present
        (which can only happen when using the JWE JSON Serialization and
        no "protected" member is present), let this value be the empty
        string.

   15.  Let the Additional Authenticated Data encryption parameter be
        ASCII(Encoded Protected Header).  However, if a JWE AAD value is
        present (which can only be the case when using the JWE JSON
        Serialization), instead let the Additional Authenticated Data
        encryption parameter be ASCII(Encoded Protected Header || '.' ||
        BASE64URL(JWE AAD)).

   16.  Decrypt the JWE Ciphertext using the CEK, the JWE Initialization
        Vector, the Additional Authenticated Data value, and the JWE
        Authentication Tag (which is the Authentication Tag input to the
        calculation) using the specified content encryption algorithm,
        returning the decrypted plaintext and validating the JWE
        Authentication Tag in the manner specified for the algorithm,
        rejecting the input without emitting any decrypted output if the
        JWE Authentication Tag is incorrect.

   17.  If a "zip" parameter was included, uncompress the decrypted
        plaintext using the specified compression algorithm.

   18.  If there was no recipient for which all of the decryption steps
        succeeded, then the JWE MUST be considered invalid.  Otherwise,
        output the plaintext.  In the JWE JSON Serialization case, also
        return a result to the application indicating for which of the
        recipients the decryption succeeded and failed.




<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 19]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-20" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   Finally, note that it is an application decision which algorithms may
   be used in a given context.  Even if a JWE can be successfully
   decrypted, unless the algorithms used in the JWE are acceptable to
   the application, it SHOULD consider the JWE to be invalid.

<span class="h3"><a class="selflink" id="section-5.3" href="#section-5.3">5.3</a>.  String Comparison Rules</span>

   The string comparison rules for this specification are the same as
   those defined in Section 5.3 of [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>].

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Key Identification</span>

   The key identification methods for this specification are the same as
   those defined in Section 6 of [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>], except that the key being
   identified is the public key to which the JWE was encrypted.

<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  Serializations</span>

   JWEs use one of two serializations: the JWE Compact Serialization or
   the JWE JSON Serialization.  Applications using this specification
   need to specify what serialization and serialization features are
   used for that application.  For instance, applications might specify
   that only the JWE JSON Serialization is used, that only JWE JSON
   Serialization support for a single recipient is used, or that support
   for multiple recipients is used.  JWE implementations only need to
   implement the features needed for the applications they are designed
   to support.

<span class="h3"><a class="selflink" id="section-7.1" href="#section-7.1">7.1</a>.  JWE Compact Serialization</span>

   The JWE Compact Serialization represents encrypted content as a
   compact, URL-safe string.  This string is:

      BASE64URL(UTF8(JWE Protected Header)) || '.' ||
      BASE64URL(JWE Encrypted Key) || '.' ||
      BASE64URL(JWE Initialization Vector) || '.' ||
      BASE64URL(JWE Ciphertext) || '.' ||
      BASE64URL(JWE Authentication Tag)

   Only one recipient is supported by the JWE Compact Serialization and
   it provides no syntax to represent JWE Shared Unprotected Header, JWE
   Per-Recipient Unprotected Header, or JWE AAD values.

<span class="h3"><a class="selflink" id="section-7.2" href="#section-7.2">7.2</a>.  JWE JSON Serialization</span>

   The JWE JSON Serialization represents encrypted content as a JSON
   object.  This representation is neither optimized for compactness nor
   URL safe.



<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 20]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-21" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   Two closely related syntaxes are defined for the JWE JSON
   Serialization: a fully general syntax, with which content can be
   encrypted to more than one recipient, and a flattened syntax, which
   is optimized for the single-recipient case.

<span class="h4"><a class="selflink" id="section-7.2.1" href="#section-7.2.1">7.2.1</a>.  General JWE JSON Serialization Syntax</span>

   The following members are defined for use in top-level JSON objects
   used for the fully general JWE JSON Serialization syntax:

   protected
      The "protected" member MUST be present and contain the value
      BASE64URL(UTF8(JWE Protected Header)) when the JWE Protected
      Header value is non-empty; otherwise, it MUST be absent.  These
      Header Parameter values are integrity protected.

   unprotected
      The "unprotected" member MUST be present and contain the value JWE
      Shared Unprotected Header when the JWE Shared Unprotected Header
      value is non-empty; otherwise, it MUST be absent.  This value is
      represented as an unencoded JSON object, rather than as a string.
      These Header Parameter values are not integrity protected.

   iv
      The "iv" member MUST be present and contain the value
      BASE64URL(JWE Initialization Vector) when the JWE Initialization
      Vector value is non-empty; otherwise, it MUST be absent.

   aad
      The "aad" member MUST be present and contain the value
      BASE64URL(JWE AAD)) when the JWE AAD value is non-empty;
      otherwise, it MUST be absent.  A JWE AAD value can be included to
      supply a base64url-encoded value to be integrity protected but not
      encrypted.

   ciphertext
      The "ciphertext" member MUST be present and contain the value
      BASE64URL(JWE Ciphertext).

   tag
      The "tag" member MUST be present and contain the value
      BASE64URL(JWE Authentication Tag) when the JWE Authentication Tag
      value is non-empty; otherwise, it MUST be absent.

   recipients
      The "recipients" member value MUST be an array of JSON objects.
      Each object contains information specific to a single recipient.
      This member MUST be present with exactly one array element per



<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 21]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-22" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


      recipient, even if some or all of the array element values are the
      empty JSON object "{}" (which can happen when all Header Parameter
      values are shared between all recipients and when no encrypted key
      is used, such as when doing Direct Encryption).

   The following members are defined for use in the JSON objects that
   are elements of the "recipients" array:

   header
      The "header" member MUST be present and contain the value JWE Per-
      Recipient Unprotected Header when the JWE Per-Recipient
      Unprotected Header value is non-empty; otherwise, it MUST be
      absent.  This value is represented as an unencoded JSON object,
      rather than as a string.  These Header Parameter values are not
      integrity protected.

   encrypted_key
      The "encrypted_key" member MUST be present and contain the value
      BASE64URL(JWE Encrypted Key) when the JWE Encrypted Key value is
      non-empty; otherwise, it MUST be absent.

   At least one of the "header", "protected", and "unprotected" members
   MUST be present so that "alg" and "enc" Header Parameter values are
   conveyed for each recipient computation.

   Additional members can be present in both the JSON objects defined
   above; if not understood by implementations encountering them, they
   MUST be ignored.

   Some Header Parameters, including the "alg" parameter, can be shared
   among all recipient computations.  Header Parameters in the JWE
   Protected Header and JWE Shared Unprotected Header values are shared
   among all recipients.

   The Header Parameter values used when creating or validating per-
   recipient ciphertext and Authentication Tag values are the union of
   the three sets of Header Parameter values that may be present: (1)
   the JWE Protected Header represented in the "protected" member, (2)
   the JWE Shared Unprotected Header represented in the "unprotected"
   member, and (3) the JWE Per-Recipient Unprotected Header represented
   in the "header" member of the recipient's array element.  The union
   of these sets of Header Parameters comprises the JOSE Header.  The
   Header Parameter names in the three locations MUST be disjoint.

   Each JWE Encrypted Key value is computed using the parameters of the
   corresponding JOSE Header value in the same manner as for the JWE
   Compact Serialization.  This has the desirable property that each JWE
   Encrypted Key value in the "recipients" array is identical to the



<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 22]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-23" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   value that would have been computed for the same parameter in the JWE
   Compact Serialization.  Likewise, the JWE Ciphertext and JWE
   Authentication Tag values match those produced for the JWE Compact
   Serialization, provided that the JWE Protected Header value (which
   represents the integrity-protected Header Parameter values) matches
   that used in the JWE Compact Serialization.

   All recipients use the same JWE Protected Header, JWE Initialization
   Vector, JWE Ciphertext, and JWE Authentication Tag values, when
   present, resulting in potentially significant space savings if the
   message is large.  Therefore, all Header Parameters that specify the
   treatment of the plaintext value MUST be the same for all recipients.
   This primarily means that the "enc" (encryption algorithm) Header
   Parameter value in the JOSE Header for each recipient and any
   parameters of that algorithm MUST be the same.

   In summary, the syntax of a JWE using the general JWE JSON
   Serialization is as follows:

     {
      "protected":"&lt;integrity-protected shared header contents&gt;",
      "unprotected":&lt;non-integrity-protected shared header contents&gt;,
      "recipients":[
       {"header":&lt;per-recipient unprotected header 1 contents&gt;,
        "encrypted_key":"&lt;encrypted key 1 contents&gt;"},
       ...
       {"header":&lt;per-recipient unprotected header N contents&gt;,
        "encrypted_key":"&lt;encrypted key N contents&gt;"}],
      "aad":"&lt;additional authenticated data contents&gt;",
      "iv":"&lt;initialization vector contents&gt;",
      "ciphertext":"&lt;ciphertext contents&gt;",
      "tag":"&lt;authentication tag contents&gt;"
     }

   See <a href="#appendix-A.4">Appendix A.4</a> for an example JWE using the general JWE JSON
   Serialization syntax.

<span class="h4"><a class="selflink" id="section-7.2.2" href="#section-7.2.2">7.2.2</a>.  Flattened JWE JSON Serialization Syntax</span>

   The flattened JWE JSON Serialization syntax is based upon the general
   syntax, but flattens it, optimizing it for the single-recipient case.
   It flattens it by removing the "recipients" member and instead
   placing those members defined for use in the "recipients" array (the
   "header" and "encrypted_key" members) in the top-level JSON object
   (at the same level as the "ciphertext" member).






<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 23]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-24" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   The "recipients" member MUST NOT be present when using this syntax.
   Other than this syntax difference, JWE JSON Serialization objects
   using the flattened syntax are processed identically to those using
   the general syntax.

   In summary, the syntax of a JWE using the flattened JWE JSON
   Serialization is as follows:

     {
      "protected":"&lt;integrity-protected header contents&gt;",
      "unprotected":&lt;non-integrity-protected header contents&gt;,
      "header":&lt;more non-integrity-protected header contents&gt;,
      "encrypted_key":"&lt;encrypted key contents&gt;",
      "aad":"&lt;additional authenticated data contents&gt;",
      "iv":"&lt;initialization vector contents&gt;",
      "ciphertext":"&lt;ciphertext contents&gt;",
      "tag":"&lt;authentication tag contents&gt;"
     }

   Note that when using the flattened syntax, just as when using the
   general syntax, any unprotected Header Parameter values can reside in
   either the "unprotected" member or the "header" member, or in both.

   See <a href="#appendix-A.5">Appendix A.5</a> for an example JWE using the flattened JWE JSON
   Serialization syntax.

<span class="h2"><a class="selflink" id="section-8" href="#section-8">8</a>.  TLS Requirements</span>

   The Transport Layer Security (TLS) requirements for this
   specification are the same as those defined in Section 8 of [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>].

<span class="h2"><a class="selflink" id="section-9" href="#section-9">9</a>.  Distinguishing between JWS and JWE Objects</span>

   There are several ways of distinguishing whether an object is a JWS
   or JWE.  All these methods will yield the same result for all legal
   input values; they may yield different results for malformed inputs.

   o  If the object is using the JWS Compact Serialization or the JWE
      Compact Serialization, the number of base64url-encoded segments
      separated by period ('.') characters differs for JWSs and JWEs.
      JWSs have three segments separated by two period ('.') characters.
      JWEs have five segments separated by four period ('.') characters.

   o  If the object is using the JWS JSON Serialization or the JWE JSON
      Serialization, the members used will be different.  JWSs have a
      "payload" member and JWEs do not.  JWEs have a "ciphertext" member
      and JWSs do not.




<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 24]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-25" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   o  The JOSE Header for a JWS can be distinguished from the JOSE
      Header for a JWE by examining the "alg" (algorithm) Header
      Parameter value.  If the value represents a digital signature or
      MAC algorithm, or is the value "none", it is for a JWS; if it
      represents a Key Encryption, Key Wrapping, Direct Key Agreement,
      Key Agreement with Key Wrapping, or Direct Encryption algorithm,
      it is for a JWE.  (Extracting the "alg" value to examine is
      straightforward when using the JWS Compact Serialization or the
      JWE Compact Serialization and may be more difficult when using the
      JWS JSON Serialization or the JWE JSON Serialization.)

   o  The JOSE Header for a JWS can also be distinguished from the JOSE
      Header for a JWE by determining whether an "enc" (encryption
      algorithm) member exists.  If the "enc" member exists, it is a
      JWE; otherwise, it is a JWS.

<span class="h2"><a class="selflink" id="section-10" href="#section-10">10</a>.  IANA Considerations</span>

<span class="h3"><a class="selflink" id="section-10.1" href="#section-10.1">10.1</a>.  JSON Web Signature and Encryption Header Parameters Registration</span>

   This section registers the Header Parameter names defined in
   <a href="#section-4.1">Section 4.1</a> in the IANA "JSON Web Signature and Encryption Header
   Parameters" registry established by [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>].

<span class="h4"><a class="selflink" id="section-10.1.1" href="#section-10.1.1">10.1.1</a>.  Registry Contents</span>

   o  Header Parameter Name: "alg"
   o  Header Parameter Description: Algorithm
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.1">Section&nbsp;4.1.1 of RFC 7516</a>

   o  Header Parameter Name: "enc"
   o  Header Parameter Description: Encryption Algorithm
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.2">Section&nbsp;4.1.2 of RFC 7516</a>

   o  Header Parameter Name: "zip"
   o  Header Parameter Description: Compression Algorithm
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.3">Section&nbsp;4.1.3 of RFC 7516</a>








<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 25]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-26" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   o  Header Parameter Name: "jku"
   o  Header Parameter Description: JWK Set URL
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.4">Section&nbsp;4.1.4 of RFC 7516</a>

   o  Header Parameter Name: "jwk"
   o  Header Parameter Description: JSON Web Key
   o  Header Parameter Usage Location(s): JWE

   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.5">Section&nbsp;4.1.5 of RFC 7516</a>

   o  Header Parameter Name: "kid"
   o  Header Parameter Description: Key ID
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.6">Section&nbsp;4.1.6 of RFC 7516</a>

   o  Header Parameter Name: "x5u"
   o  Header Parameter Description: X.509 URL
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.7">Section&nbsp;4.1.7 of RFC 7516</a>

   o  Header Parameter Name: "x5c"
   o  Header Parameter Description: X.509 Certificate Chain
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.8">Section&nbsp;4.1.8 of RFC 7516</a>

   o  Header Parameter Name: "x5t"
   o  Header Parameter Description: X.509 Certificate SHA-1 Thumbprint
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.9">Section&nbsp;4.1.9 of RFC 7516</a>

   o  Header Parameter Name: "x5t#S256"
   o  Header Parameter Description: X.509 Certificate SHA-256 Thumbprint
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.10">Section&nbsp;4.1.10 of RFC 7516</a>

   o  Header Parameter Name: "typ"
   o  Header Parameter Description: Type
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.11">Section&nbsp;4.1.11 of RFC 7516</a>



<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 26]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-27" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   o  Header Parameter Name: "cty"
   o  Header Parameter Description: Content Type
   o  Header Parameter Usage Location(s): JWE
   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.12">Section&nbsp;4.1.12 of RFC 7516</a>

   o  Header Parameter Name: "crit"
   o  Header Parameter Description: Critical
   o  Header Parameter Usage Location(s): JWE

   o  Change Controller: IESG
   o  Specification Document(s): <a href="./rfc7516#section-4.1.13">Section&nbsp;4.1.13 of RFC 7516</a>

<span class="h2"><a class="selflink" id="section-11" href="#section-11">11</a>.  Security Considerations</span>

   All of the security issues that are pertinent to any cryptographic
   application must be addressed by JWS/JWE/JWK agents.  Among these
   issues are protecting the user's asymmetric private and symmetric
   secret keys and employing countermeasures to various attacks.

   All the security considerations in the JWS specification also apply
   to this specification.  Likewise, all the security considerations in
   XML Encryption 1.1 [<a href="#ref-W3C.REC-xmlenc-core1-20130411">W3C.REC-xmlenc-core1-20130411</a>] also apply, other
   than those that are XML specific.

<span class="h3"><a class="selflink" id="section-11.1" href="#section-11.1">11.1</a>.  Key Entropy and Random Values</span>

   See Section 10.1 of [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] for security considerations on key entropy
   and random values.  In addition to the uses of random values listed
   there, note that random values are also used for Content Encryption
   Keys (CEKs) and Initialization Vectors (IVs) when performing
   encryption.

<span class="h3"><a class="selflink" id="section-11.2" href="#section-11.2">11.2</a>.  Key Protection</span>

   See Section 10.2 of [<a href="#ref-JWS" title="&quot;JSON Web Signature (JWS)&quot;">JWS</a>] for security considerations on key
   protection.  In addition to the keys listed there that must be
   protected, implementations performing encryption must protect the key
   encryption key and the Content Encryption Key.  Compromise of the key
   encryption key may result in the disclosure of all contents protected
   with that key.  Similarly, compromise of the Content Encryption Key
   may result in disclosure of the associated encrypted content.









<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 27]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-28" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h3"><a class="selflink" id="section-11.3" href="#section-11.3">11.3</a>.  Using Matching Algorithm Strengths</span>

   Algorithms of matching strengths should be used together whenever
   possible.  For instance, when AES Key Wrap is used with a given key
   size, using the same key size is recommended when AES GCM is also
   used.  If the key encryption and content encryption algorithms are
   different, the effective security is determined by the weaker of the
   two algorithms.

   Also, see <a href="./rfc3766">RFC 3766</a> [<a href="./rfc3766" title="&quot;Determining Strengths For Public Keys Used For Exchanging Symmetric Keys&quot;">RFC3766</a>] for information on determining strengths
   for public keys used for exchanging symmetric keys.

<span class="h3"><a class="selflink" id="section-11.4" href="#section-11.4">11.4</a>.  Adaptive Chosen-Ciphertext Attacks</span>

   When decrypting, particular care must be taken not to allow the JWE
   recipient to be used as an oracle for decrypting messages.  <a href="./rfc3218">RFC 3218</a>
   [<a href="./rfc3218" title="&quot;Preventing the Million Message Attack on Cryptographic Message Syntax&quot;">RFC3218</a>] should be consulted for specific countermeasures to attacks
   on RSAES-PKCS1-v1_5.  An attacker might modify the contents of the
   "alg" Header Parameter from "RSA-OAEP" to "RSA1_5" in order to
   generate a formatting error that can be detected and used to recover
   the CEK even if RSAES-OAEP was used to encrypt the CEK.  It is
   therefore particularly important to report all formatting errors to
   the CEK, Additional Authenticated Data, or ciphertext as a single
   error when the encrypted content is rejected.

   Additionally, this type of attack can be prevented by restricting the
   use of a key to a limited set of algorithms -- usually one.  This
   means, for instance, that if the key is marked as being for
   "RSA-OAEP" only, any attempt to decrypt a message using the "RSA1_5"
   algorithm with that key should fail immediately due to invalid use of
   the key.

<span class="h3"><a class="selflink" id="section-11.5" href="#section-11.5">11.5</a>.  Timing Attacks</span>

   To mitigate the attacks described in <a href="./rfc3218">RFC 3218</a> [<a href="./rfc3218" title="&quot;Preventing the Million Message Attack on Cryptographic Message Syntax&quot;">RFC3218</a>], the
   recipient MUST NOT distinguish between format, padding, and length
   errors of encrypted keys.  It is strongly recommended, in the event
   of receiving an improperly formatted key, that the recipient
   substitute a randomly generated CEK and proceed to the next step, to
   mitigate timing attacks.











<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 28]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-29" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h2"><a class="selflink" id="section-12" href="#section-12">12</a>.  References</span>

<span class="h3"><a class="selflink" id="section-12.1" href="#section-12.1">12.1</a>.  Normative References</span>

   [<a id="ref-JWA">JWA</a>]      Jones, M., "JSON Web Algorithms (JWA)", <a href="./rfc7518">RFC 7518</a>,
              DOI 10.17487/RFC7518, May 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7518">http://www.rfc-editor.org/info/rfc7518</a>&gt;.

   [<a id="ref-JWK">JWK</a>]      Jones, M., "JSON Web Key (JWK)", <a href="./rfc7517">RFC 7517</a>,
              DOI 10.17487/RFC7517, May 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7517">http://www.rfc-editor.org/info/rfc7517</a>&gt;.

   [<a id="ref-JWS">JWS</a>]      Jones, M., Bradley, J., and N. Sakimura, "JSON Web
              Signature (JWS)", <a href="./rfc7515">RFC 7515</a>, DOI 10.17487/RFC7515, May
              2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7515">http://www.rfc-editor.org/info/rfc7515</a>&gt;.

   [<a id="ref-RFC1951">RFC1951</a>]  Deutsch, P., "DEFLATE Compressed Data Format Specification
              version 1.3", <a href="./rfc1951">RFC 1951</a>, DOI 10.17487/RFC1951, May 1996,
              &lt;<a href="https://www.rfc-editor.org/info/rfc1951">http://www.rfc-editor.org/info/rfc1951</a>&gt;.

   [<a id="ref-RFC20">RFC20</a>]    Cerf, V., "ASCII format for Network Interchange", STD 80,
              <a href="./rfc20">RFC 20</a>, DOI 10.17487/RFC0020, October 1969,
              &lt;<a href="https://www.rfc-editor.org/info/rfc20">http://www.rfc-editor.org/info/rfc20</a>&gt;.

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC3629">RFC3629</a>]  Yergeau, F., "UTF-8, a transformation format of ISO
              10646", STD 63, <a href="./rfc3629">RFC 3629</a>, DOI 10.17487/RFC3629, November
              2003, &lt;<a href="https://www.rfc-editor.org/info/rfc3629">http://www.rfc-editor.org/info/rfc3629</a>&gt;.

   [<a id="ref-RFC4949">RFC4949</a>]  Shirey, R., "Internet Security Glossary, Version 2",
              FYI 36, <a href="./rfc4949">RFC 4949</a>, DOI 10.17487/RFC4949, August 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4949">http://www.rfc-editor.org/info/rfc4949</a>&gt;.

   [<a id="ref-RFC5280">RFC5280</a>]  Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
              Housley, R., and W. Polk, "Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List
              (CRL) Profile", <a href="./rfc5280">RFC 5280</a>, DOI 10.17487/RFC5280, May 2008,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5280">http://www.rfc-editor.org/info/rfc5280</a>&gt;.

   [<a id="ref-RFC7159">RFC7159</a>]  Bray, T., Ed., "The JavaScript Object Notation (JSON) Data
              Interchange Format", <a href="./rfc7159">RFC 7159</a>, DOI 10.17487/RFC7159, March
              2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7159">http://www.rfc-editor.org/info/rfc7159</a>&gt;.





<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 29]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-30" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   [<a id="ref-UNICODE">UNICODE</a>]  The Unicode Consortium, "The Unicode Standard",
              &lt;<a href="http://www.unicode.org/versions/latest/">http://www.unicode.org/versions/latest/</a>&gt;.

<span class="h3"><a class="selflink" id="section-12.2" href="#section-12.2">12.2</a>.  Informative References</span>

   [<a id="ref-AES">AES</a>]      National Institute of Standards and Technology (NIST),
              "Advanced Encryption Standard (AES)", FIPS PUB 197,
              November 2001, &lt;<a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf">http://csrc.nist.gov/publications/</a>
              <a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf">fips/fips197/fips-197.pdf</a>&gt;.

   [<a id="ref-JSE">JSE</a>]      Bradley, J. and N. Sakimura (editor), "JSON Simple
              Encryption", September 2010,
              &lt;<a href="http://jsonenc.info/enc/1.0/">http://jsonenc.info/enc/1.0/</a>&gt;.

   [<a id="ref-JSMS">JSMS</a>]     Rescorla, E. and J. Hildebrand, "JavaScript Message
              Security Format", Work in Progress,
              <a href="./draft-rescorla-jsms-00">draft-rescorla-jsms-00</a>, March 2011.

   [<a id="ref-NIST.800-38D">NIST.800-38D</a>]
              National Institute of Standards and Technology (NIST),
              "Recommendation for Block Cipher Modes of Operation:
              Galois/Counter Mode (GCM) and GMAC", NIST PUB 800-38D,
              November 2007, &lt;<a href="http://csrc.nist.gov/publications/nistpubs/800-38D/SP-800-38D.pdf">http://csrc.nist.gov/publications/</a>
              <a href="http://csrc.nist.gov/publications/nistpubs/800-38D/SP-800-38D.pdf">nistpubs/800-38D/SP-800-38D.pdf</a>&gt;.

   [<a id="ref-RFC3218">RFC3218</a>]  Rescorla, E., "Preventing the Million Message Attack on
              Cryptographic Message Syntax", <a href="./rfc3218">RFC 3218</a>,
              DOI 10.17487/RFC3218, January 2002,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3218">http://www.rfc-editor.org/info/rfc3218</a>&gt;.

   [<a id="ref-RFC3447">RFC3447</a>]  Jonsson, J. and B. Kaliski, "Public-Key Cryptography
              Standards (PKCS) #1: RSA Cryptography Specifications
              Version 2.1", <a href="./rfc3447">RFC 3447</a>, DOI 10.17487/RFC3447, February
              2003, &lt;<a href="https://www.rfc-editor.org/info/rfc3447">http://www.rfc-editor.org/info/rfc3447</a>&gt;.

   [<a id="ref-RFC3766">RFC3766</a>]  Orman, H. and P. Hoffman, "Determining Strengths For
              Public Keys Used For Exchanging Symmetric Keys", <a href="https://www.rfc-editor.org/bcp/bcp86">BCP 86</a>,
              <a href="./rfc3766">RFC 3766</a>, DOI 10.17487/RFC3766, April 2004,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3766">http://www.rfc-editor.org/info/rfc3766</a>&gt;.

   [<a id="ref-RFC4086">RFC4086</a>]  Eastlake 3rd, D., Schiller, J., and S. Crocker,
              "Randomness Requirements for Security", <a href="https://www.rfc-editor.org/bcp/bcp106">BCP 106</a>, <a href="./rfc4086">RFC 4086</a>,
              DOI 10.17487/RFC4086, June 2005,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4086">http://www.rfc-editor.org/info/rfc4086</a>&gt;.







<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 30]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-31" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   [<a id="ref-RFC5652">RFC5652</a>]  Housley, R., "Cryptographic Message Syntax (CMS)", STD 70,
              <a href="./rfc5652">RFC 5652</a>, DOI 10.17487/RFC5652, September 2009,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5652">http://www.rfc-editor.org/info/rfc5652</a>&gt;.

   [<a id="ref-W3C.REC-xmlenc-core1-20130411">W3C.REC-xmlenc-core1-20130411</a>]
              Eastlake, D., Reagle, J., Hirsch, F., and T. Roessler,
              "XML Encryption Syntax and Processing Version 1.1", World
              Wide Web Consortium Recommendation
              REC-xmlenc-core1-20130411, April 2013,
              &lt;<a href="http://www.w3.org/TR/2013/REC-xmlenc-core1-20130411/">http://www.w3.org/TR/2013/REC-xmlenc-core1-20130411/</a>&gt;.









































<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 31]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-32" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h2"><a class="selflink" id="appendix-A" href="#appendix-A">Appendix A</a>.  JWE Examples</span>

   This section provides examples of JWE computations.

<span class="h3"><a class="selflink" id="appendix-A.1" href="#appendix-A.1">A.1</a>.  Example JWE using RSAES-OAEP and AES GCM</span>

   This example encrypts the plaintext "The true sign of intelligence is
   not knowledge but imagination." to the recipient using RSAES-OAEP for
   key encryption and AES GCM for content encryption.  The
   representation of this plaintext (using JSON array notation) is:

   [84, 104, 101, 32, 116, 114, 117, 101, 32, 115, 105, 103, 110, 32,
   111, 102, 32, 105, 110, 116, 101, 108, 108, 105, 103, 101, 110, 99,
   101, 32, 105, 115, 32, 110, 111, 116, 32, 107, 110, 111, 119, 108,
   101, 100, 103, 101, 32, 98, 117, 116, 32, 105, 109, 97, 103, 105,
   110, 97, 116, 105, 111, 110, 46]

<span class="h4"><a class="selflink" id="appendix-A.1.1" href="#appendix-A.1.1">A.1.1</a>.  JOSE Header</span>

   The following example JWE Protected Header declares that:

   o  The Content Encryption Key is encrypted to the recipient using the
      RSAES-OAEP algorithm to produce the JWE Encrypted Key.
   o  Authenticated encryption is performed on the plaintext using the
      AES GCM algorithm with a 256-bit key to produce the ciphertext and
      the Authentication Tag.

     {"alg":"RSA-OAEP","enc":"A256GCM"}

   Encoding this JWE Protected Header as BASE64URL(UTF8(JWE Protected
   Header)) gives this value:

     eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ

<span class="h4"><a class="selflink" id="appendix-A.1.2" href="#appendix-A.1.2">A.1.2</a>.  Content Encryption Key (CEK)</span>

   Generate a 256-bit random CEK.  In this example, the value (using
   JSON array notation) is:

   [177, 161, 244, 128, 84, 143, 225, 115, 63, 180, 3, 255, 107, 154,
   212, 246, 138, 7, 110, 91, 112, 46, 34, 105, 47, 130, 203, 46, 122,
   234, 64, 252]









<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 32]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-33" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="appendix-A.1.3" href="#appendix-A.1.3">A.1.3</a>.  Key Encryption</span>

   Encrypt the CEK with the recipient's public key using the RSAES-OAEP
   algorithm to produce the JWE Encrypted Key.  This example uses the
   RSA key represented in JSON Web Key [<a href="#ref-JWK" title="&quot;JSON Web Key (JWK)&quot;">JWK</a>] format below (with line
   breaks within values for display purposes only):

     {"kty":"RSA",
      "n":"oahUIoWw0K0usKNuOR6H4wkf4oBUXHTxRvgb48E-BVvxkeDNjbC4he8rUW
           cJoZmds2h7M70imEVhRU5djINXtqllXI4DFqcI1DgjT9LewND8MW2Krf3S
           psk_ZkoFnilakGygTwpZ3uesH-PFABNIUYpOiN15dsQRkgr0vEhxN92i2a
           sbOenSZeyaxziK72UwxrrKoExv6kc5twXTq4h-QChLOln0_mtUZwfsRaMS
           tPs6mS6XrgxnxbWhojf663tuEQueGC-FCMfra36C9knDFGzKsNa7LZK2dj
           YgyD3JR_MB_4NUJW_TqOQtwHYbxevoJArm-L5StowjzGy-_bq6Gw",
      "e":"AQAB",
      "d":"kLdtIj6GbDks_ApCSTYQtelcNttlKiOyPzMrXHeI-yk1F7-kpDxY4-WY5N
           WV5KntaEeXS1j82E375xxhWMHXyvjYecPT9fpwR_M9gV8n9Hrh2anTpTD9
           3Dt62ypW3yDsJzBnTnrYu1iwWRgBKrEYY46qAZIrA2xAwnm2X7uGR1hghk
           qDp0Vqj3kbSCz1XyfCs6_LehBwtxHIyh8Ripy40p24moOAbgxVw3rxT_vl
           t3UVe4WO3JkJOzlpUf-KTVI2Ptgm-dARxTEtE-id-4OJr0h-K-VFs3VSnd
           VTIznSxfyrj8ILL6MG_Uv8YAu7VILSB3lOW085-4qE3DzgrTjgyQ",
      "p":"1r52Xk46c-LsfB5P442p7atdPUrxQSy4mti_tZI3Mgf2EuFVbUoDBvaRQ-
           SWxkbkmoEzL7JXroSBjSrK3YIQgYdMgyAEPTPjXv_hI2_1eTSPVZfzL0lf
           fNn03IXqWF5MDFuoUYE0hzb2vhrlN_rKrbfDIwUbTrjjgieRbwC6Cl0",
      "q":"wLb35x7hmQWZsWJmB_vle87ihgZ19S8lBEROLIsZG4ayZVe9Hi9gDVCOBm
           UDdaDYVTSNx_8Fyw1YYa9XGrGnDew00J28cRUoeBB_jKI1oma0Orv1T9aX
           IWxKwd4gvxFImOWr3QRL9KEBRzk2RatUBnmDZJTIAfwTs0g68UZHvtc",
      "dp":"ZK-YwE7diUh0qR1tR7w8WHtolDx3MZ_OTowiFvgfeQ3SiresXjm9gZ5KL
           hMXvo-uz-KUJWDxS5pFQ_M0evdo1dKiRTjVw_x4NyqyXPM5nULPkcpU827
           rnpZzAJKpdhWAgqrXGKAECQH0Xt4taznjnd_zVpAmZZq60WPMBMfKcuE",
      "dq":"Dq0gfgJ1DdFGXiLvQEZnuKEN0UUmsJBxkjydc3j4ZYdBiMRAy86x0vHCj
           ywcMlYYg4yoC4YZa9hNVcsjqA3FeiL19rk8g6Qn29Tt0cj8qqyFpz9vNDB
           UfCAiJVeESOjJDZPYHdHY8v1b-o-Z2X5tvLx-TCekf7oxyeKDUqKWjis",
      "qi":"VIMpMYbPf47dT1w_zDUXfPimsSegnMOA1zTaX7aGk_8urY6R8-ZW1FxU7
           AlWAyLWybqq6t16VFd7hQd0y6flUK4SlOydB61gwanOsXGOAOv82cHq0E3
           eL4HrtZkUuKvnPrMnsUUFlfUdybVzxyjz9JF_XyaY14ardLSjf4L_FNY"
     }














<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 33]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-34" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   The resulting JWE Encrypted Key value is:

   [56, 163, 154, 192, 58, 53, 222, 4, 105, 218, 136, 218, 29, 94, 203,
   22, 150, 92, 129, 94, 211, 232, 53, 89, 41, 60, 138, 56, 196, 216,
   82, 98, 168, 76, 37, 73, 70, 7, 36, 8, 191, 100, 136, 196, 244, 220,
   145, 158, 138, 155, 4, 117, 141, 230, 199, 247, 173, 45, 182, 214,
   74, 177, 107, 211, 153, 11, 205, 196, 171, 226, 162, 128, 171, 182,
   13, 237, 239, 99, 193, 4, 91, 219, 121, 223, 107, 167, 61, 119, 228,
   173, 156, 137, 134, 200, 80, 219, 74, 253, 56, 185, 91, 177, 34, 158,
   89, 154, 205, 96, 55, 18, 138, 43, 96, 218, 215, 128, 124, 75, 138,
   243, 85, 25, 109, 117, 140, 26, 155, 249, 67, 167, 149, 231, 100, 6,
   41, 65, 214, 251, 232, 87, 72, 40, 182, 149, 154, 168, 31, 193, 126,
   215, 89, 28, 111, 219, 125, 182, 139, 235, 195, 197, 23, 234, 55, 58,
   63, 180, 68, 202, 206, 149, 75, 205, 248, 176, 67, 39, 178, 60, 98,
   193, 32, 238, 122, 96, 158, 222, 57, 183, 111, 210, 55, 188, 215,
   206, 180, 166, 150, 166, 106, 250, 55, 229, 72, 40, 69, 214, 216,
   104, 23, 40, 135, 212, 28, 127, 41, 80, 175, 174, 168, 115, 171, 197,
   89, 116, 92, 103, 246, 83, 216, 182, 176, 84, 37, 147, 35, 45, 219,
   172, 99, 226, 233, 73, 37, 124, 42, 72, 49, 242, 35, 127, 184, 134,
   117, 114, 135, 206]

   Encoding this JWE Encrypted Key as BASE64URL(JWE Encrypted Key) gives
   this value (with line breaks for display purposes only):

     OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
     ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
     Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
     mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
     1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
     6UklfCpIMfIjf7iGdXKHzg

<span class="h4"><a class="selflink" id="appendix-A.1.4" href="#appendix-A.1.4">A.1.4</a>.  Initialization Vector</span>

   Generate a random 96-bit JWE Initialization Vector.  In this example,
   the value is:

   [227, 197, 117, 252, 2, 219, 233, 68, 180, 225, 77, 219]

   Encoding this JWE Initialization Vector as BASE64URL(JWE
   Initialization Vector) gives this value:

     48V1_ALb6US04U3b









<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 34]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-35" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="appendix-A.1.5" href="#appendix-A.1.5">A.1.5</a>.  Additional Authenticated Data</span>

   Let the Additional Authenticated Data encryption parameter be
   ASCII(BASE64URL(UTF8(JWE Protected Header))).  This value is:

   [101, 121, 74, 104, 98, 71, 99, 105, 79, 105, 74, 83, 85, 48, 69,
   116, 84, 48, 70, 70, 85, 67, 73, 115, 73, 109, 86, 117, 89, 121, 73,
   54, 73, 107, 69, 121, 78, 84, 90, 72, 81, 48, 48, 105, 102, 81]

<span class="h4"><a class="selflink" id="appendix-A.1.6" href="#appendix-A.1.6">A.1.6</a>.  Content Encryption</span>

   Perform authenticated encryption on the plaintext with the AES GCM
   algorithm using the CEK as the encryption key, the JWE Initialization
   Vector, and the Additional Authenticated Data value above, requesting
   a 128-bit Authentication Tag output.  The resulting ciphertext is:

   [229, 236, 166, 241, 53, 191, 115, 196, 174, 43, 73, 109, 39, 122,
   233, 96, 140, 206, 120, 52, 51, 237, 48, 11, 190, 219, 186, 80, 111,
   104, 50, 142, 47, 167, 59, 61, 181, 127, 196, 21, 40, 82, 242, 32,
   123, 143, 168, 226, 73, 216, 176, 144, 138, 247, 106, 60, 16, 205,
   160, 109, 64, 63, 192]

   The resulting Authentication Tag value is:

   [92, 80, 104, 49, 133, 25, 161, 215, 173, 101, 219, 211, 136, 91,
   210, 145]

   Encoding this JWE Ciphertext as BASE64URL(JWE Ciphertext) gives this
   value (with line breaks for display purposes only):

     5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
     SdiwkIr3ajwQzaBtQD_A

   Encoding this JWE Authentication Tag as BASE64URL(JWE Authentication
   Tag) gives this value:

     XFBoMYUZodetZdvTiFvSkQ














<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 35]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-36" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="appendix-A.1.7" href="#appendix-A.1.7">A.1.7</a>.  Complete Representation</span>

   Assemble the final representation: The Compact Serialization of this
   result is the string BASE64URL(UTF8(JWE Protected Header)) || '.' ||
   BASE64URL(JWE Encrypted Key) || '.' || BASE64URL(JWE Initialization
   Vector) || '.' || BASE64URL(JWE Ciphertext) || '.' || BASE64URL(JWE
   Authentication Tag).

   The final result in this example (with line breaks for display
   purposes only) is:

     eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.
     OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
     ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
     Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
     mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
     1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
     6UklfCpIMfIjf7iGdXKHzg.
     48V1_ALb6US04U3b.
     5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
     SdiwkIr3ajwQzaBtQD_A.
     XFBoMYUZodetZdvTiFvSkQ

<span class="h4"><a class="selflink" id="appendix-A.1.8" href="#appendix-A.1.8">A.1.8</a>.  Validation</span>

   This example illustrates the process of creating a JWE with
   RSAES-OAEP for key encryption and AES GCM for content encryption.
   These results can be used to validate JWE decryption implementations
   for these algorithms.  Note that since the RSAES-OAEP computation
   includes random values, the encryption results above will not be
   completely reproducible.  However, since the AES GCM computation is
   deterministic, the JWE Encrypted Ciphertext values will be the same
   for all encryptions performed using these inputs.

<span class="h3"><a class="selflink" id="appendix-A.2" href="#appendix-A.2">A.2</a>.  Example JWE using RSAES-PKCS1-v1_5 and AES_128_CBC_HMAC_SHA_256</span>

   This example encrypts the plaintext "Live long and prosper." to the
   recipient using RSAES-PKCS1-v1_5 for key encryption and
   AES_128_CBC_HMAC_SHA_256 for content encryption.  The representation
   of this plaintext (using JSON array notation) is:

   [76, 105, 118, 101, 32, 108, 111, 110, 103, 32, 97, 110, 100, 32,
   112, 114, 111, 115, 112, 101, 114, 46]








<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 36]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-37" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="appendix-A.2.1" href="#appendix-A.2.1">A.2.1</a>.  JOSE Header</span>

   The following example JWE Protected Header declares that:

   o  The Content Encryption Key is encrypted to the recipient using the
      RSAES-PKCS1-v1_5 algorithm to produce the JWE Encrypted Key.
   o  Authenticated encryption is performed on the plaintext using the
      AES_128_CBC_HMAC_SHA_256 algorithm to produce the ciphertext and
      the Authentication Tag.

     {"alg":"RSA1_5","enc":"A128CBC-HS256"}

   Encoding this JWE Protected Header as BASE64URL(UTF8(JWE Protected
   Header)) gives this value:

     eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0

<span class="h4"><a class="selflink" id="appendix-A.2.2" href="#appendix-A.2.2">A.2.2</a>.  Content Encryption Key (CEK)</span>

   Generate a 256-bit random CEK.  In this example, the key value is:

   [4, 211, 31, 197, 84, 157, 252, 254, 11, 100, 157, 250, 63, 170, 106,
   206, 107, 124, 212, 45, 111, 107, 9, 219, 200, 177, 0, 240, 143, 156,
   44, 207]



























<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 37]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-38" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="appendix-A.2.3" href="#appendix-A.2.3">A.2.3</a>.  Key Encryption</span>

   Encrypt the CEK with the recipient's public key using the
   RSAES-PKCS1-v1_5 algorithm to produce the JWE Encrypted Key.  This
   example uses the RSA key represented in JSON Web Key [<a href="#ref-JWK" title="&quot;JSON Web Key (JWK)&quot;">JWK</a>] format
   below (with line breaks within values for display purposes only):

     {"kty":"RSA",
      "n":"sXchDaQebHnPiGvyDOAT4saGEUetSyo9MKLOoWFsueri23bOdgWp4Dy1Wl
           UzewbgBHod5pcM9H95GQRV3JDXboIRROSBigeC5yjU1hGzHHyXss8UDpre
           cbAYxknTcQkhslANGRUZmdTOQ5qTRsLAt6BTYuyvVRdhS8exSZEy_c4gs_
           7svlJJQ4H9_NxsiIoLwAEk7-Q3UXERGYw_75IDrGA84-lA_-Ct4eTlXHBI
           Y2EaV7t7LjJaynVJCpkv4LKjTTAumiGUIuQhrNhZLuF_RJLqHpM2kgWFLU
           7-VTdL1VbC2tejvcI2BlMkEpk1BzBZI0KQB0GaDWFLN-aEAw3vRw",
      "e":"AQAB",
      "d":"VFCWOqXr8nvZNyaaJLXdnNPXZKRaWCjkU5Q2egQQpTBMwhprMzWzpR8Sxq
           1OPThh_J6MUD8Z35wky9b8eEO0pwNS8xlh1lOFRRBoNqDIKVOku0aZb-ry
           nq8cxjDTLZQ6Fz7jSjR1Klop-YKaUHc9GsEofQqYruPhzSA-QgajZGPbE_
           0ZaVDJHfyd7UUBUKunFMScbflYAAOYJqVIVwaYR5zWEEceUjNnTNo_CVSj
           -VvXLO5VZfCUAVLgW4dpf1SrtZjSt34YLsRarSb127reG_DUwg9Ch-Kyvj
           T1SkHgUWRVGcyly7uvVGRSDwsXypdrNinPA4jlhoNdizK2zF2CWQ",
      "p":"9gY2w6I6S6L0juEKsbeDAwpd9WMfgqFoeA9vEyEUuk4kLwBKcoe1x4HG68
           ik918hdDSE9vDQSccA3xXHOAFOPJ8R9EeIAbTi1VwBYnbTp87X-xcPWlEP
           krdoUKW60tgs1aNd_Nnc9LEVVPMS390zbFxt8TN_biaBgelNgbC95sM",
      "q":"uKlCKvKv_ZJMVcdIs5vVSU_6cPtYI1ljWytExV_skstvRSNi9r66jdd9-y
           BhVfuG4shsp2j7rGnIio901RBeHo6TPKWVVykPu1iYhQXw1jIABfw-MVsN
           -3bQ76WLdt2SDxsHs7q7zPyUyHXmps7ycZ5c72wGkUwNOjYelmkiNS0",
      "dp":"w0kZbV63cVRvVX6yk3C8cMxo2qCM4Y8nsq1lmMSYhG4EcL6FWbX5h9yuv
           ngs4iLEFk6eALoUS4vIWEwcL4txw9LsWH_zKI-hwoReoP77cOdSL4AVcra
           Hawlkpyd2TWjE5evgbhWtOxnZee3cXJBkAi64Ik6jZxbvk-RR3pEhnCs",
      "dq":"o_8V14SezckO6CNLKs_btPdFiO9_kC1DsuUTd2LAfIIVeMZ7jn1Gus_Ff
           7B7IVx3p5KuBGOVF8L-qifLb6nQnLysgHDh132NDioZkhH7mI7hPG-PYE_
           odApKdnqECHWw0J-F0JWnUd6D2B_1TvF9mXA2Qx-iGYn8OVV1Bsmp6qU",
      "qi":"eNho5yRBEBxhGBtQRww9QirZsB66TrfFReG_CcteI1aCneT0ELGhYlRlC
           tUkTRclIfuEPmNsNDPbLoLqqCVznFbvdB7x-Tl-m0l_eFTj2KiqwGqE9PZ
           B9nNTwMVvH3VRRSLWACvPnSiwP8N5Usy-WRXS-V7TbpxIhvepTfE0NNo"
     }














<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 38]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-39" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   The resulting JWE Encrypted Key value is:

   [80, 104, 72, 58, 11, 130, 236, 139, 132, 189, 255, 205, 61, 86, 151,
   176, 99, 40, 44, 233, 176, 189, 205, 70, 202, 169, 72, 40, 226, 181,
   156, 223, 120, 156, 115, 232, 150, 209, 145, 133, 104, 112, 237, 156,
   116, 250, 65, 102, 212, 210, 103, 240, 177, 61, 93, 40, 71, 231, 223,
   226, 240, 157, 15, 31, 150, 89, 200, 215, 198, 203, 108, 70, 117, 66,
   212, 238, 193, 205, 23, 161, 169, 218, 243, 203, 128, 214, 127, 253,
   215, 139, 43, 17, 135, 103, 179, 220, 28, 2, 212, 206, 131, 158, 128,
   66, 62, 240, 78, 186, 141, 125, 132, 227, 60, 137, 43, 31, 152, 199,
   54, 72, 34, 212, 115, 11, 152, 101, 70, 42, 219, 233, 142, 66, 151,
   250, 126, 146, 141, 216, 190, 73, 50, 177, 146, 5, 52, 247, 28, 197,
   21, 59, 170, 247, 181, 89, 131, 241, 169, 182, 246, 99, 15, 36, 102,
   166, 182, 172, 197, 136, 230, 120, 60, 58, 219, 243, 149, 94, 222,
   150, 154, 194, 110, 227, 225, 112, 39, 89, 233, 112, 207, 211, 241,
   124, 174, 69, 221, 179, 107, 196, 225, 127, 167, 112, 226, 12, 242,
   16, 24, 28, 120, 182, 244, 213, 244, 153, 194, 162, 69, 160, 244,
   248, 63, 165, 141, 4, 207, 249, 193, 79, 131, 0, 169, 233, 127, 167,
   101, 151, 125, 56, 112, 111, 248, 29, 232, 90, 29, 147, 110, 169,
   146, 114, 165, 204, 71, 136, 41, 252]

   Encoding this JWE Encrypted Key as BASE64URL(JWE Encrypted Key) gives
   this value (with line breaks for display purposes only):

     UGhIOguC7IuEvf_NPVaXsGMoLOmwvc1GyqlIKOK1nN94nHPoltGRhWhw7Zx0-kFm
     1NJn8LE9XShH59_i8J0PH5ZZyNfGy2xGdULU7sHNF6Gp2vPLgNZ__deLKxGHZ7Pc
     HALUzoOegEI-8E66jX2E4zyJKx-YxzZIItRzC5hlRirb6Y5Cl_p-ko3YvkkysZIF
     NPccxRU7qve1WYPxqbb2Yw8kZqa2rMWI5ng8OtvzlV7elprCbuPhcCdZ6XDP0_F8
     rkXds2vE4X-ncOIM8hAYHHi29NX0mcKiRaD0-D-ljQTP-cFPgwCp6X-nZZd9OHBv
     -B3oWh2TbqmScqXMR4gp_A

<span class="h4"><a class="selflink" id="appendix-A.2.4" href="#appendix-A.2.4">A.2.4</a>.  Initialization Vector</span>

   Generate a random 128-bit JWE Initialization Vector.  In this
   example, the value is:

   [3, 22, 60, 12, 43, 67, 104, 105, 108, 108, 105, 99, 111, 116, 104,
   101]

   Encoding this JWE Initialization Vector as BASE64URL(JWE
   Initialization Vector) gives this value:

     AxY8DCtDaGlsbGljb3RoZQ








<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 39]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-40" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="appendix-A.2.5" href="#appendix-A.2.5">A.2.5</a>.  Additional Authenticated Data</span>

   Let the Additional Authenticated Data encryption parameter be
   ASCII(BASE64URL(UTF8(JWE Protected Header))).  This value is:

   [101, 121, 74, 104, 98, 71, 99, 105, 79, 105, 74, 83, 85, 48, 69,
   120, 88, 122, 85, 105, 76, 67, 74, 108, 98, 109, 77, 105, 79, 105,
   74, 66, 77, 84, 73, 52, 81, 48, 74, 68, 76, 85, 104, 84, 77, 106, 85,
   50, 73, 110, 48]

<span class="h4"><a class="selflink" id="appendix-A.2.6" href="#appendix-A.2.6">A.2.6</a>.  Content Encryption</span>

   Perform authenticated encryption on the plaintext with the
   AES_128_CBC_HMAC_SHA_256 algorithm using the CEK as the encryption
   key, the JWE Initialization Vector, and the Additional Authenticated
   Data value above.  The steps for doing this using the values from
   <a href="#appendix-A.3">Appendix A.3</a> are detailed in <a href="#appendix-B">Appendix B</a>.  The resulting ciphertext
   is:

   [40, 57, 83, 181, 119, 33, 133, 148, 198, 185, 243, 24, 152, 230, 6,
   75, 129, 223, 127, 19, 210, 82, 183, 230, 168, 33, 215, 104, 143,
   112, 56, 102]

   The resulting Authentication Tag value is:

   [246, 17, 244, 190, 4, 95, 98, 3, 231, 0, 115, 157, 242, 203, 100,
   191]

   Encoding this JWE Ciphertext as BASE64URL(JWE Ciphertext) gives this
   value:

     KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY

   Encoding this JWE Authentication Tag as BASE64URL(JWE Authentication
   Tag) gives this value:

     9hH0vgRfYgPnAHOd8stkvw

<span class="h4"><a class="selflink" id="appendix-A.2.7" href="#appendix-A.2.7">A.2.7</a>.  Complete Representation</span>

   Assemble the final representation: The Compact Serialization of this
   result is the string BASE64URL(UTF8(JWE Protected Header)) || '.' ||
   BASE64URL(JWE Encrypted Key) || '.' || BASE64URL(JWE Initialization
   Vector) || '.' || BASE64URL(JWE Ciphertext) || '.' || BASE64URL(JWE
   Authentication Tag).






<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 40]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-41" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   The final result in this example (with line breaks for display
   purposes only) is:

     eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.
     UGhIOguC7IuEvf_NPVaXsGMoLOmwvc1GyqlIKOK1nN94nHPoltGRhWhw7Zx0-kFm
     1NJn8LE9XShH59_i8J0PH5ZZyNfGy2xGdULU7sHNF6Gp2vPLgNZ__deLKxGHZ7Pc
     HALUzoOegEI-8E66jX2E4zyJKx-YxzZIItRzC5hlRirb6Y5Cl_p-ko3YvkkysZIF
     NPccxRU7qve1WYPxqbb2Yw8kZqa2rMWI5ng8OtvzlV7elprCbuPhcCdZ6XDP0_F8
     rkXds2vE4X-ncOIM8hAYHHi29NX0mcKiRaD0-D-ljQTP-cFPgwCp6X-nZZd9OHBv
     -B3oWh2TbqmScqXMR4gp_A.
     AxY8DCtDaGlsbGljb3RoZQ.
     KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY.
     9hH0vgRfYgPnAHOd8stkvw

<span class="h4"><a class="selflink" id="appendix-A.2.8" href="#appendix-A.2.8">A.2.8</a>.  Validation</span>

   This example illustrates the process of creating a JWE with
   RSAES-PKCS1-v1_5 for key encryption and AES_CBC_HMAC_SHA2 for content
   encryption.  These results can be used to validate JWE decryption
   implementations for these algorithms.  Note that since the
   RSAES-PKCS1-v1_5 computation includes random values, the encryption
   results above will not be completely reproducible.  However, since
   the AES-CBC computation is deterministic, the JWE Encrypted
   Ciphertext values will be the same for all encryptions performed
   using these inputs.

<span class="h3"><a class="selflink" id="appendix-A.3" href="#appendix-A.3">A.3</a>.  Example JWE Using AES Key Wrap and AES_128_CBC_HMAC_SHA_256</span>

   This example encrypts the plaintext "Live long and prosper." to the
   recipient using AES Key Wrap for key encryption and
   AES_128_CBC_HMAC_SHA_256 for content encryption.  The representation
   of this plaintext (using JSON array notation) is:

   [76, 105, 118, 101, 32, 108, 111, 110, 103, 32, 97, 110, 100, 32,
   112, 114, 111, 115, 112, 101, 114, 46]

<span class="h4"><a class="selflink" id="appendix-A.3.1" href="#appendix-A.3.1">A.3.1</a>.  JOSE Header</span>

   The following example JWE Protected Header declares that:

   o  The Content Encryption Key is encrypted to the recipient using the
      AES Key Wrap algorithm with a 128-bit key to produce the JWE
      Encrypted Key.
   o  Authenticated encryption is performed on the plaintext using the
      AES_128_CBC_HMAC_SHA_256 algorithm to produce the ciphertext and
      the Authentication Tag.

     {"alg":"A128KW","enc":"A128CBC-HS256"}



<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 41]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-42" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   Encoding this JWE Protected Header as BASE64URL(UTF8(JWE Protected
   Header)) gives this value:

     eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0

<span class="h4"><a class="selflink" id="appendix-A.3.2" href="#appendix-A.3.2">A.3.2</a>.  Content Encryption Key (CEK)</span>

   Generate a 256-bit random CEK.  In this example, the value is:

   [4, 211, 31, 197, 84, 157, 252, 254, 11, 100, 157, 250, 63, 170, 106,
   206, 107, 124, 212, 45, 111, 107, 9, 219, 200, 177, 0, 240, 143, 156,
   44, 207]

<span class="h4"><a class="selflink" id="appendix-A.3.3" href="#appendix-A.3.3">A.3.3</a>.  Key Encryption</span>

   Encrypt the CEK with the shared symmetric key using the AES Key Wrap
   algorithm to produce the JWE Encrypted Key.  This example uses the
   symmetric key represented in JSON Web Key [<a href="#ref-JWK" title="&quot;JSON Web Key (JWK)&quot;">JWK</a>] format below:

     {"kty":"oct",
      "k":"GawgguFyGrWKav7AX4VKUg"
     }

   The resulting JWE Encrypted Key value is:

   [232, 160, 123, 211, 183, 76, 245, 132, 200, 128, 123, 75, 190, 216,
   22, 67, 201, 138, 193, 186, 9, 91, 122, 31, 246, 90, 28, 139, 57, 3,
   76, 124, 193, 11, 98, 37, 173, 61, 104, 57]

   Encoding this JWE Encrypted Key as BASE64URL(JWE Encrypted Key) gives
   this value:

     6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ

<span class="h4"><a class="selflink" id="appendix-A.3.4" href="#appendix-A.3.4">A.3.4</a>.  Initialization Vector</span>

   Generate a random 128-bit JWE Initialization Vector.  In this
   example, the value is:

   [3, 22, 60, 12, 43, 67, 104, 105, 108, 108, 105, 99, 111, 116, 104,
   101]

   Encoding this JWE Initialization Vector as BASE64URL(JWE
   Initialization Vector) gives this value:

     AxY8DCtDaGlsbGljb3RoZQ





<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 42]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-43" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="appendix-A.3.5" href="#appendix-A.3.5">A.3.5</a>.  Additional Authenticated Data</span>

   Let the Additional Authenticated Data encryption parameter be
   ASCII(BASE64URL(UTF8(JWE Protected Header))).  This value is:

   [101, 121, 74, 104, 98, 71, 99, 105, 79, 105, 74, 66, 77, 84, 73, 52,
   83, 49, 99, 105, 76, 67, 74, 108, 98, 109, 77, 105, 79, 105, 74, 66,
   77, 84, 73, 52, 81, 48, 74, 68, 76, 85, 104, 84, 77, 106, 85, 50, 73,
   110, 48]

<span class="h4"><a class="selflink" id="appendix-A.3.6" href="#appendix-A.3.6">A.3.6</a>.  Content Encryption</span>

   Perform authenticated encryption on the plaintext with the
   AES_128_CBC_HMAC_SHA_256 algorithm using the CEK as the encryption
   key, the JWE Initialization Vector, and the Additional Authenticated
   Data value above.  The steps for doing this using the values from
   this example are detailed in <a href="#appendix-B">Appendix B</a>.  The resulting ciphertext
   is:

   [40, 57, 83, 181, 119, 33, 133, 148, 198, 185, 243, 24, 152, 230, 6,
   75, 129, 223, 127, 19, 210, 82, 183, 230, 168, 33, 215, 104, 143,
   112, 56, 102]

   The resulting Authentication Tag value is:

   [83, 73, 191, 98, 104, 205, 211, 128, 201, 189, 199, 133, 32, 38,
   194, 85]

   Encoding this JWE Ciphertext as BASE64URL(JWE Ciphertext) gives this
   value:

     KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY

   Encoding this JWE Authentication Tag as BASE64URL(JWE Authentication
   Tag) gives this value:

     U0m_YmjN04DJvceFICbCVQ

<span class="h4"><a class="selflink" id="appendix-A.3.7" href="#appendix-A.3.7">A.3.7</a>.  Complete Representation</span>

   Assemble the final representation: The Compact Serialization of this
   result is the string BASE64URL(UTF8(JWE Protected Header)) || '.' ||
   BASE64URL(JWE Encrypted Key) || '.' || BASE64URL(JWE Initialization
   Vector) || '.' || BASE64URL(JWE Ciphertext) || '.' || BASE64URL(JWE
   Authentication Tag).






<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 43]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-44" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   The final result in this example (with line breaks for display
   purposes only) is:

     eyJhbGciOiJBMTI4S1ciLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.
     6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ.
     AxY8DCtDaGlsbGljb3RoZQ.
     KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY.
     U0m_YmjN04DJvceFICbCVQ

<span class="h4"><a class="selflink" id="appendix-A.3.8" href="#appendix-A.3.8">A.3.8</a>.  Validation</span>

   This example illustrates the process of creating a JWE with AES Key
   Wrap for key encryption and AES GCM for content encryption.  These
   results can be used to validate JWE decryption implementations for
   these algorithms.  Also, since both the AES Key Wrap and AES GCM
   computations are deterministic, the resulting JWE value will be the
   same for all encryptions performed using these inputs.  Since the
   computation is reproducible, these results can also be used to
   validate JWE encryption implementations for these algorithms.

<span class="h3"><a class="selflink" id="appendix-A.4" href="#appendix-A.4">A.4</a>.  Example JWE Using General JWE JSON Serialization</span>

   This section contains an example using the general JWE JSON
   Serialization syntax.  This example demonstrates the capability for
   encrypting the same plaintext to multiple recipients.

   Two recipients are present in this example.  The algorithm and key
   used for the first recipient are the same as that used in
   <a href="#appendix-A.2">Appendix A.2</a>.  The algorithm and key used for the second recipient
   are the same as that used in <a href="#appendix-A.3">Appendix A.3</a>.  The resulting JWE
   Encrypted Key values are therefore the same; those computations are
   not repeated here.

   The plaintext, the CEK, JWE Initialization Vector, and JWE Protected
   Header are shared by all recipients (which must be the case, since
   the ciphertext and Authentication Tag are also shared).















<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 44]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-45" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="appendix-A.4.1" href="#appendix-A.4.1">A.4.1</a>.  JWE Per-Recipient Unprotected Headers</span>

   The first recipient uses the RSAES-PKCS1-v1_5 algorithm to encrypt
   the CEK.  The second uses AES Key Wrap to encrypt the CEK.  Key ID
   values are supplied for both keys.  The two JWE Per-Recipient
   Unprotected Header values used to represent these algorithms and key
   IDs are:

     {"alg":"RSA1_5","kid":"2011-04-29"}

   and

     {"alg":"A128KW","kid":"7"}

<span class="h4"><a class="selflink" id="appendix-A.4.2" href="#appendix-A.4.2">A.4.2</a>.  JWE Protected Header</span>

   Authenticated encryption is performed on the plaintext using the
   AES_128_CBC_HMAC_SHA_256 algorithm to produce the common JWE
   Ciphertext and JWE Authentication Tag values.  The JWE Protected
   Header value representing this is:

     {"enc":"A128CBC-HS256"}

   Encoding this JWE Protected Header as BASE64URL(UTF8(JWE Protected
   Header)) gives this value:

     eyJlbmMiOiJBMTI4Q0JDLUhTMjU2In0

<span class="h4"><a class="selflink" id="appendix-A.4.3" href="#appendix-A.4.3">A.4.3</a>.  JWE Shared Unprotected Header</span>

   This JWE uses the "jku" Header Parameter to reference a JWK Set.
   This is represented in the following JWE Shared Unprotected Header
   value as:

     {"jku":"https://server.example.com/keys.jwks"}

<span class="h4"><a class="selflink" id="appendix-A.4.4" href="#appendix-A.4.4">A.4.4</a>.  Complete JOSE Header Values</span>

   Combining the JWE Per-Recipient Unprotected Header, JWE Protected
   Header, and JWE Shared Unprotected Header values supplied, the JOSE
   Header values used for the first and second recipient, respectively,
   are:

     {"alg":"RSA1_5",
      "kid":"2011-04-29",
      "enc":"A128CBC-HS256",
      "jku":"https://server.example.com/keys.jwks"}




<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 45]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-46" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   and

     {"alg":"A128KW",
      "kid":"7",
      "enc":"A128CBC-HS256",
      "jku":"https://server.example.com/keys.jwks"}

<span class="h4"><a class="selflink" id="appendix-A.4.5" href="#appendix-A.4.5">A.4.5</a>.  Additional Authenticated Data</span>

   Let the Additional Authenticated Data encryption parameter be
   ASCII(BASE64URL(UTF8(JWE Protected Header))).  This value is:

   [101, 121, 74, 108, 98, 109, 77, 105, 79, 105, 74, 66, 77, 84, 73,
   52, 81, 48, 74, 68, 76, 85, 104, 84, 77, 106, 85, 50, 73, 110, 48]

<span class="h4"><a class="selflink" id="appendix-A.4.6" href="#appendix-A.4.6">A.4.6</a>.  Content Encryption</span>

   Perform authenticated encryption on the plaintext with the
   AES_128_CBC_HMAC_SHA_256 algorithm using the CEK as the encryption
   key, the JWE Initialization Vector, and the Additional Authenticated
   Data value above.  The steps for doing this using the values from
   <a href="#appendix-A.3">Appendix A.3</a> are detailed in <a href="#appendix-B">Appendix B</a>.  The resulting ciphertext
   is:

   [40, 57, 83, 181, 119, 33, 133, 148, 198, 185, 243, 24, 152, 230, 6,
   75, 129, 223, 127, 19, 210, 82, 183, 230, 168, 33, 215, 104, 143,
   112, 56, 102]

   The resulting Authentication Tag value is:

   [51, 63, 149, 60, 252, 148, 225, 25, 92, 185, 139, 245, 35, 2, 47,
   207]

   Encoding this JWE Ciphertext as BASE64URL(JWE Ciphertext) gives this
   value:

     KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY

   Encoding this JWE Authentication Tag as BASE64URL(JWE Authentication
   Tag) gives this value:

     Mz-VPPyU4RlcuYv1IwIvzw









<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 46]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-47" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h4"><a class="selflink" id="appendix-A.4.7" href="#appendix-A.4.7">A.4.7</a>.  Complete JWE JSON Serialization Representation</span>

   The complete JWE JSON Serialization for these values is as follows
   (with line breaks within values for display purposes only):

     {
      "protected":
       "eyJlbmMiOiJBMTI4Q0JDLUhTMjU2In0",
      "unprotected":
       {"jku":"https://server.example.com/keys.jwks"},
      "recipients":[
       {"header":
         {"alg":"RSA1_5","kid":"2011-04-29"},
        "encrypted_key":
         "UGhIOguC7IuEvf_NPVaXsGMoLOmwvc1GyqlIKOK1nN94nHPoltGRhWhw7Zx0-
          kFm1NJn8LE9XShH59_i8J0PH5ZZyNfGy2xGdULU7sHNF6Gp2vPLgNZ__deLKx
          GHZ7PcHALUzoOegEI-8E66jX2E4zyJKx-YxzZIItRzC5hlRirb6Y5Cl_p-ko3
          YvkkysZIFNPccxRU7qve1WYPxqbb2Yw8kZqa2rMWI5ng8OtvzlV7elprCbuPh
          cCdZ6XDP0_F8rkXds2vE4X-ncOIM8hAYHHi29NX0mcKiRaD0-D-ljQTP-cFPg
          wCp6X-nZZd9OHBv-B3oWh2TbqmScqXMR4gp_A"},
       {"header":
         {"alg":"A128KW","kid":"7"},
        "encrypted_key":
         "6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ"}],
      "iv":
       "AxY8DCtDaGlsbGljb3RoZQ",
      "ciphertext":
       "KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY",
      "tag":
       "Mz-VPPyU4RlcuYv1IwIvzw"
     }

<span class="h3"><a class="selflink" id="appendix-A.5" href="#appendix-A.5">A.5</a>.  Example JWE Using Flattened JWE JSON Serialization</span>

   This section contains an example using the flattened JWE JSON
   Serialization syntax.  This example demonstrates the capability for
   encrypting the plaintext to a single recipient in a flattened JSON
   structure.

   The values in this example are the same as those for the second
   recipient of the previous example in <a href="#appendix-A.4">Appendix A.4</a>.










<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 47]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-48" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   The complete JWE JSON Serialization for these values is as follows
   (with line breaks within values for display purposes only):

     {
      "protected":
       "eyJlbmMiOiJBMTI4Q0JDLUhTMjU2In0",
      "unprotected":
       {"jku":"https://server.example.com/keys.jwks"},
      "header":
       {"alg":"A128KW","kid":"7"},
      "encrypted_key":
       "6KB707dM9YTIgHtLvtgWQ8mKwboJW3of9locizkDTHzBC2IlrT1oOQ",
      "iv":
       "AxY8DCtDaGlsbGljb3RoZQ",
      "ciphertext":
       "KDlTtXchhZTGufMYmOYGS4HffxPSUrfmqCHXaI9wOGY",
      "tag":
       "Mz-VPPyU4RlcuYv1IwIvzw"
     }

<span class="h2"><a class="selflink" id="appendix-B" href="#appendix-B">Appendix B</a>.  Example AES_128_CBC_HMAC_SHA_256 Computation</span>

   This example shows the steps in the AES_128_CBC_HMAC_SHA_256
   authenticated encryption computation using the values from the
   example in <a href="#appendix-A.3">Appendix A.3</a>.  As described where this algorithm is
   defined in Sections <a href="#section-5.2">5.2</a> and <a href="#section-5.2.3">5.2.3</a> of JWA, the AES_CBC_HMAC_SHA2
   family of algorithms are implemented using Advanced Encryption
   Standard (AES) in Cipher Block Chaining (CBC) mode with Public-Key
   Cryptography Standards (PKCS) #7 padding to perform the encryption
   and an HMAC SHA-2 function to perform the integrity calculation -- in
   this case, HMAC SHA-256.

<span class="h3"><a class="selflink" id="appendix-B.1" href="#appendix-B.1">B.1</a>.  Extract MAC_KEY and ENC_KEY from Key</span>

   The 256 bit AES_128_CBC_HMAC_SHA_256 key K used in this example
   (using JSON array notation) is:

   [4, 211, 31, 197, 84, 157, 252, 254, 11, 100, 157, 250, 63, 170, 106,
   206, 107, 124, 212, 45, 111, 107, 9, 219, 200, 177, 0, 240, 143, 156,
   44, 207]

   Use the first 128 bits of this key as the HMAC SHA-256 key MAC_KEY,
   which is:

   [4, 211, 31, 197, 84, 157, 252, 254, 11, 100, 157, 250, 63, 170, 106,
   206]





<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 48]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-49" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   Use the last 128 bits of this key as the AES-CBC key ENC_KEY, which
   is:

   [107, 124, 212, 45, 111, 107, 9, 219, 200, 177, 0, 240, 143, 156, 44,
   207]

   Note that the MAC key comes before the encryption key in the input
   key K; this is in the opposite order of the algorithm names in the
   identifiers "AES_128_CBC_HMAC_SHA_256" and "A128CBC-HS256".

<span class="h3"><a class="selflink" id="appendix-B.2" href="#appendix-B.2">B.2</a>.  Encrypt Plaintext to Create Ciphertext</span>

   Encrypt the plaintext with AES in CBC mode using PKCS #7 padding
   using the ENC_KEY above.  The plaintext in this example is:

   [76, 105, 118, 101, 32, 108, 111, 110, 103, 32, 97, 110, 100, 32,
   112, 114, 111, 115, 112, 101, 114, 46]

   The encryption result is as follows, which is the ciphertext output:

   [40, 57, 83, 181, 119, 33, 133, 148, 198, 185, 243, 24, 152, 230, 6,
   75, 129, 223, 127, 19, 210, 82, 183, 230, 168, 33, 215, 104, 143,
   112, 56, 102]

<span class="h3"><a class="selflink" id="appendix-B.3" href="#appendix-B.3">B.3</a>.  64-Bit Big-Endian Representation of AAD Length</span>

   The Additional Authenticated Data (AAD) in this example is:

   [101, 121, 74, 104, 98, 71, 99, 105, 79, 105, 74, 66, 77, 84, 73, 52,
   83, 49, 99, 105, 76, 67, 74, 108, 98, 109, 77, 105, 79, 105, 74, 66,
   77, 84, 73, 52, 81, 48, 74, 68, 76, 85, 104, 84, 77, 106, 85, 50, 73,
   110, 48]

   This AAD is 51-bytes long, which is 408-bits long.  The octet string
   AL, which is the number of bits in AAD expressed as a big-endian
   64-bit unsigned integer is:

   [0, 0, 0, 0, 0, 0, 1, 152]

<span class="h3"><a class="selflink" id="appendix-B.4" href="#appendix-B.4">B.4</a>.  Initialization Vector Value</span>

   The Initialization Vector value used in this example is:

   [3, 22, 60, 12, 43, 67, 104, 105, 108, 108, 105, 99, 111, 116, 104,
   101]






<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 49]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-50" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


<span class="h3"><a class="selflink" id="appendix-B.5" href="#appendix-B.5">B.5</a>.  Create Input to HMAC Computation</span>

   Concatenate the AAD, the Initialization Vector, the ciphertext, and
   the AL value.  The result of this concatenation is:

   [101, 121, 74, 104, 98, 71, 99, 105, 79, 105, 74, 66, 77, 84, 73, 52,
   83, 49, 99, 105, 76, 67, 74, 108, 98, 109, 77, 105, 79, 105, 74, 66,
   77, 84, 73, 52, 81, 48, 74, 68, 76, 85, 104, 84, 77, 106, 85, 50, 73,
   110, 48, 3, 22, 60, 12, 43, 67, 104, 105, 108, 108, 105, 99, 111,
   116, 104, 101, 40, 57, 83, 181, 119, 33, 133, 148, 198, 185, 243, 24,
   152, 230, 6, 75, 129, 223, 127, 19, 210, 82, 183, 230, 168, 33, 215,
   104, 143, 112, 56, 102, 0, 0, 0, 0, 0, 0, 1, 152]

<span class="h3"><a class="selflink" id="appendix-B.6" href="#appendix-B.6">B.6</a>.  Compute HMAC Value</span>

   Compute the HMAC SHA-256 of the concatenated value above.  This
   result M is:

   [83, 73, 191, 98, 104, 205, 211, 128, 201, 189, 199, 133, 32, 38,
   194, 85, 9, 84, 229, 201, 219, 135, 44, 252, 145, 102, 179, 140, 105,
   86, 229, 116]

<span class="h3"><a class="selflink" id="appendix-B.7" href="#appendix-B.7">B.7</a>.  Truncate HMAC Value to Create Authentication Tag</span>

   Use the first half (128 bits) of the HMAC output M as the
   Authentication Tag output T.  This truncated value is:

   [83, 73, 191, 98, 104, 205, 211, 128, 201, 189, 199, 133, 32, 38,
   194, 85]

Acknowledgements

   Solutions for encrypting JSON content were also explored by "JSON
   Simple Encryption" [<a href="#ref-JSE" title="&quot;JSON Simple Encryption&quot;">JSE</a>] and "JavaScript Message Security Format"
   [<a href="#ref-JSMS" title="&quot;JavaScript Message Security Format&quot;">JSMS</a>], both of which significantly influenced this document.  This
   document attempts to explicitly reuse as many of the relevant
   concepts from XML Encryption 1.1 [<a href="#ref-W3C.REC-xmlenc-core1-20130411">W3C.REC-xmlenc-core1-20130411</a>] and
   <a href="./rfc5652">RFC 5652</a> [<a href="./rfc5652" title="&quot;Cryptographic Message Syntax (CMS)&quot;">RFC5652</a>] as possible, while utilizing simple, compact JSON-
   based data structures.

   Special thanks are due to John Bradley, Eric Rescorla, and Nat
   Sakimura for the discussions that helped inform the content of this
   specification; to Eric Rescorla and Joe Hildebrand for allowing the
   reuse of text from [<a href="#ref-JSMS" title="&quot;JavaScript Message Security Format&quot;">JSMS</a>] in this document; and to Eric Rescorla for
   co-authoring many drafts of this specification.

   Thanks to Axel Nennker, Emmanuel Raviart, Brian Campbell, and Edmund
   Jay for validating the examples in this specification.



<span class="grey">Jones &amp; Hildebrand           Standards Track                   [Page 50]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-51" ></span>
<span class="grey"><a href="./rfc7516">RFC 7516</a>                JSON Web Encryption (JWE)               May 2015</span>


   This specification is the work of the JOSE working group, which
   includes dozens of active and dedicated participants.  In particular,
   the following individuals contributed ideas, feedback, and wording
   that influenced this specification:

   Richard Barnes, John Bradley, Brian Campbell, Alissa Cooper, Breno de
   Medeiros, Stephen Farrell, Dick Hardt, Jeff Hodges, Russ Housley,
   Edmund Jay, Scott Kelly, Stephen Kent, Barry Leiba, James Manger,
   Matt Miller, Kathleen Moriarty, Tony Nadalin, Hideki Nara, Axel
   Nennker, Ray Polk, Emmanuel Raviart, Eric Rescorla, Pete Resnick, Nat
   Sakimura, Jim Schaad, Hannes Tschofenig, and Sean Turner.

   Jim Schaad and Karen O'Donoghue chaired the JOSE working group and
   Sean Turner, Stephen Farrell, and Kathleen Moriarty served as
   Security Area Directors during the creation of this specification.

Authors' Addresses

   Michael B. Jones
   Microsoft

   EMail: mbj@microsoft.com
   URI:   <a href="http://self-issued.info/">http://self-issued.info/</a>


   Joe Hildebrand
   Cisco Systems, Inc.

   EMail: jhildebr@cisco.com






















Jones &amp; Hildebrand           Standards Track                   [Page 51]
</pre>

</body>
</html>

