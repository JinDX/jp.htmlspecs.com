<!DOCTYPE html>
<html lang="ja-JP">

<head>
    <meta charset="utf-8">
    <!-- <meta name="generator" content="ReSpec 35.4.0"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        span.example-title {
            text-transform: none
        }

        :is(aside, div).example,
        div.illegal-example {
            padding: .5em;
            margin: 1em 0;
            position: relative;
            clear: both
        }

        div.illegal-example {
            color: red
        }

        div.illegal-example p {
            color: #000
        }

        aside.example div.example {
            border-left-width: .1em;
            border-color: #999;
            background: #fff
        }
    </style>
    <style>
        .issue-label {
            text-transform: initial
        }

        .warning>p:first-child {
            margin-top: 0
        }

        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid
        }

        span.warning {
            padding: .1em .5em .15em
        }

        .issue.closed span.issue-number {
            text-decoration: line-through
        }

        .issue.closed span.issue-number::after {
            content: " (Closed)";
            font-size: smaller
        }

        .warning {
            border-color: #f11;
            border-color: var(--warning-border, #f11);
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9;
            background: var(--warning-bg, #fbe9e9);
            color: #000;
            color: var(--text, #000)
        }

        .warning-title:before {
            content: "⚠";
            font-size: 1.3em;
            float: left;
            padding-right: .3em;
            margin-top: -.3em
        }

        li.task-list-item {
            list-style: none
        }

        input.task-list-item-checkbox {
            margin: 0 .35em .25em -1.6em;
            vertical-align: middle
        }

        .issue a.respec-gh-label {
            padding: 5px;
            margin: 0 2px 0 2px;
            font-size: 10px;
            text-transform: none;
            text-decoration: none;
            font-weight: 700;
            border-radius: 4px;
            position: relative;
            bottom: 2px;
            border: none;
            display: inline-block
        }
    </style>
    <style>
        pre.idl {
            padding: 1em;
            position: relative
        }

        pre.idl>code {
            color: #000;
            color: var(--text, #000)
        }

        @media print {
            pre.idl {
                white-space: pre-wrap
            }
        }

        .idlHeader {
            display: block;
            width: 150px;
            background: #8ccbf2;
            background: var(--def-border, #8ccbf2);
            color: #fff;
            color: var(--defrow-border, #fff);
            font-family: sans-serif;
            font-weight: 700;
            margin: -1em 0 1em -1em;
            height: 28px;
            line-height: 28px
        }

        .idlHeader a.self-link {
            margin-left: .3cm;
            text-decoration: none;
            border-bottom: none;
            color: inherit
        }

        .idlID {
            font-weight: 700;
            color: #005a9c
        }

        .idlType {
            color: #005a9c
        }

        .idlName {
            color: #ff4500
        }

        .idlName a {
            color: #ff4500;
            border-bottom: 1px dotted #ff4500;
            text-decoration: none
        }

        a.idlEnumItem {
            color: #000;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        .idlSuperclass {
            font-style: italic;
            color: #005a9c
        }

        .idlDefaultValue,
        .idlParamName {
            font-style: italic
        }

        .extAttr {
            color: #666
        }

        .idlSectionComment {
            color: gray
        }

        .idlIncludes a {
            font-weight: 700
        }

        .respec-button-copy-paste:focus {
            text-decoration: none;
            border-color: #51a7e8;
            outline: 0;
            box-shadow: 0 0 5px rgba(81, 167, 232, .5)
        }

        .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
            border-color: #51a7e8
        }

        .respec-button-copy-paste:is(:hover, :active, .zeroclipboard-is-hover, .zeroclipboard-is-active) {
            text-decoration: none;
            background-color: #ddd;
            background-image: linear-gradient(#eee, #ddd);
            border-color: #ccc
        }

        .respec-button-copy-paste:is(:active, .selected, .zeroclipboard-is-active) {
            background-color: #dcdcdc;
            background-image: none;
            border-color: #b5b5b5;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .15)
        }

        .respec-button-copy-paste.selected:hover {
            background-color: #cfcfcf
        }

        .respec-button-copy-paste:is(:disabled, :disabled:hover, .disabled, .disabled:hover) {
            color: rgba(102, 102, 102, .5);
            cursor: default;
            background-color: rgba(229, 229, 229, .5);
            background-image: none;
            border-color: rgba(197, 197, 197, .5);
            box-shadow: none
        }

        @media print {
            .respec-button-copy-paste {
                visibility: hidden
            }
        }
    </style>
    <style>
        dfn {
            cursor: pointer
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            min-width: 300px;
            max-width: 500px;
            padding: .5em .75em;
            margin-top: .6em;
            font-family: "Helvetica Neue", sans-serif;
            font-size: small;
            background: #fff;
            background: var(--indextable-hover-bg, #fff);
            color: #000;
            color: var(--text, #000);
            box-shadow: 0 1em 3em -.4em rgba(0, 0, 0, .3), 0 0 1px 1px rgba(0, 0, 0, .05);
            box-shadow: 0 1em 3em -.4em var(--tocsidebar-shadow, rgba(0, 0, 0, .3)), 0 0 1px 1px var(--tocsidebar-shadow, rgba(0, 0, 0, .05));
            border-radius: 2px
        }

        .dfn-panel:not(.docked)>.caret {
            position: absolute;
            top: -9px
        }

        .dfn-panel:not(.docked)>.caret::after,
        .dfn-panel:not(.docked)>.caret::before {
            content: "";
            position: absolute;
            border: 10px solid transparent;
            border-top: 0;
            border-bottom: 10px solid #fff;
            border-bottom-color: var(--indextable-hover-bg, #fff);
            top: 0
        }

        .dfn-panel:not(.docked)>.caret::before {
            border-bottom: 9px solid #a2a9b1;
            border-bottom-color: var(--indextable-hover-bg, #a2a9b1)
        }

        .dfn-panel * {
            margin: 0
        }

        .dfn-panel b {
            display: block;
            color: #000;
            color: var(--text, #000);
            margin-top: .25em
        }

        .dfn-panel ul a[href] {
            color: #333;
            color: var(--text, #333)
        }

        .dfn-panel>div {
            display: flex
        }

        .dfn-panel a.self-link {
            font-weight: 700;
            margin-right: auto
        }

        .dfn-panel .marker {
            padding: .1em;
            margin-left: .5em;
            border-radius: .2em;
            text-align: center;
            white-space: nowrap;
            font-size: 90%;
            color: #040b1c
        }

        .dfn-panel .marker.dfn-exported {
            background: #d1edfd;
            box-shadow: 0 0 0 .125em #1ca5f940
        }

        .dfn-panel .marker.idl-block {
            background: #8ccbf2;
            box-shadow: 0 0 0 .125em #0670b161
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important
        }

        .dfn-panel a[href]:hover {
            border-bottom-width: 1px
        }

        .dfn-panel ul {
            padding: 0
        }

        .dfn-panel li {
            margin-left: 1em
        }

        .dfn-panel.docked {
            position: fixed;
            left: .5em;
            top: unset;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - .75em * 2 - .5em - .2em * 2);
            max-height: 30vh;
            overflow: auto
        }
    </style>


    <title>requestIdleCallback()</title>



    <style id="respec-mainstyle">
        @keyframes pop {
            0% {
                transform: scale(1, 1)
            }

            25% {
                transform: scale(1.25, 1.25);
                opacity: .75
            }

            100% {
                transform: scale(1, 1)
            }
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        a.bibref {
            text-decoration: none
        }

        .respec-offending-element:target {
            animation: pop .25s ease-in-out 0s 1
        }

        .respec-offending-element,
        a[href].respec-offending-element {
            text-decoration: red wavy underline
        }

        @supports not (text-decoration:red wavy underline) {
            .respec-offending-element:not(pre) {
                display: inline-block
            }

            .respec-offending-element {
                background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x
            }
        }

        #references :target {
            background: #eaf3ff;
            animation: pop .4s ease-in-out 0s 1
        }

        cite .bibref {
            font-style: italic
        }

        a[href].orcid {
            padding-left: 4px;
            padding-right: 4px
        }

        a[href].orcid>svg {
            margin-bottom: -2px
        }

        ol.tof,
        ul.tof {
            list-style: none outside none
        }

        .caption {
            margin-top: .5em;
            font-style: italic
        }

        #issue-summary>ul {
            column-count: 2
        }

        #issue-summary li {
            list-style: none;
            display: inline-block
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top
        }

        details.respec-tests-details>* {
            padding-right: 2em
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: #fff;
            padding-bottom: .5em
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -.3em
        }

        details.respec-tests-details>li {
            padding-left: 1em
        }

        .self-link:hover {
            opacity: 1;
            text-decoration: none;
            background-color: transparent
        }

        aside.example .marker>a.self-link {
            color: inherit
        }

        .header-wrapper {
            display: flex;
            align-items: baseline
        }

        :is(h2, h3, h4, h5, h6):not(#toc>h2, #abstract>h2, #sotd>h2, .head>h2) {
            position: relative;
            left: -.5em
        }

        :is(h2, h3, h4, h5, h6):not(#toch2)+a.self-link {
            color: inherit;
            order: -1;
            position: relative;
            left: -1.1em;
            font-size: 1rem;
            opacity: .5
        }

        :is(h2, h3, h4, h5, h6)+a.self-link::before {
            content: "§";
            text-decoration: none;
            color: var(--heading-text)
        }

        :is(h2, h3)+a.self-link {
            top: -.2em
        }

        :is(h4, h5, h6)+a.self-link::before {
            color: #000
        }

        @media (max-width:767px) {
            dd {
                margin-left: 0
            }
        }

        @media print {
            .removeOnSave {
                display: none
            }
        }
    </style>
    <meta name="color-scheme" content="light">
    <!-- <meta name="revision" content="c4604781337b7bbfad37802a95f23907fca50e9e"> -->
    <meta name="description"
        content="このドキュメントは、ウェブページの作成者がAPIを使用して、他の高優先度タスク（入力処理、アニメーション、フレーム合成など）と同じイベントループを共有する場合、それらに遅延を発生させず、協調的にバックグラウンドタスクをスケジューリングできる方法を定義します。ユーザーエージェントは、現在スケジュールされているタスク、vsyncの締め切り、ユーザーインタラクションなどの知識を基に、バックグラウンドタスクがユーザーに知覚される遅延やアニメーション、入力応答のカクつきを発生させずに実行できるタイミングをより適切に判断できます。このAPIを使用することで、ブラウザがアイドル状態となる時間帯にバックグラウンドタスクをより適切にスケジューリングできるようになります。">
    <link rel="canonical" href="https://www.w3.org/TR/requestidlecallback/">
    <style>
        .hljs {
            --base: #fafafa;
            --mono-1: #383a42;
            --mono-2: #686b77;
            --mono-3: #717277;
            --hue-1: #0b76c5;
            --hue-2: #336ae3;
            --hue-3: #a626a4;
            --hue-4: #42803c;
            --hue-5: #ca4706;
            --hue-5-2: #c91243;
            --hue-6: #986801;
            --hue-6-2: #9a6a01
        }

        @media (prefers-color-scheme:dark) {
            .hljs {
                --base: #282c34;
                --mono-1: #abb2bf;
                --mono-2: #818896;
                --mono-3: #5c6370;
                --hue-1: #56b6c2;
                --hue-2: #61aeee;
                --hue-3: #c678dd;
                --hue-4: #98c379;
                --hue-5: #e06c75;
                --hue-5-2: #be5046;
                --hue-6: #d19a66;
                --hue-6-2: #e6c07b
            }
        }

        .hljs {
            display: block;
            overflow-x: auto;
            padding: .5em;
            color: #383a42;
            color: var(--mono-1, #383a42);
            background: #fafafa;
            background: var(--base, #fafafa)
        }

        .hljs-comment,
        .hljs-quote {
            color: #717277;
            color: var(--mono-3, #717277);
            font-style: italic
        }

        .hljs-doctag,
        .hljs-formula,
        .hljs-keyword {
            color: #a626a4;
            color: var(--hue-3, #a626a4)
        }

        .hljs-deletion,
        .hljs-name,
        .hljs-section,
        .hljs-selector-tag,
        .hljs-subst {
            color: #ca4706;
            color: var(--hue-5, #ca4706);
            font-weight: 700
        }

        .hljs-literal {
            color: #0b76c5;
            color: var(--hue-1, #0b76c5)
        }

        .hljs-addition,
        .hljs-attribute,
        .hljs-meta-string,
        .hljs-regexp,
        .hljs-string {
            color: #42803c;
            color: var(--hue-4, #42803c)
        }

        .hljs-built_in,
        .hljs-class .hljs-title {
            color: #9a6a01;
            color: var(--hue-6-2, #9a6a01)
        }

        .hljs-attr,
        .hljs-number,
        .hljs-selector-attr,
        .hljs-selector-class,
        .hljs-selector-pseudo,
        .hljs-template-variable,
        .hljs-type,
        .hljs-variable {
            color: #986801;
            color: var(--hue-6, #986801)
        }

        .hljs-bullet,
        .hljs-link,
        .hljs-meta,
        .hljs-selector-id,
        .hljs-symbol,
        .hljs-title {
            color: #336ae3;
            color: var(--hue-2, #336ae3)
        }

        .hljs-emphasis {
            font-style: italic
        }

        .hljs-strong {
            font-weight: 700
        }

        .hljs-link {
            text-decoration: underline
        }
    </style>
    <style>
        var:hover {
            text-decoration: underline;
            cursor: pointer
        }

        var.respec-hl {
            color: var(--color, #000);
            background-color: var(--bg-color);
            box-shadow: 0 0 0 2px var(--bg-color)
        }

        @media (prefers-color-scheme:dark) {
            var.respec-hl {
                filter: saturate(.9) brightness(.9)
            }
        }

        var.respec-hl-c1 {
            --bg-color: #f4d200
        }

        var.respec-hl-c2 {
            --bg-color: #ff87a2
        }

        var.respec-hl-c3 {
            --bg-color: #96e885
        }

        var.respec-hl-c4 {
            --bg-color: #3eeed2
        }

        var.respec-hl-c5 {
            --bg-color: #eacfb6
        }

        var.respec-hl-c6 {
            --bg-color: #82ddff
        }

        var.respec-hl-c7 {
            --bg-color: #ffbcf2
        }

        @media print {
            var.respec-hl {
                background: 0 0;
                color: #000;
                box-shadow: unset
            }
        }
    </style>
    <style>
        var {
            position: relative;
            cursor: pointer
        }

        var[data-type]::after,
        var[data-type]::before {
            position: absolute;
            left: 50%;
            top: -6px;
            opacity: 0;
            transition: opacity .4s;
            pointer-events: none
        }

        var[data-type]::before {
            content: "";
            transform: translateX(-50%);
            border-width: 4px 6px 0 6px;
            border-style: solid;
            border-color: transparent;
            border-top-color: #222
        }

        var[data-type]::after {
            content: attr(data-type);
            transform: translateX(-50%) translateY(-100%);
            background: #222;
            text-align: center;
            font-family: "Dank Mono", "Fira Code", monospace;
            font-style: normal;
            padding: 6px;
            border-radius: 3px;
            color: #daca88;
            text-indent: 0;
            font-weight: 400
        }

        var[data-type]:hover::after,
        var[data-type]:hover::before {
            opacity: 1
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
  "specStatus": "WD",
  "editors": [
    {
      "name": "Scott Haseley",
      "company": "Google Inc.",
      "companyURL": "https://google.com/",
      "w3cid": "122093"
    }
  ],
  "formerEditors": [
    {
      "name": "Ross McIlroy",
      "company": "Google Inc.",
      "companyURL": "https://google.com/",
      "w3cid": "80940"
    },
    {
      "name": "Ilya Grigorik",
      "url": "https://www.igvita.com/",
      "company": "Google Inc.",
      "companyURL": "https://google.com/",
      "w3cid": "56102"
    }
  ],
  "group": "webperf",
  "github": "w3c/requestidlecallback",
  "localBiblio": {
    "RESPONSETIME": {
      "title": "Response time in man-computer conversational transactions",
      "href": "http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf",
      "authors": [
        "Robert B. Miller"
      ],
      "status": "Fall Joint Computer Conference",
      "date": "December 1968",
      "id": "responsetime"
    }
  },
  "implementationReportURI": "https://wpt.fyi/requestidlecallback",
  "xref": "web-platform",
  "shortName": "requestidlecallback",
  "gitRevision": "c4604781337b7bbfad37802a95f23907fca50e9e",
  "publishDate": "2025-05-21",
  "previousMaturity": "WD",
  "previousPublishDate": "2024-12-17",
  "publishISODate": "2025-05-21T00:00:00.000Z",
  "generatedSubtitle": "W3C Working Draft 21 May 2025"
}</script>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>

<body class="h-entry" data-cite="WEBIDL HTML INFRA URL WEBIDL DOM FETCH">
    <div class="head">
        <p class="logos"><a class="logo" href="https://www.w3.org/"> alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a></p>
        <h1 id="title" class="title"><code>requestIdleCallback()</code></h1>
        <h2 id="subtitle" class="subtitle">バックグラウンドタスクの協調的スケジューリング</h2>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C ワーキングドラフト</a> <time class="dt-published"
                datetime="2025-05-21">2025年5月21日</time></p>
        <details open="">
            <summary>このドキュメントの詳細</summary>
            <dl>
                <dt>このバージョン:</dt>
                <dd>
                    <a class="u-url"
                        href="https://www.w3.org/TR/2025/WD-requestidlecallback-20250521/">https://www.w3.org/TR/2025/WD-requestidlecallback-20250521/</a>
                </dd>
                <dt>最新公開バージョン:</dt>
                <dd>
                    <a href="https://www.w3.org/TR/requestidlecallback/">https://www.w3.org/TR/requestidlecallback/</a>
                </dd>
                <dt>最新エディタードラフト:</dt>
                <dd><a href="https://w3c.github.io/requestidlecallback/">https://w3c.github.io/requestidlecallback/</a>
                </dd>
                <dt>履歴:</dt>
                <dd>
                    <a
                        href="https://www.w3.org/standards/history/requestidlecallback/">https://www.w3.org/standards/history/requestidlecallback/</a>
                </dd>
                <dd>
                    <a href="https://github.com/w3c/requestidlecallback/commits/">コミット履歴</a>
                </dd>

                <dt>実装レポート:</dt>
                <dd>
                    <a href="https://wpt.fyi/requestidlecallback">https://wpt.fyi/requestidlecallback</a>
                </dd>



                <dt>編集者:</dt>
                <dd class="editor p-author h-card vcard" data-editor-id="122093">
                    <span class="p-name fn">Scott Haseley</span> (<a class="p-org org h-org"
                        href="https://google.com/">Google Inc.</a>)
                </dd>
                <dt>
                    以前の編集者:
                </dt>
                <dd class="editor p-author h-card vcard" data-editor-id="80940">
                    <span class="p-name fn">Ross McIlroy</span> (<a class="p-org org h-org"
                        href="https://google.com/">Google Inc.</a>)
                </dd>
                <dd class="editor p-author h-card vcard" data-editor-id="56102">
                    <a class="u-url url p-name fn" href="https://www.igvita.com/">Ilya Grigorik</a> (<a
                        class="p-org org h-org" href="https://google.com/">Google Inc.</a>)
                </dd>

                <dt>フィードバック:</dt>
                <dd>
                    <a href="https://github.com/w3c/requestidlecallback/">GitHub w3c/requestidlecallback</a>
                    (<a href="https://github.com/w3c/requestidlecallback/pulls/">プルリクエスト</a>,
                    <a href="https://github.com/w3c/requestidlecallback/issues/new/choose">新しい課題</a>,
                    <a href="https://github.com/w3c/requestidlecallback/issues/">オープン課題</a>)
                </dd>


            </dl>
        </details>


        <p class="copyright">
            <a href="https://www.w3.org/policies/#copyright">Copyright</a>
            ©
            2025

            <a href="https://www.w3.org/">World Wide Web Consortium</a>.
            <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
            <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
            <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
            <a rel="license" href="https://www.w3.org/copyright/software-license-2023/"
                title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>


    <section id="abstract" class="introductory">
        <h2>概要</h2>
        <p>本書は、ウェブページの作成者が、同じイベントループを共有する他の高優先度タスク（入力処理、アニメーション、フレーム合成など）に遅延を発生させることなく、協調的にバックグラウンドタスクをスケジューリングできるAPIを定義します。ユーザーエージェントは、現在スケジュールされているタスク、vsyncの締め切り、ユーザーインタラクションなどの知識をもとに、ユーザーに知覚される遅延やアニメーションのカクつき、入力応答の悪化を発生させずにバックグラウンドタスクを実行するタイミングを、より適切に判断できます。そのため、このAPIを使用することで、ブラウザがアイドル状態となる時間帯にバックグラウンドタスクのより適切なスケジューリングが実現されます。
        </p>
    </section>
    <section id="sotd" class="introductory">
        <h2>この文書のステータス</h2>
        <p><em>このセクションでは、本書の発行時点でのステータスについて説明します。現在の<abbr title="World Wide Web Consortium">W3C</abbr>発行物と本技術レポートの最新版は、
                <a href="https://www.w3.org/TR/"><abbr
                        title="World Wide Web Consortium">W3C</abbr>標準とドラフト一覧</a>（https://www.w3.org/TR/）でご覧いただけます。</em>
        </p>
        <p>Web Performance Working Group は仕様用の<a
                href="https://w3c-test.org/requestidlecallback/">テストスイート</a>を管理しています。ワーキンググループの<a
                href="http://wpt.fyi/requestidlecallback">実装レポート</a>もご参照ください。本ドキュメントの実装に関心のあるベンダーは、下記のメーリングリストに参加し、議論に加わることを<em
                class="rfc2119">推奨</em>します。
        </p>
        <p>
            この文書は<a href="https://www.w3.org/groups/wg/webperf">Web Performance Working Group</a>により、<a
                href="https://www.w3.org/policies/process/20231103/#recs-and-notes">勧告トラック</a>を使用してワーキングドラフトとして公開されました。
        </p>
        <p>ワーキングドラフトとしての公開は、<abbr title="World Wide Web Consortium">W3C</abbr>およびその会員による承認を意味しません。</p>
        <p>
            この文書はドラフトであり、今後いつでも他の文書によって更新・差し替え・廃止される可能性があります。進行中の作業以外の文書として引用するのは適切ではありません。

        </p>
        <p>

            このドキュメントは、<a href="https://www.w3.org/policies/patent-policy/"><abbr
                    title="World Wide Web Consortium">W3C</abbr>特許ポリシー</a>のもとで活動するグループにより作成されました。

            <abbr title="World Wide Web Consortium">W3C</abbr> は、グループの成果物に関連してなされた<a rel="disclosure"
                href="https://www.w3.org/groups/wg/webperf/ipr">特許開示の公開リスト</a>を管理しています。そのページには特許開示の手順も掲載されています。特許について実際に知っている人は、<a
                href="https://www.w3.org/policies/patent-policy/#def-essential">Essential Claim(s)</a>を含むと考えた場合、<a
                href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">W3C特許ポリシーの第6節</a>に従って情報を開示する必要があります。

        </p>
        <p>
            この文書は
            <a id="w3c_process_revision" href="https://www.w3.org/policies/process/20231103/">2023年11月3日付け<abbr
                    title="World Wide Web Consortium">W3C</abbr>プロセス文書</a>に従って管理されています。
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">目次</h2>
        <ol class="toc">
            <li class="tocline"><a class="tocxref" href="#abstract">概要</a></li>
            <li class="tocline"><a class="tocxref" href="#sotd">この文書のステータス</a></li>
            <li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>はじめに</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#idle-periods"><bdi class="secno">2. </bdi>アイドル期間</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">3. </bdi>適合性</a></li>
            <li class="tocline"><a class="tocxref" href="#window_extensions"><bdi class="secno">4. </bdi><span
                        data-xref-type="_IDL_" data-link-type="interface" data-lt="Window" data-cite="html"
                        data-cite-path="/nav-history-apis.html" data-cite-frag="window"
                        class="formerLink"><code>Window</code></span> インターフェース拡張</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#the-requestidlecallback-method"><bdi class="secno">4.1
                            </bdi><span data-export="" data-dfn-type="method" data-idl="operation"
                                data-title="requestIdleCallback()" data-dfn-for="Window" data-type="unsigned long"
                                data-lt="requestIdleCallback()|requestIdleCallback(callback)|requestIdleCallback(callback, options)"
                                data-local-lt="Window.requestIdleCallback|Window.requestIdleCallback()|requestIdleCallback"><code>requestIdleCallback()</code></span>
                            メソッド</a></li>
                    <li class="tocline"><a class="tocxref" href="#the-cancelidlecallback-method"><bdi class="secno">4.2
                            </bdi><span data-export="" data-dfn-type="method" data-idl="operation"
                                data-title="cancelIdleCallback()" data-dfn-for="Window" data-type="undefined"
                                data-lt="cancelIdleCallback()|cancelIdleCallback(handle)"
                                data-local-lt="Window.cancelIdleCallback|Window.cancelIdleCallback()|cancelIdleCallback"><code>cancelIdleCallback()</code></span>
                            メソッド</a></li>
                    <li class="tocline"><a class="tocxref" href="#the-idledeadline-interface"><bdi class="secno">4.3
                            </bdi><span data-export="" data-dfn-type="interface" data-idl="interface"
                                data-title="IdleDeadline" data-dfn-for=""><code>IdleDeadline</code></span> インターフェース</a>
                    </li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#processing"><bdi class="secno">5. </bdi>処理</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#start-an-idle-period-algorithm"><bdi class="secno">5.1
                            </bdi>アイドル期間開始アルゴリズム</a></li>
                    <li class="tocline"><a class="tocxref" href="#invoke-idle-callbacks-algorithm"><bdi
                                class="secno">5.2 </bdi>アイドルコールバック呼び出しアルゴリズム</a></li>
                    <li class="tocline"><a class="tocxref" href="#invoke-idle-callback-timeout-algorithm"><bdi
                                class="secno">5.3 </bdi>アイドルコールバックタイムアウト呼び出しアルゴリズム</a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#privacy-considerations"><bdi class="secno">6.
                    </bdi>プライバシーに関する考慮事項</a></li>
            <li class="tocline"><a class="tocxref" href="#security-considerations"><bdi class="secno">7.
                    </bdi>セキュリティに関する考慮事項</a></li>
            <li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">A.
                    </bdi>謝辞</a></li>
            <li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>参考文献</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1
                            </bdi>規範的参考文献</a></li>
                    <li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">B.2
                            </bdi>参考情報</a></li>
                </ol>
            </li>
        </ol>
    </nav>
    <section class="informative" id="introduction">
        <div class="header-wrapper">
            <h2 id="x1-introduction"><bdi class="secno">1. </bdi>はじめに</h2><a class="self-link" href="#introduction"
                aria-label="Permalink for Section 1."></a>
        </div>
        <p><em>このセクションは規範的ではありません。</em></p>

        <p>ウェブページは、時間的に重要ではないものの、実行にかなりの時間がかかる可能性がある計算タスクを、ブラウザのイベントループで実行したい場合がよくあります。そのようなバックグラウンドタスクの例として、アナリティクスデータの記録、長時間かかるデータ処理操��、クライアントサイドのテンプレート処理や、近い将来表示される可能性が高いコンテンツのプリレンダリングなどが挙げられます。これらのタスクは、入力への反応や<a
                data-link-type="method" data-lt="requestAnimationFrame()"
                href="https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#dom-animationframeprovider-requestanimationframe"><code>requestAnimationFrame</code></a><code>()</code>
            を使ったスクリプトベースのアニメーションなど、他の時間的に重要な処理とイベントループを共有しなければなりません。これらのバックグラウンドタスクは、通常、<a data-link-type="method"
                data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>
            でコールバックをスケジューリングし、そのコールバック内でバックグラウンドタスクを実行することで行われます。
        </p>
        <p>この方法の欠点は、スクリプトの作成者が、ある<a data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>
            コールバックが時間的に重要なのか、それともブラウザがアイドル状態になるまで遅延してもよいものなのかをユーザーエージェントに伝える方法がないことです。さらに、ユーザーエージェントは、コールバックが時間的に重要な処理を遅延させたり、カクつきなどのユーザが気づく遅延を引き起こさずに、どの程度の時間まで実行し続けられるかの情報をコールバックに提供できません。その結果、もっとも簡単な対応策は、<a
                data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>
            を非常に小さな値で呼び出し、そこで最小限の作業を実行し、さらに必要な作業を<a data-link-type="method" data-lt="setTimeout()"
                href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout"><code>setTimeout</code></a><code>()</code>
            でもう一度スケジューリングすることです。しかしこの方法は、ユーザーエージェントのイベントループに複数の小さいタスクを投稿してその実行をスケジューリングする余分なオーバーヘッドが発生します。また、各コールバックの合間にユーザーエージェントが他の時間的に重要な処理を適切に割り込ませる必要があるため、各コールバックの実行にかかる時間をユーザーエージェントが正確に推測できない点も問題です。
        </p>
        <p>本書で解説するAPIは、スクリプト作成者が、ユーザーエージェントがアイドル状態であるときにコールバックのスケジューリングをリクエストできるようにします。ユーザーエージェントは、どれくらいアイドル状態が続くと見積もっているかを、コールバックに渡される期限（deadline）として提供します。ページ作成者はこの期限を使って、これらのバックグラウンドタスクがアニメーションや入力応答などの遅延が許されないイベントに影響を与えないようにできます。
        </p>
        <p>以下はこのAPIを使ってバックグラウンドタスクを書く例です。</p>
        <div class="example" id="example-1">
            <div class="marker">
                <a class="self-link" href="#example-1">例<bdi> 1</bdi></a>
            </div>
            <pre class="highlight"
                aria-busy="false"><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>requestIdleCallbackを使用したバックグラウンドタスクのスケジューリング<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">
<span class="hljs-keyword">var</span> requestId = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> pointsTotal = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> pointsInside = <span class="hljs-number">0</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">piStep</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">var</span> r = <span class="hljs-number">10</span>;
  <span class="hljs-keyword">var</span> x = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() <span class="hljs-string">`*`</span> r <span class="hljs-string">`*`</span> <span class="hljs-number">2</span> - r;
  <span class="hljs-keyword">var</span> y = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() <span class="hljs-string">`*`</span> r <span class="hljs-string">`*`</span> <span class="hljs-number">2</span> - r;
  <span class="hljs-keyword">return</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(x, <span class="hljs-number">2</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(y, <span class="hljs-number">2</span>) &lt; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(r, <span class="hljs-number">2</span>))
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">refinePi</span>(<span class="hljs-params">deadline</span>) {
  <span class="hljs-keyword">while</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">piStep</span>())
      pointsInside++;
    pointsTotal++;
  }
  currentEstimate = (<span class="hljs-number">4</span> <span class="hljs-string">`*`</span> pointsInside / pointsTotal);
  textElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"piEstimate"</span>);
  textElement.<span class="hljs-property">innerHTML</span>=<span class="hljs-string">"円周率推定値: "</span> + currentEstimate;
  requestId = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestIdleCallback</span>(refinePi);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) {
  requestId = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestIdleCallback</span>(refinePi);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">if</span> (requestId)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">cancelIdleCallback</span>(requestId);
  requestId = <span class="hljs-number">0</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"start()"</span>&gt;</span>クリックで開始<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"stop()"</span>&gt;</span>クリックで停止<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"piEstimate"</span>&gt;</span>未開始<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>
        </div>
    </section>
    <section class="informative" id="idle-periods">
        <div class="header-wrapper">
            <h2 id="x2-idle-periods"><bdi class="secno">2. </bdi>アイドル期間</h2><a class="self-link" href="#idle-periods"
                aria-label="Permalink for Section 2."></a>
        </div>
        <p><em>このセクションは規範的ではありません。</em></p>

        <p>入力処理、描画や合成など、そのフレームの処理が完了したあと、ユーザーエージェントのメインスレッドは次のいずれかのタイミングまでしばしばアイドル状態になります：次のフレーム処理の開始、未処理のタスクが実行可能になる、またはユーザー入力がある場合です。本仕様は、こうしたアイドル時間に<a
                data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-1"><code>requestIdleCallback</code></a><code>()</code> APIを
            使ってコールバックの実行をスケジューリングする方法を提供します。
        </p>
        <p><a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-2"><code>requestIdleCallback</code></a><code>()</code> API
            経由で投稿されたコールバックは、ユーザーエージェントが定義したアイドル期間中に実行対象となります。アイドルコールバックが実行されると、その時のアイドル期間の終了時点に対応する期限（deadline）が渡されます。アイドル期間がいつかはユーザーエージェントごとに定義されますが、一般的にはブラウザがアイドル状態になる静穏時に発生することが期待されます。
        </p>
        <p>アイドル期間の一例は、アクティブなアニメーション中に特定のフレームを画面にコミットした後、次のフレームの処理を開始するまでの間で、<a href="#figure1" class="fig-ref"
                title="Example of an inter-frame idle period">図 <bdi
                    class="">1</bdi></a>で示されています。こうしたアイドル期間は、アクティブなアニメーションや
            画面更新中に頻繁に発生しますが、通常ごく短時間（たとえば60Hzのvsyncサイクルのデバイスでは16ms未満）です。</p>

        <figure id="figure1">
            <img alt="フレーム間アイドル期間の例" src="https://www.w3.org/TR/requestidlecallback/images/image01.png">
            <figcaption><a class="self-link" href="#figure1">図 <bdi class="figno">1</bdi></a> <span class="fig-title">
                    フレーム間アイドル期間の例
                </span></figcaption>
        </figure>
        <div class="note" role="note" id="issue-container-generatedID">
            <div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>注記</span></div>
            <p class="">
                ウェブ開発者は、アイドルコールバック中に実行するすべての作業を考慮しておくべきです。Promiseの解決やページレイアウトの発生など、一部の操作は、アイドルコールバック終了後に後続のタスクをスケジューリングする場合があります。このような場合、次のフレーム締め切り前にこれらの操作が実行できるよう、期限満了前に（コールバック側が）処理を明け渡すことで追加作業に対応させるべきです。
            </p>
        </div>
        <p>アイドル期間の別の例として、ユーザーエージェントがアイドルで、画面更新が発生していないときがあります。このような場合、ユーザーエージェントはアイドル期間の終了を制約できる後続タスクを持たないことがあります。予測不能なタスク（たとえばユーザー入力処理など）による、ユーザが気づく遅延を回避するため、こうしたアイドル期間の長さは最大値<a
                href="#why50">50ms</a>に制限すべきです。アイドル期間が終了してもユーザーエージェントが引き続きアイドルであれば、<a href="#figure2" class="fig-ref"
                title="Example of an idle period when there are no pending frame updates">図 <bdi
                    class="">2</bdi></a>のように、追加のアイドル期間をスケジューリングし、長いアイドル時間帯でもバックグラウンド処理が続けて行えるようになります。</p>


        <figure id="figure2">
            <img alt="未処理のフレーム更新がないときのアイドル期間例" src="https://www.w3.org/TR/requestidlecallback/images/image00.png">
            <figcaption><a class="self-link" href="#figure2">図 <bdi class="figno">2</bdi></a> <span class="fig-title">
                    未処理のフレーム更新がないときのアイドル期間例
                </span></figcaption>
        </figure>
        <p>アイドル期間中、ユーザーエージェントはFIFO順でアイドルコールバックを実行し、アイドル期間終了または実行待ちのコールバックがなくなるまで繰り返します。そのため、すべてのアイドルコールバックが一つのアイドル期間中に必ずしも実行されるとは限りません。残ったアイドルタスクは次のアイドル期間で実行対象になります。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-0">
            <div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>注記</span></div>
            <p class="">
                性能を最大限に発揮するため、開発者は意味のないコールバック（例えばrequestAnimationFrameやsetTimeout等）を不要に残さず、イベント対応が必要になった時点でのみスケジューリングしてください。このパターンは全体の効率を高め、ユーザーエージェントがバックグラウンド作業に効率的に使える長いアイドルコールバック（最大50ms）のスケジューリングを実現します。
            </p>
        </div>
        <p>現在のアイドル期間の開始前に投稿されたタスクだけがその期間中に実行対象となります。そのため、アイドルコールバック中に<a data-link-type="idl"
                data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback" class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-3"><code>requestIdleCallback</code></a><code>()</code>
            でもうひとつコールバックを投稿した場合、その後続コールバックは今のアイドル期間中には実行されません。これにより、アイドルコールバックが期限までに処理を終えられない場合、将来のアイドル期間に自身を再投稿するコードパターン（下記例のような）が可能になります――このとき短すぎるアイドル期間中にコールバックが何度も実行されてしまうことはありません：
        </p>
        <div class="example" id="example-2">
            <div class="marker">
                <a class="self-link" href="#example-2">例<bdi> 2</bdi></a>
            </div>
            <pre class="highlight" aria-busy="false"><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">doWork</span>(<span class="hljs-params">deadline</span>) {
  <span class="hljs-keyword">if</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &lt;= <span class="hljs-number">5</span>) {
    <span class="hljs-comment">// これには5ms以上かかるので、</span>
    <span class="hljs-comment">// 十分長い締め切りで次回呼ばれるのを待つ。</span>
    <span class="hljs-title function_">requestIdleCallback</span>(doWork);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-comment">// 処理を行う...</span>
}</code></pre>
        </div>
        <p>次のアイドル期間の開始時、新たに投稿されたアイドルコールバックは実行可能なタスクリストの末尾に追加されます。これにより、コールバックの再投稿はラウンドロビン方式で実行されることが保証され、すべてのコールバックが先行するタスクの再投稿コールバックよりも先に一度は実行されることになります。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-1">
            <div role="heading" class="note-title marker" id="h-note-1" aria-level="3"><span>注記</span></div>
            <p class="">
                本仕様の将来バージョンでは他のスケジューリング戦略も認められる可能性があります。たとえば「同じアイドル期間中にスケジュール」「アイドル時間がXミリ秒以上の期間中」等。現行仕様では次のアイドル期間へのスケジューリングだけをサポートしており、その際にコールバックがロジックを実行するか、さらに再投稿で次のアイドル期間への移行ができます。
            </p>
        </div>
        <p>ユーザーエージェントがウェブページをユーザ不可視と判断した場合、デバイスの電力消費を減らすためにアイドル期間を間引くことがあります。例として、連続ではなく10秒ごとに一回だけアイドル期間を呼び出すなどです。</p>
        <p>最後に注意すべき点として、ページの負荷が高い場合、ユーザーエージェントがアイドルCPU時間を全く確保できない場合もあります。そのため、<a data-link-type="idl"
                data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback" class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-4"><code>requestIdleCallback</code></a><code>()</code>
            API経由で投稿されたアイドルコールバックは、無期限に実行が延期される可能性があり、その場合アイドル期間自体がスケジューリングされないこともあります。コールバックをアイドル期間中に実行したいものの、実行期限を設けておきたい場合には、<code>options</code>引数の<code>timeout</code>プロパティを指定できます。指定したタイムアウトが先に到達した場合は、アイドル期間外でもタスクがキューイングされて実行されます。
        </p>
        <div class="note" role="note" id="why50">
            <div role="heading" class="note-title marker" id="h-note-2" aria-level="3"><span>注記</span></div>
            <p class="">最大50msという期限値は、研究
                [<cite><a class="bibref" data-link-type="biblio" href="#bib-responsetime"
                        title="Response time in man-computer conversational transactions">RESPONSETIME</a></cite>]に基づいています。これによれば、ユーザー入力に100ms以内に応答すると、人間にはほぼ瞬時に反応したと認識されます。アイドル期限を50msに制限することで、仮にアイドルタスクが開始直後にユーザー入力があった場合でも、ユーザーエージェントはその入力に50ms以内で反応できるため、遅延が知覚されません。
            </p>
        </div>
    </section>
    <section id="conformance">
        <div class="header-wrapper">
            <h2 id="x3-conformance"><bdi class="secno">3. </bdi>適合性</h2><a class="self-link" href="#conformance"
                aria-label="Permalink for Section 3."></a>
        </div>
        <p>「規範的ではありません」と記されたセクションだけでなく、本仕様中のすべての著述ガイドライン、図、例、注記も規範的ではありません。この仕様のその他全ては規範的です。</p>
        <p>
            このドキュメント中のキーワード<em class="rfc2119">MUST</em>、<em class="rfc2119">REQUIRED</em>、<em
                class="rfc2119">SHALL</em>、<em class="rfc2119">SHOULD</em> は、
            <a href="https://www.rfc-editor.org/info/bcp14">BCP 14</a>
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119"
                    title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a
                    class="bibref" data-link-type="biblio" href="#bib-rfc8174"
                    title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
            に記載されている通りに解釈してください。ただし、例示のようにすべて大文字で出てきた場合（のみ）。
        </p>
        <p>本仕様中のIDL断片は、準拠IDL断片に必要な形式として<em class="rfc2119">MUST</em>解釈されます。</p>
        <p>この仕様で定義される適合クラスは一つだけです：</p>
        <dl>
            <dt>準拠ユーザーエージェント</dt>
            <dd>
                本仕様における<em class="rfc2119">MUST</em>・<em class="rfc2119">REQUIRED</em>・<em
                    class="rfc2119">SHALL</em>要件すべてを満たす場合、ユーザーエージェントは準拠ユーザーエージェントと見なされます。準拠ユーザーエージェントは、<a
                    data-link-type="dfn"
                    href="https://webidl.spec.whatwg.org/#dfn-conforming-implementation">IDL断片の準拠実装</a>（<a
                    href="#window_extensions" class="sec-ref"><bdi class="secno">4.
                    </bdi><span><code>Window</code></span>インターフェース拡張</a>参照）でもなければなりません。
            </dd>
        </dl>
    </section>
    <section id="window_extensions">
        <div class="header-wrapper">
            <h2 id="x4-window-interface-extensions"><bdi class="secno">4. </bdi><a data-link-type="interface"
                    data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                インターフェース拡張</h2><a class="self-link" href="#window_extensions" aria-label="Permalink for Section 4."></a>
        </div>

        <p>以下のIDL断片の partial interface は、
            <a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                class="internalDFN"
                id="ref-for-dom-window-requestidlecallback-6"><code>requestIdleCallback</code></a><code>()</code>
            操作を
            <a data-link-type="interface" data-lt="Window"
                href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
            オブジェクト上に公開するために使用されます。
        </p>
        <pre class="idl def"
            id="webidl-1323139649"><span class="idlHeader"><a class="self-link" href="#webidl-1323139649">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-window-partial-1" data-title="Window">partial interface <a data-idl="partial" data-link-type="interface" data-title="Window" class="idlID" data-dfn-for="Window" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window">Window</a> {<span data-idl="" class="idlMethod" id="idl-def-window-requestidlecallback-callback-options" data-title="requestIdleCallback" data-dfn-for="Window"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-window-requestidlecallback" id="ref-for-dom-window-requestidlecallback-7"><code>requestIdleCallback</code></a>(<span class="idlType"><a data-link-type="idl" href="#dom-idlerequestcallback" class="internalDFN" id="ref-for-dom-idlerequestcallback-1"><code>IdleRequestCallback</code></a></span> <span class="idlParamName">callback</span>, optional<span class="idlType"> <a data-link-type="idl" href="#dom-idlerequestoptions" class="internalDFN" id="ref-for-dom-idlerequestoptions-1"><code>IdleRequestOptions</code></a></span> <span class="idlParamName">options</span> = {});</span><span data-idl="" class="idlMethod" id="idl-def-window-cancelidlecallback-handle" data-title="cancelIdleCallback" data-dfn-for="Window"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-window-cancelidlecallback" id="ref-for-dom-window-cancelidlecallback-1"><code>cancelIdleCallback</code></a>(<span class="idlType"><a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">handle</span>);</span>
};</span><span data-idl="" class="idlDictionary" id="idl-def-idlerequestoptions" data-title="IdleRequestOptions">

dictionary <a class="internalDFN idlID" data-link-type="dictionary" href="#dom-idlerequestoptions" id="ref-for-dom-idlerequestoptions-2"><code>IdleRequestOptions</code></a> {<span data-idl="" class="idlMember" id="idl-def-idlerequestoptions-timeout" data-title="timeout" data-dfn-for="IdleRequestOptions"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-idlerequestoptions-timeout" id="ref-for-dom-idlerequestoptions-timeout-1"><code>timeout</code></a>;</span>
};</span><span data-idl="" class="idlInterface" id="idl-def-idledeadline" data-title="IdleDeadline">

[<span class="extAttr"><a data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>] interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-idledeadline" id="ref-for-dom-idledeadline-1"><code>IdleDeadline</code></a> {<span data-idl="" class="idlMethod" id="idl-def-idledeadline-timeremaining" data-title="timeRemaining" data-dfn-for="IdleDeadline"><span class="idlType">
  <a data-link-type="typedef" href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp">DOMHighResTimeStamp</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-idledeadline-timeremaining" id="ref-for-dom-idledeadline-timeremaining-1"><code>timeRemaining</code></a>();</span><span data-idl="" class="idlAttribute" id="idl-def-idledeadline-didtimeout" data-title="didTimeout" data-dfn-for="IdleDeadline">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-idledeadline-didtimeout" id="ref-for-dom-idledeadline-didtimeout-1"><code>didTimeout</code></a>;</span>
};</span><span data-idl="" class="idlCallback" id="idl-def-idlerequestcallback" data-title="IdleRequestCallback">

callback <a class="internalDFN idlID" data-link-type="callback" href="#dom-idlerequestcallback" id="ref-for-dom-idlerequestcallback-2"><code>IdleRequestCallback</code></a> =<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> (<span class="idlType"><a data-link-type="idl" href="#dom-idledeadline" class="internalDFN" id="ref-for-dom-idledeadline-2"><code>IdleDeadline</code></a></span> <span class="idlParamName">deadline</span>);</span></code></pre>
        <p>各 <a data-link-type="interface" data-lt="Window"
                href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
            は以下を持つ:
        </p>
        <ul>
            <li><dfn id="dfn-list-of-idle-request-callbacks" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">アイドルリクエストコールバックのリスト</dfn>。このリストは最初空でなければならず、それぞれのエントリには、<a
                    data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                オブジェクトの存続期間内で一意の番号が割り当てられていなければならない。</li>
            <li><dfn id="dfn-list-of-runnable-idle-callbacks" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">実行可能なアイドルコールバックのリスト</dfn>。このリストも最初は空でなければならず、それぞれのエントリには、その<a
                    data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                オブジェクトの存続期間内で一意の番号が割り当てられていなければならない。</li>
            <li><dfn id="dfn-idle-callback-identifier" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">アイドルコールバック識別子</dfn> であり、最初はゼロでなければならない数値だ。</li>
        </ul>
        <section data-dfn-for="Window" id="the-requestidlecallback-method">
            <div class="header-wrapper">
                <h3 id="x4-1-the-requestidlecallback-method"><bdi class="secno">4.1 </bdi><dfn data-export=""
                        data-dfn-type="method" id="dom-window-requestidlecallback" data-idl="operation"
                        data-title="requestIdleCallback()" data-dfn-for="Window" data-type="unsigned long"
                        data-lt="requestIdleCallback()|requestIdleCallback(callback)|requestIdleCallback(callback, options)"
                        data-local-lt="Window.requestIdleCallback|Window.requestIdleCallback()|requestIdleCallback"
                        tabindex="0" aria-haspopup="dialog"><code>requestIdleCallback()</code></dfn> メソッド</h3><a
                    class="self-link" href="#the-requestidlecallback-method" aria-label="Permalink for Section 4.1"></a>
            </div>

            <p><a data-link-type="idl" href="#dom-window-requestidlecallback" class="internalDFN"
                    id="ref-for-dom-window-requestidlecallback-8"><code>requestIdleCallback</code></a><code>(<var>callback</var>, <var>options</var>)</code>
                が
                <dfn data-export="" data-dfn-type="callback" id="dom-idlerequestcallback" data-idl="callback"
                    data-title="IdleRequestCallback" data-dfn-for="" tabindex="0"
                    aria-haspopup="dialog"><code>IdleRequestCallback</code></dfn>
                および省略可能な <dfn data-export="" data-dfn-type="dictionary" id="dom-idlerequestoptions"
                    data-idl="dictionary" data-title="IdleRequestOptions" data-dfn-for="" tabindex="0"
                    aria-haspopup="dialog"><code>IdleRequestOptions</code></dfn> で呼び出されたとき、ユーザーエージェントは
                次の手順を実行しなければならない:
            </p>
            <ol>
                <li><var>window</var> を this の <a data-link-type="interface" data-lt="Window"
                        href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                    オブジェクトとする。</li>
                <li><var>window</var> の <a href="#dfn-idle-callback-identifier" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-idle-callback-identifier-1">アイドルコールバック識別子</a>
                    を1インクリメントする。</li>
                <li><var>handle</var> を <var>window</var> の
                    <a href="#dfn-idle-callback-identifier" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-idle-callback-identifier-2">アイドルコールバック識別子</a>
                    の現在の値とする。
                </li>
                <li><var>callback</var> を <var>window</var> の <a href="#dfn-list-of-idle-request-callbacks"
                        class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-idle-request-callbacks-1">アイドルリクエストコールバックのリスト</a>の末尾に、<var>handle</var>に関連付けて追加する。
                </li>
                <li><var>handle</var> を返し、それからこのアルゴリズムを非同期に続行する。
                    <div class="note" role="note" id="issue-container-generatedID-2">
                        <div role="heading" class="note-title marker" id="h-note-3" aria-level="4"><span>注記</span>
                        </div>
                        <p class="">以下の手順は並列に実行され、省略可能な <code>timeout</code> プロパティが指定された場合
                            <code>setTimeout()</code> に似たタイマーがキューされる。ここから、アイドルとタイムアウト両者のコールバックはレース状態となり、
                            一方が先にスケジュールされれば他方をキャンセルする（例: アイドルコールバックが先にスケジュールされた場合はタイムアウトコールバックがキャンセルされ、その逆も同様）。
                        </p>
                    </div>
                </li>
                <li><code><dfn data-dfn-for="IdleRequestOptions" data-export="" data-dfn-type="dict-member" id="dom-idlerequestoptions-timeout" data-idl="field" data-title="timeout" data-type="unsigned long" tabindex="0" aria-haspopup="dialog">timeout</dfn>
        </code> プロパティが <var>options</var> に存在し値が正の場合:
                    <ol>
                        <li><var>timeout</var> ミリ秒間待つ。</li>
                        <li>このアルゴリズムのそれまでに投稿された <var>timeout</var> を加算した時刻が本件より前であるすべての呼び出しの完了を待つ。
                        </li>
                        <li>必要に応じ、ユーザーエージェント定義のさらに追加の時間待ってもよい。
                            <div class="note" role="note" id="issue-container-generatedID-3">
                                <div role="heading" class="note-title marker" id="h-note-4" aria-level="4">
                                    <span>注記</span>
                                </div>
                                <p class="">これは省電力のため、ユーザーエージェントが必要に応じてタイムアウトをパディングできるよう意図されたもの。
                                    たとえば一部のプロセッサは低消費電力モード時にタイマーの粒度が粗くなるため、こうしたプラットフォームでは
                                    高精度タイマーによる消費増大を避けるため、ユーザーエージェントはタイマーを遅延させてもよい。</p>
                            </div>
                        </li>
                        <li>アイドルタスク用の <a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">タスクソース</a>
                            に紐づくキューで
                            <a href="#dfn-invoke-idle-callback-timeout-algorithm" class="internalDFN"
                                data-link-type="dfn"
                                id="ref-for-dfn-invoke-idle-callback-timeout-algorithm-1">アイドルコールバックタイムアウトアルゴリズム</a>
                            を <var>handle</var> と <var>window</var> を渡してキューイングする。
                        </li>
                    </ol>
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-4">
                <div role="heading" class="note-title marker" id="h-note-5" aria-level="4"><span>注記</span></div>
                <p class=""><a data-link-type="idl" data-lt="requestIdleCallback()"
                        href="#dom-window-requestidlecallback" class="internalDFN"
                        id="ref-for-dom-window-requestidlecallback-9"><code>requestIdleCallback</code></a><code>()</code>
                    は単一のコールバックだけをスケジューリングし、単一の
                    <a href="#dfn-idle-period" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-idle-period-1">アイドル期間</a>中に実行される。コールバックが指定期限までに処理を終えられない場合は、
                    （コールバック内部で）再度
                    <a data-link-type="idl" data-lt="requestIdleCallback()" href="#dom-window-requestidlecallback"
                        class="internalDFN"
                        id="ref-for-dom-window-requestidlecallback-10"><code>requestIdleCallback</code></a><code>()</code>
                    を呼び出して続きを将来のコールバックとしてスケジューリングし、すぐに処理を抜けて
                    <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">イベントループ</a>
                    に制御を返すべきである。
                </p>
            </div>
        </section>
        <section data-dfn-for="Window" id="the-cancelidlecallback-method">
            <div class="header-wrapper">
                <h3 id="x4-2-the-cancelidlecallback-method"><bdi class="secno">4.2 </bdi><dfn data-export=""
                        data-dfn-type="method" id="dom-window-cancelidlecallback" data-idl="operation"
                        data-title="cancelIdleCallback()" data-dfn-for="Window" data-type="undefined"
                        data-lt="cancelIdleCallback()|cancelIdleCallback(handle)"
                        data-local-lt="Window.cancelIdleCallback|Window.cancelIdleCallback()|cancelIdleCallback"
                        tabindex="0" aria-haspopup="dialog"><code>cancelIdleCallback()</code></dfn> メソッド</h3><a
                    class="self-link" href="#the-cancelidlecallback-method" aria-label="Permalink for Section 4.2"></a>
            </div>

            <p><a data-link-type="idl" data-lt="cancelIdleCallback()" href="#dom-window-cancelidlecallback"
                    class="internalDFN"
                    id="ref-for-dom-window-cancelidlecallback-2"><code>cancelIdleCallback</code></a><code>()</code>
                メソッドは、以前スケジューリングをリクエストしたアイドルコールバックをキャンセルするためのものである。
                <a data-link-type="idl" href="#dom-window-cancelidlecallback" class="internalDFN"
                    id="ref-for-dom-window-cancelidlecallback-3"><code>cancelIdleCallback</code></a><code>(<var>handle</var>)</code>
                が呼ばれたとき、ユーザーエージェントは次の手順を実行しなければならない:
            </p>
            <ol>
                <li><var>window</var> を this の <a data-link-type="interface" data-lt="Window"
                        href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                    オブジェクトとする。</li>
                <li><var>window</var> の <a href="#dfn-list-of-idle-request-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-2">アイドルリクエストコールバックのリスト</a>
                    または <a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-1">実行可能なアイドルコールバックのリスト</a> のうちで
                    <var>handle</var> に紐付くエントリを探す。
                </li>
                <li>該当するエントリが存在すれば、そのエントリを両方のリストから取り除く。</li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-5">
                <div role="heading" class="note-title marker" id="h-note-6" aria-level="4"><span>注記</span></div>
                <p class=""><a data-link-type="idl" data-lt="cancelIdleCallback()" href="#dom-window-cancelidlecallback"
                        class="internalDFN"
                        id="ref-for-dom-window-cancelidlecallback-4"><code>cancelIdleCallback</code></a><code>()</code>
                    は、<var>window</var> の <a href="#dfn-list-of-idle-request-callbacks" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-list-of-idle-request-callbacks-4">アイドルリクエストコールバックのリスト</a>
                    または <a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-3">実行可��なアイドルコールバックのリスト</a>
                    のエントリに対して呼ばれることがある。いずれの場合もそのエントリはリストから削除され、コールバックは実行されない。</p>
            </div>
        </section>
        <section data-dfn-for="IdleDeadline" id="the-idledeadline-interface">
            <div class="header-wrapper">
                <h3 id="x4-3-the-idledeadline-interface"><bdi class="secno">4.3 </bdi><dfn data-export=""
                        data-dfn-type="interface" id="dom-idledeadline" data-idl="interface" data-title="IdleDeadline"
                        data-dfn-for="" tabindex="0" aria-haspopup="dialog"><code>IdleDeadline</code></dfn> インターフェース
                </h3><a class="self-link" href="#the-idledeadline-interface" aria-label="Permalink for Section 4.3"></a>
            </div>

            <p>各 <a data-link-type="idl" data-lt="IdleDeadline" href="#dom-idledeadline" class="internalDFN"
                    id="ref-for-dom-idledeadline-3"><code>IdleDeadline</code></a> には <dfn id="dfn-get-deadline-time"
                    tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">期限時刻の取得アルゴリズム</dfn> が関連付けられており、
                これは期限となる絶対時刻（ミリ秒単位）の
                <a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                を返す。
                初期値はゼロになる。
            </p>
            <p><dfn data-export="" data-dfn-type="method" id="dom-idledeadline-timeremaining" data-idl="operation"
                    data-title="timeRemaining()" data-dfn-for="IdleDeadline" data-type="DOMHighResTimeStamp"
                    data-lt="timeRemaining()"
                    data-local-lt="IdleDeadline.timeRemaining|IdleDeadline.timeRemaining()|timeRemaining" tabindex="0"
                    aria-haspopup="dialog"><code>timeRemaining()</code></dfn> メソッドが
                <a href="#dom-idledeadline" class="internalDFN" data-link-type="idl"
                    id="ref-for-dom-idledeadline-4"><code>IdleDeadline</code></a> オブジェクトで呼ばれた場合、
                期限切れまでの残り時間を
                <a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                で返さなければならない。この値は計測可能だがタイミング攻撃を防止できる程度にせよ ― 詳細は [<cite><a class="bibref" data-link-type="biblio"
                        href="#bib-hr-time" title="High Resolution Time">HR-TIME</a></cite>] の「Privacy and
                Security」を参照。この値は以下の手順で計算:
            </p>
            <ol>
                <li><var>now</var> を
                    <a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                        href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                    型で現在の高解像度時刻（ミリ秒）として取得する。
                </li>
                <li><var>deadline</var> は、<a data-link-type="idl" data-lt="IdleDeadline" href="#dom-idledeadline"
                        class="internalDFN" id="ref-for-dom-idledeadline-5"><code>IdleDeadline</code></a> の <a
                        href="#dfn-get-deadline-time" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-get-deadline-time-1">期限時刻の取得アルゴリズム</a> の結果とする。</li>
                <li><var>timeRemaining</var> を <var>deadline</var> -
                    <var>now</var> とする。
                </li>
                <li><var>timeRemaining</var> が負なら 0 にする。</li>
                <li><var>timeRemaining</var> を返す。</li>
            </ol>
            <p>各 <a href="#dom-idledeadline" class="internalDFN" data-link-type="idl"
                    id="ref-for-dom-idledeadline-6"><code>IdleDeadline</code></a> には <dfn id="dfn-timeout" tabindex="0"
                    aria-haspopup="dialog" data-dfn-type="dfn">timeout</dfn> が関連付けられ、初期値は false である。
                <code><dfn data-export="" data-dfn-type="attribute" id="dom-idledeadline-didtimeout" data-idl="attribute" data-title="didTimeout" data-dfn-for="IdleDeadline" data-type="boolean" data-lt="didTimeout" data-local-lt="IdleDeadline.didTimeout" tabindex="0" aria-haspopup="dialog">didTimeout</dfn></code>
                ゲッターは必ず
                <a href="#dfn-timeout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-timeout-1">timeout</a>
                を返す。
            </p>
            <div class="note" role="note" id="issue-container-generatedID-6">
                <div role="heading" class="note-title marker" id="h-note-7" aria-level="4"><span>注記</span></div>
                <p class=""><a href="#dfn-invoke-idle-callback-timeout-algorithm" class="internalDFN"
                        data-link-type="dfn"
                        id="ref-for-dfn-invoke-idle-callback-timeout-algorithm-2">アイドルコールバックタイムアウトアルゴリズム</a> は
                    <a href="#dfn-timeout" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-timeout-2">timeout</a> を true にし、これは登録時に渡された
                    <a href="#dom-idlerequestoptions" class="internalDFN" data-link-type="idl"
                        id="ref-for-dom-idlerequestoptions-3"><code>IdleRequestOptions</code></a> のタイムアウトプロパティ値超過により
                    アイドル期間外でコールバックが実行されることを示す。
                </p>
            </div>
        </section>
    </section>
    <section id="processing">
        <div class="header-wrapper">
            <h2 id="x5-processing"><bdi class="secno">5. </bdi>処理</h2><a class="self-link" href="#processing"
                aria-label="Permalink for Section 5."></a>
        </div>

        <section id="start-an-idle-period-algorithm">
            <div class="header-wrapper">
                <h3 id="x5-1-start-an-idle-period-algorithm"><bdi class="secno">5.1 </bdi>アイドル期間開始アルゴリズム
                </h3><a class="self-link" href="#start-an-idle-period-algorithm"
                    aria-label="Permalink for Section 5.1"></a>
            </div>

            <p><dfn class="export" data-export="" id="dfn-start-an-idle-period" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">アイドル期間を開始する</dfn>には、<a data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                <var>window</var> と
                <var>getDeadline</var>（<a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                を返すアルゴリズム）を与えて行う：[<cite><a class="bibref" data-link-type="biblio" href="#bib-hr-time"
                        title="High Resolution Time">HR-TIME</a></cite>]

            </p>
            <div class="note" role="note" id="issue-container-generatedID-7">
                <div role="heading" class="note-title marker" id="h-note-8" aria-level="4"><span>注記</span></div>
                <p class="">このアルゴリズムは
                    <a href="https://html.spec.whatwg.org/multipage/#event-loop-processing-model">イベントループ処理モデル</a>
                    により、<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">イベントループ</a>が
                    アイドルであると判断したときに呼び出される。
                </p>
            </div>

            <ol>
                <li>ユーザーエージェントがアイドル期間を遅延すべきと判断した場合は、オプションでこのアルゴリズムからリターンしてよい。
                    <div class="note" role="note" id="issue-container-generatedID-8">
                        <div role="heading" class="note-title marker" id="h-note-9" aria-level="4"><span>注記</span>
                        </div>
                        <p class="" data-cite="page-visibility-2">
                            これはユーザーエージェントが必要に応じてデバイスの省電力最適化のため、アイドル期間の開始を遅らせられるようにする意図です。たとえば、<a
                                data-link-type="interface" data-lt="Document"
                                href="https://dom.spec.whatwg.org/#document"><code>Document</code></a> の <a
                                data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/interaction.html#visibility-state">visibility
                                state</a> が "hidden" の場合は、ユーザーエージェントはアイドル期間生成を間引き、
                            たとえば10秒に1度だけアイドル期間を発生させて省電力最適化を行うことができる。</p>
                    </div>
                </li>
                <li><var>pending_list</var> を<var>window</var>の<a href="#dfn-list-of-idle-request-callbacks"
                        class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-idle-request-callbacks-5">アイドルリクエストコールバックのリスト</a>とする。
                </li>
                <li><var>run_list</var> を<var>window</var>の<a href="#dfn-list-of-runnable-idle-callbacks"
                        class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-4">実行可能アイドルコールバックのリスト</a>とする。
                </li>
                <li><var>pending_list</var>の全エントリを順序を保ったまま<var>run_list</var>の末尾に追加する。
                </li>
                <li><var>pending_list</var>をクリアする。</li>
                <li>アイドルタスク用<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">タスク</a>を、
                    <a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">task source</a>
                    に紐づくキューにキューイングし、パラメータとして<var>window</var>と<var>getDeadline</var>を用いて
                    <a href="#dfn-invoke-idle-callbacks-algorithm" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-invoke-idle-callbacks-algorithm-1">アイドルコールバック呼び出しアルゴリズム</a> のステップを実行する。
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-9">
                <div role="heading" class="note-title marker" id="h-note-10" aria-level="4"><span>注記</span></div>
                <div class="">
                    <p>現在から期限(deadline)までの時間を<dfn id="dfn-idle-period" tabindex="0" aria-haspopup="dialog"
                            data-dfn-type="dfn">アイドル期間</dfn>という。同じ<a data-link-type="interface" data-lt="Window"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                        につきアクティブなアイドル期間は同時に1つしか存在しない。ユーザーエージェントはアイドルでなくなったと判断した時点で
                        このアイドル期間を早期終了でき、その場合次のアイドル期間は<var>deadline</var>より後にしか始まらない。</p>
                </div>
            </div>
        </section>
        <section id="invoke-idle-callbacks-algorithm">
            <div class="header-wrapper">
                <h3 id="x5-2-invoke-idle-callbacks-algorithm"><bdi class="secno">5.2 </bdi>アイドルコールバック呼び出しアルゴリズム</h3><a
                    class="self-link" href="#invoke-idle-callbacks-algorithm"
                    aria-label="Permalink for Section 5.2"></a>
            </div>

            <p><dfn id="dfn-invoke-idle-callbacks-algorithm" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">アイドルコールバック呼び出しアルゴリズム</dfn>を<a data-link-type="interface" data-lt="Window"
                    href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><code>Window</code></a>
                <var>window</var> と
                <var>getDeadline</var>（<a data-link-type="typedef" data-lt="DOMHighResTimeStamp"
                    href="https://www.w3.org/TR/hr-time-3/#dom-domhighrestimestamp"><code>DOMHighResTimeStamp</code></a>
                を返すアルゴリズム）で行う：[<cite><a class="bibref" data-link-type="biblio" href="#bib-hr-time"
                        title="High Resolution Time">HR-TIME</a></cite>]。
            </p>
            <ol>
                <li>ユーザーエージェントが新たに高優先度な作業がスケジューリングされたなどの理由でアイドル期間を早期終了すべきだと判断した場合、このアルゴリズムからリターン。
                </li>
                <li><var>now</var>を現在時刻にする。</li>
                <li><var>now</var>が<var>getDeadline</var>の呼び出し結果より小さく、かつ
                    <var>window</var>の<a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN"
                        data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-5">実行可能アイドルコールバックのリスト</a>が空でなければ:
                    <ol>
                        <li><var>window</var>の<a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN"
                                data-link-type="dfn"
                                id="ref-for-dfn-list-of-runnable-idle-callbacks-6">実行可能アイドルコールバックのリスト</a>から
                            先頭の<var>callback</var>をpopする。
                        </li>
                        <li><a href="#dom-idledeadline" class="internalDFN" data-link-type="idl"
                                id="ref-for-dom-idledeadline-7"><code>IdleDeadline</code></a>
                            を生成し、その<a href="#dfn-get-deadline-time" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-get-deadline-time-2">期限時刻の取得</a>アルゴリズムを<var>getDeadline</var>
                            にする。この<var>deadlineArg</var>を用意する。
                        </li>
                        <li><a data-link-type="dfn"
                                href="https://webidl.spec.whatwg.org/#invoke-a-callback-function">コールバック関数の呼び出し</a>で
                            <var>callback</var>を « <var>deadlineArg</var> » , "<code>report</code>"を引数に呼び出す。
                        </li>
                        <li><var>window</var>の<a href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN"
                                data-link-type="dfn"
                                id="ref-for-dfn-list-of-runnable-idle-callbacks-7">実行可能アイドルコールバックのリスト</a>
                            が空でなければ、タスクを<a data-link-type="dfn"
                                href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">キューイング</a>し、
                            パラメータには<var>getDeadline</var>と<var>window</var>を使い、本アルゴリズムの残りステップを実行してリターン
                        </li>
                    </ol>
                </li>
            </ol>
            <div class="note" role="note" id="issue-container-generatedID-10">
                <div role="heading" class="note-title marker" id="h-note-11" aria-level="4"><span>注記</span></div>
                <p class="">ユーザーエージェントは、たとえ<var>deadline</var>に達していなくても、ステップ1のリターンでアイドル期間を早期終了してよい。
                    たとえば高優先度作業が実行可能になった場合などで判断される。</p>
            </div>
        </section>
        <section id="invoke-idle-callback-timeout-algorithm">
            <div class="header-wrapper">
                <h3 id="x5-3-invoke-idle-callback-timeout-algorithm"><bdi class="secno">5.3
                    </bdi>アイドルコールバックタイムアウト実行アルゴリズム</h3><a class="self-link"
                    href="#invoke-idle-callback-timeout-algorithm" aria-label="Permalink for Section 5.3"></a>
            </div>

            <p><dfn id="dfn-invoke-idle-callback-timeout-algorithm" tabindex="0" aria-haspopup="dialog"
                    data-dfn-type="dfn">アイドルコールバックタイムアウトアルゴリズム</dfn>:</p>
            <ol>
                <li><var>callback</var> を、<var>
                        window</var>の<a href="#dfn-list-of-idle-request-callbacks" class="internalDFN"
                        data-link-type="dfn"
                        id="ref-for-dfn-list-of-idle-request-callbacks-6">アイドルリクエストコールバックのリスト</a>または<a
                        href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-list-of-runnable-idle-callbacks-8">実行可能なアイドルコールバックのリスト</a>から、
                    このアルゴリズムの<var>handle</var>引数に対応するエントリとして探索する。
                </li>
                <li><var>callback</var>がundefinedでない場合:
                    <ol>
                        <li><var>callback</var>を<var>window</var>の<a href="#dfn-list-of-idle-request-callbacks"
                                class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-list-of-idle-request-callbacks-7">アイドルリクエストコールバックのリスト</a>と<a
                                href="#dfn-list-of-runnable-idle-callbacks" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-list-of-runnable-idle-callbacks-9">実行可能なアイドルコールバックのリスト</a>の両方から削除する。
                        </li>
                        <li><var>now</var> を現在時刻にする。</li>
                        <li><a href="#dom-idledeadline" class="internalDFN" data-link-type="idl"
                                id="ref-for-dom-idledeadline-8"><code>IdleDeadline</code></a>
                            の新しいインスタンス<var>deadlineArg</var>を用意し、<a href="#dfn-get-deadline-time" class="internalDFN"
                                data-link-type="dfn"
                                id="ref-for-dfn-get-deadline-time-3">期限時刻取得</a>には<var>now</var>を返すアルゴリズムを設定し、
                            <a href="#dfn-timeout" class="internalDFN" data-link-type="dfn"
                                id="ref-for-dfn-timeout-3">timeout</a>もtrueに設定する。
                        </li>
                        <li><a data-link-type="dfn"
                                href="https://webidl.spec.whatwg.org/#invoke-a-callback-function">コールバック関数の呼び出し</a>
                            で<var>callback</var>を « <var>deadlineArg</var> » , "<code>report</code>"を引数に呼び出す。
                        </li>
                    </ol>
                </li>
            </ol>
        </section>
    </section>
    <section id="privacy-considerations">
        <div class="header-wrapper">
            <h2 id="x6-privacy-considerations"><bdi class="secno">6. </bdi>プライバシーに関する考慮事項</h2><a class="self-link"
                href="#privacy-considerations" aria-label="Permalink for Section 6."></a>
        </div>

        <p>アイドルコールバックをスケジューリングすると、ユーザーエージェントはどのくらいアイドル状態で居��けるつもりかの推定値を提供する。この情報は、そのフレーム内で他のアプリタスクやブラウザー処理にかかる時間を推定するのに利用できる。ただし、開発者はすでに他の手段（たとえば<code>requestAnimationFrame</code>でフレームの開始をマークし、次のフレーム時刻を推定してあらゆるコールバック内で「残り時間」を計算するなど）で得ることは可能である。
        </p>
        <p><a href="#dom-idledeadline" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-idledeadline-9"><code>IdleDeadline</code></a>インターフェースで返すこの時間推定値の精度は、
            キャッシュや統計的フィンガープリント攻撃への対策として、<a data-link-type="dfn" data-lt="coarsen time"
                href="https://www.w3.org/TR/hr-time-3/#dfn-coarsen-time">coarsen time</a> を
            <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability">cross-origin
                isolated capability</a> 基準で粗くすることで、このAPIが他のタイマーAPI以上の情報を公開しないようにすべきである。
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-hr-time"
                    title="High Resolution Time">HR-TIME</a></cite>]
        </p>
    </section>
    <section id="security-considerations">
        <div class="header-wrapper">
            <h2 id="x7-security-considerations"><bdi class="secno">7. </bdi>セキュリティに関する考慮事項</h2><a class="self-link"
                href="#security-considerations" aria-label="Permalink for Section 7."></a>
        </div>

        <p>TBD
        </p>
    </section>
    <section id="acknowledgements" class="appendix">
        <div class="header-wrapper">
            <h2 id="a-acknowledgments"><bdi class="secno">A. </bdi>謝辞</h2><a class="self-link" href="#acknowledgements"
                aria-label="Permalink for Appendix A."></a>
        </div>

        <p>編集者は、本仕様への貢献者として以下の方々に謝意を表します: Sami Kyostila, Alex Clarke, Boris Zbarsky, Marcos
            Caceres, Jonas Sicking, Robert O'Callahan, David Baron, Todd Reifsteck,
            Tobin Titus, Elliott Sprehn, Tetsuharu OHZEKI, Lon Ingram, Domenic Denicola,
            Philippe Le Hegaret and Anne van Kesteren. </p>
    </section>


    <section id="references" class="appendix">
        <div class="header-wrapper">
            <h2 id="b-references"><bdi class="secno">B. </bdi>参考文献</h2><a class="self-link" href="#references"
                aria-label="Permalink for Appendix B."></a>
        </div>
        <section id="normative-references">
            <div class="header-wrapper">
                <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>規範的参考文献</h3><a class="self-link"
                    href="#normative-references" aria-label="Permalink for Appendix B.1"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-hr-time">[HR-TIME]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/hr-time-3/"><cite>High Resolution Time</cite></a>. Yoav Weiss. W3C.
                    2024年11月7日. W3C 作業草案. URL: <a
                        href="https://www.w3.org/TR/hr-time-3/">https://www.w3.org/TR/hr-time-3/</a>
                </dd>
                <dt id="bib-html">[html]</dt>
                <dd>
                    <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van Kesteren;
                    Domenic Denicola; Dominic Farolino; Ian Hickson; Philip Jägenstedt; Simon Pieters. WHATWG.
                    リビングスタンダード. URL: <a
                        href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
                </dd>
                <dt id="bib-rfc2119">[RFC2119]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate
                            Requirement Levels</cite></a>. S. Bradner. IETF. 1997年3月. Best Current Practice. URL: <a
                        href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
                </dd>
                <dt id="bib-rfc8174">[RFC8174]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC
                            2119 Key Words</cite></a>. B. Leiba. IETF. 2017年5月. Best Current Practice. URL: <a
                        href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
                </dd>
                <dt id="bib-webidl">[webidl]</dt>
                <dd>
                    <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Edgar Chen; Timothy Gu.
                    WHATWG. リビングスタンダード. URL: <a
                        href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
                </dd>
            </dl>
        </section>
        <section id="informative-references">
            <div class="header-wrapper">
                <h3 id="b-2-informative-references"><bdi class="secno">B.2 </bdi>参考情報</h3><a class="self-link"
                    href="#informative-references" aria-label="Permalink for Appendix B.2"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-dom">[dom]</dt>
                <dd>
                    <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Anne van Kesteren. WHATWG.
                    リビングスタンダード. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-responsetime">[RESPONSETIME]</dt>
                <dd>
                    <a href="http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf"><cite>Response
                            time in man-computer conversational transactions</cite></a>. Robert B. Miller. 1968年12月.
                    Fall Joint Computer Conference. URL: <a
                        href="http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf">http://yusufarslan.net/sites/yusufarslan.net/files/upload/content/Miller1968.pdf</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="Back to Top">↑</abbr></a>
    </p>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-list-of-idle-request-callbacks"
        aria-label="Links in this document to definition: list of idle request callbacks">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-list-of-idle-request-callbacks"
                aria-label="Permalink for definition: list of idle request callbacks. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-1" title="§ 4.1 The requestIdleCallback() method">§
                    4.1 The requestIdleCallback() method</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-2" title="§ 4.2 The cancelIdleCallback() method">§
                    4.2 The cancelIdleCallback() method</a> <a href="#ref-for-dfn-list-of-idle-request-callbacks-3"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-list-of-idle-request-callbacks-4"
                    title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-5" title="§ 5.1 Start an idle period algorithm">§
                    5.1 Start an idle period algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-idle-request-callbacks-6"
                    title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke idle callback timeout
                    algorithm</a> <a href="#ref-for-dfn-list-of-idle-request-callbacks-7" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-list-of-runnable-idle-callbacks"
        aria-label="Links in this document to definition: list of runnable idle callbacks">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-list-of-runnable-idle-callbacks"
                aria-label="Permalink for definition: list of runnable idle callbacks. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-1" title="§ 4.2 The cancelIdleCallback() method">§
                    4.2 The cancelIdleCallback() method</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-3"
                    title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-4" title="§ 5.1 Start an idle period algorithm">§
                    5.1 Start an idle period algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-5" title="§ 5.2 Invoke idle callbacks algorithm">§
                    5.2 Invoke idle callbacks algorithm</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-6"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-7"
                    title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-8"
                    title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke idle callback timeout
                    algorithm</a> <a href="#ref-for-dfn-list-of-runnable-idle-callbacks-9" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-idle-callback-identifier"
        aria-label="Links in this document to definition: idle callback identifier">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-idle-callback-identifier"
                aria-label="Permalink for definition: idle callback identifier. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-idle-callback-identifier-1" title="§ 4.1 The requestIdleCallback() method">§ 4.1
                    The requestIdleCallback() method</a> <a href="#ref-for-dfn-idle-callback-identifier-2"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-window-requestidlecallback"
        aria-label="Links in this document to definition: requestIdleCallback()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-window-requestidlecallback"
                aria-label="Permalink for definition: requestIdleCallback(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-window-requestidlecallback-1" title="§ 2. Idle Periods">§ 2. Idle Periods</a> <a
                    href="#ref-for-dom-window-requestidlecallback-2" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-window-requestidlecallback-3" title="Reference 3">(3)</a> <a
                    href="#ref-for-dom-window-requestidlecallback-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dom-window-requestidlecallback-5" title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dom-window-requestidlecallback-6" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a> <a href="#ref-for-dom-window-requestidlecallback-7"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-window-requestidlecallback-8" title="§ 4.1 The requestIdleCallback() method">§ 4.1
                    The requestIdleCallback() method</a> <a href="#ref-for-dom-window-requestidlecallback-9"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-window-requestidlecallback-10"
                    title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idlerequestcallback"
        aria-label="Links in this document to definition: IdleRequestCallback">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idlerequestcallback"
                aria-label="Permalink for definition: IdleRequestCallback. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idlerequestcallback-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a> <a href="#ref-for-dom-idlerequestcallback-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idlerequestoptions"
        aria-label="Links in this document to definition: IdleRequestOptions">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idlerequestoptions"
                aria-label="Permalink for definition: IdleRequestOptions. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idlerequestoptions-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a> <a href="#ref-for-dom-idlerequestoptions-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-idlerequestoptions-3" title="§ 4.3 The IdleDeadline interface">§ 4.3 The
                    IdleDeadline interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idlerequestoptions-timeout"
        aria-label="Links in this document to definition: timeout">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idlerequestoptions-timeout"
                aria-label="Permalink for definition: timeout. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idlerequestoptions-timeout-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-window-cancelidlecallback"
        aria-label="Links in this document to definition: cancelIdleCallback()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-window-cancelidlecallback"
                aria-label="Permalink for definition: cancelIdleCallback(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-window-cancelidlecallback-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
            <li>
                <a href="#ref-for-dom-window-cancelidlecallback-2" title="§ 4.2 The cancelIdleCallback() method">§ 4.2
                    The cancelIdleCallback() method</a> <a href="#ref-for-dom-window-cancelidlecallback-3"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-window-cancelidlecallback-4"
                    title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idledeadline"
        aria-label="Links in this document to definition: IdleDeadline">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idledeadline"
                aria-label="Permalink for definition: IdleDeadline. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idledeadline-1" title="§ 4. Window interface extensions">§ 4. Window interface
                    extensions</a> <a href="#ref-for-dom-idledeadline-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-3" title="§ 4.3 The IdleDeadline interface">§ 4.3 The IdleDeadline
                    interface</a> <a href="#ref-for-dom-idledeadline-4" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-idledeadline-5" title="Reference 3">(3)</a> <a href="#ref-for-dom-idledeadline-6"
                    title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-7" title="§ 5.2 Invoke idle callbacks algorithm">§ 5.2 Invoke idle
                    callbacks algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-8" title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke
                    idle callback timeout algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dom-idledeadline-9" title="§ 6. Privacy Considerations">§ 6. Privacy
                    Considerations</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-get-deadline-time"
        aria-label="Links in this document to definition: get deadline time">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-get-deadline-time"
                aria-label="Permalink for definition: get deadline time. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-get-deadline-time-1" title="§ 4.3 The IdleDeadline interface">§ 4.3 The
                    IdleDeadline interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-get-deadline-time-2" title="§ 5.2 Invoke idle callbacks algorithm">§ 5.2 Invoke
                    idle callbacks algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-get-deadline-time-3" title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3
                    Invoke idle callback timeout algorithm</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idledeadline-timeremaining"
        aria-label="Links in this document to definition: timeRemaining()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idledeadline-timeremaining"
                aria-label="Permalink for definition: timeRemaining(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idledeadline-timeremaining-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-timeout"
        aria-label="Links in this document to definition: timeout">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-timeout"
                aria-label="Permalink for definition: timeout. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-timeout-1" title="§ 4.3 The IdleDeadline interface">§ 4.3 The IdleDeadline
                    interface</a> <a href="#ref-for-dfn-timeout-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-timeout-3" title="§ 5.3 Invoke idle callback timeout algorithm">§ 5.3 Invoke idle
                    callback timeout algorithm</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-idledeadline-didtimeout"
        aria-label="Links in this document to definition: didTimeout">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-idledeadline-didtimeout"
                aria-label="Permalink for definition: didTimeout. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1323139649">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-idledeadline-didtimeout-1" title="§ 4. Window interface extensions">§ 4. Window
                    interface extensions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-start-an-idle-period"
        aria-label="Links in this document to definition: start an idle period">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-start-an-idle-period"
                aria-label="Permalink for definition: start an idle period. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>Not referenced in this document.</li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-idle-period"
        aria-label="Links in this document to definition: idle period">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-idle-period"
                aria-label="Permalink for definition: idle period. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-idle-period-1" title="§ 4.1 The requestIdleCallback() method">§ 4.1 The
                    requestIdleCallback() method</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-invoke-idle-callbacks-algorithm"
        aria-label="Links in this document to definition: invoke idle callbacks algorithm">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-invoke-idle-callbacks-algorithm"
                aria-label="Permalink for definition: invoke idle callbacks algorithm. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callbacks-algorithm-1" title="§ 5.1 Start an idle period algorithm">§
                    5.1 Start an idle period algorithm</a>
            </li>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callbacks-algorithm-2" title="§ 5.2 Invoke idle callbacks algorithm">§
                    5.2 Invoke idle callbacks algorithm</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-invoke-idle-callback-timeout-algorithm"
        aria-label="Links in this document to definition: invoke idle callback timeout algorithm">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-invoke-idle-callback-timeout-algorithm"
                aria-label="Permalink for definition: invoke idle callback timeout algorithm. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callback-timeout-algorithm-1"
                    title="§ 4.1 The requestIdleCallback() method">§ 4.1 The requestIdleCallback() method</a>
            </li>
            <li>
                <a href="#ref-for-dfn-invoke-idle-callback-timeout-algorithm-2"
                    title="§ 4.3 The IdleDeadline interface">§ 4.3 The IdleDeadline interface</a>
            </li>
        </ul>
    </div>
    <script id="respec-highlight-vars">(() => {
            // @ts-check

            if (document.respec) {
                document.respec.ready.then(setupVarHighlighter);
            } else {
                setupVarHighlighter();
            }

            function setupVarHighlighter() {
                document
                    .querySelectorAll("var")
                    .forEach(varElem => varElem.addEventListener("click", highlightListener));
            }

            function highlightListener(ev) {
                ev.stopPropagation();
                const { target: varElem } = ev;
                const hightligtedElems = highlightVars(varElem);
                const resetListener = () => {
                    const hlColor = getHighlightColor(varElem);
                    hightligtedElems.forEach(el => removeHighlight(el, hlColor));
                    [...HL_COLORS.keys()].forEach(key => HL_COLORS.set(key, true));
                };
                if (hightligtedElems.length) {
                    document.body.addEventListener("click", resetListener, { once: true });
                }
            }

            // availability of highlight colors. colors from var.css
            const HL_COLORS = new Map([
                ["respec-hl-c1", true],
                ["respec-hl-c2", true],
                ["respec-hl-c3", true],
                ["respec-hl-c4", true],
                ["respec-hl-c5", true],
                ["respec-hl-c6", true],
                ["respec-hl-c7", true],
            ]);

            function getHighlightColor(target) {
                // return current colors if applicable
                const { value } = target.classList;
                const re = /respec-hl-\w+/;
                const activeClass = re.test(value) && value.match(re);
                if (activeClass) return activeClass[0];

                // first color preference
                if (HL_COLORS.get("respec-hl-c1") === true) return "respec-hl-c1";

                // otherwise get some other available color
                return [...HL_COLORS.keys()].find(c => HL_COLORS.get(c)) || "respec-hl-c1";
            }

            function highlightVars(varElem) {
                const textContent = norm(varElem.textContent);
                const parent = varElem.closest(".algorithm, section");
                const highlightColor = getHighlightColor(varElem);

                const varsToHighlight = [...parent.querySelectorAll("var")].filter(
                    el =>
                        norm(el.textContent) === textContent &&
                        el.closest(".algorithm, section") === parent
                );

                // update availability of highlight color
                const colorStatus = varsToHighlight[0].classList.contains("respec-hl");
                HL_COLORS.set(highlightColor, colorStatus);

                // highlight vars
                if (colorStatus) {
                    varsToHighlight.forEach(el => removeHighlight(el, highlightColor));
                    return [];
                } else {
                    varsToHighlight.forEach(el => addHighlight(el, highlightColor));
                }
                return varsToHighlight;
            }

            function removeHighlight(el, highlightColor) {
                el.classList.remove("respec-hl", highlightColor);
                // clean up empty class attributes so they don't come in export
                if (!el.classList.length) el.removeAttribute("class");
            }

            function addHighlight(elem, highlightColor) {
                elem.classList.add("respec-hl", highlightColor);
            }

            /**
             * Same as `norm` from src/core/utils, but our build process doesn't allow
             * imports in runtime scripts, so duplicated here.
             * @param {string} str
             */
            function norm(str) {
                return str.trim().replace(/\s+/g, " ");
            }
        })()</script>
    <script id="respec-dfn-panel">(() => {
                                               // @ts-check
                                               if (document.respec) {
                                                   document.respec.ready.then(setupPanel);
                                               } else {
                                                   setupPanel();
                                               }

                                               function setupPanel() {
                                                   const listener = panelListener();
                                                   document.body.addEventListener("keydown", listener);
                                                   document.body.addEventListener("click", listener);
                                               }

                                               function panelListener() {
                                                   /** @type {HTMLElement} */
                                                   let panel = null;
                                                   return event => {
                                                       const { target, type } = event;

                                                       if (!(target instanceof HTMLElement)) return;

                                                       // For keys, we only care about Enter key to activate the panel
                                                       // otherwise it's activated via a click.
                                                       if (type === "keydown" && event.key !== "Enter") return;

                                                       const action = deriveAction(event);

                                                       switch (action) {
                                                           case "show": {
                                                               hidePanel(panel);
                                                               /** @type {HTMLElement} */
                                                               const dfn = target.closest("dfn, .index-term");
                                                               panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
                                                               const coords = deriveCoordinates(event);
                                                               displayPanel(dfn, panel, coords);
                                                               break;
                                                           }
                                                           case "dock": {
                                                               panel.style.left = null;
                                                               panel.style.top = null;
                                                               panel.classList.add("docked");
                                                               break;
                                                           }
                                                           case "hide": {
                                                               hidePanel(panel);
                                                               panel = null;
                                                               break;
                                                           }
                                                       }
                                                   };
                                               }

                                               /**
                                                * @param {MouseEvent|KeyboardEvent} event
                                                */
                                               function deriveCoordinates(event) {
                                                   const target = /** @type HTMLElement */ (event.target);

                                                   // We prevent synthetic AT clicks from putting
                                                   // the dialog in a weird place. The AT events sometimes
                                                   // lack coordinates, so they have clientX/Y = 0
                                                   const rect = target.getBoundingClientRect();
                                                   if (
                                                       event instanceof MouseEvent &&
                                                       event.clientX >= rect.left &&
                                                       event.clientY >= rect.top
                                                   ) {
                                                       // The event probably happened inside the bounding rect...
                                                       return { x: event.clientX, y: event.clientY };
                                                   }

                                                   // Offset to the middle of the element
                                                   const x = rect.x + rect.width / 2;
                                                   // Placed at the bottom of the element
                                                   const y = rect.y + rect.height;
                                                   return { x, y };
                                               }

                                               /**
                                                * @param {Event} event
                                                */
                                               function deriveAction(event) {
                                                   const target = /** @type {HTMLElement} */ (event.target);
                                                   const hitALink = !!target.closest("a");
                                                   if (target.closest("dfn:not([data-cite]), .index-term")) {
                                                       return hitALink ? "none" : "show";
                                                   }
                                                   if (target.closest(".dfn-panel")) {
                                                       if (hitALink) {
                                                           return target.classList.contains("self-link") ? "hide" : "dock";
                                                       }
                                                       const panel = target.closest(".dfn-panel");
                                                       return panel.classList.contains("docked") ? "hide" : "none";
                                                   }
                                                   if (document.querySelector(".dfn-panel:not([hidden])")) {
                                                       return "hide";
                                                   }
                                                   return "none";
                                               }

                                               /**
                                                * @param {HTMLElement} dfn
                                                * @param {HTMLElement} panel
                                                * @param {{ x: number, y: number }} clickPosition
                                                */
                                               function displayPanel(dfn, panel, { x, y }) {
                                                   panel.hidden = false;
                                                   // distance (px) between edge of panel and the pointing triangle (caret)
                                                   const MARGIN = 20;

                                                   const dfnRects = dfn.getClientRects();
                                                   // Find the `top` offset when the `dfn` can be spread across multiple lines
                                                   let closestTop = 0;
                                                   let minDiff = Infinity;
                                                   for (const rect of dfnRects) {
                                                       const { top, bottom } = rect;
                                                       const diffFromClickY = Math.abs((top + bottom) / 2 - y);
                                                       if (diffFromClickY < minDiff) {
                                                           minDiff = diffFromClickY;
                                                           closestTop = top;
                                                       }
                                                   }

                                                   const top = window.scrollY + closestTop + dfnRects[0].height;
                                                   const left = x - MARGIN;
                                                   panel.style.left = `${left}px`;
                                                   panel.style.top = `${top}px`;

                                                   // Find if the panel is flowing out of the window
                                                   const panelRect = panel.getBoundingClientRect();
                                                   const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
                                                   if (panelRect.right > SCREEN_WIDTH) {
                                                       const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
                                                       const newCaretOffset = left - newLeft;
                                                       panel.style.left = `${newLeft}px`;
                                                       /** @type {HTMLElement} */
                                                       const caret = panel.querySelector(".caret");
                                                       caret.style.left = `${newCaretOffset}px`;
                                                   }

                                                   // As it's a dialog, we trap focus.
                                                   // TODO: when <dialog> becomes a implemented, we should really
                                                   // use that.
                                                   trapFocus(panel, dfn);
                                               }

                                               /**
                                                * @param {HTMLElement} panel
                                                * @param {HTMLElement} dfn
                                                * @returns
                                                */
                                               function trapFocus(panel, dfn) {
                                                   /** @type NodeListOf<HTMLAnchorElement> elements */
                                                   const anchors = panel.querySelectorAll("a[href]");
                                                   // No need to trap focus
                                                   if (!anchors.length) return;

                                                   // Move focus to first anchor element
                                                   const first = anchors.item(0);
                                                   first.focus();

                                                   const trapListener = createTrapListener(anchors, panel, dfn);
                                                   panel.addEventListener("keydown", trapListener);

                                                   // Hiding the panel releases the trap
                                                   const mo = new MutationObserver(records => {
                                                       const [record] = records;
                                                       const target = /** @type HTMLElement */ (record.target);
                                                       if (target.hidden) {
                                                           panel.removeEventListener("keydown", trapListener);
                                                           mo.disconnect();
                                                       }
                                                   });
                                                   mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
                                               }

                                               /**
                                                *
                                                * @param {NodeListOf<HTMLAnchorElement>} anchors
                                                * @param {HTMLElement} panel
                                                * @param {HTMLElement} dfn
                                                * @returns
                                                */
                                               function createTrapListener(anchors, panel, dfn) {
                                                   const lastIndex = anchors.length - 1;
                                                   let currentIndex = 0;
                                                   return event => {
                                                       switch (event.key) {
                                                           // Hitting "Tab" traps us in a nice loop around elements.
                                                           case "Tab": {
                                                               event.preventDefault();
                                                               currentIndex += event.shiftKey ? -1 : +1;
                                                               if (currentIndex < 0) {
                                                                   currentIndex = lastIndex;
                                                               } else if (currentIndex > lastIndex) {
                                                                   currentIndex = 0;
                                                               }
                                                               anchors.item(currentIndex).focus();
                                                               break;
                                                           }

                                                           // Hitting "Enter" on an anchor releases the trap.
                                                           case "Enter":
                                                               hidePanel(panel);
                                                               break;

                                                           // Hitting "Escape" returns focus to dfn.
                                                           case "Escape":
                                                               hidePanel(panel);
                                                               dfn.focus();
                                                               return;
                                                       }
                                                   };
                                               }

                                               /** @param {HTMLElement} panel */
                                               function hidePanel(panel) {
                                                   if (!panel) return;
                                                   panel.hidden = true;
                                                   panel.classList.remove("docked");
                                               }
                                           })()</script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <script src="https://htmlspecs.com/dropdown.js"></script>
</body>

</html>