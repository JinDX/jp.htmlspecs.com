<!doctype html>
<html lang="ja-JP">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>サブリソース整合性</title>
    <meta content="WD" name="w3c-status">
    <meta content="Bikeshed version 618007319, updated Thu Jun 26 17:23:55 2025 -0700" name="generator">
    <link href="https://www.w3.org/TR/sri-2/" rel="canonical">
    <meta content="f7029a47215628e91d97cf30def3db3c1adf5575" name="revision">
    <meta content="dark light" name="color-scheme">
    <style>
        /* Boilerplate: style-autolinks */
        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --selflink-text: black;
                --selflink-bg: silver;
                --selflink-hover-text: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-colors */
        /* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
        :root {
            color-scheme: light dark;

            --text: black;
            --bg: white;

            --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

            --logo-bg: #1a5e9a;
            --logo-active-bg: #c00;
            --logo-text: white;

            --tocnav-normal-text: #707070;
            --tocnav-normal-bg: var(--bg);
            --tocnav-hover-text: var(--tocnav-normal-text);
            --tocnav-hover-bg: #f8f8f8;
            --tocnav-active-text: #c00;
            --tocnav-active-bg: var(--tocnav-normal-bg);

            --tocsidebar-text: var(--text);
            --tocsidebar-bg: #f7f8f9;
            --tocsidebar-shadow: rgba(0, 0, 0, .1);
            --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

            --toclink-text: var(--text);
            --toclink-underline: #3980b5;
            --toclink-visited-text: var(--toclink-text);
            --toclink-visited-underline: #054572;

            --heading-text: #005a9c;

            --hr-text: var(--text);

            --algo-border: #def;

            --del-text: red;
            --del-bg: transparent;
            --ins-text: #080;
            --ins-bg: transparent;

            --a-normal-text: #034575;
            --a-normal-underline: #bbb;
            --a-visited-text: var(--a-normal-text);
            --a-visited-underline: #707070;
            --a-hover-bg: rgba(75%, 75%, 75%, .25);
            --a-active-text: #c00;
            --a-active-underline: #c00;

            --blockquote-border: silver;
            --blockquote-bg: transparent;
            --blockquote-text: currentcolor;

            --issue-border: #e05252;
            --issue-bg: #fbe9e9;
            --issue-text: var(--text);
            --issueheading-text: #831616;

            --example-border: #e0cb52;
            --example-bg: #fcfaee;
            --example-text: var(--text);
            --exampleheading-text: #574b0f;

            --note-border: #52e052;
            --note-bg: #e9fbe9;
            --note-text: var(--text);
            --noteheading-text: hsl(120, 70%, 30%);
            --notesummary-underline: silver;

            --assertion-border: #aaa;
            --assertion-bg: #eee;
            --assertion-text: black;

            --advisement-border: orange;
            --advisement-bg: #fec;
            --advisement-text: var(--text);
            --advisementheading-text: #b35f00;

            --warning-border: red;
            --warning-bg: hsla(40, 100%, 50%, 0.95);
            --warning-text: var(--text);

            --amendment-border: #330099;
            --amendment-bg: #F5F0FF;
            --amendment-text: var(--text);
            --amendmentheading-text: #220066;

            --def-border: #8ccbf2;
            --def-bg: #def;
            --def-text: var(--text);
            --defrow-border: #bbd7e9;

            --datacell-border: silver;

            --indexinfo-text: #707070;

            --indextable-hover-text: black;
            --indextable-hover-bg: #f7f8f9;

            --outdatedspec-bg: rgba(0, 0, 0, .5);
            --outdatedspec-text: black;
            --outdated-bg: maroon;
            --outdated-text: white;
            --outdated-shadow: red;

            --editedrec-bg: darkorange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ddd;
                --bg: black;

                --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

                --logo-bg: #1a5e9a;
                --logo-active-bg: #c00;
                --logo-text: white;

                --tocnav-normal-text: #999;
                --tocnav-normal-bg: var(--bg);
                --tocnav-hover-text: var(--tocnav-normal-text);
                --tocnav-hover-bg: #080808;
                --tocnav-active-text: #f44;
                --tocnav-active-bg: var(--tocnav-normal-bg);

                --tocsidebar-text: var(--text);
                --tocsidebar-bg: #080808;
                --tocsidebar-shadow: rgba(255, 255, 255, .1);
                --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

                --toclink-text: var(--text);
                --toclink-underline: #6af;
                --toclink-visited-text: var(--toclink-text);
                --toclink-visited-underline: #054572;

                --heading-text: #8af;

                --hr-text: var(--text);

                --algo-border: #456;

                --del-text: #f44;
                --del-bg: transparent;
                --ins-text: #4a4;
                --ins-bg: transparent;

                --a-normal-text: #6af;
                --a-normal-underline: #555;
                --a-visited-text: var(--a-normal-text);
                --a-visited-underline: var(--a-normal-underline);
                --a-hover-bg: rgba(25%, 25%, 25%, .2);
                --a-active-text: #f44;
                --a-active-underline: var(--a-active-text);

                --borderedblock-bg: rgba(255, 255, 255, .05);

                --blockquote-border: silver;
                --blockquote-bg: var(--borderedblock-bg);
                --blockquote-text: currentcolor;

                --issue-border: #e05252;
                --issue-bg: var(--borderedblock-bg);
                --issue-text: var(--text);
                --issueheading-text: hsl(0deg, 70%, 70%);

                --example-border: hsl(50deg, 90%, 60%);
                --example-bg: var(--borderedblock-bg);
                --example-text: var(--text);
                --exampleheading-text: hsl(50deg, 70%, 70%);

                --note-border: hsl(120deg, 100%, 35%);
                --note-bg: var(--borderedblock-bg);
                --note-text: var(--text);
                --noteheading-text: hsl(120, 70%, 70%);
                --notesummary-underline: silver;

                --assertion-border: #444;
                --assertion-bg: var(--borderedblock-bg);
                --assertion-text: var(--text);

                --advisement-border: orange;
                --advisement-bg: #222218;
                --advisement-text: var(--text);
                --advisementheading-text: #f84;

                --warning-border: red;
                --warning-bg: hsla(40, 100%, 20%, 0.95);
                --warning-text: var(--text);

                --amendment-border: #330099;
                --amendment-bg: #080010;
                --amendment-text: var(--text);
                --amendmentheading-text: #cc00ff;

                --def-border: #8ccbf2;
                --def-bg: #080818;
                --def-text: var(--text);
                --defrow-border: #136;

                --datacell-border: silver;

                --indexinfo-text: #aaa;

                --indextable-hover-text: var(--text);
                --indextable-hover-bg: #181818;

                --outdatedspec-bg: rgba(255, 255, 255, .5);
                --outdatedspec-text: black;
                --outdated-bg: maroon;
                --outdated-text: white;
                --outdated-shadow: red;

                --editedrec-bg: darkorange;
            }

            /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
            img {
                background: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-counters */
        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
            --dfnpanel-target-bg: #ffc;
            --dfnpanel-target-outline: orange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
                --dfnpanel-target-bg: #333;
                --dfnpanel-target-outline: silver;
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel a:focus {
            outline: 5px auto Highlight;
            outline: 5px auto -webkit-focus-ring-color;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: 8px;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
            transition: left 1s ease-out, bottom 1s ease-out;
        }

        .dfn-panel .link-item:hover {
            text-decoration: underline;
        }

        .dfn-panel .link-item .copy-icon {
            opacity: 0;
        }

        .dfn-panel .link-item:hover .copy-icon,
        .dfn-panel .link-item .copy-icon:focus {
            opacity: 1;
        }

        .dfn-panel .copy-icon {
            display: inline-block;
            margin-right: 0.5em;
            width: 0.85em;
            height: 1em;
            border-radius: 3px;
            background-color: #ccc;
            cursor: pointer;
        }

        .dfn-panel .copy-icon .icon {
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .dfn-panel .copy-icon .icon::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #ccc;
            opacity: 0.25;
            transform: translate(3px, -3px);
        }

        .dfn-panel .copy-icon:active .icon::before {
            opacity: 1;
        }

        .dfn-paneled[role="button"] {
            cursor: help;
        }

        .highlighted {
            animation: target-fade 3s;
        }

        @keyframes target-fade {
            from {
                background-color: var(--dfnpanel-target-bg);
                outline: 5px solid var(--dfnpanel-target-outline);
            }

            to {
                color: var(--a-normal-text);
                background-color: transparent;
                outline: transparent;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-idl-highlighting */
        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }
    </style>
    <style>
        /* Boilerplate: style-issues */
        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* Boilerplate: style-md-lists */
        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* Boilerplate: style-ref-hints */
        :root {
            --ref-hint-bg: #ddd;
            --ref-hint-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ref-hint-bg: #222;
                --ref-hint-text: var(--text);
            }
        }

        .ref-hint {
            display: inline-block;
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.5em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--ref-hint-bg);
            color: var(--ref-hint-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .ref-hint * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .ref-hint ul {
            padding: 0 0 0 1em;
            list-style: none;
        }
    </style>
    <style>
        /* Boilerplate: style-selflinks */
        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* Boilerplate: style-syntax-highlighting */
        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */

        @media (prefers-color-scheme: dark) {
            .highlight:not(.idl) {
                background: rgba(255, 255, 255, .05);
            }

            c-[a] {
                color: #d33682
            }

            /* Keyword.Declaration */
            c-[b] {
                color: #d33682
            }

            /* Keyword.Type */
            c-[c] {
                color: #2aa198
            }

            /* Comment */
            c-[d] {
                color: #2aa198
            }

            /* Comment.Multiline */
            c-[e] {
                color: #268bd2
            }

            /* Name.Attribute */
            c-[f] {
                color: #b58900
            }

            /* Name.Tag */
            c-[g] {
                color: #cb4b16
            }

            /* Name.Variable */
            c-[k] {
                color: #d33682
            }

            /* Keyword */
            c-[l] {
                color: #657b83
            }

            /* Literal */
            c-[m] {
                color: #657b83
            }

            /* Literal.Number */
            c-[n] {
                color: #268bd2
            }

            /* Name */
            c-[o] {
                color: #657b83
            }

            /* Operator */
            c-[p] {
                color: #657b83
            }

            /* Punctuation */
            c-[s] {
                color: #6c71c4
            }

            /* Literal.String */
            c-[t] {
                color: #6c71c4
            }

            /* Literal.String.Single */
            c-[u] {
                color: #6c71c4
            }

            /* Literal.String.Double */
            c-[ch] {
                color: #2aa198
            }

            /* Comment.Hashbang */
            c-[cp] {
                color: #2aa198
            }

            /* Comment.Preproc */
            c-[cpf] {
                color: #2aa198
            }

            /* Comment.PreprocFile */
            c-[c1] {
                color: #2aa198
            }

            /* Comment.Single */
            c-[cs] {
                color: #2aa198
            }

            /* Comment.Special */
            c-[kc] {
                color: #d33682
            }

            /* Keyword.Constant */
            c-[kn] {
                color: #d33682
            }

            /* Keyword.Namespace */
            c-[kp] {
                color: #d33682
            }

            /* Keyword.Pseudo */
            c-[kr] {
                color: #d33682
            }

            /* Keyword.Reserved */
            c-[ld] {
                color: #657b83
            }

            /* Literal.Date */
            c-[nc] {
                color: #268bd2
            }

            /* Name.Class */
            c-[no] {
                color: #268bd2
            }

            /* Name.Constant */
            c-[nd] {
                color: #268bd2
            }

            /* Name.Decorator */
            c-[ni] {
                color: #268bd2
            }

            /* Name.Entity */
            c-[ne] {
                color: #268bd2
            }

            /* Name.Exception */
            c-[nf] {
                color: #268bd2
            }

            /* Name.Function */
            c-[nl] {
                color: #268bd2
            }

            /* Name.Label */
            c-[nn] {
                color: #268bd2
            }

            /* Name.Namespace */
            c-[py] {
                color: #268bd2
            }

            /* Name.Property */
            c-[ow] {
                color: #657b83
            }

            /* Operator.Word */
            c-[mb] {
                color: #657b83
            }

            /* Literal.Number.Bin */
            c-[mf] {
                color: #657b83
            }

            /* Literal.Number.Float */
            c-[mh] {
                color: #657b83
            }

            /* Literal.Number.Hex */
            c-[mi] {
                color: #657b83
            }

            /* Literal.Number.Integer */
            c-[mo] {
                color: #657b83
            }

            /* Literal.Number.Oct */
            c-[sa] {
                color: #6c71c4
            }

            /* Literal.String.Affix */
            c-[sb] {
                color: #6c71c4
            }

            /* Literal.String.Backtick */
            c-[sc] {
                color: #6c71c4
            }

            /* Literal.String.Char */
            c-[dl] {
                color: #6c71c4
            }

            /* Literal.String.Delimiter */
            c-[sd] {
                color: #6c71c4
            }

            /* Literal.String.Doc */
            c-[se] {
                color: #6c71c4
            }

            /* Literal.String.Escape */
            c-[sh] {
                color: #6c71c4
            }

            /* Literal.String.Heredoc */
            c-[si] {
                color: #6c71c4
            }

            /* Literal.String.Interpol */
            c-[sx] {
                color: #6c71c4
            }

            /* Literal.String.Other */
            c-[sr] {
                color: #6c71c4
            }

            /* Literal.String.Regex */
            c-[ss] {
                color: #6c71c4
            }

            /* Literal.String.Symbol */
            c-[fm] {
                color: #268bd2
            }

            /* Name.Function.Magic */
            c-[vc] {
                color: #cb4b16
            }

            /* Name.Variable.Class */
            c-[vg] {
                color: #cb4b16
            }

            /* Name.Variable.Global */
            c-[vi] {
                color: #cb4b16
            }

            /* Name.Variable.Instance */
            c-[vm] {
                color: #cb4b16
            }

            /* Name.Variable.Magic */
            c-[il] {
                color: #657b83
            }

            /* Literal.Number.Integer.Long */
        }
    </style>
    <style>
        /* Boilerplate: style-wpt */
        :root {
            --wpt-border: hsl(0, 0%, 60%);
            --wpt-bg: hsl(0, 0%, 95%);
            --wpt-text: var(--text);
            --wptheading-text: hsl(0, 0%, 30%);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --wpt-border: hsl(0, 0%, 30%);
                --wpt-bg: var(--borderedblock-bg);
                --wpt-text: var(--text);
                --wptheading-text: hsl(0, 0%, 60%);
            }
        }

        .wpt-tests-block {
            list-style: none;
            border-left: .5em solid var(--wpt-border);
            background: var(--wpt-bg);
            color: var(--wpt-text);
            margin: 1em auto;
            padding: .5em;
        }

        .wpt-tests-block summary {
            color: var(--wptheading-text);
            font-weight: normal;
            text-transform: uppercase;
        }

        .wpt-tests-block summary::marker {
            color: var(--wpt-border);
        }

        .wpt-tests-block summary:hover::marker {
            color: var(--wpt-text);
        }

        /*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
        .wpt-tests-block:not([open]) {
            padding: 0;
            border: none;
            background: none;
            font-size: 0.75em;
            line-height: 1;
            position: relative;
            margin: 1em 0 0;
        }

        .wpt-tests-block:not([open]) summary {
            position: absolute;
            right: 0;
            bottom: 0;
        }

        /*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
        .wpt-tests-block:not([open]):last-child {
            padding-bottom: 1px;
            margin-bottom: -1px;
        }

        /*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
        li:not(:last-child)>.wpt-tests-block:not([open]):last-child,
        dd:not(:last-child)>.wpt-tests-block:not([open]):last-child {
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .wpt-tests-block:not([open]):not(:hover) {
            opacity: 0.5;
        }

        .wpt-tests-list {
            list-style: none;
            display: grid;
            margin: 0;
            padding: 0;
            grid-template-columns: 1fr max-content auto auto;
            grid-column-gap: .5em;
        }

        .wpt-tests-block hr:last-child {
            display: none;
        }

        .wpt-test {
            display: contents;
        }

        .wpt-test>a {
            text-decoration: underline;
            border: none;
        }

        .wpt-test>.wpt-name {
            grid-column: 1;
        }

        .wpt-test>.wpt-results {
            grid-column: 2;
        }

        .wpt-test>.wpt-live {
            grid-column: 3;
        }

        .wpt-test>.wpt-source {
            grid-column: 4;
        }

        .wpt-test>.wpt-results {
            display: flex;
            gap: .1em;
        }

        .wpt-test .wpt-result {
            display: inline-block;
            height: 1em;
            width: 1em;
            border-radius: 50%;
            position: relative;
        }
    </style>
    <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD" rel="stylesheet">
    <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet"
        type="text/css">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/">
                <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a>
        </p>
        <h1 class="p-name no-ref" id="title">サブリソース整合性</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types/#WD">W3C作業草案</a>,
            <time class="dt-updated" datetime="2025-07-10">2025年7月10日</time>
        </p>
        <details open>
            <summary>この文書の詳細情報</summary>
            <div data-fill-with="spec-metadata">
                <dl>
                    <dt>このバージョン:
                    <dd><a class="u-url"
                            href="https://www.w3.org/TR/2025/WD-sri-2-20250710/">https://www.w3.org/TR/2025/WD-sri-2-20250710/</a>
                    <dt>最新版:
                    <dd><a href="https://www.w3.org/TR/sri-2/">https://www.w3.org/TR/sri-2/</a>
                    <dt>編集者草案:
                    <dd><a
                            href="https://w3c.github.io/webappsec-subresource-integrity/">https://w3c.github.io/webappsec-subresource-integrity/</a>
                    <dt>以前のバージョン:
                    <dd><a href="https://www.w3.org/TR/2025/WD-sri-2-20250709/"
                            rel="prev">https://www.w3.org/TR/2025/WD-sri-2-20250709/</a>
                    <dt>履歴:
                    <dd><a class="u-url"
                            href="https://www.w3.org/standards/history/sri-2/">https://www.w3.org/standards/history/sri-2/</a>
                    <dt>フィードバック:
                    <dd><span><a
                                href="mailto:public-webappsec@w3.org?subject=%5Bsri%5D%20YOUR%20TOPIC%20HERE">public-webappsec@w3.org</a>
                            件名 “<kbd>[sri] <i data-lt>… メッセージトピック …</i></kbd>” (<a
                                href="https://lists.w3.org/Archives/Public/public-webappsec/"
                                rel="discussion">アーカイブ</a>)</span>
                    <dd><a href="https://github.com/w3c/webappsec-subresource-integrity/issues/">GitHub</a>
                    <dt class="editor">編集者:
                    <dd class="editor p-author h-card vcard" data-editor-id="68466"><a class="p-name fn u-url url"
                            href="https://frederik-braun.com">Frederik Braun</a> (<span
                            class="p-org org">Mozilla</span>) <a class="u-email email"
                            href="mailto:fbraun@mozilla.com">fbraun@mozilla.com</a>
                    <dt class="editor">以前の編集者:
                    <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url"
                            href="http://devd.me">Devdatta Akhawe</a> (<span class="p-org org">Dropbox Inc.</span>) <a
                            class="u-email email" href="mailto:dev.akhawe@gmail.com">dev.akhawe@gmail.com</a>
                    <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url"
                            href="https://fmarier.org">François Marier</a> (<span class="p-org org">Mozilla</span>) <a
                            class="u-email email" href="mailto:francois@mozilla.com">francois@mozilla.com</a>
                    <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url"
                            href="https://joelweinberger.us">Joel Weinberger</a> (<span class="p-org org">Google
                            Inc.</span>) <a class="u-email email" href="mailto:jww@google.com">jww@google.com</a>
                    <dt>テストスイート:
                    <dd class="wpt-overview"><a
                            href="https://wpt.fyi/results/subresource-integrity/">https://wpt.fyi/results/subresource-integrity/</a>
                </dl>
            </div>
        </details>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> ©
            2025 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr
                title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a
                href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/copyright/software-license/" rel="license"
                title="W3C Software and Document License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">概要</span></h2>
        <p>本仕様は、ユーザーエージェントが取得したリソースが予期しない改ざんなく配信されたことを検証できる仕組みを定義します。</p>
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">この文書の位置付け</span></h2>
    <div data-fill-with="status">
        <p>
            <em>このセクションは、本書の公開時点での文書の位置付けを説明します。最新のW3C出版物の一覧と、本技術レポートの最新改訂版は<a
                    href="https://www.w3.org/TR/">W3C技術レポート索引</a>で確認できます。</em>
        </p>
        <p>
            本書は
            <a href="https://www.w3.org/groups/wg/webappsec">Webアプリケーションセキュリティ作業グループ</a>
            によって、<a
                href="https://www.w3.org/policies/process/20231103/#recs-and-notes">勧告プロセス</a>に従い作業草案として公開されました。本書はW3C勧告となることを意図しています。
        </p>
        <p>
            (<a href="https://lists.w3.org/Archives/Public/public-webappsec/">アーカイブ</a>) 公開メーリングリスト
            <a
                href="mailto:public-webappsec@w3.org?Subject=%5Bsri%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a>
            (<a href="https://www.w3.org/Mail/Request">投稿方法</a>参照)
            が本仕様の議論に推奨されます。
            メール送信時は件名に「sri」を含めてください。例えば：
            「[sri] <em>…コメント概要…</em>」
        </p>
        <p>
            作業草案としての公開は、<abbr
                title="World Wide Web Consortium">W3C</abbr>およびその会員による承認を意味しません。本書はドラフト文書であり、随時更新・差し替え・廃止される可能性があります。進行中の作業以外として引用するのは不適切です。
        </p>
        <p>
            本書は
            <a href="https://www.w3.org/groups/wg/webappsec">Webアプリケーションセキュリティ作業グループ</a>
            によって作成されました。
        </p>
        <p>
            本書は
            <a href="https://www.w3.org/policies/patent-policy/">W3C特許方針</a>の下で活動するグループによって作成されました。
            W3Cはグループ成果物に関して<a href="https://www.w3.org/groups/wg/webappsec/ipr" rel="disclosure">特許開示の公開リスト</a>を管理しています。
            特許開示方法についても記載されています。
            本人が<a href="https://www.w3.org/policies/patent-policy/#def-essential">必須な特許請求</a>を含むと認識した特許を知っている場合は、<a
                href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">W3C特許方針第6節</a>に従い開示しなければなりません。
        </p>
        <p>
            本書は<a href="https://www.w3.org/policies/process/20231103/"
                id="w3c_process_revision">2023年11月3日W3Cプロセス文書</a>の管理下にあります。
        </p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目次</h2>
        <ol class="toc" role="directory">
            <li>
                <a href="#intro"><span class="secno">1</span> <span class="content">はじめに</span></a>
                <ol class="toc">
                    <li><a href="#goals"><span class="secno">1.1</span> <span class="content">目的</span></a>
                    <li>
                        <a href="#examples"><span class="secno">1.2</span> <span class="content">ユースケース・例</span></a>
                        <ol class="toc">
                            <li><a href="#resource-integrity"><span class="secno">1.2.1</span> <span
                                        class="content">リソース整合性</span></a>
                        </ol>
                </ol>
            <li>
                <a href="#terms"><span class="secno">2</span> <span class="content">主要概念と用語</span></a>
                <ol class="toc">
                    <li><a href="#grammar-concepts"><span class="secno">2.1</span> <span
                                class="content">文法上の概念</span></a>
                </ol>
            <li>
                <a href="#framework"><span class="secno">3</span> <span class="content">フレームワーク</span></a>
                <ol class="toc">
                    <li><a href="#integrity-metadata-description"><span class="secno">3.1</span> <span
                                class="content">整合性メタデータ</span></a>
                    <li>
                        <a href="#hash-functions"><span class="secno">3.2</span> <span
                                class="content">暗号学的ハッシュ関数</span></a>
                        <ol class="toc">
                            <li><a href="#agility"><span class="secno">3.2.1</span> <span class="content">柔軟性</span></a>
                            <li><a href="#priority"><span class="secno">3.2.2</span> <span
                                        class="content">優先順位</span></a>
                        </ol>
                    <li>
                        <a href="#verification-algorithms"><span class="secno">3.3</span> <span
                                class="content">レスポンス検証アルゴリズム</span></a>
                        <ol class="toc">
                            <li><a href="#apply-algorithm-to-response"><span class="secno">3.3.1</span> <span
                                        class="content">algorithmをbytesへ適用</span></a>
                            <li><a href="#parse-metadata-section"><span class="secno">3.3.2</span> <span
                                        class="content">メタデータの解析</span></a>
                            <li><a href="#get-the-strongest-metadata"><span class="secno">3.3.3</span> <span
                                        class="content">setから最強のメタデータを取得</span></a>
                            <li><a href="#does-response-match-metadatalist"><span class="secno">3.3.4</span> <span
                                        class="content">bytesがmetadataListに一致するか？</span></a>
                        </ol>
                    <li><a href="#verification-of-html-document-subresources"><span class="secno">3.4</span> <span
                                class="content">HTML文書サブリソースの検証</span></a>
                    <li><a href="#the-integrity-attribute"><span class="secno">3.5</span> <span
                                class="content"><code>integrity</code>属性</span></a>
                    <li><a href="#the-integrity-link-processing-option"><span class="secno">3.6</span> <span
                                class="content"><code>integrity</code>リンク処理オプション</span></a>
                    <li><a href="#handling-integrity-violations"><span class="secno">3.7</span> <span
                                class="content">整合性違反の取り扱い</span></a>
                    <li>
                        <a href="#integrity-policy-section"><span class="secno">3.8</span> <span
                                class="content">Integrity-Policy</span></a>
                        <ol class="toc">
                            <li><a href="#parse-integrity-policy-headers-section"><span class="secno">3.8.1</span> <span
                                        class="content">Integrity-Policyヘッダーの解析</span></a>
                            <li><a href="#should-request-be-blocked-by-integrity-policy-section"><span
                                        class="secno">3.8.2</span> <span class="content">Integrity
                                        Policyによるリクエストのブロック可否</span></a>
                            <li><a href="#report-violations"><span class="secno">3.8.3</span> <span
                                        class="content">違反の報告</span></a>
                        </ol>
                </ol>
            <li><a href="#proxies"><span class="secno">4</span> <span class="content">プロキシ</span></a>
            <li>
                <a href="#security-considerations"><span class="secno">5</span> <span
                        class="content">セキュリティおよびプライバシーの考慮事項</span></a>
                <ol class="toc">
                    <li><a href="#non-secure-contexts"><span class="secno">5.1</span> <span
                                class="content">非セキュアなコンテキストは非セキュアなまま</span></a>
                    <li><a href="#hash-collision-attacks"><span class="secno">5.2</span> <span
                                class="content">ハッシュ衝突攻撃</span></a>
                    <li><a href="#cross-origin-data-leakage"><span class="secno">5.3</span> <span
                                class="content">クロスオリジンのデータ漏洩</span></a>
                </ol>
            <li><a href="#acknowledgements"><span class="secno">6</span> <span class="content">謝辞</span></a>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">適合性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文書規約</span></a>
                    <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span
                                class="content">適合アルゴリズム</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本仕様で定義される用語</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">他仕様で定義される用語</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">規範的参考文献</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">参考情報</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span
                class="content">はじめに</span><a class="self-link" href="#intro"></a></h2>
        <p>ウェブ上のサイトやアプリケーションは、単一オリジンのリソースだけで構成されることはほとんどありません。例えば、著者は様々なサービスやコンテンツ配信ネットワーク（CDN）からスクリプトやスタイルを取得し、配信された内容が本当に期待したものかを信頼する必要があります。攻撃者がユーザーを悪意あるサーバーからコンテンツをダウンロードさせるよう誘導した場合（DNS
            <a data-link-type="biblio" href="#biblio-rfc1035"
                title="Domain names - implementation and specification">[RFC1035]</a>ポイズニングなど）、著者には対処手段がありません。同様に、攻撃者がCDNサーバー上のファイルを置き換えることができれば、任意のコンテンツを注入することも可能です。
        </p>
        <p>安全なチャネルを通じてリソースを配信することで、このリスクの一部は軽減できます。TLS <a data-link-type="biblio" href="#biblio-tls"
                title="The Transport Layer Security (TLS) Protocol Version 1.3">[TLS]</a>、HSTS <a
                data-link-type="biblio" href="#biblio-rfc6797"
                title="HTTP Strict Transport Security (HSTS)">[RFC6797]</a>、公開鍵ピンニング<a data-link-type="biblio"
                href="#biblio-rfc7469"
                title="Public Key Pinning Extension for HTTP">[RFC7469]</a>によって、ユーザーエージェントは本当に意図したサーバーと通信していることをかなり確信できます。しかし、これらの仕組みは<em>サーバー</em>のみを認証し、<em>コンテンツ</em>自体は認証しません。サーバーへのアクセス権を持つ攻撃者（や管理者）は、自由にコンテンツを改ざんできます。理想的には、著者がサーバーの鍵だけでなく<em>コンテンツ</em>もピン留めできれば、リソースの正確な内容だけが読み込まれ、実行されることを保証できます。
        </p>
        <p>本書はそのような検証方式を定義し、2つのHTML要素に<code>integrity</code>属性を拡張します。この属性には、著者が期待するリソースの内容の暗号学的ハッシュ値を格納します。例えば、著者がフレームワークを自身のオリジンではなく共有サーバーから読み込む場合、<code>https://example.com/example-framework.js</code>の<em>期待される</em>SHA-384ハッシュ値が<code>Li9vy3DqF8tnTXuiaAJuML3ky+er10rcgNR/VqsVpcw+ThHmYcwiB1pbOxEbzJr7</code>であると指定すれば、ユーザーエージェントはそのURLから取得したデータが期待したハッシュ値と一致しているかを検証した上で、JavaScriptを実行します。この整合性検証により、攻撃者が悪意あるコンテンツを差し替えるリスクを大幅に低減できます。
        </p>
        <p>この例は、<code>script</code>要素にハッシュ値を追加することでユーザーエージェントに伝達できます：</p>
        <div class="example" id="example-59806504">
            <a class="self-link" href="#example-59806504"></a>

            <pre class="highlight"><c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"https://example.com/example-framework.js"</c->
        <c- e>integrity</c-><c- o>=</c-><c- s>"sha384-Li9vy3DqF8tnTXuiaAJuML3ky+er10rcgNR/VqsVpcw+ThHmYcwiB1pbOxEbzJr7"</c->
        <c- e>crossorigin</c-><c- o>=</c-><c- s>"anonymous"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
        </div>
        <p>もちろん、スクリプトだけでなく他のレスポンスタイプも整合性検証の恩恵を受けます。本仕様の方式は<code>link</code>要素にも適用され、今後のバージョンでは対象範囲が拡張される可能性があります。</p>
        <details class="wpt-tests-block" dir="ltr" lang="en">
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/subresource-integrity/subresource-integrity.html"
                        title="subresource-integrity/subresource-integrity.html">subresource-integrity.html</a> <a
                        class="wpt-live"
                        href="http://wpt.live/subresource-integrity/subresource-integrity.html"><small>(ライブテスト)</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/subresource-integrity/subresource-integrity.html"><small>(ソース)</small></a>
            </ul>
        </details>
        <h3 class="heading settled" data-level="1.1" id="goals"><span class="secno">1.1. </span><span
                class="content">目的</span><a class="self-link" href="#goals"></a></h3>
        <ol>
            <li data-md>
                <p>サードパーティサービスが侵害された場合でも、そのスクリプトを含むすべてのサイトが自動的に侵害されないようにすべきです。コンテンツ著者は、読み込むコンテンツの期待値を指定する仕組みを持つことで、<em>特定の</em>スクリプトのみを読み込み、同じURLの<em>任意の</em>スクリプトを読み込まないようにできます。
                </p>
            <li data-md>
                <p>検証機構は、無効なレスポンスを受信した場合に著者へ通知するエラー報告機能を備えるべきです。</p>
        </ol>
        <h3 class="heading settled" data-level="1.2" id="examples"><span class="secno">1.2. </span><span
                class="content">ユースケース・例</span><a class="self-link" href="#examples"></a></h3>
        <h4 class="heading settled" data-level="1.2.1" id="resource-integrity"><span class="secno">1.2.1. </span><span
                class="content">リソース整合性</span><a class="self-link" href="#resource-integrity"></a></h4>
        <ul>
            <li data-md>
                <p>著者はグローバルに分散したユーザーのため、コンテンツ配信ネットワーク（CDN）を利用してパフォーマンス向上を図りたいと考えています。しかし、CDNのサーバーが<em>著者が期待する</em>コードのみを配信することを保証する必要があります。CDNの侵害や予期せぬ悪意ある挙動によるサイトの改ざんリスクを軽減するため、ページに含める<code>link</code>要素に<a
                        data-link-type="dfn" href="#integrity-metadata"
                        id="ref-for-integrity-metadata">整合性メタデータ</a>を追加します：
                </p>
                <div class="example" id="example-ed55c3e6">
                    <a class="self-link" href="#example-ed55c3e6"></a>

                    <pre class="highlight"><c- p>&lt;</c-><c- f>link</c-> <c- e>rel</c-><c- o>=</c-><c- s>"stylesheet"</c-> <c- e>href</c-><c- o>=</c-><c- s>"https://site53.example.net/style.css"</c->
      <c- e>integrity</c-><c- o>=</c-><c- s>"sha384-+/M6kredJcxdsqkczBUjMLvqyHb1K/JThDXWsBVxMEeZHEaMKEOEct339VItX1zB"</c->
      <c- e>crossorigin</c-><c- o>=</c-><c- s>"anonymous"</c-><c- p>></c->
</pre>
                </div>
            <li data-md>
                <p>著者は、サードパーティのアナリティクスサービスが提供するJavaScriptをページに含めたいと考えています。慎重にレビューしたコードのみが実行されるよう保証するため、著者はスクリプトの<a
                        data-link-type="dfn" href="#integrity-metadata"
                        id="ref-for-integrity-metadata①">整合性メタデータ</a>を生成し、<code>script</code>要素に追加します：</p>
                <div class="example" id="example-af0f59ce">
                    <a class="self-link" href="#example-af0f59ce"></a>

                    <pre class="highlight"><c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"https://analytics-r-us.example.com/v1.0/include.js"</c->
        <c- e>integrity</c-><c- o>=</c-><c- s>"sha384-MBO5IDfYaE6c6Aao94oZrIOiC6CGiSN2n4QUbHNPhzk5Xhm0djZLQqTpL0HzTUxk"</c->
        <c- e>crossorigin</c-><c- o>=</c-><c- s>"anonymous"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
                </div>
            <li data-md>
                <p>ユーザーエージェントは、高権限のHTMLコンテキスト（例: ブラウザの新しいタブページ）で実行されるJavaScriptコードが表示前に改ざんされないよう保証したいと考えています。<a
                        data-link-type="dfn" href="#integrity-metadata"
                        id="ref-for-integrity-metadata②">整合性メタデータ</a>は、これら高権限コンテキストで改ざんされたJavaScriptが実行されるリスクを軽減します。
                </p>
        </ul>
        <h2 class="heading settled" data-level="2" id="terms"><span class="secno">2. </span><span
                class="content">主要概念と用語</span><a class="self-link" href="#terms"></a></h2>
        <p>このセクションでは文書全体で使用されるいくつかの用語を定義します。</p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="digest">ダイジェスト</dfn>とは、任意のデータブロックに対して暗号学的ハッシュ関数を実行した結果をbase64でエンコードしたものを指します。</p>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"
                id="ref-for-concept-origin">オリジン</a>および<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin"
                id="ref-for-same-origin">同一オリジン</a>の用語はHTMLで定義されています。<a data-link-type="biblio" href="#biblio-html"
                title="HTML Standard">[HTML]</a></p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="base64-encoding">base64エンコーディング</dfn>は<a
                href="https://tools.ietf.org/html/rfc4648#section-4">RFC 4648のセクション4</a>で定義されています。<a
                data-link-type="biblio" href="#biblio-rfc4648"
                title="The Base16, Base32, and Base64 Data Encodings">[RFC4648]</a></p>
        <p><a data-link-type="dfn" href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something">SHA-256</a>、<a data-link-type="dfn" data-refhint-key="37de769a"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something①">SHA-384</a>、<a data-link-type="dfn" data-refhint-key="a801f883"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something②">SHA-512</a>は、NISTが定義する<a data-link-type="dfn" data-refhint-key="14c46ca8"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something③">SHA-2</a>暗号学的ハッシュ関数群の一部です。<a data-link-type="biblio" href="#biblio-sha2"
                title="FIPS PUB 180-4, Secure Hash Standard">[SHA2]</a></p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="valid-sri-hash-algorithm-token-set">有効なSRIハッシュアルゴリズムトークン集合</dfn>は、<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">順序付き集合</a>«
            "<code>sha256</code>", "<code>sha384</code>", "<code>sha512</code>" »（それぞれ<a data-link-type="dfn"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something④">SHA-256</a>、<a data-link-type="dfn" data-refhint-key="37de769a"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something⑤">SHA-384</a>、<a data-link-type="dfn" data-refhint-key="a801f883"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something⑥">SHA-512</a>に対応）。この集合の順序は意味を持ち、より強力なアルゴリズムが後ろに並びます。詳細は<a href="#priority">§ 3.2.2
                優先順位</a>および<a href="#get-the-strongest-metadata">§ 3.3.3 集合から最強のメタデータを取得</a>を参照してください。</p>
        <p>文字列が<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="valid-sri-hash-algorithm-token">有効なSRIハッシュアルゴリズムトークン</dfn>であるとは、その<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#ascii-lowercase" id="ref-for-ascii-lowercase">ASCII小文字化</a>が<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain"
                id="ref-for-list-contain">含まれている</a>場合、<a data-link-type="dfn"
                href="#valid-sri-hash-algorithm-token-set"
                id="ref-for-valid-sri-hash-algorithm-token-set">有効なSRIハッシュアルゴリズムトークン集合</a>に含まれることを指します。</p>
        <h3 class="heading settled" data-level="2.1" id="grammar-concepts"><span class="secno">2.1. </span><span
                class="content">文法上の概念</span><a class="self-link" href="#grammar-concepts"></a></h3>
        <p>この文書で使用される拡張バッカス・ナウア形式（ABNF）記法はRFC5234で定義されています。<a data-link-type="biblio" href="#biblio-abnf"
                title="Augmented BNF for Syntax Specifications: ABNF">[ABNF]</a></p>
        <p><a href="https://tools.ietf.org/html/rfc5234#appendix-B.1" id="58fa9b5f0">RFC5234の付録B.1</a>は、<a
                data-link-type="dfn" href="https://tools.ietf.org/html/rfc5234#appendix-B.1"
                id="ref-for-appendix-B.1">VCHAR</a>（表示可能文字）および<a data-link-type="dfn" data-refhint-key="fc7b3d90"
                href="https://tools.ietf.org/html/rfc5234#appendix-B.1"
                id="ref-for-appendix-B.1①">WSP</a>（空白）の規則を定義しています。</p>
        <p>Content Security Policyは<a data-link-type="grammar"
                href="https://www.w3.org/TR/CSP3/#grammardef-base64-value"
                id="ref-for-grammardef-base64-value"><code>base64-value</code></a>および<a data-link-type="grammar"
                href="https://www.w3.org/TR/CSP3/#grammardef-hash-algorithm"
                id="ref-for-grammardef-hash-algorithm"><code>hash-algorithm</code></a>規則を定義しています。<a
                data-link-type="biblio" href="#biblio-csp" title="Content Security Policy Level 3">[CSP]</a></p>
        <h2 class="heading settled" data-level="3" id="framework"><span class="secno">3. </span><span
                class="content">フレームワーク</span><a class="self-link" href="#framework"></a></h2>
        <p>ここで規定される整合性検証機構は、リソースに対して十分に強力な暗号学的ダイジェストを生成し、そのダイジェストをユーザーエージェントに送信してレスポンスの検証に利用するというプロセスに集約されます。</p>
        <h3 class="heading settled" data-level="3.1" id="integrity-metadata-description"><span class="secno">3.1.
            </span><span class="content">整合性メタデータ</span><a class="self-link" href="#integrity-metadata-description"></a>
        </h3>
        <p>レスポンスの整合性を検証するためには、ユーザーエージェントは<a data-link-type="dfn" data-lt="integrity metadata" data-noexport
                id="integrity-metadata">整合性メタデータ</a>を<a data-link-type="dfn"
                href="https://fetch.spec.whatwg.org/#concept-request"
                id="ref-for-concept-request">リクエスト</a>の一部として必要とします。このメタデータは以下の情報で構成されます：</p>
        <ul>
            <li data-md>
                <p>暗号学的ハッシュ関数（"alg"）</p>
            <li data-md>
                <p><a data-link-type="dfn" href="#digest" id="ref-for-digest">ダイジェスト</a>（"val"）</p>
            <li data-md>
                <p>オプション（"opt"）</p>
        </ul>
        <p>レスポンスの整合性検証には、ハッシュ関数とダイジェストの指定が必須です。</p>
        <p class="note" role="note"><span class="marker">注:</span>
            現時点ではオプションは定義されていませんが、将来的な仕様バージョンでMIMEタイプなどのオプションが定義される可能性があります。<a data-link-type="biblio"
                href="#biblio-mime-types"
                title="Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types">[MIME-TYPES]</a></p>
        <p>このメタデータは、Content Security Policy Level 2仕様の<a
                href="https://www.w3.org/TR/CSP2/#source-list-syntax">セクション4.2</a>にある<code>hash-source</code>（シングルクォートを除く）と同じ形式でエンコードしなければなりません。
        </p>
        <p>例えば、スクリプトリソースが<code>alert('Hello,   world.');</code>という文字列のみを含む場合、著者はハッシュ関数として<a data-link-type="dfn"
                data-refhint-key="37de769a" href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something⑦">SHA-384</a>を選択できます。<code>H8BRh8j48O9oYatfu5AZzq6A9RINhZO5H16dQZngK7T62em8MUt1FLm52t+eX6xO</code>が生成される<a
                data-link-type="dfn" href="#base64-encoding"
                id="ref-for-base64-encoding">base64エンコード</a>されたダイジェストです。これを次のようにエンコードします：</p>
        <div class="example" id="example-cc8e7f02">
            <a class="self-link" href="#example-cc8e7f02"></a>

            <pre>sha384-H8BRh8j48O9oYatfu5AZzq6A9RINhZO5H16dQZngK7T62em8MUt1FLm52t+eX6xO
</pre>
        </div>
        <div class="note" role="note">

            ダイジェストは様々なユーティリティで生成できます。例えば<a
                href="https://www.openssl.org/">OpenSSL</a>は一般的によく利用されています。このセクションの例は、以下のコマンドラインの結果です：

            <pre class="highlight">echo -n <c- u>"alert('Hello, world.');"</c-> <c- p>|</c-> openssl dgst -sha384 -binary <c- p>|</c-> openssl base64 -A
</pre>
        </div>
        <h3 class="heading settled" data-level="3.2" id="hash-functions"><span class="secno">3.2. </span><span
                class="content">暗号学的ハッシュ関数</span><a class="self-link" href="#hash-functions"></a></h3>
        <p>適合するユーザーエージェントは、リクエストの<a data-link-type="dfn" href="#integrity-metadata"
                id="ref-for-integrity-metadata③">整合性メタデータ</a>の一部として<a data-link-type="dfn"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something⑧">SHA-256</a>、<a data-link-type="dfn" data-refhint-key="37de769a"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something⑨">SHA-384</a>、<a data-link-type="dfn" data-refhint-key="a801f883"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something①⓪">SHA-512</a>暗号学的ハッシュ関数をサポートしなければならず、将来の仕様で定義される追加のハッシュ関数もサポートしてもよいです。</p>
        <p class="note" role="note"><span class="marker">注:</span>
            本書でサポートされるアルゴリズムは現時点では第二原像攻撃や衝突攻撃に対して安全と考えられています。将来サポートされるアルゴリズムの追加・削除時も同様の基準を適用することが望ましいです。詳細は<a
                href="#hash-collision-attacks">§ 5.2 ハッシュ衝突攻撃</a>を参照してください。</p>
        <h4 class="heading settled" data-level="3.2.1" id="agility"><span class="secno">3.2.1. </span><span
                class="content">柔軟性</span><a class="self-link" href="#agility"></a></h4>
        <p>将来的な暗号学的発見に対応する柔軟性を持たせるため、単一リソースに複数セットの<a data-link-type="dfn" href="#integrity-metadata"
                id="ref-for-integrity-metadata④">整合性メタデータ</a>を関連付けることができます。例えば、前節のリソースは以下のいずれかのハッシュ式で表現できます：</p>
        <div class="example" id="example-a9403be4">
            <a class="self-link" href="#example-a9403be4"></a>

            <pre>sha384-H8BRh8j48O9oYatfu5AZzq6A9RINhZO5H16dQZngK7T62em8MUt1FLm52t+eX6xO
sha512-Q2bFTOhEALkN8hOms2FKTDLy7eugP2zFZ1T8LCvX42Fp3WoNr3bjZSAHeOsHrbV1Fu9/A0EzCinRE7Af1ofPrw==
</pre>
        </div>
        <p>著者は例えば両方を指定することもできます：</p>
        <div class="example" id="example-da4338e9">
            <a class="self-link" href="#example-da4338e9"></a>

            <pre class="highlight"><c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"hello_world.js"</c->
   <c- e>integrity</c-><c- o>=</c-><c- s>"sha384-H8BRh8j48O9oYatfu5AZzq6A9RINhZO5H16dQZngK7T62em8MUt1FLm52t+eX6xO</c->
<c- s>              sha512-Q2bFTOhEALkN8hOms2FKTDLy7eugP2zFZ1T8LCvX42Fp3WoNr3bjZSAHeOsHrbV1Fu9/A0EzCinRE7Af1ofPrw=="</c->
   <c- e>crossorigin</c-><c- o>=</c-><c- s>"anonymous"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
        </div>
        <p>この場合、ユーザーエージェントはリスト中で最も強力なハッシュ関数を選択し、そのメタデータでレスポンスを検証します（<a href="#parse-metadata-section">§ 3.3.2
                メタデータの解析</a>および<a href="#get-the-strongest-metadata">§ 3.3.3 集合から最強のメタデータを取得</a>のアルゴリズム参照）。</p>
        <p>ハッシュ関数が安全でないと判断された場合、ユーザーエージェントはそのハッシュ関数による整合性検証のサポートを非推奨とし、最終的に削除すべきです。ユーザーエージェントは非推奨関数によるダイジェストでレスポンスの妥当性をチェックしてもかまいません。
        </p>
        <p>著者が古いユーザーエージェントに縛られず強力なハッシュ関数へ切り替えられるよう、サポートされていないハッシュ関数による検証は整合性値が未指定の場合と同様に扱われます（<a
                href="#does-response-match-metadatalist" id="ref-for-does-response-match-metadatalist">§ 3.3.4
                bytesがmetadataListに一致するか？</a>参照）。著者は強力なハッシュ関数の利用を推奨され、利用可能になったら随時移行を開始してください。</p>
        <h4 class="heading settled" data-level="3.2.2" id="priority"><span class="secno">3.2.2. </span><span
                class="content">優先順位</span><a class="self-link" href="#priority"></a></h4>
        <p>ハッシュアルゴリズムの優先順位は、<a data-link-type="dfn" href="#valid-sri-hash-algorithm-token-set"
                id="ref-for-valid-sri-hash-algorithm-token-set①">有効なSRIハッシュアルゴリズムトークン集合</a>におけるトークンの順序で指定されます。集合の前方のアルゴリズムほど弱く、後方ほど強力です。
        </p>
        <p>現行仕様では、<a data-link-type="dfn" href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something①①">SHA-256</a>は<a data-link-type="dfn" data-refhint-key="37de769a"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something①②">SHA-384</a>より弱く、<a data-link-type="dfn" data-refhint-key="a801f883"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something①③">SHA-512</a>が最も強力です。他のハッシュアルゴリズムは本仕様ではサポートされていません。</p>
        <h3 class="heading settled" data-level="3.3" id="verification-algorithms"><span class="secno">3.3. </span><span
                class="content">レスポンス検証アルゴリズム</span><a class="self-link" href="#verification-algorithms"></a></h3>
        <h4 class="heading settled" data-level="3.3.1" id="apply-algorithm-to-response"><span class="secno">3.3.1.
            </span><span class="content"><var>algorithm</var>を<var>bytes</var>へ適用</span><a class="self-link"
                href="#apply-algorithm-to-response"></a></h4>
        <ol>
            <li data-md>
                <p><var>result</var>を、<var>algorithm</var>を<var>bytes</var>に適用した結果とする。</p>
            <li data-md>
                <p><var>result</var>を<a data-link-type="dfn" href="#base64-encoding"
                        id="ref-for-base64-encoding①">base64エンコード</a>した結果を返す。</p>
        </ol>
        <h4 class="heading settled" data-level="3.3.2" id="parse-metadata-section"><span class="secno">3.3.2.
            </span><span class="content">メタデータの解析</span><a class="self-link" href="#parse-metadata-section"></a></h4>
        <p>文字列<var>metadata</var>が与えられたとき、<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="parse-metadata">メタデータを解析</dfn>するには以下の手順を実行します：</p>
        <p class="note" role="note"><span class="marker">注:</span> このアルゴリズムは、ユーザーエージェントが理解できるハッシュ関数のハッシュ式集合を返します。</p>
        <ol>
            <li data-md>
                <p><var>result</var>を空集合とする。</p>
            <li data-md>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#strictly-split"
                        id="ref-for-strictly-split">スペースで<var>metadata</var>を分割</a>して得られる各<var>item</var>について：</p>
                <ol>
                    <li data-md>
                        <p><var>expression-and-options</var>を、<a data-link-type="dfn"
                                href="https://infra.spec.whatwg.org/#strictly-split"
                                id="ref-for-strictly-split①"><var>item</var>をU+003F（?）で分割</a>した結果とする。</p>
                    <li data-md>
                        <p><var>algorithm-expression</var>を<var>expression-and-options</var>[0]とする。</p>
                    <li data-md>
                        <p><var>base64-value</var>を空文字列とする。</p>
                    <li data-md>
                        <p><var>algorithm-and-value</var>を、<a data-link-type="dfn"
                                href="https://infra.spec.whatwg.org/#strictly-split"
                                id="ref-for-strictly-split②"><var>algorithm-expression</var>をU+002D（-）で分割</a>した結果とする。
                        </p>
                    <li data-md>
                        <p><var>algorithm</var>を<var>algorithm-and-value</var>[0]とする。</p>
                    <li data-md>
                        <p>もし<var>algorithm</var>が<a data-link-type="dfn" href="#valid-sri-hash-algorithm-token"
                                id="ref-for-valid-sri-hash-algorithm-token">有効なSRIハッシュアルゴリズムトークン</a>でなければ、<a
                                data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue"
                                id="ref-for-iteration-continue">continue</a>する。</p>
                    <li data-md>
                        <p>もし<var>algorithm-and-value</var>[1]<a data-link-type="dfn"
                                href="https://infra.spec.whatwg.org/#list-contain"
                                id="ref-for-list-contain①">が存在すれば</a>、<var>base64-value</var>を<var>algorithm-and-value</var>[1]に設定する。
                        </p>
                    <li data-md>
                        <p><var>metadata</var>を、順序付きマップ«["alg" → <var>algorithm</var>, "val" →
                            <var>base64-value</var>]»とする。
                        </p>
                        <p class="note" role="note"><span class="marker">注:</span> オプションは定義されていないため（<a
                                href="#integrity-metadata-description">§ 3.1
                                整合性メタデータ</a>参照）、対応するエントリは<var>metadata</var>に設定しません。将来バージョンでオプションが定義された場合、<var>expression-and-options</var>[1]を<code>options</code>として利用できます。
                        </p>
                    <li data-md>
                        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append"
                                id="ref-for-list-append"><var>metadata</var>を<var>result</var>に追加</a>する。</p>
                </ol>
            <li data-md>
                <p><var>result</var>を返す。</p>
        </ol>
        <h4 class="heading settled" data-level="3.3.3" id="get-the-strongest-metadata"><span class="secno">3.3.3.
            </span><span class="content"><var>set</var>から最強のメタデータを取得</span><a class="self-link"
                href="#get-the-strongest-metadata"></a></h4>
        <ol>
            <li data-md>
                <p><var>result</var>を空集合、<var>strongest</var>をnullとする。</p>
            <li data-md>
                <p><var>set</var>の各<var>item</var>について：</p>
                <ol>
                    <li data-md>
                        <p class="assertion">保証：<var>item</var>["<code>alg</code>"]は<a data-link-type="dfn"
                                href="#valid-sri-hash-algorithm-token"
                                id="ref-for-valid-sri-hash-algorithm-token①">有効なSRIハッシュアルゴリズムトークン</a>である。</p>
                    <li data-md>
                        <p>もし<var>result</var>が空集合なら：</p>
                        <ol>
                            <li data-md>
                                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append"
                                        id="ref-for-set-append">result</a>に<var>item</var>を追加。</p>
                            <li data-md>
                                <p><var>strongest</var>を<var>item</var>に設定。</p>
                            <li data-md>
                                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue"
                                        id="ref-for-iteration-continue①">続行</a>。</p>
                        </ol>
                    <li data-md>
                        <p><var>currentAlgorithm</var>を<var>strongest</var>["<code>alg</code>"]、<var>currentAlgorithmIndex</var>を<a
                                data-link-type="dfn" href="#valid-sri-hash-algorithm-token-set"
                                id="ref-for-valid-sri-hash-algorithm-token-set②">有効なSRIハッシュアルゴリズムトークン集合</a>における<var>currentAlgorithm</var>のインデックスとする。
                        </p>
                    <li data-md>
                        <p><var>newAlgorithm</var>を<var>item</var>["<code>alg</code>"]、<var>newAlgorithmIndex</var>を<a
                                data-link-type="dfn" href="#valid-sri-hash-algorithm-token-set"
                                id="ref-for-valid-sri-hash-algorithm-token-set③">有効なSRIハッシュアルゴリズムトークン集合</a>における<var>newAlgorithm</var>のインデックスとする。
                        </p>
                    <li data-md>
                        <p>もし<var>newAlgorithmIndex</var>が<var>currentAlgorithmIndex</var>より小さければ、<a
                                data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue"
                                id="ref-for-iteration-continue②">続行</a>。</p>
                    <li data-md>
                        <p>それ以外で、<var>newAlgorithmIndex</var>が<var>currentAlgorithmIndex</var>より大きい場合：</p>
                        <ol>
                            <li data-md>
                                <p><var>strongest</var>を<var>item</var>に設定。</p>
                            <li data-md>
                                <p><var>result</var>を« <var>item</var> »に設定。</p>
                        </ol>
                    <li data-md>
                        <p>それ以外の場合、<var>newAlgorithmIndex</var>と<var>currentAlgorithmIndex</var>が同じ値なら、<a
                                data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append"
                                id="ref-for-set-append①">result</a>に<var>item</var>を追加。</p>
                </ol>
            <li data-md>
                <p><var>result</var>を返す。</p>
        </ol>
        <h4 class="heading settled dfn-paneled" data-dfn-type="dfn" data-export data-level="3.3.4"
            data-lt="Do bytes match metadataList?" id="does-response-match-metadatalist"><span class="secno">3.3.4.
            </span><span class="content"><var>bytes</var>が<var>metadataList</var>に一致するか？</span><a class="self-link"
                href="#does-response-match-metadatalist" id="ref-for-does-response-match-metadatalist①"></a></h4>
        <ol>
            <li data-md>
                <p><var>parsedMetadata</var>を、<a data-link-type="dfn" href="#parse-metadata"
                        id="ref-for-parse-metadata"><var>metadataList</var>を解析</a>した結果とする。</p>
            <li data-md>
                <p>もし<var>parsedMetadata</var>が<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-is-empty"
                        id="ref-for-list-is-empty">空集合</a>なら、<code>true</code>を返す。</p>
            <li data-md>
                <p><var>metadata</var>を<a href="#get-the-strongest-metadata">parsedMetadataから最強のメタデータを取得</a>した結果とする。</p>
            <li data-md>
                <p><var>metadata</var>の各<var>item</var>について：</p>
                <ol>
                    <li data-md>
                        <p><var>algorithm</var>を<var>item</var>["alg"]とする。</p>
                    <li data-md>
                        <p><var>expectedValue</var>を<var>item</var>["val"]とする。</p>
                    <li data-md>
                        <p><var>actualValue</var>を<a
                                href="#apply-algorithm-to-response"><var>algorithm</var>を<var>bytes</var>へ適用</a>した結果とする。
                        </p>
                    <li data-md>
                        <p>もし<var>actualValue</var>が<var>expectedValue</var>と厳密一致した場合、<code>true</code>を返す。</p>
                </ol>
            <li data-md>
                <p><code>false</code>を返す。</p>
        </ol>
        <p>このアルゴリズムにより、ユーザーエージェントは複数の有効かつ強力なハッシュ関数を受理できます。例えば、開発者は次のような<code>script</code>要素を書くことができます：</p>
        <div class="example" id="example-3e451647">
            <a class="self-link" href="#example-3e451647"></a>

            <pre class="highlight"><c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"https://example.com/example-framework.js"</c->
        <c- e>integrity</c-><c- o>=</c-><c- s>"sha384-Li9vy3DqF8tnTXuiaAJuML3ky+er10rcgNR/VqsVpcw+ThHmYcwiB1pbOxEbzJr7</c->
<c- s>                   sha384-+/M6kredJcxdsqkczBUjMLvqyHb1K/JThDXWsBVxMEeZHEaMKEOEct339VItX1zB"</c->
        <c- e>crossorigin</c-><c- o>=</c-><c- s>"anonymous"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
        </div>
        <p>この場合、ユーザーエージェントは2つの異なるコンテンツペイロードのいずれかを受理できます。1つは1つ目の<a data-link-type="dfn" data-refhint-key="37de769a"
                href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something①④">SHA-384</a>ハッシュ値と一致し、もう1つは2つ目の<a data-link-type="dfn"
                data-refhint-key="37de769a" href="https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#"
                id="ref-for-something①⑤">SHA-384</a>ハッシュ値と一致します。
        </p>
        <p class="note" role="note"><span class="marker">注:</span>
            ユーザーエージェントはユーザーの設定、ブックマークレット、サードパーティ追加機能などでこのアルゴリズムの結果を変更できる場合があります。例えばHTTPS
            Everywhereのような拡張によるリダイレクトでも、リソースのHTTPS版とHTTP版が異なっていても、正常に読み込み・実行されることがあります。</p>
        <p class="note" role="note"><span class="marker">注:</span>
            サブリソース整合性にはCORSが必要です。CORSなしで利用しようとすると論理エラーとなるため、ユーザーエージェントは開発者コンソールで警告メッセージを報告することが推奨されます。<a
                data-link-type="biblio" href="#biblio-fetch" title="Fetch Standard">[Fetch]</a></p>
        <h3 class="heading settled" data-level="3.4" id="verification-of-html-document-subresources"><span
                class="secno">3.4. </span><span class="content">HTML文書サブリソースの検証</span><a class="self-link"
                href="#verification-of-html-document-subresources"></a></h3>
        <p>さまざまなHTML要素は、ドキュメントへ埋め込まれたり、その文脈で実行されたりするリソースへのリクエストを生成します。これらの一部要素で整合性メタデータをサポートするため、<code>link</code>および<code>script</code>要素のコンテンツ属性リストに新たに<code>integrity</code>属性が追加されます。<a
                data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a></p>
        <p class="note" role="note"><span class="marker">注:</span>
            本仕様の将来バージョンでは、<code>a</code>、<code>audio</code>、<code>embed</code>、<code>iframe</code>、<code>img</code>、<code>link</code>、<code>object</code>、<code>script</code>、<code>source</code>、<code>track</code>、<code>video</code>など、全てのサブリソース要素で整合性サポートが追加される可能性があります。
        </p>
        <h3 class="heading settled" data-level="3.5" id="the-integrity-attribute"><span class="secno">3.5. </span><span
                class="content"><code>integrity</code>属性</span><a class="self-link" href="#the-integrity-attribute"></a>
        </h3>
        <p><code>integrity</code>属性は、要素の<a data-link-type="dfn" href="#integrity-metadata"
                id="ref-for-integrity-metadata⑤">整合性メタデータ</a>を表します。
            この属性値は空文字列、または下記ABNF文法で記述される有効なメタデータが1つ以上でなければなりません：</p>
        <pre><dfn class="dfn-paneled" data-dfn-type="grammar" data-export id="grammardef-integrity-metadata">integrity-metadata</dfn> = *<a data-link-type="grammar" data-refhint-key="fc7b3d90" href="https://tools.ietf.org/html/rfc5234#appendix-B.1" id="ref-for-appendix-B.1②">WSP</a> <a data-link-type="grammar" href="#grammardef-hash-with-options" id="ref-for-grammardef-hash-with-options">hash-with-options</a> *(1*<a data-link-type="grammar" data-refhint-key="fc7b3d90" href="https://tools.ietf.org/html/rfc5234#appendix-B.1" id="ref-for-appendix-B.1③">WSP</a> <a data-link-type="grammar" href="#grammardef-hash-with-options" id="ref-for-grammardef-hash-with-options①">hash-with-options</a> ) *<a data-link-type="grammar" data-refhint-key="fc7b3d90" href="https://tools.ietf.org/html/rfc5234#appendix-B.1" id="ref-for-appendix-B.1④">WSP</a> / *<a data-link-type="grammar" data-refhint-key="fc7b3d90" href="https://tools.ietf.org/html/rfc5234#appendix-B.1" id="ref-for-appendix-B.1⑤">WSP</a>
<dfn class="dfn-paneled" data-dfn-type="grammar" data-export id="grammardef-hash-with-options">hash-with-options</dfn>  = <a data-link-type="grammar" href="#grammardef-hash-expression" id="ref-for-grammardef-hash-expression">hash-expression</a> *("?" <a data-link-type="grammar" href="#grammardef-option-expression" id="ref-for-grammardef-option-expression">option-expression</a>)
<dfn class="dfn-paneled" data-dfn-type="grammar" data-export id="grammardef-option-expression">option-expression</dfn>  = *<a data-link-type="grammar" data-refhint-key="3fed24ef" href="https://tools.ietf.org/html/rfc5234#appendix-B.1" id="ref-for-appendix-B.1⑥">VCHAR</a>
<dfn class="dfn-paneled" data-dfn-type="grammar" data-export id="grammardef-hash-expression">hash-expression</dfn>    = <a data-link-type="grammar" href="https://www.w3.org/TR/CSP3/#grammardef-hash-algorithm" id="ref-for-grammardef-hash-algorithm①">hash-algorithm</a> "-" <a data-link-type="grammar" href="https://www.w3.org/TR/CSP3/#grammardef-base64-value" id="ref-for-grammardef-base64-value①">base64-value</a>
</pre>
        <p><code>option-expression</code>は各<code>hash-expression</code>ごとに関連付けられ、その直前の<code>hash-expression</code>のみに適用されます。
        </p>
        <p>ユーザーエージェントが将来のオプションと完全な前方互換性を維持するため、認識できない<code>option-expression</code>はすべて無視しなければなりません。</p>
        <p class="note" role="note"><span class="marker">注:</span>
            <code>option-expression</code>は構文上予約されているものの、現時点ではオプションは定義されていません。将来の仕様バージョンではより具体的なオプション構文が定義される可能性が高いため、現段階ではできるだけ広く定義されています。
        </p>
        <h3 class="heading settled" data-level="3.6" id="the-integrity-link-processing-option"><span class="secno">3.6.
            </span><span class="content"><code>integrity</code>リンク処理オプション</span><a class="self-link"
                href="#the-integrity-link-processing-option"></a></h3>
        <p><a data-link-type="dfn" href="#integrity-metadata" id="ref-for-integrity-metadata⑥">整合性メタデータ</a>は
            `<code><a data-link-type="http-header" href="https://tools.ietf.org/html/rfc8288#link" id="ref-for-link">link</a></code>`
            HTTPレスポンスヘッダーにも、<code>integrity</code>リンクパラメータとして指定できます。この場合も要素の<code>integrity</code>属性と同じ<a
                data-link-type="grammar" href="#grammardef-integrity-metadata"
                id="ref-for-grammardef-integrity-metadata"><code>integrity-metadata</code></a>文法で指定しなければなりません。例：
        </p>
        <pre class="language-http highlight">Link: &lt;/style.css>; rel=preload; as=style;  crossorigin="anonymous"; integrity="sha256-[digest goes here]"
</pre>
        <h3 class="heading settled" data-level="3.7" id="handling-integrity-violations"><span class="secno">3.7.
            </span><span class="content">整合性違反の取り扱い</span><a class="self-link"
                href="#handling-integrity-violations"></a></h3>
        <p>ユーザーエージェントは整合性チェックに失敗したレスポンスの描画や実行を拒否し、代わりにFetchで定義されるネットワークエラーを返します。<a data-link-type="biblio"
                href="#biblio-fetch" title="Fetch Standard">[Fetch]</a></p>
        <p class="note" role="note"><span class="marker">注:</span>
            整合性チェックに失敗した場合、<code>error</code>イベントが発火します。開発者がCDNではなくセカンダリの信頼できるが遅いソース等、標準的なフォールバックリソースを提供したい場合、この<code>error</code>イベントをキャッチし、失敗したリソースを適切な別リソースで置換するハンドラを用意できます。
        </p>
        <h3 class="heading settled" data-level="3.8" id="integrity-policy-section"><span class="secno">3.8. </span><span
                class="content">Integrity-Policy</span><a class="self-link" href="#integrity-policy-section"></a></h3>

        <code>Integrity-Policy</code>および<code>Integrity-Policy-Report-Only</code> HTTPヘッダーは、ドキュメントが読み込む特定の<a
            data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination"
            id="ref-for-concept-request-destination">destination</a>のサブリソースすべてに対する整合性メタデータ要件のポリシーを強制できます。

        <p>ヘッダー値は<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc9651#name-dictionaries"
                id="ref-for-name-dictionaries">辞書</a>型で、各メンバー値は<a data-link-type="dfn"
                href="https://tools.ietf.org/html/rfc9651#name-inner-lists"
                id="ref-for-name-inner-lists">内部リスト</a>であり、<a data-link-type="dfn"
                href="https://tools.ietf.org/html/rfc9651#name-tokens" id="ref-for-name-tokens">トークン</a>のリストです。<a
                data-link-type="biblio" href="#biblio-rfc9651" title="Structured Field Values for HTTP">[RFC9651]</a>
        </p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="source">source</dfn>は文字列で、値は"<code>inline</code>"のみです。</p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="destination">destination</dfn>は<a
                data-link-type="dfn" href="https://fetch.spec.whatwg.org/#destination-type"
                id="ref-for-destination-type">destination type</a>であり、値は"<code>script</code>"と"<code>style</code>"です。
        </p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="integrity-policy">整合性ポリシー</dfn>は、以下を含む<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">構造体</a>です：</p>
        <ul>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sources">sources</dfn>：<a
                        data-link-type="dfn" href="#source" id="ref-for-source">source</a>のリスト（初期値は空）。</p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="blocked-destinations">blocked
                        destinations</dfn>：<a data-link-type="dfn" href="#destination"
                        id="ref-for-destination">destination</a>のリスト（初期値は空）。</p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="endpoints">endpoints</dfn>：文字列の<a
                        data-link-type="dfn" href="https://infra.spec.whatwg.org/#list"
                        id="ref-for-list">リスト</a>（初期値は空）。</p>
        </ul>
        <p><a class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="processing-an-integrity-policy">整合性ポリシーの処理</a>は、<a data-link-type="dfn"
                href="https://fetch.spec.whatwg.org/#concept-header-list" id="ref-for-concept-header-list">header
                list</a> <var>headers</var>と<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-name"
                id="ref-for-header-name">header name</a> <var>headerName</var>で以下のように行う：</p>
        <ol>
            <li data-md>
                <p><var>integrityPolicy</var>を新しい<a data-link-type="dfn" href="#integrity-policy"
                        id="ref-for-integrity-policy">整合性ポリシー</a>とする。</p>
            <li data-md>
                <p><var>dictionary</var>を、<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header"
                        id="ref-for-concept-header-list-get-structured-header">構造化フィールド値を取得</a>した結果とする（<var>headers</var>、<var>headerName</var>、"<code>dictionary</code>"を与える）。
                </p>
            <li data-md>
                <p>もし<var>dictionary</var>["<code>sources</code>"]が<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain②">存在しない</a>か、その値が<a
                        data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain"
                        id="ref-for-list-contain③">"inline"</a>を含む場合は、<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-append"
                        id="ref-for-list-append①">integrityPolicyのsources</a>に"<code>inline</code>"を追加。</p>
            <li data-md>
                <p>もし<var>dictionary</var>["<code>blocked-destinations</code>"]が<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain④">存在する</a>なら：</p>
                <ol>
                    <li data-md>
                        <p>その値が"<code>script</code>"を<a data-link-type="dfn"
                                href="https://infra.spec.whatwg.org/#list-contain"
                                id="ref-for-list-contain⑤">含む</a>なら、<a data-link-type="dfn"
                                href="https://infra.spec.whatwg.org/#list-append"
                                id="ref-for-list-append②">integrityPolicyのblocked
                                destinations</a>に"<code>script</code>"を追加。</p>
                    <li data-md>
                        <p>その値が"<code>style</code>"を<a data-link-type="dfn"
                                href="https://infra.spec.whatwg.org/#list-contain"
                                id="ref-for-list-contain⑥">含む</a>なら、<a data-link-type="dfn"
                                href="https://infra.spec.whatwg.org/#list-append"
                                id="ref-for-list-append③">integrityPolicyのblocked
                                destinations</a>に"<code>style</code>"を追加。</p>
                </ol>
            <li data-md>
                <p>もし<var>dictionary</var>["<code>endpoints</code>"]が<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">存在する</a>なら：</p>
                <ol>
                    <li data-md>
                        <p><a data-link-type="dfn" href="#endpoints"
                                id="ref-for-endpoints">integrityPolicyのendpoints</a>を<var>dictionary</var>['endpoints']に設定。
                        </p>
                </ol>
            <li data-md>
                <p><var>integrityPolicy</var>を返す。</p>
        </ol>
        <div class="example" id="example-917c0880">
            <a class="self-link" href="#example-917c0880"></a>
            次のヘッダーは、integrityメタデータなしで読み込まれる外部スクリプト（またはno-CORS外部スクリプト）のリクエストをブロックします。

            <pre class="language-http highlight">Integrity-Policy: blocked-destinations=(script), endpoints=(integrity-endpoint)
</pre>
            <p>このブロックにより、"<code>integrity-endpoint</code>"レポートエンドポイント（対応する<code>Reporting-Endpoints</code>ヘッダーで定義）にレポートも発行されます。
            </p>
            <p>開発者は"<code>integrity-violation</code>"のReportingObserverを登録することで、JavaScriptでレポートを取得することもできます。</p>
        </div>
        <h4 class="heading settled" data-level="3.8.1" id="parse-integrity-policy-headers-section"><span
                class="secno">3.8.1. </span><span class="content">Integrity-Policyヘッダーの解析</span><a class="self-link"
                href="#parse-integrity-policy-headers-section"></a></h4>

        <dfn class="dfn-paneled" data-dfn-type="dfn" data-export
            id="parse-integrity-policy-headers">Integrity-Policyヘッダーを解析</dfn>するには、<a data-link-type="dfn"
            href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">Response</a>
        <var>response</var>
        および<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#policy-container"
            id="ref-for-policy-container">policy container</a> <var>container</var>が与えられたとき、以下を行う：

        <ol>
            <li data-md>
                <p><var>headers</var>を<var>response</var>の<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-response-header-list"
                        id="ref-for-concept-response-header-list">ヘッダーリスト</a>とする。</p>
            <li data-md>
                <p>もし<var>headers</var>が<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#header-list-contains"
                        id="ref-for-header-list-contains">integrity-policy</a>を含むなら、
                    <var>container</var>の<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#policy-container-integrity-policy"
                        id="ref-for-policy-container-integrity-policy">integrity policy</a>を
                    対応する<a data-link-type="dfn" href="#processing-an-integrity-policy"
                        id="ref-for-processing-an-integrity-policy">整合性ポリシーの処理</a>の結果に設定する。
                    （対応する<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-value"
                        id="ref-for-header-value">ヘッダー値</a>を使用）
                </p>
            <li data-md>
                <p>もし<var>headers</var>が<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#header-list-contains"
                        id="ref-for-header-list-contains①">integrity-policy-report-only</a>を含むなら、
                    <var>container</var>の<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#policy-container-report-only-integrity-policy"
                        id="ref-for-policy-container-report-only-integrity-policy">report only integrity policy</a>を
                    対応する<a data-link-type="dfn" href="#processing-an-integrity-policy"
                        id="ref-for-processing-an-integrity-policy①">整合性ポリシーの処理</a>の結果に設定する。
                    （対応する<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-value"
                        id="ref-for-header-value①">ヘッダー値</a>を使用）
                </p>
        </ol>
        <h4 class="heading settled" data-level="3.8.2" id="should-request-be-blocked-by-integrity-policy-section"><span
                class="secno">3.8.2. </span><span class="content">Integrity Policyによるリクエストのブロック可否</span><a
                class="self-link" href="#should-request-be-blocked-by-integrity-policy-section"></a></h4>

        <dfn class="dfn-paneled" data-dfn-type="dfn" data-export
            id="should-request-be-blocked-by-integrity-policy">Integrity Policyによるリクエストのブロック可否</dfn>を判定するには、
        <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request"
            id="ref-for-concept-request①">request</a> <var>request</var>が与えられたとき、以下を行う：

        <ol>
            <li data-md>
                <p><var>policyContainer</var>を<var>request</var>の<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-policy-container"
                        id="ref-for-concept-request-policy-container">policy container</a>とする。</p>
            <li data-md>
                <p><var>parsedMetadata</var>を<a data-link-type="dfn" href="#parse-metadata"
                        id="ref-for-parse-metadata①">parse metadata</a>に
                    <var>request</var>の<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-integrity-metadata"
                        id="ref-for-concept-request-integrity-metadata">integrity metadata</a>を渡して得られる結果とする。
                </p>
            <li data-md>
                <p>もし<var>parsedMetadata</var>が空集合ではなく、かつ<var>request</var>の<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-mode"
                        id="ref-for-concept-request-mode">mode</a>が"<code>cors</code>"または"<code>same-origin</code>"なら、
                    "Allowed"を返す。</p>
            <li data-md>
                <p>もし<var>request</var>の<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-url"
                        id="ref-for-concept-request-url">url</a>が<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#is-local" id="ref-for-is-local">local</a>なら、
                    "Allowed"を返す。</p>
            <li data-md>
                <p><var>policy</var>を<var>policyContainer</var>の<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#policy-container-integrity-policy"
                        id="ref-for-policy-container-integrity-policy①">integrity policy</a>とする。</p>
            <li data-md>
                <p><var>reportPolicy</var>を<var>policyContainer</var>の<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/browsers.html#policy-container-report-only-integrity-policy"
                        id="ref-for-policy-container-report-only-integrity-policy①">report only integrity policy</a>
                    とする。</p>
            <li data-md>
                <p>もし<var>policy</var>と<var>reportPolicy</var>が両方とも空の<a data-link-type="dfn" href="#integrity-policy"
                        id="ref-for-integrity-policy①">整合性ポリシー</a>なら、"Allowed"を返す。</p>
            <li data-md>
                <p><var>global</var>を<var>request</var>の<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-client"
                        id="ref-for-concept-request-client">client</a>の<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global"
                        id="ref-for-concept-settings-object-global">global object</a>とする。</p>
            <li data-md>
                <p>もし<var>global</var>が<code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code>
                    でも<code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope">WorkerGlobalScope</a></code>
                    でもなければ、"<code>Allowed</code>"を返す。</p>
            <li data-md>
                <p><var>block</var>をboolean型で初期値falseとする。</p>
            <li data-md>
                <p><var>reportBlock</var>をboolean型で初期値falseとする。</p>
            <li data-md>
                <p>もし<var>policy</var>の<a data-link-type="dfn" href="#sources" id="ref-for-sources①">sources</a>が<a
                        data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain"
                        id="ref-for-list-contain⑦">"inline"</a>を含み、
                    かつ<var>policy</var>の<a data-link-type="dfn" href="#blocked-destinations"
                        id="ref-for-blocked-destinations②">blocked destinations</a>が<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain⑧">request</a>の<a
                        data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination"
                        id="ref-for-concept-request-destination①">destination</a>を含むなら、
                    <var>block</var>をtrueに設定する。
                </p>
            <li data-md>
                <p>もし<var>reportPolicy</var>の<a data-link-type="dfn" href="#sources"
                        id="ref-for-sources②">sources</a>が<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain⑨">"inline"</a>を含み、
                    かつ<var>reportPolicy</var>の<a data-link-type="dfn" href="#blocked-destinations"
                        id="ref-for-blocked-destinations③">blocked destinations</a>が<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①⓪">request</a>の<a
                        data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-destination"
                        id="ref-for-concept-request-destination②">destination</a>を含むなら、
                    <var>reportBlock</var>をtrueに設定する。
                </p>
            <li data-md>
                <p>もし<var>block</var>または<var>reportBlock</var>がtrueなら、<a data-link-type="dfn" href="#report-violation"
                        id="ref-for-report-violation">違反を報告</a>を
                    <var>request</var>, <var>block</var>, <var>reportBlock</var>, <var>policy</var>,
                    <var>reportPolicy</var>で呼び出す。
                </p>
            <li data-md>
                <p>もし<var>block</var>がtrueなら"<code>Blocked</code>"を返し、そうでなければ"<code>Allowed</code>"を返す。</p>
        </ol>
        <h4 class="heading settled" data-level="3.8.3" id="report-violations"><span class="secno">3.8.3. </span><span
                class="content">違反の報告</span><a class="self-link" href="#report-violations"></a></h4>
        <pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-integrityviolationreportbody"><code><c- g>IntegrityViolationReportBody</c-></code></dfn> : <a data-link-type="idl-name" href="https://www.w3.org/TR/reporting-1/#reportbody" id="ref-for-reportbody"><c- n>ReportBody</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IntegrityViolationReportBody" data-dfn-type="dict-member" data-export data-type="USVString" id="dom-integrityviolationreportbody-documenturl"><code><c- g>documentURL</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IntegrityViolationReportBody" data-dfn-type="dict-member" data-export data-type="USVString" id="dom-integrityviolationreportbody-blockedurl"><code><c- g>blockedURL</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="IntegrityViolationReportBody" data-dfn-type="dict-member" data-export data-type="USVString" id="dom-integrityviolationreportbody-destination"><code><c- g>destination</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a>   <dfn class="dfn-paneled idl-code" data-dfn-for="IntegrityViolationReportBody" data-dfn-type="dict-member" data-export data-type="boolean" id="dom-integrityviolationreportbody-reportonly"><code><c- g>reportOnly</c-></code></dfn>;
};
</pre>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="report-violation">違反を報告</dfn>するには、
            <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request"
                id="ref-for-concept-request②">Request</a> <var>request</var>、boolean <var>block</var>、
            boolean <var>reportBlock</var>、<a data-link-type="dfn" href="#integrity-policy"
                id="ref-for-integrity-policy②">整合性ポリシー</a> <var>policy</var>、
            および<a data-link-type="dfn" href="#integrity-policy" id="ref-for-integrity-policy③">整合性ポリシー</a>
            <var>reportPolicy</var>が与えられたとき、以下を行う：
        </p>
        <ol>
            <li data-md>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                        id="ref-for-assert">保証</a>：<var>request</var>の<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-client"
                        id="ref-for-concept-request-client①">client</a>はnullではない。</p>
            <li data-md>
                <p><var>settingsObject</var>を<var>request</var>の<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-client"
                        id="ref-for-concept-request-client②">client</a>とする。</p>
            <li data-md>
                <p><var>global</var>を<var>settingsObject</var>の<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global"
                        id="ref-for-concept-settings-object-global①">global object</a>とする。</p>
            <li data-md>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                        id="ref-for-assert①">保証</a>：<var>global</var>は<code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①">Window</a></code>
                    または<code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope①">WorkerGlobalScope</a></code>である。
                </p>
            <li data-md>
                <p><var>url</var>をnullとする。</p>
            <li data-md>
                <p>もし<var>global</var>が<code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window②">Window</a></code>なら、
                    <var>url</var>を<var>global</var>の<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"
                        id="ref-for-concept-document-window">関連付けられたDocument</a>の<code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-document-url" id="ref-for-dom-document-url">URL</a></code>に設定。
                </p>
            <li data-md>
                <p>もし<var>global</var>が<code
                        class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope②">WorkerGlobalScope</a></code>なら、
                    <var>url</var>を<var>global</var>の<a data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-url"
                        id="ref-for-concept-workerglobalscope-url">URL</a>に設定。
                </p>
            <li data-md>
                <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                        id="ref-for-assert②">保証</a>：<var>url</var>は<a data-link-type="dfn"
                        href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a>である。</p>
            <li data-md>
                <p><var>documentURL</var>を<a data-link-type="dfn"
                        href="https://www.w3.org/TR/reporting-1/#strip-url-for-use-in-reports"
                        id="ref-for-strip-url-for-use-in-reports"><var>url</var>をレポート用にストリップ</a>した結果とする。</p>
            <li data-md>
                <p><var>blockedURL</var>を、<var>request</var>の<a data-link-type="dfn"
                        href="https://fetch.spec.whatwg.org/#concept-request-url"
                        id="ref-for-concept-request-url①">URL</a>に<a data-link-type="dfn"
                        href="https://www.w3.org/TR/reporting-1/#strip-url-for-use-in-reports"
                        id="ref-for-strip-url-for-use-in-reports①">レポート用URLストリップ</a>を適用した結果とする。</p>
            <li data-md>
                <p>もし<var>block</var>がtrueなら、<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                        id="ref-for-list-iterate">policyのendpoints</a>の各<var>endpoint</var>について：</p>
                <ol>
                    <li data-md>
                        <p><var>body</var>を新しい<code
                                class="idl"><a data-link-type="idl" href="#dictdef-integrityviolationreportbody" id="ref-for-dictdef-integrityviolationreportbody">IntegrityViolationReportBody</a></code>として、以下で初期化：
                        </p>
                        <dl>
                            <dt data-md><code
                                    class="idl"><a data-link-type="idl" href="#dom-integrityviolationreportbody-documenturl" id="ref-for-dom-integrityviolationreportbody-documenturl">documentURL</a></code>
                            <dd data-md>
                                <p><var>documentURL</var></p>
                            <dt data-md><code
                                    class="idl"><a data-link-type="idl" href="#dom-integrityviolationreportbody-blockedurl" id="ref-for-dom-integrityviolationreportbody-blockedurl">blockedURL</a></code>
                            <dd data-md>
                                <p><var>blockedURL</var></p>
                            <dt data-md><code
                                    class="idl"><a data-link-type="idl" href="#dom-integrityviolationreportbody-destination" id="ref-for-dom-integrityviolationreportbody-destination">destination</a></code>
                            <dd data-md>
                                <p><var>request</var>の<a data-link-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-destination"
                                        id="ref-for-concept-request-destination③">destination</a></p>
                            <dt data-md><code
                                    class="idl"><a data-link-type="idl" href="#dom-integrityviolationreportbody-reportonly" id="ref-for-dom-integrityviolationreportbody-reportonly">reportOnly</a></code>
                            <dd data-md>
                                <p>false</p>
                        </dl>
                    <li data-md>
                        <p><a data-link-type="dfn" href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report"
                                id="ref-for-generate-and-queue-a-report">レポート生成とキューイング</a>を以下の引数で呼び出す：</p>
                        <dl>
                            <dt data-md><a data-link-type="dfn"
                                    href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-context"
                                    id="ref-for-generate-and-queue-a-report-context"><i>context</i></a>
                            <dd data-md>
                                <p><var>settingsObject</var></p>
                            <dt data-md><a data-link-type="dfn"
                                    href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-type"
                                    id="ref-for-generate-and-queue-a-report-type"><i>type</i></a>
                            <dd data-md>
                                <p>"<code>integrity-violation</code>"</p>
                            <dt data-md><a data-link-type="dfn"
                                    href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-destination"
                                    id="ref-for-generate-and-queue-a-report-destination"><i>destination</i></a>
                            <dd data-md>
                                <p><var>endpoint</var></p>
                            <dt data-md><a data-link-type="dfn"
                                    href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-data"
                                    id="ref-for-generate-and-queue-a-report-data"><i>data</i></a>
                            <dd data-md>
                                <p><var>body</var></p>
                        </dl>
                </ol>
            <li data-md>
                <p>もし<var>reportBlock</var>がtrueなら、<a data-link-type="dfn"
                        href="https://infra.spec.whatwg.org/#list-iterate"
                        id="ref-for-list-iterate①">reportPolicyのendpoints</a>の各<var>endpoint</var>について：</p>
                <ol>
                    <li data-md>
                        <p><var>reportBody</var>を新しい<code
                                class="idl"><a data-link-type="idl" href="#dictdef-integrityviolationreportbody" id="ref-for-dictdef-integrityviolationreportbody①">IntegrityViolationReportBody</a></code>として、以下で初期化：
                        </p>
                        <dl>
                            <dt data-md><code
                                    class="idl"><a data-link-type="idl" href="#dom-integrityviolationreportbody-documenturl" id="ref-for-dom-integrityviolationreportbody-documenturl①">documentURL</a></code>
                            <dd data-md>
                                <p><var>documentURL</var></p>
                            <dt data-md><code
                                    class="idl"><a data-link-type="idl" href="#dom-integrityviolationreportbody-blockedurl" id="ref-for-dom-integrityviolationreportbody-blockedurl①">blockedURL</a></code>
                            <dd data-md>
                                <p><var>blockedURL</var></p>
                            <dt data-md><code
                                    class="idl"><a data-link-type="idl" href="#dom-integrityviolationreportbody-destination" id="ref-for-dom-integrityviolationreportbody-destination①">destination</a></code>
                            <dd data-md>
                                <p><var>request</var>の<a data-link-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-destination"
                                        id="ref-for-concept-request-destination④">destination</a></p>
                            <dt data-md><code
                                    class="idl"><a data-link-type="idl" href="#dom-integrityviolationreportbody-reportonly" id="ref-for-dom-integrityviolationreportbody-reportonly①">reportOnly</a></code>
                            <dd data-md>
                                <p>true</p>
                        </dl>
                    <li data-md>
                        <p><a data-link-type="dfn" href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report"
                                id="ref-for-generate-and-queue-a-report①">レポート生成とキューイング</a>を以下の引数で呼び出す：</p>
                        <dl>
                            <dt data-md><a data-link-type="dfn"
                                    href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-context"
                                    id="ref-for-generate-and-queue-a-report-context①"><i>context</i></a>
                            <dd data-md>
                                <p><var>settingsObject</var></p>
                            <dt data-md><a data-link-type="dfn"
                                    href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-type"
                                    id="ref-for-generate-and-queue-a-report-type①"><i>type</i></a>
                            <dd data-md>
                                <p>"<code>integrity-violation</code>"</p>
                            <dt data-md><a data-link-type="dfn"
                                    href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-destination"
                                    id="ref-for-generate-and-queue-a-report-destination①"><i>destination</i></a>
                            <dd data-md>
                                <p><var>endpoint</var></p>
                            <dt data-md><a data-link-type="dfn"
                                    href="https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-data"
                                    id="ref-for-generate-and-queue-a-report-data①"><i>data</i></a>
                            <dd data-md>
                                <p><var>reportBody</var></p>
                        </dl>
                </ol>
        </ol>
        <h2 class="heading settled" data-level="4" id="proxies"><span class="secno">4. </span><span
                class="content">プロキシ</span><a class="self-link" href="#proxies"></a></h2>
        <p>最適化プロキシやレスポンスを変更するその他の中間サーバーは、これらのレスポンスに関連付けられたダイジェストが新しいコンテンツと同期していることを必ず保証しなければなりません。1つの選択肢は、リソースに関連付けられた<a
                data-link-type="dfn" href="#integrity-metadata"
                id="ref-for-integrity-metadata⑦">整合性メタデータ</a>を更新することです。もう1つは、ページ著者が整合性検証を要求したリソースの正規バージョンのみを配信することです。
        </p>
        <p>中間サーバーへの通知を支援するため、リソースを配信するサーバーは、リソースとともに<a data-link-type="dfn"
                href="https://tools.ietf.org/html/rfc7234#section-5.2"
                id="ref-for-section-5.2"><code>Cache-Control</code></a>ヘッダーを値<a data-link-type="dfn"
                href="https://tools.ietf.org/html/rfc7234#section-5.2.1.6"
                id="ref-for-section-5.2.1.6"><code>no-transform</code></a>で送信するべきです。</p>
        <h2 class="heading settled" data-level="5" id="security-considerations"><span class="secno">5. </span><span
                class="content">セキュリティおよびプライバシーの考慮事項</span><a class="self-link" href="#security-considerations"></a>
        </h2>
        <p><em> このセクションは規範的ではありません。</em></p>
        <h3 class="heading settled" data-level="5.1" id="non-secure-contexts"><span class="secno">5.1. </span><span
                class="content">非セキュアなコンテキストは非セキュアなまま</span><a class="self-link" href="#non-secure-contexts"></a></h3>
        <p><a data-link-type="dfn" href="#integrity-metadata" id="ref-for-integrity-metadata⑧">整合性メタデータ</a>
            がHTTPページなどの<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"
                id="ref-for-secure-context">セキュアコンテキスト</a>以外のコンテキストから配信された場合、外部リソースがホストされているサーバーの侵害のみからオリジンを保護します。ネットワーク攻撃者はダイジェストを途中で改変したり（あるいは完全に削除したり、その他文書に対し何でも）でき、ハッシュで検証しようとするレスポンス自体も改変可能です。そのため、著者は<a
                data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context"
                id="ref-for-secure-context①">セキュアコンテキスト</a>でのみ整合性メタデータを配信することを推奨します。関連：<a
                href="https://www.w3.org/2001/tag/doc/web-https ">Securing the Web</a></p>
        <h3 class="heading settled" data-level="5.2" id="hash-collision-attacks"><span class="secno">5.2. </span><span
                class="content">ハッシュ衝突攻撃</span><a class="self-link" href="#hash-collision-attacks"></a>
        </h3>
        <p>ダイジェストの強度は、それを生成したハッシュ関数に依存します。ユーザーエージェントは、既知の弱いハッシュ関数のサポートを拒否し、衝突耐性があると知られているアルゴリズムのみをサポートするべきです。推奨されないハッシュ関数の例にはMD5やSHA-1があります。執筆時点ではSHA-384が良い基準です。
        </p>
        <p>さらに、ユーザーエージェントはサポートするハッシュ関数を定期的に再評価し、安全性が失われた関数はサポートを非推奨にすべきです。時間の経過とともにハッシュ関数が予想以上に弱いと判明したり、場合によっては破られることもあるため、ユーザーエージェントはこうした進展に常に注意を払う必要があります。
        </p>
        <h3 class="heading settled" data-level="5.3" id="cross-origin-data-leakage"><span class="secno">5.3.
            </span><span class="content">クロスオリジンのデータ漏洩</span><a class="self-link" href="#cross-origin-data-leakage"></a>
        </h3>
        <p>この仕様では、整合性保護されたクロスオリジンリクエストにリソースの内容が明示的にリクエスト元と共有されるよう<a data-link-type="dfn"
                href="https://fetch.spec.whatwg.org/#cors-protocol"
                id="ref-for-cors-protocol">CORSプロトコル</a>の使用を要求します。これが省略されると、攻撃者は<a
                href="https://www.w3.org/Security/wiki/Same_Origin_Policy">同一オリジンポリシー</a>を破り、クロスオリジンリソースに特定の内容があるかどうか知ることができます。
        </p>
        <p>攻撃者は既知のダイジェストでリソースをロードし、ロード失敗を監視します。ロードが失敗すれば、レスポンスがハッシュと一致しなかったと推測でき、内容をある程度把握できます。例えば、ユーザーが特定サービスにログインしているか否かが分かる場合もあります。
        </p>
        <p>さらに、攻撃者は静的なリソース内の特定値を総当たりで推測できます。例えば次のようなJSONレスポンスの場合：</p>
        <div class="example" id="example-6c05895b">
            <a class="self-link" href="#example-6c05895b"></a>

            <pre class="highlight"><c- p>{</c-><c- f>"status"</c-><c- p>:</c-> <c- u>"authenticated"</c-><c- p>,</c-> <c- f>"username"</c-><c- p>:</c-> <c- u>"admin"</c-><c- p>}</c->
</pre>
        </div>
        <p>攻撃者は様々な一般的ユーザー名でレスポンスのハッシュを事前計算し、それらを指定して文書ロードを繰り返します。ロードが成功すれば、攻撃者はユーザー名を正しく推測できたことになります。</p>
        <h2 class="heading settled" data-level="6" id="acknowledgements"><span class="secno">6. </span><span
                class="content">謝辞</span><a class="self-link" href="#acknowledgements"></a></h2>
        <p>ここに記載の多くの内容は、Gervase Markham氏の<a href="http://www.gerv.net/security/link-fingerprints/">Link Fingerprints</a>
            構想およびWHATWGの<a href="https://wiki.whatwg.org/wiki/Link_Hashes">Link Hashes</a>に強く影響を受けています。</p>
        <p>この仕様の初期バージョンに多大な貢献をしてくれたMike West氏に特別な感謝を捧げます。Brad Hill氏、Anne van Kesteren氏、Jonathan
            Kingston氏、Fatih Kilic氏、Mark Nottingham氏、Sergey Shekyan氏、Dan Veditz氏、Eduardo Vela氏、
            Tanvi Vyas氏、Yoav Weiss氏、Michal Zalewski氏にも貴重なフィードバックをいただき感謝します。</p>
    </main>
    <div data-fill-with="conformance">
        <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">適合性</span><a
                class="self-link" href="#w3c-conformance"></a></h2>
        <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">文書規約</span><a
                class="self-link" href="#w3c-conventions"></a></h3>
        <p>適合性要件は記述的な断定とRFC 2119用語の組み合わせで表現されます。
            本書の規範的セクションで使われる“MUST”、“MUST NOT”、“REQUIRED”、“SHALL”、“SHALL NOT”、“SHOULD”、“SHOULD
            NOT”、“RECOMMENDED”、“MAY”、“OPTIONAL”というキーワードはRFC 2119の定義に従って解釈してください。
            ただし、可読性のため、これらの単語は本仕様ではすべて大文字で表示しません。
        </p>
        <p>この仕様書のテキストは、明示的に非規範的とされたセクション、例、注記を除きすべて規範的です。<a data-link-type="biblio" href="#biblio-rfc2119"
                title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>
        </p>
        <p>本仕様中の例は「for example」で始まるか、または下記のように
            <code>class="example"</code>
            によって規範テキストと区別されています：
        </p>
        <div class="example" id="w3c-example">
            <a class="self-link" href="#w3c-example"></a>

            <p>これは参考例の一例です。
            </p>
        </div>
        <p>参考注記は“Note”で始まり、下記のように
            <code>class="note"</code>
            によって規範テキストと区別されています：
        </p>
        <p class="note" role="note">Note, これは参考注記です。</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <p>本仕様の内容に関するテストはこのような“Tests”ブロックで記載される場合があります。
                そのようなブロックは全て非規範的です。</p>
            <ul class="wpt-tests-list"></ul>
            <hr>
        </details>
        <section>
            <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span
                    class="content">適合アルゴリズム</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
            <p>アルゴリズムの一部として命令形で記述された要件（"先頭の空白文字をすべて削除する"や"falseを返してこれらの手順を中止する"など）は、アルゴリズム導入時に使われたキーワード（"must"、"should"、"may"など）に従った意味で解釈してください。
            </p>
            <p>アルゴリズムや具体的手順として表現された適合性要件は、同等の結果になる限りどのような方法でも実装可能です。
                特に、本仕様で定義されるアルゴリズムは理解しやすいことを目的とし、性能面は意図していません。
                実装者は最適化を推奨します。
            </p>
        </section>
    </div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本仕様で定義される用語</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#base64-encoding">base64エンコーディング</a><span>, § 2</span>
        <li><a href="#blocked-destinations">blocked destinations</a><span>, § 3.8</span>
        <li><a href="#dom-integrityviolationreportbody-blockedurl">blockedURL</a><span>, § 3.8.3</span>
        <li>
            destination
            <ul>
                <li><a href="#destination">定義</a><span>, § 3.8</span>
                <li><a
                        href="#dom-integrityviolationreportbody-destination">IntegrityViolationReportBodyのdict-member</a><span>,
                        § 3.8.3</span>
            </ul>
        <li><a href="#digest">ダイジェスト</a><span>, § 2</span>
        <li><a href="#does-response-match-metadatalist">bytesがmetadataListに一致するか？</a><span>, § 3.3.3</span>
        <li><a href="#dom-integrityviolationreportbody-documenturl">documentURL</a><span>, § 3.8.3</span>
        <li><a href="#endpoints">endpoints</a><span>, § 3.8</span>
        <li><a href="#grammardef-hash-expression">hash-expression</a><span>, § 3.5</span>
        <li><a href="#grammardef-hash-with-options">hash-with-options</a><span>, § 3.5</span>
        <li><a href="#integrity-metadata">整合性メタデータ</a><span>, § 3.1</span>
        <li><a href="#grammardef-integrity-metadata">integrity-metadata</a><span>, § 3.5</span>
        <li><a href="#integrity-policy">整合性ポリシー</a><span>, § 3.8</span>
        <li><a href="#dictdef-integrityviolationreportbody">IntegrityViolationReportBody</a><span>, § 3.8.3</span>
        <li><a href="#grammardef-option-expression">option-expression</a><span>, § 3.5</span>
        <li><a href="#parse-integrity-policy-headers">Integrity-Policyヘッダーの解析</a><span>, § 3.8.1</span>
        <li><a href="#parse-metadata">メタデータの解析</a><span>, § 3.3.2</span>
        <li><a href="#processing-an-integrity-policy">整合性ポリシーの処理</a><span>, § 3.8</span>
        <li><a href="#dom-integrityviolationreportbody-reportonly">reportOnly</a><span>, § 3.8.3</span>
        <li><a href="#report-violation">違反の報告</a><span>, § 3.8.3</span>
        <li><a href="#should-request-be-blocked-by-integrity-policy">Integrity Policyによるリクエストのブロック可否</a><span>,
                § 3.8.2</span>
        <li><a href="#source">source</a><span>, § 3.8</span>
        <li><a href="#sources">sources</a><span>, § 3.8</span>
        <li><a href="#valid-sri-hash-algorithm-token">有効なSRIハッシュアルゴリズムトークン</a><span>, § 2</span>
        <li><a href="#valid-sri-hash-algorithm-token-set">有効なSRIハッシュアルゴリズムトークン集合</a><span>, § 2</span>
    </ul>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">他仕様で定義される用語</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[ABNF]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="c6544229">VCHAR</span>
                <li><span class="dfn-paneled" id="bed34579">WSP</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSP]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="d7db864b">base64-value</span>
                <li><span class="dfn-paneled" id="f8eebe57">hash-algorithm</span>
            </ul>
        <li>
            <a data-link-type="biblio">[DOM]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="5a84ded6">URL</span>
            </ul>
        <li>
            <a data-link-type="biblio">[Fetch]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="857d5516">client</span>
                <li><span class="dfn-paneled" id="d5434eef">contains</span>
                <li><span class="dfn-paneled" id="a2a30ba8">CORSプロトコル</span>
                <li><span class="dfn-paneled" id="3ae34c95">destination</span>
                <li><span class="dfn-paneled" id="e56c6177">destination type</span>
                <li><span class="dfn-paneled" id="5c66de35">get a structured field value</span>
                <li><span class="dfn-paneled" id="d85a6c84">header list</span>
                <li><span class="dfn-paneled" id="f7b00a8b">header list <small>(for response)</small></span>
                <li><span class="dfn-paneled" id="1534f1eb">header name</span>
                <li><span class="dfn-paneled" id="c07f8014">header value</span>
                <li><span class="dfn-paneled" id="d79a826f">integrity metadata</span>
                <li><span class="dfn-paneled" id="8f26de31">is local</span>
                <li><span class="dfn-paneled" id="cb98f71f">mode</span>
                <li><span class="dfn-paneled" id="86efadaf">policy container</span>
                <li><span class="dfn-paneled" id="55213b5b">request</span>
                <li><span class="dfn-paneled" id="ee7bba09">response</span>
                <li><span class="dfn-paneled" id="dc1cd39b">URL</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="5d7209e9">Window</span>
                <li><span class="dfn-paneled" id="83c59a3a">WorkerGlobalScope</span>
                <li><span class="dfn-paneled" id="3349d69f">関連付けられたDocument</span>
                <li><span class="dfn-paneled" id="8a30477b">global object</span>
                <li><span class="dfn-paneled" id="71a49668">integrity policy</span>
                <li><span class="dfn-paneled" id="086e3aff">origin</span>
                <li><span class="dfn-paneled" id="b33787b2">policy container</span>
                <li><span class="dfn-paneled" id="1471f9a3">report only integrity policy</span>
                <li><span class="dfn-paneled" id="7393da89">same origin</span>
                <li><span class="dfn-paneled" id="65181da8">セキュアコンテキスト</span>
                <li><span class="dfn-paneled" id="c5b6dcb3">url</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="53275e46">append <small>(for list)</small></span>
                <li><span class="dfn-paneled" id="a3b18719">append <small>(for set)</small></span>
                <li><span class="dfn-paneled" id="6f2dfa22">ASCII小文字化</span>
                <li><span class="dfn-paneled" id="77b4c09a">assert</span>
                <li><span class="dfn-paneled" id="ae8def21">contain</span>
                <li><span class="dfn-paneled" id="f937b7b6">continue</span>
                <li><span class="dfn-paneled" id="75393c04">exist <small>(for list)</small></span>
                <li><span class="dfn-paneled" id="1243a891">exist <small>(for map)</small></span>
                <li><span class="dfn-paneled" id="16d07e10">for each</span>
                <li><span class="dfn-paneled" id="6b815fdd">is empty</span>
                <li><span class="dfn-paneled" id="649608b9">list</span>
                <li><span class="dfn-paneled" id="692595fe">順序付き集合</span>
                <li><span class="dfn-paneled" id="e5fc5b88">strictly split</span>
                <li><span class="dfn-paneled" id="984221ca">構造体</span>
            </ul>
        <li>
            <a data-link-type="biblio">[REPORTING-1]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="574c86b8">ReportBody</span>
                <li><span class="dfn-paneled" id="db64faf0">context</span>
                <li><span class="dfn-paneled" id="511f0dde">data</span>
                <li><span class="dfn-paneled" id="ead5b288">destination</span>
                <li><span class="dfn-paneled" id="07d359a5">generate and queue a report</span>
                <li><span class="dfn-paneled" id="4c47fc9d">strip URL for use in reports</span>
                <li><span class="dfn-paneled" id="cbfb19d1">type</span>
            </ul>
        <li>
            <a data-link-type="biblio">[RFC7234]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="b3a57b71">Cache-Control</span>
                <li><span class="dfn-paneled" id="5f693367">no-transform</span>
            </ul>
        <li>
            <a data-link-type="biblio">[RFC8288]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="d1364af2">link</span>
            </ul>
        <li>
            <a data-link-type="biblio">[RFC9651]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="42bcaebe">Dictionary</span>
                <li><span class="dfn-paneled" id="998ca7a7">inner list</span>
                <li><span class="dfn-paneled" id="f4486aa1">token</span>
            </ul>
        <li>
            <a data-link-type="biblio">[SHA2]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="104bce7f">SHA-2</span>
                <li><span class="dfn-paneled" id="0de10dfb">SHA-256</span>
                <li><span class="dfn-paneled" id="bbbbe32e">SHA-384</span>
                <li><span class="dfn-paneled" id="92ff7496">SHA-512</span>
            </ul>
        <li>
            <a data-link-type="biblio">[URL]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="dcffbccd">URL</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> で定義される用語:
            <ul>
                <li><span class="dfn-paneled" id="b0d7f3c3">USVString</span>
                <li><span class="dfn-paneled" id="5372cca8">boolean</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">規範的参考文献</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-abnf">[ABNF]
        <dd>D. Crocker, Ed.; P. Overell. <a href="https://www.rfc-editor.org/rfc/rfc5234"><cite>Augmented BNF for Syntax
                    Specifications: ABNF</cite></a>. 2008年1月。Internet Standard。URL: <a
                href="https://www.rfc-editor.org/rfc/rfc5234">https://www.rfc-editor.org/rfc/rfc5234</a>
        <dt id="biblio-csp">[CSP]
        <dd>Mike West; Antonio Sartori. <a href="https://www.w3.org/TR/CSP3/"><cite>Content Security Policy Level
                    3</cite></a>. 2025年6月30日。WD。URL: <a
                href="https://www.w3.org/TR/CSP3/">https://www.w3.org/TR/CSP3/</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM標準</cite></a>。現行標準。URL: <a
                href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-fetch">[Fetch]
        <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch標準</cite></a>。現行標準。URL: <a
                href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; 他。 <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML標準</cite></a>。現行標準。URL: <a
                href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a
                href="https://infra.spec.whatwg.org/"><cite>Infra標準</cite></a>。現行標準。URL: <a
                href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-mime-types">[MIME-TYPES]
        <dd>N. Freed; N. Borenstein. <a href="https://www.rfc-editor.org/rfc/rfc2046"><cite>Multipurpose Internet Mail
                    Extensions (MIME) Part Two: Media Types</cite></a>. 1996年11月。Draft Standard。URL: <a
                href="https://www.rfc-editor.org/rfc/rfc2046">https://www.rfc-editor.org/rfc/rfc2046</a>
        <dt id="biblio-reporting-1">[REPORTING-1]
        <dd>Douglas Creager; Ian Clelland; Mike West. <a href="https://www.w3.org/TR/reporting-1/"><cite>Reporting
                    API</cite></a>. 2025年6月11日。WD。URL: <a
                href="https://www.w3.org/TR/reporting-1/">https://www.w3.org/TR/reporting-1/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to
                    Indicate Requirement Levels</cite></a>. 1997年3月。Best Current Practice。URL: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-rfc4648">[RFC4648]
        <dd>S. Josefsson. <a href="https://www.rfc-editor.org/rfc/rfc4648"><cite>The Base16, Base32, and Base64 Data
                    Encodings</cite></a>. 2006年10月。Proposed Standard。URL: <a
                href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>
        <dt id="biblio-rfc7234">[RFC7234]
        <dd>R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. <a
                href="https://httpwg.org/specs/rfc7234.html"><cite>Hypertext Transfer Protocol (HTTP/1.1):
                    Caching</cite></a>. 2014年6月。Proposed Standard。URL: <a
                href="https://httpwg.org/specs/rfc7234.html">https://httpwg.org/specs/rfc7234.html</a>
        <dt id="biblio-rfc8288">[RFC8288]
        <dd>M. Nottingham. <a href="https://httpwg.org/specs/rfc8288.html"><cite>Web Linking</cite></a>. 2017年10月。
            Proposed Standard。URL: <a
                href="https://httpwg.org/specs/rfc8288.html">https://httpwg.org/specs/rfc8288.html</a>
        <dt id="biblio-rfc9651">[RFC9651]
        <dd>M. Nottingham; P-H. Kamp. <a href="https://www.rfc-editor.org/rfc/rfc9651"><cite>Structured Field Values for
                    HTTP</cite></a>. 2024年9月。Proposed Standard。URL: <a
                href="https://www.rfc-editor.org/rfc/rfc9651">https://www.rfc-editor.org/rfc/rfc9651</a>
        <dt id="biblio-sha2">[SHA2]
        <dd><a href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf"><cite>FIPS PUB 180-4, Secure Hash
                    Standard</cite></a>。URL: <a
                href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</a>
        <dt id="biblio-url">[URL]
        <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL標準</cite></a>。現行標準。URL: <a
                href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL標準</cite></a>。現行標準。URL: <a
                href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">参考情報</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-rfc1035">[RFC1035]
        <dd>P. Mockapetris. <a href="https://www.rfc-editor.org/rfc/rfc1035"><cite>Domain names - implementation and
                    specification</cite></a>. 1987年11月。Internet Standard。URL: <a
                href="https://www.rfc-editor.org/rfc/rfc1035">https://www.rfc-editor.org/rfc/rfc1035</a>
        <dt id="biblio-rfc6797">[RFC6797]
        <dd>J. Hodges; C. Jackson; A. Barth. <a href="https://www.rfc-editor.org/rfc/rfc6797"><cite>HTTP Strict
                    Transport Security (HSTS)</cite></a>. 2012年11月。Proposed Standard。URL: <a
                href="https://www.rfc-editor.org/rfc/rfc6797">https://www.rfc-editor.org/rfc/rfc6797</a>
        <dt id="biblio-rfc7469">[RFC7469]
        <dd>C. Evans; C. Palmer; R. Sleevi. <a href="https://www.rfc-editor.org/rfc/rfc7469"><cite>Public Key Pinning
                    Extension for HTTP</cite></a>. 2015年4月。Proposed Standard。URL: <a
                href="https://www.rfc-editor.org/rfc/rfc7469">https://www.rfc-editor.org/rfc/rfc7469</a>
        <dt id="biblio-tls">[TLS]
        <dd>E. Rescorla. <a href="https://www.rfc-editor.org/rfc/rfc8446"><cite>Transport Layer Security (TLS)プロトコル
                    1.3版</cite></a>。2018年8月。Proposed Standard。URL: <a
                href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def"><c- b>dictionary</c-> <a href="#dictdef-integrityviolationreportbody"><code><c- g>IntegrityViolationReportBody</c-></code></a> : <a data-link-type="idl-name" href="https://www.w3.org/TR/reporting-1/#reportbody"><c- n>ReportBody</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-type="USVString" href="#dom-integrityviolationreportbody-documenturl"><code><c- g>documentURL</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-type="USVString" href="#dom-integrityviolationreportbody-blockedurl"><code><c- g>blockedURL</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-type="USVString" href="#dom-integrityviolationreportbody-destination"><code><c- g>destination</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a>   <a data-type="boolean" href="#dom-integrityviolationreportbody-reportonly"><code><c- g>reportOnly</c-></code></a>;
};

</pre>
    <script>/* Boilerplate: script-dom-helper */
        "use strict";
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }</script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            let dfnPanelData = {
                "07d359a5": { "dfnID": "07d359a5", "dfnText": "generate and queue a report", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-generate-and-queue-a-report" }, { "id": "ref-for-generate-and-queue-a-report\u2460" }], "title": "3.8.3. Report violations" }], "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report" },
                "086e3aff": { "dfnID": "086e3aff", "dfnText": "origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-origin" }], "title": "2. Key Concepts and Terminology" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" },
                "0de10dfb": { "dfnID": "0de10dfb", "dfnText": "SHA-256", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-something" }, { "id": "ref-for-something\u2460" }, { "id": "ref-for-something\u2461" }, { "id": "ref-for-something\u2462" }, { "id": "ref-for-something\u2463" }, { "id": "ref-for-something\u2464" }, { "id": "ref-for-something\u2465" }], "title": "2. Key Concepts and Terminology" }, { "refs": [{ "id": "ref-for-something\u2466" }], "title": "3.1. Integrity metadata" }, { "refs": [{ "id": "ref-for-something\u2467" }, { "id": "ref-for-something\u2468" }, { "id": "ref-for-something\u2460\u24ea" }], "title": "3.2. Cryptographic hash functions" }, { "refs": [{ "id": "ref-for-something\u2460\u2460" }, { "id": "ref-for-something\u2460\u2461" }, { "id": "ref-for-something\u2460\u2462" }], "title": "3.2.2. Priority" }, { "refs": [{ "id": "ref-for-something\u2460\u2463" }, { "id": "ref-for-something\u2460\u2464" }], "title": "3.3.4. Do bytes match metadataList?" }], "url": "https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" },
                "104bce7f": { "dfnID": "104bce7f", "dfnText": "SHA-2", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-something" }, { "id": "ref-for-something\u2460" }, { "id": "ref-for-something\u2461" }, { "id": "ref-for-something\u2462" }, { "id": "ref-for-something\u2463" }, { "id": "ref-for-something\u2464" }, { "id": "ref-for-something\u2465" }], "title": "2. Key Concepts and Terminology" }, { "refs": [{ "id": "ref-for-something\u2466" }], "title": "3.1. Integrity metadata" }, { "refs": [{ "id": "ref-for-something\u2467" }, { "id": "ref-for-something\u2468" }, { "id": "ref-for-something\u2460\u24ea" }], "title": "3.2. Cryptographic hash functions" }, { "refs": [{ "id": "ref-for-something\u2460\u2460" }, { "id": "ref-for-something\u2460\u2461" }, { "id": "ref-for-something\u2460\u2462" }], "title": "3.2.2. Priority" }, { "refs": [{ "id": "ref-for-something\u2460\u2463" }, { "id": "ref-for-something\u2460\u2464" }], "title": "3.3.4. Do bytes match metadataList?" }], "url": "https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" },
                "1243a891": { "dfnID": "1243a891", "dfnText": "exist (for map)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-map-exists" }], "title": "3.8. Integrity-Policy" }], "url": "https://infra.spec.whatwg.org/#map-exists" },
                "1471f9a3": { "dfnID": "1471f9a3", "dfnText": "report only integrity policy", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-policy-container-report-only-integrity-policy" }], "title": "3.8.1. Parse Integrity-Policy headers" }, { "refs": [{ "id": "ref-for-policy-container-report-only-integrity-policy\u2460" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#policy-container-report-only-integrity-policy" },
                "1534f1eb": { "dfnID": "1534f1eb", "dfnText": "header name", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-header-name" }], "title": "3.8. Integrity-Policy" }], "url": "https://fetch.spec.whatwg.org/#header-name" },
                "16d07e10": { "dfnID": "16d07e10", "dfnText": "for each", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-iterate" }, { "id": "ref-for-list-iterate\u2460" }], "title": "3.8.3. Report violations" }], "url": "https://infra.spec.whatwg.org/#list-iterate" },
                "3349d69f": { "dfnID": "3349d69f", "dfnText": "associated Document", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-document-window" }], "title": "3.8.3. Report violations" }], "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" },
                "3ae34c95": { "dfnID": "3ae34c95", "dfnText": "destination", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-destination" }], "title": "3.8. Integrity-Policy" }, { "refs": [{ "id": "ref-for-concept-request-destination\u2460" }, { "id": "ref-for-concept-request-destination\u2461" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }, { "refs": [{ "id": "ref-for-concept-request-destination\u2462" }, { "id": "ref-for-concept-request-destination\u2463" }], "title": "3.8.3. Report violations" }], "url": "https://fetch.spec.whatwg.org/#concept-request-destination" },
                "42bcaebe": { "dfnID": "42bcaebe", "dfnText": "Dictionary", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-name-dictionaries" }], "title": "3.8. Integrity-Policy" }], "url": "https://tools.ietf.org/html/rfc9651#name-dictionaries" },
                "4c47fc9d": { "dfnID": "4c47fc9d", "dfnText": "strip URL for use in reports", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-strip-url-for-use-in-reports" }, { "id": "ref-for-strip-url-for-use-in-reports\u2460" }], "title": "3.8.3. Report violations" }], "url": "https://www.w3.org/TR/reporting-1/#strip-url-for-use-in-reports" },
                "511f0dde": { "dfnID": "511f0dde", "dfnText": "data", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-generate-and-queue-a-report-data" }, { "id": "ref-for-generate-and-queue-a-report-data\u2460" }], "title": "3.8.3. Report violations" }], "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-data" },
                "53275e46": { "dfnID": "53275e46", "dfnText": "append (for list)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-append" }], "title": "3.3.2. Parse metadata" }, { "refs": [{ "id": "ref-for-list-append\u2460" }, { "id": "ref-for-list-append\u2461" }, { "id": "ref-for-list-append\u2462" }], "title": "3.8. Integrity-Policy" }], "url": "https://infra.spec.whatwg.org/#list-append" },
                "5372cca8": { "dfnID": "5372cca8", "dfnText": "boolean", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-boolean" }], "title": "3.8.3. Report violations" }], "url": "https://webidl.spec.whatwg.org/#idl-boolean" },
                "55213b5b": { "dfnID": "55213b5b", "dfnText": "request", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request" }], "title": "3.1. Integrity metadata" }, { "refs": [{ "id": "ref-for-concept-request\u2460" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }, { "refs": [{ "id": "ref-for-concept-request\u2461" }], "title": "3.8.3. Report violations" }], "url": "https://fetch.spec.whatwg.org/#concept-request" },
                "574c86b8": { "dfnID": "574c86b8", "dfnText": "ReportBody", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-reportbody" }], "title": "3.8.3. Report violations" }], "url": "https://www.w3.org/TR/reporting-1/#reportbody" },
                "5a84ded6": { "dfnID": "5a84ded6", "dfnText": "URL", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-document-url" }], "title": "3.8.3. Report violations" }], "url": "https://dom.spec.whatwg.org/#dom-document-url" },
                "5c66de35": { "dfnID": "5c66de35", "dfnText": "get a structured field value", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-header-list-get-structured-header" }], "title": "3.8. Integrity-Policy" }], "url": "https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header" },
                "5d7209e9": { "dfnID": "5d7209e9", "dfnText": "Window", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-window" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }, { "refs": [{ "id": "ref-for-window\u2460" }, { "id": "ref-for-window\u2461" }], "title": "3.8.3. Report violations" }], "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" },
                "5f693367": { "dfnID": "5f693367", "dfnText": "no-transform", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-5.2.1.6" }], "title": "4. Proxies" }], "url": "https://tools.ietf.org/html/rfc7234#section-5.2.1.6" },
                "649608b9": { "dfnID": "649608b9", "dfnText": "list", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list" }], "title": "3.8. Integrity-Policy" }], "url": "https://infra.spec.whatwg.org/#list" },
                "65181da8": { "dfnID": "65181da8", "dfnText": "secure context", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-secure-context" }, { "id": "ref-for-secure-context\u2460" }], "title": "5.1. Non-secure contexts remain non-secure" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" },
                "692595fe": { "dfnID": "692595fe", "dfnText": "ordered set", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-ordered-set" }], "title": "2. Key Concepts and Terminology" }], "url": "https://infra.spec.whatwg.org/#ordered-set" },
                "6b815fdd": { "dfnID": "6b815fdd", "dfnText": "is empty", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-is-empty" }], "title": "3.3.4. Do bytes match metadataList?" }], "url": "https://infra.spec.whatwg.org/#list-is-empty" },
                "6f2dfa22": { "dfnID": "6f2dfa22", "dfnText": "ASCII lowercase", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-ascii-lowercase" }], "title": "2. Key Concepts and Terminology" }], "url": "https://infra.spec.whatwg.org/#ascii-lowercase" },
                "71a49668": { "dfnID": "71a49668", "dfnText": "integrity policy", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-policy-container-integrity-policy" }], "title": "3.8.1. Parse Integrity-Policy headers" }, { "refs": [{ "id": "ref-for-policy-container-integrity-policy\u2460" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#policy-container-integrity-policy" },
                "7393da89": { "dfnID": "7393da89", "dfnText": "same origin", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-same-origin" }], "title": "2. Key Concepts and Terminology" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-origin" },
                "75393c04": { "dfnID": "75393c04", "dfnText": "exist (for list)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-contain" }], "title": "2. Key Concepts and Terminology" }, { "refs": [{ "id": "ref-for-list-contain\u2460" }], "title": "3.3.2. Parse metadata" }, { "refs": [{ "id": "ref-for-list-contain\u2461" }, { "id": "ref-for-list-contain\u2462" }, { "id": "ref-for-list-contain\u2463" }, { "id": "ref-for-list-contain\u2464" }, { "id": "ref-for-list-contain\u2465" }], "title": "3.8. Integrity-Policy" }, { "refs": [{ "id": "ref-for-list-contain\u2466" }, { "id": "ref-for-list-contain\u2467" }, { "id": "ref-for-list-contain\u2468" }, { "id": "ref-for-list-contain\u2460\u24ea" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "https://infra.spec.whatwg.org/#list-contain" },
                "77b4c09a": { "dfnID": "77b4c09a", "dfnText": "assert", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-assert" }, { "id": "ref-for-assert\u2460" }, { "id": "ref-for-assert\u2461" }], "title": "3.8.3. Report violations" }], "url": "https://infra.spec.whatwg.org/#assert" },
                "83c59a3a": { "dfnID": "83c59a3a", "dfnText": "WorkerGlobalScope", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-workerglobalscope" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }, { "refs": [{ "id": "ref-for-workerglobalscope\u2460" }, { "id": "ref-for-workerglobalscope\u2461" }], "title": "3.8.3. Report violations" }], "url": "https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" },
                "857d5516": { "dfnID": "857d5516", "dfnText": "client", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-client" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }, { "refs": [{ "id": "ref-for-concept-request-client\u2460" }, { "id": "ref-for-concept-request-client\u2461" }], "title": "3.8.3. Report violations" }], "url": "https://fetch.spec.whatwg.org/#concept-request-client" },
                "86efadaf": { "dfnID": "86efadaf", "dfnText": "policy container", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-policy-container" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "https://fetch.spec.whatwg.org/#concept-request-policy-container" },
                "8a30477b": { "dfnID": "8a30477b", "dfnText": "global object", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-settings-object-global" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }, { "refs": [{ "id": "ref-for-concept-settings-object-global\u2460" }], "title": "3.8.3. Report violations" }], "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" },
                "8f26de31": { "dfnID": "8f26de31", "dfnText": "is local", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-is-local" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "https://fetch.spec.whatwg.org/#is-local" },
                "92ff7496": { "dfnID": "92ff7496", "dfnText": "SHA-512", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-something" }, { "id": "ref-for-something\u2460" }, { "id": "ref-for-something\u2461" }, { "id": "ref-for-something\u2462" }, { "id": "ref-for-something\u2463" }, { "id": "ref-for-something\u2464" }, { "id": "ref-for-something\u2465" }], "title": "2. Key Concepts and Terminology" }, { "refs": [{ "id": "ref-for-something\u2466" }], "title": "3.1. Integrity metadata" }, { "refs": [{ "id": "ref-for-something\u2467" }, { "id": "ref-for-something\u2468" }, { "id": "ref-for-something\u2460\u24ea" }], "title": "3.2. Cryptographic hash functions" }, { "refs": [{ "id": "ref-for-something\u2460\u2460" }, { "id": "ref-for-something\u2460\u2461" }, { "id": "ref-for-something\u2460\u2462" }], "title": "3.2.2. Priority" }, { "refs": [{ "id": "ref-for-something\u2460\u2463" }, { "id": "ref-for-something\u2460\u2464" }], "title": "3.3.4. Do bytes match metadataList?" }], "url": "https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" },
                "984221ca": { "dfnID": "984221ca", "dfnText": "struct", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-struct" }], "title": "3.8. Integrity-Policy" }], "url": "https://infra.spec.whatwg.org/#struct" },
                "998ca7a7": { "dfnID": "998ca7a7", "dfnText": "inner list", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-name-inner-lists" }], "title": "3.8. Integrity-Policy" }], "url": "https://tools.ietf.org/html/rfc9651#name-inner-lists" },
                "a2a30ba8": { "dfnID": "a2a30ba8", "dfnText": "CORS protocol", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-cors-protocol" }], "title": "5.3. Cross-origin data leakage" }], "url": "https://fetch.spec.whatwg.org/#cors-protocol" },
                "a3b18719": { "dfnID": "a3b18719", "dfnText": "append (for set)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-set-append" }, { "id": "ref-for-set-append\u2460" }], "title": "3.3.3. Get the strongest metadata from set" }], "url": "https://infra.spec.whatwg.org/#set-append" },
                "ae8def21": { "dfnID": "ae8def21", "dfnText": "contain", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-list-contain" }], "title": "2. Key Concepts and Terminology" }, { "refs": [{ "id": "ref-for-list-contain\u2460" }], "title": "3.3.2. Parse metadata" }, { "refs": [{ "id": "ref-for-list-contain\u2461" }, { "id": "ref-for-list-contain\u2462" }, { "id": "ref-for-list-contain\u2463" }, { "id": "ref-for-list-contain\u2464" }, { "id": "ref-for-list-contain\u2465" }], "title": "3.8. Integrity-Policy" }, { "refs": [{ "id": "ref-for-list-contain\u2466" }, { "id": "ref-for-list-contain\u2467" }, { "id": "ref-for-list-contain\u2468" }, { "id": "ref-for-list-contain\u2460\u24ea" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "https://infra.spec.whatwg.org/#list-contain" },
                "b0d7f3c3": { "dfnID": "b0d7f3c3", "dfnText": "USVString", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-idl-USVString" }, { "id": "ref-for-idl-USVString\u2460" }, { "id": "ref-for-idl-USVString\u2461" }], "title": "3.8.3. Report violations" }], "url": "https://webidl.spec.whatwg.org/#idl-USVString" },
                "b33787b2": { "dfnID": "b33787b2", "dfnText": "policy container", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-policy-container" }], "title": "3.8.1. Parse Integrity-Policy headers" }], "url": "https://html.spec.whatwg.org/multipage/browsers.html#policy-container" },
                "b3a57b71": { "dfnID": "b3a57b71", "dfnText": "Cache-Control", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-section-5.2" }], "title": "4. Proxies" }], "url": "https://tools.ietf.org/html/rfc7234#section-5.2" },
                "base64-encoding": { "dfnID": "base64-encoding", "dfnText": "base64 encoding", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-base64-encoding" }], "title": "3.1. Integrity metadata" }, { "refs": [{ "id": "ref-for-base64-encoding\u2460" }], "title": "3.3.1. Apply algorithm to bytes" }], "url": "#base64-encoding" },
                "bbbbe32e": { "dfnID": "bbbbe32e", "dfnText": "SHA-384", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-something" }, { "id": "ref-for-something\u2460" }, { "id": "ref-for-something\u2461" }, { "id": "ref-for-something\u2462" }, { "id": "ref-for-something\u2463" }, { "id": "ref-for-something\u2464" }, { "id": "ref-for-something\u2465" }], "title": "2. Key Concepts and Terminology" }, { "refs": [{ "id": "ref-for-something\u2466" }], "title": "3.1. Integrity metadata" }, { "refs": [{ "id": "ref-for-something\u2467" }, { "id": "ref-for-something\u2468" }, { "id": "ref-for-something\u2460\u24ea" }], "title": "3.2. Cryptographic hash functions" }, { "refs": [{ "id": "ref-for-something\u2460\u2460" }, { "id": "ref-for-something\u2460\u2461" }, { "id": "ref-for-something\u2460\u2462" }], "title": "3.2.2. Priority" }, { "refs": [{ "id": "ref-for-something\u2460\u2463" }, { "id": "ref-for-something\u2460\u2464" }], "title": "3.3.4. Do bytes match metadataList?" }], "url": "https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" },
                "bed34579": { "dfnID": "bed34579", "dfnText": "WSP", "external": true, "refSections": [{ "refs": [{ "id": "58fa9b5f0" }, { "id": "ref-for-appendix-B.1" }, { "id": "ref-for-appendix-B.1\u2460" }], "title": "2.1. Grammatical Concepts" }, { "refs": [{ "id": "ref-for-appendix-B.1\u2461" }, { "id": "ref-for-appendix-B.1\u2462" }, { "id": "ref-for-appendix-B.1\u2463" }, { "id": "ref-for-appendix-B.1\u2464" }, { "id": "ref-for-appendix-B.1\u2465" }], "title": "3.5. The integrity attribute" }], "url": "https://tools.ietf.org/html/rfc5234#appendix-B.1" },
                "blocked-destinations": { "dfnID": "blocked-destinations", "dfnText": "blocked destinations", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-blocked-destinations" }, { "id": "ref-for-blocked-destinations\u2460" }], "title": "3.8. Integrity-Policy" }, { "refs": [{ "id": "ref-for-blocked-destinations\u2461" }, { "id": "ref-for-blocked-destinations\u2462" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "#blocked-destinations" },
                "c07f8014": { "dfnID": "c07f8014", "dfnText": "header value", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-header-value" }, { "id": "ref-for-header-value\u2460" }], "title": "3.8.1. Parse Integrity-Policy headers" }], "url": "https://fetch.spec.whatwg.org/#header-value" },
                "c5b6dcb3": { "dfnID": "c5b6dcb3", "dfnText": "url", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-workerglobalscope-url" }], "title": "3.8.3. Report violations" }], "url": "https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-url" },
                "c6544229": { "dfnID": "c6544229", "dfnText": "VCHAR", "external": true, "refSections": [{ "refs": [{ "id": "58fa9b5f0" }, { "id": "ref-for-appendix-B.1" }, { "id": "ref-for-appendix-B.1\u2460" }], "title": "2.1. Grammatical Concepts" }, { "refs": [{ "id": "ref-for-appendix-B.1\u2461" }, { "id": "ref-for-appendix-B.1\u2462" }, { "id": "ref-for-appendix-B.1\u2463" }, { "id": "ref-for-appendix-B.1\u2464" }, { "id": "ref-for-appendix-B.1\u2465" }], "title": "3.5. The integrity attribute" }], "url": "https://tools.ietf.org/html/rfc5234#appendix-B.1" },
                "cb98f71f": { "dfnID": "cb98f71f", "dfnText": "mode", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-mode" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "https://fetch.spec.whatwg.org/#concept-request-mode" },
                "cbfb19d1": { "dfnID": "cbfb19d1", "dfnText": "type", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-generate-and-queue-a-report-type" }, { "id": "ref-for-generate-and-queue-a-report-type\u2460" }], "title": "3.8.3. Report violations" }], "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-type" },
                "d1364af2": { "dfnID": "d1364af2", "dfnText": "link", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-link" }], "title": "3.6. The integrity link processing option" }], "url": "https://tools.ietf.org/html/rfc8288#link" },
                "d5434eef": { "dfnID": "d5434eef", "dfnText": "contains", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-header-list-contains" }, { "id": "ref-for-header-list-contains\u2460" }], "title": "3.8.1. Parse Integrity-Policy headers" }], "url": "https://fetch.spec.whatwg.org/#header-list-contains" },
                "d79a826f": { "dfnID": "d79a826f", "dfnText": "integrity metadata", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-integrity-metadata" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "https://fetch.spec.whatwg.org/#concept-request-integrity-metadata" },
                "d7db864b": { "dfnID": "d7db864b", "dfnText": "base64-value", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-grammardef-base64-value" }], "title": "2.1. Grammatical Concepts" }, { "refs": [{ "id": "ref-for-grammardef-base64-value\u2460" }], "title": "3.5. The integrity attribute" }], "url": "https://www.w3.org/TR/CSP3/#grammardef-base64-value" },
                "d85a6c84": { "dfnID": "d85a6c84", "dfnText": "header list", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-header-list" }], "title": "3.8. Integrity-Policy" }], "url": "https://fetch.spec.whatwg.org/#concept-header-list" },
                "db64faf0": { "dfnID": "db64faf0", "dfnText": "context", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-generate-and-queue-a-report-context" }, { "id": "ref-for-generate-and-queue-a-report-context\u2460" }], "title": "3.8.3. Report violations" }], "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-context" },
                "dc1cd39b": { "dfnID": "dc1cd39b", "dfnText": "URL", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-request-url" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }, { "refs": [{ "id": "ref-for-concept-request-url\u2460" }], "title": "3.8.3. Report violations" }], "url": "https://fetch.spec.whatwg.org/#concept-request-url" },
                "dcffbccd": { "dfnID": "dcffbccd", "dfnText": "URL", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-url" }], "title": "3.8.3. Report violations" }], "url": "https://url.spec.whatwg.org/#concept-url" },
                "destination": { "dfnID": "destination", "dfnText": "destination", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-destination" }], "title": "3.8. Integrity-Policy" }], "url": "#destination" },
                "dictdef-integrityviolationreportbody": { "dfnID": "dictdef-integrityviolationreportbody", "dfnText": "IntegrityViolationReportBody", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dictdef-integrityviolationreportbody" }, { "id": "ref-for-dictdef-integrityviolationreportbody\u2460" }], "title": "3.8.3. Report violations" }], "url": "#dictdef-integrityviolationreportbody" },
                "digest": { "dfnID": "digest", "dfnText": "digest", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-digest" }], "title": "3.1. Integrity metadata" }], "url": "#digest" },
                "does-response-match-metadatalist": { "dfnID": "does-response-match-metadatalist", "dfnText": "3.3.4. Do bytes match metadataList?", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-does-response-match-metadatalist" }], "title": "3.2.1. Agility" }, { "refs": [{ "id": "ref-for-does-response-match-metadatalist" }], "title": "3.3.4. Do bytes match metadataList?" }], "url": "#does-response-match-metadatalist" },
                "dom-integrityviolationreportbody-blockedurl": { "dfnID": "dom-integrityviolationreportbody-blockedurl", "dfnText": "blockedURL", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-integrityviolationreportbody-blockedurl" }, { "id": "ref-for-dom-integrityviolationreportbody-blockedurl\u2460" }], "title": "3.8.3. Report violations" }], "url": "#dom-integrityviolationreportbody-blockedurl" },
                "dom-integrityviolationreportbody-destination": { "dfnID": "dom-integrityviolationreportbody-destination", "dfnText": "destination", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-integrityviolationreportbody-destination" }, { "id": "ref-for-dom-integrityviolationreportbody-destination\u2460" }], "title": "3.8.3. Report violations" }], "url": "#dom-integrityviolationreportbody-destination" },
                "dom-integrityviolationreportbody-documenturl": { "dfnID": "dom-integrityviolationreportbody-documenturl", "dfnText": "documentURL", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-integrityviolationreportbody-documenturl" }, { "id": "ref-for-dom-integrityviolationreportbody-documenturl\u2460" }], "title": "3.8.3. Report violations" }], "url": "#dom-integrityviolationreportbody-documenturl" },
                "dom-integrityviolationreportbody-reportonly": { "dfnID": "dom-integrityviolationreportbody-reportonly", "dfnText": "reportOnly", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-integrityviolationreportbody-reportonly" }, { "id": "ref-for-dom-integrityviolationreportbody-reportonly\u2460" }], "title": "3.8.3. Report violations" }], "url": "#dom-integrityviolationreportbody-reportonly" },
                "e56c6177": { "dfnID": "e56c6177", "dfnText": "destination type", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-destination-type" }], "title": "3.8. Integrity-Policy" }], "url": "https://fetch.spec.whatwg.org/#destination-type" },
                "e5fc5b88": { "dfnID": "e5fc5b88", "dfnText": "strictly split", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-strictly-split" }, { "id": "ref-for-strictly-split\u2460" }, { "id": "ref-for-strictly-split\u2461" }], "title": "3.3.2. Parse metadata" }], "url": "https://infra.spec.whatwg.org/#strictly-split" },
                "ead5b288": { "dfnID": "ead5b288", "dfnText": "destination", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-generate-and-queue-a-report-destination" }, { "id": "ref-for-generate-and-queue-a-report-destination\u2460" }], "title": "3.8.3. Report violations" }], "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-destination" },
                "ee7bba09": { "dfnID": "ee7bba09", "dfnText": "response", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-response" }], "title": "3.8.1. Parse Integrity-Policy headers" }], "url": "https://fetch.spec.whatwg.org/#concept-response" },
                "endpoints": { "dfnID": "endpoints", "dfnText": "endpoints", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-endpoints" }], "title": "3.8. Integrity-Policy" }, { "refs": [{ "id": "ref-for-endpoints\u2460" }, { "id": "ref-for-endpoints\u2461" }], "title": "3.8.3. Report violations" }], "url": "#endpoints" },
                "f4486aa1": { "dfnID": "f4486aa1", "dfnText": "token", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-name-tokens" }], "title": "3.8. Integrity-Policy" }], "url": "https://tools.ietf.org/html/rfc9651#name-tokens" },
                "f7b00a8b": { "dfnID": "f7b00a8b", "dfnText": "header list (for response)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-response-header-list" }], "title": "3.8.1. Parse Integrity-Policy headers" }], "url": "https://fetch.spec.whatwg.org/#concept-response-header-list" },
                "f8eebe57": { "dfnID": "f8eebe57", "dfnText": "hash-algorithm", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-grammardef-hash-algorithm" }], "title": "2.1. Grammatical Concepts" }, { "refs": [{ "id": "ref-for-grammardef-hash-algorithm\u2460" }], "title": "3.5. The integrity attribute" }], "url": "https://www.w3.org/TR/CSP3/#grammardef-hash-algorithm" },
                "f937b7b6": { "dfnID": "f937b7b6", "dfnText": "continue", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-iteration-continue" }], "title": "3.3.2. Parse metadata" }, { "refs": [{ "id": "ref-for-iteration-continue\u2460" }, { "id": "ref-for-iteration-continue\u2461" }], "title": "3.3.3. Get the strongest metadata from set" }], "url": "https://infra.spec.whatwg.org/#iteration-continue" },
                "grammardef-hash-expression": { "dfnID": "grammardef-hash-expression", "dfnText": "hash-expression", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-grammardef-hash-expression" }], "title": "3.5. The integrity attribute" }], "url": "#grammardef-hash-expression" },
                "grammardef-hash-with-options": { "dfnID": "grammardef-hash-with-options", "dfnText": "hash-with-options", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-grammardef-hash-with-options" }, { "id": "ref-for-grammardef-hash-with-options\u2460" }], "title": "3.5. The integrity attribute" }], "url": "#grammardef-hash-with-options" },
                "grammardef-integrity-metadata": { "dfnID": "grammardef-integrity-metadata", "dfnText": "integrity-metadata", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-grammardef-integrity-metadata" }], "title": "3.6. The integrity link processing option" }], "url": "#grammardef-integrity-metadata" },
                "grammardef-option-expression": { "dfnID": "grammardef-option-expression", "dfnText": "option-expression", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-grammardef-option-expression" }], "title": "3.5. The integrity attribute" }], "url": "#grammardef-option-expression" },
                "integrity-metadata": { "dfnID": "integrity-metadata", "dfnText": "integrity\n  metadata", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-integrity-metadata" }, { "id": "ref-for-integrity-metadata\u2460" }, { "id": "ref-for-integrity-metadata\u2461" }], "title": "1.2.1. Resource Integrity" }, { "refs": [{ "id": "ref-for-integrity-metadata\u2462" }], "title": "3.2. Cryptographic hash functions" }, { "refs": [{ "id": "ref-for-integrity-metadata\u2463" }], "title": "3.2.1. Agility" }, { "refs": [{ "id": "ref-for-integrity-metadata\u2464" }], "title": "3.5. The integrity attribute" }, { "refs": [{ "id": "ref-for-integrity-metadata\u2465" }], "title": "3.6. The integrity link processing option" }, { "refs": [{ "id": "ref-for-integrity-metadata\u2466" }], "title": "4. Proxies" }, { "refs": [{ "id": "ref-for-integrity-metadata\u2467" }], "title": "5.1. Non-secure contexts remain non-secure" }], "url": "#integrity-metadata" },
                "integrity-policy": { "dfnID": "integrity-policy", "dfnText": "integrity policy", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-integrity-policy" }], "title": "3.8. Integrity-Policy" }, { "refs": [{ "id": "ref-for-integrity-policy\u2460" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }, { "refs": [{ "id": "ref-for-integrity-policy\u2461" }, { "id": "ref-for-integrity-policy\u2462" }], "title": "3.8.3. Report violations" }], "url": "#integrity-policy" },
                "parse-integrity-policy-headers": { "dfnID": "parse-integrity-policy-headers", "dfnText": "parse Integrity-Policy headers", "external": false, "refSections": [], "url": "#parse-integrity-policy-headers" },
                "parse-metadata": { "dfnID": "parse-metadata", "dfnText": "parse metadata", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-parse-metadata" }], "title": "3.3.4. Do bytes match metadataList?" }, { "refs": [{ "id": "ref-for-parse-metadata\u2460" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "#parse-metadata" },
                "processing-an-integrity-policy": { "dfnID": "processing-an-integrity-policy", "dfnText": "processing an integrity policy", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-processing-an-integrity-policy" }, { "id": "ref-for-processing-an-integrity-policy\u2460" }], "title": "3.8.1. Parse Integrity-Policy headers" }], "url": "#processing-an-integrity-policy" },
                "report-violation": { "dfnID": "report-violation", "dfnText": "report violation", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-report-violation" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "#report-violation" },
                "should-request-be-blocked-by-integrity-policy": { "dfnID": "should-request-be-blocked-by-integrity-policy", "dfnText": "should request be blocked by integrity policy", "external": false, "refSections": [], "url": "#should-request-be-blocked-by-integrity-policy" },
                "source": { "dfnID": "source", "dfnText": "source", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-source" }], "title": "3.8. Integrity-Policy" }], "url": "#source" },
                "sources": { "dfnID": "sources", "dfnText": "sources", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-sources" }], "title": "3.8. Integrity-Policy" }, { "refs": [{ "id": "ref-for-sources\u2460" }, { "id": "ref-for-sources\u2461" }], "title": "3.8.2. Should request be blocked by Integrity Policy" }], "url": "#sources" },
                "valid-sri-hash-algorithm-token": { "dfnID": "valid-sri-hash-algorithm-token", "dfnText": "valid SRI hash algorithm token", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-valid-sri-hash-algorithm-token" }], "title": "3.3.2. Parse metadata" }, { "refs": [{ "id": "ref-for-valid-sri-hash-algorithm-token\u2460" }], "title": "3.3.3. Get the strongest metadata from set" }], "url": "#valid-sri-hash-algorithm-token" },
                "valid-sri-hash-algorithm-token-set": { "dfnID": "valid-sri-hash-algorithm-token-set", "dfnText": "valid SRI hash algorithm token set", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-valid-sri-hash-algorithm-token-set" }], "title": "2. Key Concepts and Terminology" }, { "refs": [{ "id": "ref-for-valid-sri-hash-algorithm-token-set\u2460" }], "title": "3.2.2. Priority" }, { "refs": [{ "id": "ref-for-valid-sri-hash-algorithm-token-set\u2461" }, { "id": "ref-for-valid-sri-hash-algorithm-token-set\u2462" }], "title": "3.3.3. Get the strongest metadata from set" }], "url": "#valid-sri-hash-algorithm-token-set" },
            };

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            });

            window.addEventListener("resize", () => {
                // Pin any visible dfn panel
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => positionDfnPanel(el));
            });

            function genAllDfnPanels() {
                for (const panelData of Object.values(dfnPanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                        continue;
                    }
                    dfn.panelData = panelData;
                    insertDfnPopupAction(dfn);
                }
            }

            function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
                const dfnPanel = mk.aside({
                    class: "dfn-panel on",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url, class: "dfn-link" }, url),
                    refSections.length == 0 ? [] :
                        mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({ href: `#${ref.id}` },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                    genLinkingSyntaxes(dfn),
                );

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        scrollToTargetAndHighlight(event);
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                    refocusOnTarget(event);
                });
                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel({ dfnPanel });
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.dfn = dfn;
                dfn.dfnPanel = dfnPanel;
                return dfnPanel;
            }



            function hideAllDfnPanels() {
                // Delete the currently-active dfn panel.
                queryAll(".dfn-panel").forEach(dfnPanel => hideDfnPanel({ dfnPanel }));
            }

            function showDfnPanel(dfn) {
                hideAllDfnPanels(); // Only display one at a time.

                dfn.setAttribute("aria-expanded", "true");

                const dfnPanel = genDfnPanel(dfn, dfn.panelData);

                // Give the dfn a unique tabindex, and then
                // give all the tabbable panel bits successive indexes.
                let tabIndex = 100;
                dfn.tabIndex = tabIndex++;
                const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
                for (const el of tabbable) {
                    el.tabIndex = tabIndex++;
                }

                append(document.body, dfnPanel);
                positionDfnPanel(dfnPanel);
            }

            function positionDfnPanel(dfnPanel) {
                const dfn = dfnPanel.dfn;
                const dfnPos = getBounds(dfn);
                dfnPanel.style.top = dfnPos.bottom + "px";
                dfnPanel.style.left = dfnPos.left + "px";

                const panelPos = dfnPanel.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
                    dfnPanel.style.left = newLeft + "px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.position = "fixed";
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel({ dfn, dfnPanel }) {
                if (!dfnPanel) dfnPanel = dfn.dfnPanel;
                if (!dfn) dfn = dfnPanel.dfn;
                dfn.dfnPanel = undefined;
                dfnPanel.dfn = undefined;
                dfn.setAttribute("aria-expanded", "false");
                dfn.tabIndex = undefined;
                dfnPanel.remove()
            }

            function toggleDfnPanel(dfn) {
                if (dfn.dfnPanel) {
                    hideDfnPanel(dfn);
                } else {
                    showDfnPanel(dfn);
                }
            }

            function insertDfnPopupAction(dfn) {
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    toggleDfnPanel(dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            }

            function refocusOnTarget(event) {
                const target = event.target;
                setTimeout(() => {
                    // Refocus on the event.target element.
                    // This is needed after browser scrolls to the destination.
                    target.focus();
                });
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function scrollToTargetAndHighlight(event) {
                let hash = event.target.hash;
                if (hash) {
                    hash = decodeURIComponent(hash.substring(1));
                    const dest = document.getElementById(hash);
                    if (dest) {
                        dest.classList.add('highlighted');
                        setTimeout(() => dest.classList.remove('highlighted'), 1000);
                    }
                }
            }

            // Functions, divided by link type, that wrap an autolink's
            // contents with the appropriate outer syntax.
            // Alternately, a string naming another type they format
            // the same as.
            function needsFor(type) {
                switch (type) {
                    case "descriptor":
                    case "value":
                    case "element-attr":
                    case "attr-value":
                    case "element-state":
                    case "method":
                    case "constructor":
                    case "argument":
                    case "attribute":
                    case "const":
                    case "dict-member":
                    case "event":
                    case "enum-value":
                    case "stringifier":
                    case "serializer":
                    case "iterator":
                    case "maplike":
                    case "setlike":
                    case "state":
                    case "mode":
                    case "context":
                    case "facet": return true;

                    default: return false;
                }
            }
            function refusesFor(type) {
                switch (type) {
                    case "property":
                    case "element":
                    case "interface":
                    case "namespace":
                    case "callback":
                    case "dictionary":
                    case "enum":
                    case "exception":
                    case "typedef":
                    case "http-header":
                    case "permission": return true;

                    default: return false;
                }
            }
            function linkFormatterFromType(type) {
                switch (type) {
                    case 'scheme':
                    case 'permission':
                    case 'dfn': return (text) => `[=${text}=]`;

                    case 'abstract-op': return (text) => `[\$${text}\$]`;

                    case 'function':
                    case 'at-rule':
                    case 'selector':
                    case 'value': return (text) => `''${text}''`;

                    case 'http-header': return (text) => `[:${text}:]`;

                    case 'interface':
                    case 'constructor':
                    case 'method':
                    case 'argument':
                    case 'attribute':
                    case 'callback':
                    case 'dictionary':
                    case 'dict-member':
                    case 'enum':
                    case 'enum-value':
                    case 'exception':
                    case 'const':
                    case 'typedef':
                    case 'stringifier':
                    case 'serializer':
                    case 'iterator':
                    case 'maplike':
                    case 'setlike':
                    case 'extended-attribute':
                    case 'event':
                    case 'idl': return (text) => `{{${text}}}`;

                    case 'element-state':
                    case 'element-attr':
                    case 'attr-value':
                    case 'element': return (element) => `<{${element}}>`;

                    case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

                    case 'type': return (text) => `<<${text}>>`;

                    case 'descriptor':
                    case 'property': return (text) => `'${text}'`;

                    default: return;
                };
            };

            function genLinkingSyntaxes(dfn) {
                if (dfn.tagName != "DFN") return;

                const type = dfn.getAttribute('data-dfn-type');
                if (!type) {
                    console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
                    return [];
                }

                // Return a function that wraps link text based on the type
                const linkFormatter = linkFormatterFromType(type);
                if (!linkFormatter) {
                    console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
                    return [];
                }

                let ltAlts;
                if (dfn.hasAttribute('data-lt')) {
                    ltAlts = dfn.getAttribute('data-lt')
                        .split("|")
                        .map(x => x.trim());
                } else {
                    ltAlts = [dfn.textContent.trim()];
                }
                if (type == "type") {
                    // lt of "<foo>", but "foo" is the interior;
                    // <<foo/bar>> is how you write it with a for,
                    // not <foo/<bar>> or whatever.
                    for (var i = 0; i < ltAlts.length; i++) {
                        const lt = ltAlts[i];
                        const match = /<(.*)>/.exec(lt);
                        if (match) { ltAlts[i] = match[1]; }
                    }
                }

                let forAlts;
                if (dfn.hasAttribute('data-dfn-for')) {
                    forAlts = dfn.getAttribute('data-dfn-for')
                        .split(",")
                        .map(x => x.trim());
                } else {
                    forAlts = [''];
                }

                let linkingSyntaxes = [];
                if (!needsFor(type)) {
                    for (const lt of ltAlts) {
                        linkingSyntaxes.push(linkFormatter(lt));
                    }
                }
                if (!refusesFor(type)) {
                    for (const f of forAlts) {
                        linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
                    }
                }
                return [
                    mk.b({}, 'Possible linking syntaxes:'),
                    mk.ul({},
                        ...linkingSyntaxes.map(link => {
                            const copyLink = async () =>
                                await navigator.clipboard.writeText(link);
                            return mk.li({},
                                mk.div({ class: 'link-item' },
                                    mk.button({
                                        class: 'copy-icon', title: 'Copy',
                                        type: 'button',
                                        _onclick: copyLink,
                                        tabindex: 0,
                                    }, mk.span({ class: 'icon' })),
                                    mk.span({}, link)
                                )
                            );
                        })
                    )
                ];
            }
        }
    </script>
    <script>/* Boilerplate: script-ref-hints */
        "use strict";
        {
            let refsData = {
                "#base64-encoding": { "displayText": "base64 encoding", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "base64 encoding", "type": "dfn", "url": "#base64-encoding" },
                "#blocked-destinations": { "displayText": "blocked destinations", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "blocked destinations", "type": "dfn", "url": "#blocked-destinations" },
                "#destination": { "displayText": "destination", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "destination", "type": "dfn", "url": "#destination" },
                "#dictdef-integrityviolationreportbody": { "displayText": "IntegrityViolationReportBody", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "IntegrityViolationReportBody", "type": "dictionary", "url": "#dictdef-integrityviolationreportbody" },
                "#digest": { "displayText": "digest", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "digest", "type": "dfn", "url": "#digest" },
                "#dom-integrityviolationreportbody-blockedurl": { "displayText": "blockedURL", "export": true, "for_": ["IntegrityViolationReportBody"], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "blockedURL", "type": "dict-member", "url": "#dom-integrityviolationreportbody-blockedurl" },
                "#dom-integrityviolationreportbody-destination": { "displayText": "destination", "export": true, "for_": ["IntegrityViolationReportBody"], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "destination", "type": "dict-member", "url": "#dom-integrityviolationreportbody-destination" },
                "#dom-integrityviolationreportbody-documenturl": { "displayText": "documentURL", "export": true, "for_": ["IntegrityViolationReportBody"], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "documentURL", "type": "dict-member", "url": "#dom-integrityviolationreportbody-documenturl" },
                "#dom-integrityviolationreportbody-reportonly": { "displayText": "reportOnly", "export": true, "for_": ["IntegrityViolationReportBody"], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "reportOnly", "type": "dict-member", "url": "#dom-integrityviolationreportbody-reportonly" },
                "#endpoints": { "displayText": "endpoints", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "endpoints", "type": "dfn", "url": "#endpoints" },
                "#grammardef-hash-expression": { "displayText": "hash-expression", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "hash-expression", "type": "grammar", "url": "#grammardef-hash-expression" },
                "#grammardef-hash-with-options": { "displayText": "hash-with-options", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "hash-with-options", "type": "grammar", "url": "#grammardef-hash-with-options" },
                "#grammardef-integrity-metadata": { "displayText": "integrity-metadata", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "integrity-metadata", "type": "grammar", "url": "#grammardef-integrity-metadata" },
                "#grammardef-option-expression": { "displayText": "option-expression", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "option-expression", "type": "grammar", "url": "#grammardef-option-expression" },
                "#integrity-metadata": { "displayText": "integrity metadata", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "integrity metadata", "type": "dfn", "url": "#integrity-metadata" },
                "#integrity-policy": { "displayText": "integrity policy", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "integrity policy", "type": "dfn", "url": "#integrity-policy" },
                "#parse-metadata": { "displayText": "parse metadata", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "parse metadata", "type": "dfn", "url": "#parse-metadata" },
                "#processing-an-integrity-policy": { "displayText": "processing an integrity policy", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "processing an integrity policy", "type": "dfn", "url": "#processing-an-integrity-policy" },
                "#report-violation": { "displayText": "report violation", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "report violation", "type": "dfn", "url": "#report-violation" },
                "#source": { "displayText": "source", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "source", "type": "dfn", "url": "#source" },
                "#sources": { "displayText": "sources", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "sources", "type": "dfn", "url": "#sources" },
                "#valid-sri-hash-algorithm-token": { "displayText": "valid sri hash algorithm token", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "valid sri hash algorithm token", "type": "dfn", "url": "#valid-sri-hash-algorithm-token" },
                "#valid-sri-hash-algorithm-token-set": { "displayText": "valid sri hash algorithm token set", "export": true, "for_": [], "level": "2", "normative": true, "shortname": "sri", "spec": "sri-2", "status": "local", "text": "valid sri hash algorithm token set", "type": "dfn", "url": "#valid-sri-hash-algorithm-token-set" },
                "14c46ca8_https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#": { "displayText": "SHA-2", "export": true, "for_": [], "level": "", "normative": true, "shortname": "sha2", "spec": "sha2", "status": "anchor-block", "text": "sha-2", "type": "dfn", "url": "https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" },
                "37de769a_https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#": { "displayText": "SHA-384", "export": true, "for_": [], "level": "", "normative": true, "shortname": "sha2", "spec": "sha2", "status": "anchor-block", "text": "sha-384", "type": "dfn", "url": "https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" },
                "3fed24ef_https://tools.ietf.org/html/rfc5234#appendix-B.1": { "displayText": "VCHAR", "export": true, "for_": [], "level": "", "normative": true, "shortname": "abnf", "spec": "abnf", "status": "anchor-block", "text": "vchar", "type": "grammar", "url": "https://tools.ietf.org/html/rfc5234#appendix-B.1" },
                "a801f883_https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#": { "displayText": "SHA-512", "export": true, "for_": [], "level": "", "normative": true, "shortname": "sha2", "spec": "sha2", "status": "anchor-block", "text": "sha-512", "type": "dfn", "url": "https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" },
                "fc7b3d90_https://tools.ietf.org/html/rfc5234#appendix-B.1": { "displayText": "WSP", "export": true, "for_": [], "level": "", "normative": true, "shortname": "abnf", "spec": "abnf", "status": "anchor-block", "text": "wsp", "type": "dfn", "url": "https://tools.ietf.org/html/rfc5234#appendix-B.1" },
                "https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#": { "displayText": "SHA-256", "export": true, "for_": [], "level": "", "normative": true, "shortname": "sha2", "spec": "sha2", "status": "anchor-block", "text": "sha-256", "type": "dfn", "url": "https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf#" },
                "https://dom.spec.whatwg.org/#dom-document-url": { "displayText": "URL", "export": true, "for_": ["Document"], "level": "1", "normative": true, "shortname": "dom", "spec": "dom", "status": "current", "text": "URL", "type": "attribute", "url": "https://dom.spec.whatwg.org/#dom-document-url" },
                "https://fetch.spec.whatwg.org/#concept-header-list": { "displayText": "header list", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "header list", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-header-list" },
                "https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header": { "displayText": "get a structured field value", "export": true, "for_": ["header list"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "get a structured field value", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header" },
                "https://fetch.spec.whatwg.org/#concept-request": { "displayText": "request", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "request", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request" },
                "https://fetch.spec.whatwg.org/#concept-request-client": { "displayText": "client", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "client", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-client" },
                "https://fetch.spec.whatwg.org/#concept-request-destination": { "displayText": "destination", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "destination", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-destination" },
                "https://fetch.spec.whatwg.org/#concept-request-integrity-metadata": { "displayText": "integrity metadata", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "integrity metadata", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-integrity-metadata" },
                "https://fetch.spec.whatwg.org/#concept-request-mode": { "displayText": "mode", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "mode", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-mode" },
                "https://fetch.spec.whatwg.org/#concept-request-policy-container": { "displayText": "policy container", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "policy container", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-policy-container" },
                "https://fetch.spec.whatwg.org/#concept-request-url": { "displayText": "URL", "export": true, "for_": ["request"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "url", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-request-url" },
                "https://fetch.spec.whatwg.org/#concept-response": { "displayText": "response", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "response", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-response" },
                "https://fetch.spec.whatwg.org/#concept-response-header-list": { "displayText": "header list", "export": true, "for_": ["response"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "header list", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#concept-response-header-list" },
                "https://fetch.spec.whatwg.org/#cors-protocol": { "displayText": "CORS protocol", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "cors protocol", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#cors-protocol" },
                "https://fetch.spec.whatwg.org/#destination-type": { "displayText": "destination type", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "destination type", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#destination-type" },
                "https://fetch.spec.whatwg.org/#header-list-contains": { "displayText": "contains", "export": true, "for_": ["header list"], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "contains", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#header-list-contains" },
                "https://fetch.spec.whatwg.org/#header-name": { "displayText": "header name", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "header name", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#header-name" },
                "https://fetch.spec.whatwg.org/#header-value": { "displayText": "header value", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "header value", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#header-value" },
                "https://fetch.spec.whatwg.org/#is-local": { "displayText": "is local", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "fetch", "spec": "fetch", "status": "current", "text": "is local", "type": "dfn", "url": "https://fetch.spec.whatwg.org/#is-local" },
                "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin": { "displayText": "origin", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" },
                "https://html.spec.whatwg.org/multipage/browsers.html#policy-container": { "displayText": "policy container", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "policy container", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#policy-container" },
                "https://html.spec.whatwg.org/multipage/browsers.html#policy-container-integrity-policy": { "displayText": "integrity policy", "export": true, "for_": ["policy container"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "integrity policy", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#policy-container-integrity-policy" },
                "https://html.spec.whatwg.org/multipage/browsers.html#policy-container-report-only-integrity-policy": { "displayText": "report only integrity policy", "export": true, "for_": ["policy container"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "report only integrity policy", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#policy-container-report-only-integrity-policy" },
                "https://html.spec.whatwg.org/multipage/browsers.html#same-origin": { "displayText": "same origin", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "same origin", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-origin" },
                "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window": { "displayText": "associated Document", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "associated document", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" },
                "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window": { "displayText": "Window", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "Window", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global": { "displayText": "global object", "export": true, "for_": ["environment settings object"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "global object", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" },
                "https://html.spec.whatwg.org/multipage/webappapis.html#secure-context": { "displayText": "secure context", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "secure context", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" },
                "https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-url": { "displayText": "url", "export": true, "for_": ["WorkerGlobalScope"], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "url", "type": "dfn", "url": "https://html.spec.whatwg.org/multipage/workers.html#concept-workerglobalscope-url" },
                "https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope": { "displayText": "WorkerGlobalScope", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "html", "spec": "html", "status": "current", "text": "WorkerGlobalScope", "type": "interface", "url": "https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" },
                "https://infra.spec.whatwg.org/#ascii-lowercase": { "displayText": "ASCII lowercase", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "ascii lowercase", "type": "dfn", "url": "https://infra.spec.whatwg.org/#ascii-lowercase" },
                "https://infra.spec.whatwg.org/#assert": { "displayText": "assert", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "assert", "type": "dfn", "url": "https://infra.spec.whatwg.org/#assert" },
                "https://infra.spec.whatwg.org/#iteration-continue": { "displayText": "continue", "export": true, "for_": ["iteration"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "continue", "type": "dfn", "url": "https://infra.spec.whatwg.org/#iteration-continue" },
                "https://infra.spec.whatwg.org/#list": { "displayText": "list", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "list", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list" },
                "https://infra.spec.whatwg.org/#list-append": { "displayText": "append", "export": true, "for_": ["list"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "append", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-append" },
                "https://infra.spec.whatwg.org/#list-contain": { "displayText": "contain", "export": true, "for_": ["list", "stack", "queue", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "contain", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-contain" },
                "https://infra.spec.whatwg.org/#list-is-empty": { "displayText": "is empty", "export": true, "for_": ["list", "stack", "queue", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "is empty", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-is-empty" },
                "https://infra.spec.whatwg.org/#list-iterate": { "displayText": "for each", "export": true, "for_": ["list", "set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "for each", "type": "dfn", "url": "https://infra.spec.whatwg.org/#list-iterate" },
                "https://infra.spec.whatwg.org/#map-exists": { "displayText": "exist", "export": true, "for_": ["map"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "exist", "type": "dfn", "url": "https://infra.spec.whatwg.org/#map-exists" },
                "https://infra.spec.whatwg.org/#ordered-set": { "displayText": "ordered set", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "ordered set", "type": "dfn", "url": "https://infra.spec.whatwg.org/#ordered-set" },
                "https://infra.spec.whatwg.org/#set-append": { "displayText": "append", "export": true, "for_": ["set"], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "append", "type": "dfn", "url": "https://infra.spec.whatwg.org/#set-append" },
                "https://infra.spec.whatwg.org/#strictly-split": { "displayText": "strictly split", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "strictly split", "type": "dfn", "url": "https://infra.spec.whatwg.org/#strictly-split" },
                "https://infra.spec.whatwg.org/#struct": { "displayText": "struct", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "infra", "spec": "infra", "status": "current", "text": "struct", "type": "dfn", "url": "https://infra.spec.whatwg.org/#struct" },
                "https://tools.ietf.org/html/rfc5234#appendix-B.1": { "displayText": "VCHAR", "export": true, "for_": [], "level": "", "normative": true, "shortname": "abnf", "spec": "abnf", "status": "anchor-block", "text": "vchar", "type": "dfn", "url": "https://tools.ietf.org/html/rfc5234#appendix-B.1" },
                "https://tools.ietf.org/html/rfc7234#section-5.2": { "displayText": "Cache-Control", "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc7234", "spec": "rfc7234", "status": "anchor-block", "text": "cache-control", "type": "dfn", "url": "https://tools.ietf.org/html/rfc7234#section-5.2" },
                "https://tools.ietf.org/html/rfc7234#section-5.2.1.6": { "displayText": "no-transform", "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc7234", "spec": "rfc7234", "status": "anchor-block", "text": "no-transform", "type": "dfn", "url": "https://tools.ietf.org/html/rfc7234#section-5.2.1.6" },
                "https://tools.ietf.org/html/rfc8288#link": { "displayText": "link", "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc8288", "spec": "rfc8288", "status": "anchor-block", "text": "link", "type": "http-header", "url": "https://tools.ietf.org/html/rfc8288#link" },
                "https://tools.ietf.org/html/rfc9651#name-dictionaries": { "displayText": "Dictionary", "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc9651", "spec": "rfc9651", "status": "anchor-block", "text": "dictionary", "type": "dfn", "url": "https://tools.ietf.org/html/rfc9651#name-dictionaries" },
                "https://tools.ietf.org/html/rfc9651#name-inner-lists": { "displayText": "inner list", "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc9651", "spec": "rfc9651", "status": "anchor-block", "text": "inner list", "type": "dfn", "url": "https://tools.ietf.org/html/rfc9651#name-inner-lists" },
                "https://tools.ietf.org/html/rfc9651#name-tokens": { "displayText": "token", "export": true, "for_": [], "level": "", "normative": true, "shortname": "rfc9651", "spec": "rfc9651", "status": "anchor-block", "text": "token", "type": "dfn", "url": "https://tools.ietf.org/html/rfc9651#name-tokens" },
                "https://url.spec.whatwg.org/#concept-url": { "displayText": "URL", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "url", "spec": "url", "status": "current", "text": "url", "type": "dfn", "url": "https://url.spec.whatwg.org/#concept-url" },
                "https://webidl.spec.whatwg.org/#idl-USVString": { "displayText": "USVString", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "USVString", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-USVString" },
                "https://webidl.spec.whatwg.org/#idl-boolean": { "displayText": "boolean", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "boolean", "type": "interface", "url": "https://webidl.spec.whatwg.org/#idl-boolean" },
                "https://www.w3.org/TR/CSP3/#grammardef-base64-value": { "displayText": "base64-value", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "csp", "spec": "csp3", "status": "snapshot", "text": "base64-value", "type": "grammar", "url": "https://www.w3.org/TR/CSP3/#grammardef-base64-value" },
                "https://www.w3.org/TR/CSP3/#grammardef-hash-algorithm": { "displayText": "hash-algorithm", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "csp", "spec": "csp3", "status": "snapshot", "text": "hash-algorithm", "type": "grammar", "url": "https://www.w3.org/TR/CSP3/#grammardef-hash-algorithm" },
                "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report": { "displayText": "generate and queue a report", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "reporting", "spec": "reporting-1", "status": "snapshot", "text": "generate and queue a report", "type": "dfn", "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report" },
                "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-context": { "displayText": "context", "export": true, "for_": ["generate and queue a report"], "level": "1", "normative": true, "shortname": "reporting", "spec": "reporting-1", "status": "snapshot", "text": "context", "type": "dfn", "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-context" },
                "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-data": { "displayText": "data", "export": true, "for_": ["generate and queue a report"], "level": "1", "normative": true, "shortname": "reporting", "spec": "reporting-1", "status": "snapshot", "text": "data", "type": "dfn", "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-data" },
                "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-destination": { "displayText": "destination", "export": true, "for_": ["generate and queue a report"], "level": "1", "normative": true, "shortname": "reporting", "spec": "reporting-1", "status": "snapshot", "text": "destination", "type": "dfn", "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-destination" },
                "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-type": { "displayText": "type", "export": true, "for_": ["generate and queue a report"], "level": "1", "normative": true, "shortname": "reporting", "spec": "reporting-1", "status": "snapshot", "text": "type", "type": "dfn", "url": "https://www.w3.org/TR/reporting-1/#generate-and-queue-a-report-type" },
                "https://www.w3.org/TR/reporting-1/#reportbody": { "displayText": "ReportBody", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "reporting", "spec": "reporting-1", "status": "snapshot", "text": "ReportBody", "type": "dictionary", "url": "https://www.w3.org/TR/reporting-1/#reportbody" },
                "https://www.w3.org/TR/reporting-1/#strip-url-for-use-in-reports": { "displayText": "strip URL for use in reports", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "reporting", "spec": "reporting-1", "status": "snapshot", "text": "strip url for use in reports", "type": "dfn", "url": "https://www.w3.org/TR/reporting-1/#strip-url-for-use-in-reports" },
            };

            function mkRefHint(link, ref) {
                const linkText = link.textContent;
                let dfnTextElements = '';
                if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
                    // Give the original term if it's being displayed in a different way.
                    // But allow casing differences, they're insignificant.
                    dfnTextElements =
                        mk.li({},
                            mk.b({}, "Term: "),
                            mk.span({}, ref.displayText)
                        );
                }
                const forList = ref.for_;
                let forListElements;
                if (forList.length == 0) {
                    forListElements = [];
                } else if (forList.length == 1) {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.span({}, forList[0]),
                    );
                } else {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.ul({},
                            ...forList.map(forItem =>
                                mk.li({},
                                    mk.span({}, forItem)
                                ),
                            ),
                        ),
                    );
                }
                const url = ref.url;
                const safeUrl = encodeURIComponent(url);
                const hintPanel = mk.aside({
                    class: "ref-hint",
                    id: `ref-hint-for-${safeUrl}`,
                    "data-for": url,
                    "aria-labelled-by": `ref-hint-for-${safeUrl}`,
                },
                    mk.ul({},
                        dfnTextElements,
                        mk.li({},
                            mk.b({}, "URL: "),
                            mk.a({ href: url, class: "ref" }, url),
                        ),
                        mk.li({},
                            mk.b({}, "Type: "),
                            mk.span({}, `${ref.type}`),
                        ),
                        mk.li({},
                            mk.b({}, "Spec: "),
                            mk.span({}, `${ref.spec ? ref.spec : ''}`),
                        ),
                        forListElements
                    ),
                );
                hintPanel.forLink = link;
                setupRefHintEventListeners(link, hintPanel);
                return hintPanel;
            }

            function hideAllRefHints() {
                queryAll(".ref-hint").forEach(el => hideRefHint(el));
            }

            function hideRefHint(refHint) {
                const link = refHint.forLink;
                link.setAttribute("aria-expanded", "false");
                if (refHint.teardownEventListeners) {
                    refHint.teardownEventListeners();
                }
                refHint.remove();
            }

            function showRefHint(link) {
                if (link.classList.contains("dfn-link")) return;
                const url = link.getAttribute("href");
                const refHintKey = link.getAttribute("data-refhint-key");
                let key = url;
                if (refHintKey) {
                    key = refHintKey + "_" + url;
                }
                const ref = refsData[key];
                if (!ref) return;

                hideAllRefHints(); // Only display one at this time.

                const refHint = mkRefHint(link, ref);
                append(document.body, refHint);
                link.setAttribute("aria-expanded", "true");
                positionRefHint(refHint);
            }

            function setupRefHintEventListeners(link, refHint) {
                if (refHint.teardownEventListeners) return;
                // Add event handlers to hide the refHint after the user moves away
                // from both the link and refHint, if not hovering either within one second.
                let timeout = null;
                const startHidingRefHint = (event) => {
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    timeout = setTimeout(() => {
                        hideRefHint(refHint);
                    }, 1000);
                }
                const resetHidingRefHint = (event) => {
                    if (timeout) clearTimeout(timeout);
                    timeout = null;
                };
                link.addEventListener("mouseleave", startHidingRefHint);
                link.addEventListener("mouseenter", resetHidingRefHint);
                link.addEventListener("blur", startHidingRefHint);
                link.addEventListener("focus", resetHidingRefHint);
                refHint.addEventListener("mouseleave", startHidingRefHint);
                refHint.addEventListener("mouseenter", resetHidingRefHint);
                refHint.addEventListener("blur", startHidingRefHint);
                refHint.addEventListener("focus", resetHidingRefHint);

                refHint.teardownEventListeners = () => {
                    // remove event listeners
                    resetHidingRefHint();
                    link.removeEventListener("mouseleave", startHidingRefHint);
                    link.removeEventListener("mouseenter", resetHidingRefHint);
                    link.removeEventListener("blur", startHidingRefHint);
                    link.removeEventListener("focus", resetHidingRefHint);
                    refHint.removeEventListener("mouseleave", startHidingRefHint);
                    refHint.removeEventListener("mouseenter", resetHidingRefHint);
                    refHint.removeEventListener("blur", startHidingRefHint);
                    refHint.removeEventListener("focus", resetHidingRefHint);
                };
            }

            function positionRefHint(refHint) {
                const link = refHint.forLink;
                const linkPos = getBounds(link);
                refHint.style.top = linkPos.bottom + "px";
                refHint.style.left = linkPos.left + "px";

                const panelPos = refHint.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
                    refHint.style.left = newLeft + "px";
                }
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function showRefHintListener(e) {
                // If the target isn't in a link (or is a link),
                // just ignore it.
                let link = e.target.closest("a");
                if (!link) return;

                // If the target is in a ref-hint panel
                // (aka a link in the already-open one),
                // also just ignore it.
                if (link.closest(".ref-hint")) return;

                // Otherwise, show the panel for the link.
                showRefHint(link);
            }

            function hideAllHintsListener(e) {
                // If the click is inside a ref-hint panel, ignore it.
                if (e.target.closest(".ref-hint")) return;
                // Otherwise, close all the current panels.
                hideAllRefHints();
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("mousedown", showRefHintListener);
                document.body.addEventListener("focus", showRefHintListener);

                document.body.addEventListener("click", hideAllHintsListener);
            });

            window.addEventListener("resize", () => {
                // Hide any open ref hint.
                hideAllRefHints();
            });
        }
    </script>
    <script>/* Boilerplate: script-wpt */
        "use strict";
        {
            let wptData = {
                "paths": ["/subresource-integrity/"],
            };

            document.addEventListener("DOMContentLoaded", async () => {
                if (wptData.paths.length == 0) return;

                const runsUrl = "https://wpt.fyi/api/runs?label=master&label=stable&max-count=1&product=chrome&product=firefox&product=safari&product=edge";
                const runs = await (await fetch(runsUrl)).json();

                let testResults = [];
                for (const pathPrefix of wptData.paths) {
                    const pathResults = await (await fetch("https://wpt.fyi/api/search", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            "run_ids": runs.map(x => x.id),
                            "query": { "path": pathPrefix },
                        })
                    })).json();
                    testResults = testResults.concat(pathResults.results);
                }

                const browsers = runs.map(x => ({ name: x.browser_name, version: x.browser_version, passes: 0, total: 0 }));
                const resultsFromPath = new Map(testResults.map(result => {
                    const testPath = result.test;
                    const passes = result.legacy_status.map(x => [x.passes, x.total]);
                    return [testPath, passes];
                }));
                const seenTests = new Set();
                document.querySelectorAll(".wpt-name").forEach(nameEl => {
                    const passData = resultsFromPath.get("/" + nameEl.getAttribute("title"));
                    if (!passData) {
                        console.log("Couldn't find test in results:", nameEl);
                        return
                    }
                    const numTests = passData[0][1];
                    if (numTests > 1) {
                        nameEl.insertAdjacentElement("beforeend",
                            mk.small({}, ` (${numTests} tests)`));
                    }
                    if (passData == undefined) return;
                    const resultsEl = mk.span({ "class": "wpt-results" },
                        ...passData.map((p, i) => mk.span(
                            {
                                "title": `${browsers[i].name} ${p[0]}/${p[1]}`,
                                "class": "wpt-result",
                                "style": `background: conic-gradient(forestgreen ${p[0] / p[1] * 360}deg, darkred 0deg);`,
                            })),
                    );
                    nameEl.insertAdjacentElement("afterend", resultsEl);

                    // Only update the summary pass/total count if we haven't seen this
                    // test before, to support authors listing the same test multiple times
                    // in a spec.
                    if (!seenTests.has(nameEl.getAttribute("title"))) {
                        seenTests.add(nameEl.getAttribute("title"));
                        passData.forEach((p, i) => {
                            browsers[i].passes += p[0];
                            browsers[i].total += p[1];
                        });
                    }
                });
                const overview = document.querySelector(".wpt-overview");
                if (overview) {
                    overview.appendChild(mk.ul({}, ...browsers.map(formatWptResult)));
                    document.head.appendChild(mk.style({},
                        `.wpt-overview ul { display: flex; flex-flow: row wrap; gap: .2em; justify-content: start; list-style: none; padding: 0; margin: 0;}
             .wpt-overview li { padding: .25em 1em; color: black; text-align: center; }
             .wpt-overview img { height: 1.5em; height: max(1.5em, 32px); background: transparent; }
             .wpt-overview .browser { font-weight: bold; }
             .wpt-overview .passes-none { background: #e57373; }
             .wpt-overview .passes-hardly { background: #ffb74d; }
             .wpt-overview .passes-a-few { background: #ffd54f; }
             .wpt-overview .passes-half { background: #fff176; }
             .wpt-overview .passes-lots { background: #dce775; }
             .wpt-overview .passes-most { background: #aed581; }
             .wpt-overview .passes-all { background: #81c784; }`));
                }
            });

            function formatWptResult({ name, version, passes, total }) {
                const passRate = passes / total;
                let passClass = "";
                if (passRate == 0) passClass = "passes-none";
                else if (passRate < .2) passClass = "passes-hardly";
                else if (passRate < .4) passClass = "passes-a-few";
                else if (passRate < .6) passClass = "passes-half";
                else if (passRate < .8) passClass = "passes-lots";
                else if (passRate < 1) passClass = "passes-most";
                else passClass = "passes-all";

                name = name[0].toUpperCase() + name.slice(1);
                const shortVersion = /^\d+/.exec(version);
                const icon = []

                if (name == "Chrome") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/chrome_64x64.png" }));
                if (name == "Edge") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/edge_64x64.png" }));
                if (name == "Safari") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/safari_64x64.png" }));
                if (name == "Firefox") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/firefox_64x64.png" }));

                return mk.li({ "class": passClass },
                    mk.nobr({ 'class': 'browser' }, ...icon, ` ${name} ${shortVersion}`),
                    mk.br(),
                    mk.nobr({ 'class': 'pass-rate' }, `${passes}/${total}`)
                );
            }
        }
    </script>