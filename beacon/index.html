<!DOCTYPE html>
<html lang="ja-JP" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta name="generator" content="ReSpec 32.2.1">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        span.example-title {
            text-transform: none
        }

        :is(aside, div).example,
        div.illegal-example {
            padding: .5em;
            margin: 1em 0;
            position: relative;
            clear: both
        }

        div.illegal-example {
            color: red
        }

        div.illegal-example p {
            color: #000
        }

        :is(aside, div).example {
            border-left-width: .5em;
            border-left-style: solid;
            border-color: #e0cb52;
            background: #fcfaee
        }

        aside.example div.example {
            border-left-width: .1em;
            border-color: #999;
            background: #fff
        }

        .example pre {
            background-color: rgba(0, 0, 0, .03)
        }
    </style>
    <style>
        .issue-label {
            text-transform: initial
        }

        .warning>p:first-child {
            margin-top: 0
        }

        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid
        }

        span.warning {
            padding: .1em .5em .15em
        }

        .issue.closed span.issue-number {
            text-decoration: line-through
        }

        .issue.closed span.issue-number::after {
            content: " (Closed)";
            font-size: smaller
        }

        .warning {
            border-color: #f11;
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9
        }

        .warning-title:before {
            content: "⚠";
            font-size: 1.3em;
            float: left;
            padding-right: .3em;
            margin-top: -.3em
        }

        li.task-list-item {
            list-style: none
        }

        input.task-list-item-checkbox {
            margin: 0 .35em .25em -1.6em;
            vertical-align: middle
        }

        .issue a.respec-gh-label {
            padding: 5px;
            margin: 0 2px 0 2px;
            font-size: 10px;
            text-transform: none;
            text-decoration: none;
            font-weight: 700;
            border-radius: 4px;
            position: relative;
            bottom: 2px;
            border: none;
            display: inline-block
        }
    </style>
    <style>
        pre.idl {
            padding: 1em;
            position: relative
        }

        pre.idl>code {
            color: #000
        }

        @media print {
            pre.idl {
                white-space: pre-wrap
            }
        }

        .idlHeader {
            display: block;
            width: 150px;
            background: #8ccbf2;
            color: #fff;
            font-family: sans-serif;
            font-weight: 700;
            margin: -1em 0 1em -1em;
            height: 28px;
            line-height: 28px
        }

        .idlHeader a.self-link {
            margin-left: .3cm;
            text-decoration: none;
            border-bottom: none
        }

        .idlID {
            font-weight: 700;
            color: #005a9c
        }

        .idlType {
            color: #005a9c
        }

        .idlName {
            color: #ff4500
        }

        .idlName a {
            color: #ff4500;
            border-bottom: 1px dotted #ff4500;
            text-decoration: none
        }

        a.idlEnumItem {
            color: #000;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        .idlSuperclass {
            font-style: italic;
            color: #005a9c
        }

        .idlDefaultValue,
        .idlParamName {
            font-style: italic
        }

        .extAttr {
            color: #666
        }

        .idlSectionComment {
            color: gray
        }

        .idlIncludes a {
            font-weight: 700
        }

        .respec-button-copy-paste:focus {
            text-decoration: none;
            border-color: #51a7e8;
            outline: 0;
            box-shadow: 0 0 5px rgba(81, 167, 232, .5)
        }

        .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
            border-color: #51a7e8
        }

        .respec-button-copy-paste:is(:hover, :active, .zeroclipboard-is-hover, .zeroclipboard-is-active) {
            text-decoration: none;
            background-color: #ddd;
            background-image: linear-gradient(#eee, #ddd);
            border-color: #ccc
        }

        .respec-button-copy-paste:is(:active, .selected, .zeroclipboard-is-active) {
            background-color: #dcdcdc;
            background-image: none;
            border-color: #b5b5b5;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .15)
        }

        .respec-button-copy-paste.selected:hover {
            background-color: #cfcfcf
        }

        .respec-button-copy-paste:is(:disabled, :disabled:hover, .disabled, .disabled:hover) {
            color: rgba(102, 102, 102, .5);
            cursor: default;
            background-color: rgba(229, 229, 229, .5);
            background-image: none;
            border-color: rgba(197, 197, 197, .5);
            box-shadow: none
        }

        @media print {
            .respec-button-copy-paste {
                visibility: hidden
            }
        }
    </style>
    <style>
        dfn {
            cursor: pointer
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            min-width: 300px;
            max-width: 500px;
            padding: .5em .75em;
            margin-top: .6em;
            font-family: "Helvetica Neue", sans-serif;
            font-size: small;
            background: #fff;
            color: #000;
            box-shadow: 0 1em 3em -.4em rgba(0, 0, 0, .3), 0 0 1px 1px rgba(0, 0, 0, .05);
            border-radius: 2px
        }

        .dfn-panel:not(.docked)>.caret {
            position: absolute;
            top: -9px
        }

        .dfn-panel:not(.docked)>.caret::after,
        .dfn-panel:not(.docked)>.caret::before {
            content: "";
            position: absolute;
            border: 10px solid transparent;
            border-top: 0;
            border-bottom: 10px solid #fff;
            top: 0
        }

        .dfn-panel:not(.docked)>.caret::before {
            border-bottom: 9px solid #a2a9b1
        }

        .dfn-panel * {
            margin: 0
        }

        .dfn-panel b {
            display: block;
            color: #000;
            margin-top: .25em
        }

        .dfn-panel ul a[href] {
            color: #333
        }

        .dfn-panel>div {
            display: flex
        }

        .dfn-panel a.self-link {
            font-weight: 700;
            margin-right: auto
        }

        .dfn-panel .marker {
            padding: .1em;
            margin-left: .5em;
            border-radius: .2em;
            text-align: center;
            white-space: nowrap;
            font-size: 90%;
            color: #040b1c
        }

        .dfn-panel .marker.dfn-exported {
            background: #d1edfd;
            box-shadow: 0 0 0 .125em #1ca5f940
        }

        .dfn-panel .marker.idl-block {
            background: #8ccbf2;
            box-shadow: 0 0 0 .125em #0670b161
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important
        }

        .dfn-panel a[href]:hover {
            border-bottom-width: 1px
        }

        .dfn-panel ul {
            padding: 0
        }

        .dfn-panel li {
            margin-left: 1em
        }

        .dfn-panel.docked {
            position: fixed;
            left: .5em;
            top: unset;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - .75em * 2 - .5em - .2em * 2);
            max-height: 30vh;
            overflow: auto
        }
    </style>

    <title>ビーコン</title>




    <style id="respec-mainstyle">
        @keyframes pop {
            0% {
                transform: scale(1, 1)
            }

            25% {
                transform: scale(1.25, 1.25);
                opacity: .75
            }

            100% {
                transform: scale(1, 1)
            }
        }

        :is(h1, h2, h3, h4, h5, h6, a) abbr {
            border: none
        }

        dfn {
            font-weight: 700
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        a.bibref {
            text-decoration: none
        }

        .respec-offending-element:target {
            animation: pop .25s ease-in-out 0s 1
        }

        .respec-offending-element,
        a[href].respec-offending-element {
            text-decoration: red wavy underline
        }

        @supports not (text-decoration:red wavy underline) {
            .respec-offending-element:not(pre) {
                display: inline-block
            }

            .respec-offending-element {
                background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x
            }
        }

        #references :target {
            background: #eaf3ff;
            animation: pop .4s ease-in-out 0s 1
        }

        cite .bibref {
            font-style: normal
        }

        code {
            color: #c63501
        }

        th code {
            color: inherit
        }

        a[href].orcid {
            padding-left: 4px;
            padding-right: 4px
        }

        a[href].orcid>svg {
            margin-bottom: -2px
        }

        .toc a,
        .tof a {
            text-decoration: none
        }

        a .figno,
        a .secno {
            color: #000
        }

        ol.tof,
        ul.tof {
            list-style: none outside none
        }

        .caption {
            margin-top: .5em;
            font-style: italic
        }

        table.simple {
            border-spacing: 0;
            border-collapse: collapse;
            border-bottom: 3px solid #005a9c
        }

        .simple th {
            background: #005a9c;
            color: #fff;
            padding: 3px 5px;
            text-align: left
        }

        .simple th a {
            color: #fff;
            padding: 3px 5px;
            text-align: left
        }

        .simple th[scope=row] {
            background: inherit;
            color: inherit;
            border-top: 1px solid #ddd
        }

        .simple td {
            padding: 3px 10px;
            border-top: 1px solid #ddd
        }

        .simple tr:nth-child(even) {
            background: #f0f6ff
        }

        .section dd>p:first-child {
            margin-top: 0
        }

        .section dd>p:last-child {
            margin-bottom: 0
        }

        .section dd {
            margin-bottom: 1em
        }

        .section dl.attrs dd,
        .section dl.eldef dd {
            margin-bottom: 0
        }

        #issue-summary>ul {
            column-count: 2
        }

        #issue-summary li {
            list-style: none;
            display: inline-block
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top
        }

        details.respec-tests-details>* {
            padding-right: 2em
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: #fff;
            padding-bottom: .5em
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -.3em
        }

        details.respec-tests-details>li {
            padding-left: 1em
        }

        .self-link:hover {
            opacity: 1;
            text-decoration: none;
            background-color: transparent
        }

        aside.example .marker>a.self-link {
            color: inherit
        }

        .header-wrapper {
            display: flex;
            align-items: baseline
        }

        :is(h2, h3, h4, h5, h6):not(#toc>h2, #abstract>h2, #sotd>h2, .head>h2) {
            position: relative;
            left: -.5em
        }

        :is(h2, h3, h4, h5, h6):not(#toch2)+a.self-link {
            color: inherit;
            order: -1;
            position: relative;
            left: -1.1em;
            font-size: 1rem;
            opacity: .5
        }

        :is(h2, h3, h4, h5, h6)+a.self-link::before {
            content: "§";
            text-decoration: none;
            color: var(--heading-text)
        }

        :is(h2, h3)+a.self-link {
            top: -.2em
        }

        :is(h4, h5, h6)+a.self-link::before {
            color: #000
        }

        @media (max-width:767px) {
            dd {
                margin-left: 0
            }
        }

        @media print {
            .removeOnSave {
                display: none
            }
        }
    </style>
    <meta name="description" content="This specification defines an interface that web developers can use to
    schedule asynchronous and non-blocking delivery of data that minimizes
    resource contention with other time-critical operations, while ensuring
    that such requests are still processed and delivered to destination.">
    <link rel="canonical" href="https://www.w3.org/TR/beacon/">
    <style>
        .hljs {
            display: block;
            overflow-x: auto;
            padding: .5em;
            color: #383a42;
            background: #fafafa
        }

        .hljs-comment,
        .hljs-quote {
            color: #717277;
            font-style: italic
        }

        .hljs-doctag,
        .hljs-formula,
        .hljs-keyword {
            color: #a626a4
        }

        .hljs-deletion,
        .hljs-name,
        .hljs-section,
        .hljs-selector-tag,
        .hljs-subst {
            color: #ca4706;
            font-weight: 700
        }

        .hljs-literal {
            color: #0b76c5
        }

        .hljs-addition,
        .hljs-attribute,
        .hljs-meta-string,
        .hljs-regexp,
        .hljs-string {
            color: #42803c
        }

        .hljs-built_in,
        .hljs-class .hljs-title {
            color: #9a6a01
        }

        .hljs-attr,
        .hljs-number,
        .hljs-selector-attr,
        .hljs-selector-class,
        .hljs-selector-pseudo,
        .hljs-template-variable,
        .hljs-type,
        .hljs-variable {
            color: #986801
        }

        .hljs-bullet,
        .hljs-link,
        .hljs-meta,
        .hljs-selector-id,
        .hljs-symbol,
        .hljs-title {
            color: #336ae3
        }

        .hljs-emphasis {
            font-style: italic
        }

        .hljs-strong {
            font-weight: 700
        }

        .hljs-link {
            text-decoration: underline
        }
    </style>
    <style>
        var {
            position: relative;
            cursor: pointer
        }

        var[data-type]::after,
        var[data-type]::before {
            position: absolute;
            left: 50%;
            top: -6px;
            opacity: 0;
            transition: opacity .4s;
            pointer-events: none
        }

        var[data-type]::before {
            content: "";
            transform: translateX(-50%);
            border-width: 4px 6px 0 6px;
            border-style: solid;
            border-color: transparent;
            border-top-color: #000
        }

        var[data-type]::after {
            content: attr(data-type);
            transform: translateX(-50%) translateY(-100%);
            background: #000;
            text-align: center;
            font-family: "Dank Mono", "Fira Code", monospace;
            font-style: normal;
            padding: 6px;
            border-radius: 3px;
            color: #daca88;
            text-indent: 0;
            font-weight: 400
        }

        var[data-type]:hover::after,
        var[data-type]:hover::before {
            opacity: 1
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
  "shortName": "beacon",
  "specStatus": "CRD",
  "crEnd": "2017-05-11",
  "useExperimentalStyles": true,
  "edDraftURI": "https://w3c.github.io/beacon/",
  "editors": [
    {
      "name": "Ilya Grigorik",
      "mailto": "igrigorik@gmail.com",
      "company": "Shopify",
      "w3cid": "56102",
      "url": "mailto:igrigorik@gmail.com"
    },
    {
      "name": "Alois Reitbauer",
      "mailto": "alois.reitbauer@compuware.com",
      "company": "Compuware Corp.",
      "w3cid": "48276",
      "url": "mailto:alois.reitbauer@compuware.com"
    }
  ],
  "group": "webperf",
  "license": "w3c-software-doc",
  "wgPublicList": "public-web-perf",
  "noLegacyStyle": true,
  "github": "https://github.com/w3c/beacon",
  "testSuiteURI": "https://w3c-test.org/beacon/",
  "implementationReportURI": "https://w3c.github.io/test-results/beacon/",
  "otherLinks": [
    {
      "key": "Implementation",
      "data": [
        {
          "value": "Can I use Beacon?",
          "href": "http://caniuse.com/#feat=beacon"
        }
      ]
    }
  ],
  "xref": [
    "html",
    "fetch",
    "url",
    "webidl"
  ],
  "publishDate": "2022-08-03",
  "previousMaturity": "CRD",
  "previousPublishDate": "2022-08-03",
  "publishISODate": "2022-08-03T00:00:00.000Z",
  "generatedSubtitle": "W3C Candidate Recommendation Draft 03 August 2022"
}</script>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-CRD">
</head>

<body data-link-for="Navigator" class="h-entry" data-cite="WEBIDL html fetch url webidl">
    <div class="head">
        <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a></p>
        <h1 id="title" class="title">ビーコン</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#CRD">W3C 候補勧告ドラフト</a> <time class="dt-published"
                datetime="2022-08-03">2022年8月3日</time></p>
        <details open="">
            <summary>この文書の詳細情報</summary>
            <dl>
                <dt>このバージョン:</dt>
                <dd>
                    <a class="u-url"
                        href="https://www.w3.org/TR/2022/CRD-beacon-20220803/">https://www.w3.org/TR/2022/CRD-beacon-20220803/</a>
                </dd>
                <dt>最新公開バージョン:</dt>
                <dd>
                    <a href="https://www.w3.org/TR/beacon/">https://www.w3.org/TR/beacon/</a>
                </dd>
                <dt>最新編集ドラフト:</dt>
                <dd><a href="https://w3c.github.io/beacon/">https://w3c.github.io/beacon/</a></dd>
                <dt>履歴:</dt>
                <dd>
                    <a
                        href="https://www.w3.org/standards/history/beacon">https://www.w3.org/standards/history/beacon</a>
                </dd>
                <dd>
                    <a href="https://github.com/w3c/beacon/commits/">コミット履歴</a>
                </dd>
                <dt>テストスイート:</dt>
                <dd><a href="https://w3c-test.org/beacon/">https://w3c-test.org/beacon/</a></dd>
                <dt>実装レポート:</dt>
                <dd>
                    <a href="https://w3c.github.io/test-results/beacon/">https://w3c.github.io/test-results/beacon/</a>
                </dd>



                <dt>編集者:</dt>
                <dd class="editor p-author h-card vcard" data-editor-id="56102">
                    <a class="ed_mailto u-email email p-name" href="mailto:igrigorik@gmail.com">Ilya Grigorik</a> (<span
                        class="p-org org h-org">Shopify</span>)
                </dd>
                <dd class="editor p-author h-card vcard" data-editor-id="48276">
                    <a class="ed_mailto u-email email p-name" href="mailto:alois.reitbauer@compuware.com">Alois
                        Reitbauer</a> (<span class="p-org org h-org">Compuware Corp.</span>)
                </dd>
                <dt>
                    元編集者:
                </dt>
                <dd class="editor p-author h-card vcard" data-editor-id="45188">
                    <a class="ed_mailto u-email email p-name" href="mailto:arvind@google.com">Arvind Jain</a> (<span
                        class="p-org org h-org">Google Inc.</span>) - 2015年1月1日まで
                </dd>
                <dd class="editor p-author h-card vcard" data-editor-id="44357">
                    <a class="ed_mailto u-email email p-name" href="mailto:jmann@microsoft.com">Jatinder Mann</a> (<span
                        class="p-org org h-org">Microsoft Corp.</span>) - 2014年2月1日まで
                </dd>

                <dt>フィードバック:</dt>
                <dd>
                    <a href="https://github.com/w3c/beacon/">GitHub w3c/beacon</a>
                    (<a href="https://github.com/w3c/beacon/pulls/">プルリクエスト</a>,
                    <a href="https://github.com/w3c/beacon/issues/new/choose">新しい問題</a>,
                    <a href="https://github.com/w3c/beacon/issues/">オープンな問題</a>)
                </dd>
                <dd><a
                        href="mailto:public-web-perf@w3.org?subject=%5Bbeacon%5D%20YOUR%20TOPIC%20HERE">public-web-perf@w3.org</a>
                    タイトル行に <kbd>[beacon] <em>… メッセージのトピック …</em></kbd> を含めてください (<a rel="discussion"
                        href="https://lists.w3.org/Archives/Public/public-web-perf">アーカイブ</a>)</dd>

                <dt>実装</dt>
                <dd>
                    <a href="http://caniuse.com/#feat=beacon">Beaconを使用できますか？</a>
                </dd>
            </dl>
        </details>


        <p class="copyright">
            <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
            ©
            2022

            <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
                href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
            <a href="https://www.ercim.eu/"><abbr
                    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a
                href="https://www.keio.ac.jp/">Keio</a>,
            <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C
            <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
            <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
            <a rel="license" href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document"
                title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>
    <section id="abstract" class="introductory">
        <h2>概要</h2>
        <p>この仕様は、リソースの競合を最小限に抑えながら、他の時間クリティカルな操作と非同期かつ非ブロッキングでデータを送信できるインターフェイスをウェブ開発者が利用できるように定義しています。その一方で、これらのリクエストが目的地に正しく処理されて配信されることを保証します。
        </p>
    </section>
    <section id="sotd" class="introductory">
        <h2>この文書の位置付け</h2>
        <p><em>このセクションは、この文書が公開された時点での位置付けを説明しています。現在の<abbr
                    title="World Wide Web Consortium">W3C</abbr>の公開物と、この技術レポートの最新の改訂版は、<a
                    href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr>
                    技術レポート索引</a>（https://www.w3.org/TR/）で確認できます。</em></p>
        <p>
            この文書は、<a href="https://www.w3.org/groups/wg/webperf">Web Performance Working Group</a>によって、<a
                href="https://www.w3.org/2021/Process-20211102/#recs-and-notes">勧告トラック</a>を使用して候補勧告ドラフトとして発行されました。
        </p>
        <p>候補勧告としての発行は、<abbr
                title="World Wide Web Consortium">W3C</abbr>およびその会員による承認を意味するものではありません。候補勧告ドラフトは、作業グループが次の候補勧告スナップショットに含めることを意図している前回の候補勧告からの変更を統合したものです。
        </p>
        <p>
            本文書はドラフト文書であり、いつでも更新、置き換え、または廃止される可能性があります。この文書を進行中の作業以外の用途で引用することは不適切です。
        </p>
        <p>
            本文書は、<a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr
                    title="World Wide Web Consortium">W3C</abbr>特許ポリシー</a>に基づいて運営されるグループによって作成されました。
            <abbr title="World Wide Web Consortium">W3C</abbr>は、グループの成果物に関連して提出された特許開示の<a rel="disclosure"
                href="https://www.w3.org/groups/wg/webperf/ipr">公開リスト</a>を維持しています。このページには特許を開示するための手順も記載されています。個人が、<a
                href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">必須クレーム</a>を含むと考える特許について実際の知識を持っている場合、その情報を<a
                href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">W3C特許ポリシー第6条</a>に従って開示する必要があります。
        </p>
        <p>
            本文書は、<a id="w3c_process_revision" href="https://www.w3.org/2021/Process-20211102/">2021年11月2日 <abbr
                    title="World Wide Web Consortium">W3C</abbr>プロセス文書</a>に準拠しています。
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">目次</h2>
        <ol class="toc">
            <li class="tocline"><a class="tocxref" href="#abstract">概要</a></li>
            <li class="tocline"><a class="tocxref" href="#sotd">この文書の位置付け</a></li>
            <li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>イントロダクション</a>
            </li>
            <li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">2. </bdi>適合性</a></li>
            <li class="tocline"><a class="tocxref" href="#beacon"><bdi class="secno">3. </bdi>ビーコン</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#sendbeacon-method"><bdi class="secno">3.1
                            </bdi><code><span data-export="" data-dfn-type="method" data-idl="operation" data-title="sendBeacon()" data-dfn-for="Navigator" data-type="boolean" data-lt="sendBeacon()|sendBeacon(url)|sendBeacon(url, data)" data-local-lt="Navigator.sendBeacon|Navigator.sendBeacon()|sendBeacon">sendBeacon()</span></code>
                            メソッド</a></li>
                    <li class="tocline"><a class="tocxref" href="#sec-processing-model"><bdi class="secno">3.2
                            </bdi>処理モデル</a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#privacy-and-security"><bdi class="secno">4.
                    </bdi>プライバシーとセキュリティ</a></li>
            <li class="tocline"><a class="tocxref" href="#acknowledgments"><bdi class="secno">A.
                    </bdi>謝辞</a></li>
            <li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>参考文献</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1
                            </bdi>規範的参考文献</a></li>
                    <li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">B.2
                            </bdi>参考情報文献</a></li>
                </ol>
            </li>
        </ol>
    </nav>
    <section id="introduction" class="informative">
        <div class="header-wrapper">
            <h2 id="x1-introduction"><bdi class="secno">1. </bdi>イントロダクション</h2><a class="self-link" href="#introduction"
                aria-label="セクション1の固定リンク"></a>
        </div>
        <p><em>このセクションは規範的ではありません。</em></p>

        <p>ウェブアプリケーションは、イベント、状態更新、および分析データを1つ以上のサーバーに報告するリクエストを発行する必要がある場合があります。これらのリクエストは通常、クライアント側でのレスポンス処理を必要とせず（例:
            204または200
            HTTPレスポンスコードと空のレスポンスボディ）、重要なリソースのフェッチ、入力への反応、アニメーションの実行などの高優先度操作とネットワークおよび計算リソースを競合させるべきではありません。しかし、このような一方向リクエスト（ビーコン）は、重要なアプリケーションや計測データの配信も担当しており、開発者はその配信を確保するために高コストな方法を使用せざるを得ません：
        </p>
        <ul>
            <li>開発者は、ビーコンの配信率を改善するために、配信を統合して遅延させる代わりに、各ビーコンを即時配信することを選びます。配信を遅延させることで、ビーコンリクエストが成功裏に完了するのに十分な時間が確保できない可能性があり、重要なアプリケーションデータが失われる可能性があります。
            </li>
            <li>開発者は、同期XMLHttpRequestを介してブロッキングリクエストを発行したり、無操作のビジーループを挿入したり、他の技術を使用してユーザーエージェントが時間クリティカルな操作（例:
                クリック、アンロード、その他のハンドラー）を実行するのを阻止し、ユーザーエクスペリエンスを損なうことを選びます。このブロッキング動作は、ページがアンロードされたり、システムによって中断または終了された場合でも、ユーザーエージェントやオペレーティングシステムがリクエストをキャンセルしないようにするためのものです。
            </li>
        </ul>
        <p>上記の配信および処理要件の不一致により、ほとんどの開発者が難しい選択を迫られ、ユーザーエクスペリエンスを損なうブロッキング技術が広く採用されています。この仕様では、リソース競合を最小限に抑えつつ、データの非同期かつ非ブロッキング配信をスケジュールできるインターフェースをウェブ開発者が利用できるように定義しています。このインターフェースは、次のことを保証します：
        </p>
        <ul>
            <li>ビーコンリクエストは、時間クリティカルな操作および高優先度のネットワークリクエストと競合しないように優先順位が付けられます。</li>
            <li>ビーコンリクエストは、モバイルデバイスのエネルギー使用量を最適化するために、ユーザーエージェントによって効率的に統合される場合があります。</li>
            <li>ビーコンリクエストは、ページがアンロードされる前に必ず開始され、ユーザーのインタラクティブなイベントの処理をブロックするリクエストやその他の技術を必要とせずに、完了するまで実行されることが保証されます。
            </li>
        </ul>
        <p>以下の例は、<a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-navigator-sendbeacon-1"><code>sendBeacon()</code></a>メソッドを使用して、イベント、クリック、および分析データを配信する方法を示しています：
        </p>
        <div class="example" id="example-1">
            <div class="marker">
                <a class="self-link" href="#example-1">例<bdi> 1</bdi></a>
            </div>
            <pre class="highlight" aria-busy="false"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">// クライアント側イベントを記録する非ブロッキングビーコンを送信</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reportEvent</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">var</span> data = <span class="hljs-built_in">JSON</span>.stringify({
      <span class="hljs-attr">event</span>: event,
      <span class="hljs-attr">time</span>: performance.now()
    });
    navigator.sendBeacon(<span class="hljs-string">'/collector'</span>, data);
  }

  <span class="hljs-comment">// ページがバックグラウンド状態に移行するときに（ページ可視性API）、</span>
  <span class="hljs-comment">// セッション分析データを含む非ブロッキングビーコンを送信</span>
  <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'visibilitychange'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.visibilityState === <span class="hljs-string">'hidden'</span>) {
      <span class="hljs-keyword">var</span> sessionData = buildSessionReport();
      navigator.sendBeacon(<span class="hljs-string">'/collector'</span>, sessionData);
    }
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">'http://www.w3.org/'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">'reportEvent(this)'</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"reportEvent('some event')"</span>&gt;</span>クリックしてください<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
        </div>
        <div class="note" role="note" id="issue-container-generatedID">
            <div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>注記</span></div>
            <p class="">上記の例では、<a data-link-type="dfn" data-type="event"
                    href="https://html.spec.whatwg.org/multipage/indices.html#event-visibilitychange">visibilitychange</a>
                イベント（[<cite><a class="bibref" data-link-type="biblio" href="#bib-page-visibility-2"
                        title="Page Visibility Level 2">PAGE-VISIBILITY-2</a></cite>]で定義）を使用してセッションデータの配信をトリガーします。
                このイベントは、ページがバックグラウンド状態に移行するとき（例:
                ユーザーが別のアプリケーションに切り替える、ホーム画面に戻るなど）やアンロードされるときに、モバイルデバイスで発火することが保証されている唯一のイベントです。
                <a data-link-type="dfn" data-type="event"
                    href="https://html.spec.whatwg.org/multipage/indices.html#event-unload">unload</a>イベントに依存することを避けてください。なぜなら、ページがバックグラウンド状態の場合（例:
                <a data-link-type="idl" data-type="attribute"
                    href="https://html.spec.whatwg.org/multipage/interaction.html#dom-document-visibilitystate"><code>visibilityState</code></a>
                が<a data-link-type="idl" data-type="attribute"
                    href="https://html.spec.whatwg.org/multipage/interaction.html#dom-document-hidden"><code>hidden</code></a>と等しい）モバイルOSによってプロセスが終了される場合には発火しないからです。
            </p>
        </div>
        <p><a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-navigator-sendbeacon-2"><code>sendBeacon()</code></a>メソッドを介して開始されたリクエストは、時間クリティカルな作業と競合したりブロックしたりせず、ユーザーエージェントによってネットワーク効率を改善するために優先順位付けされる可能性があり、ビーコンデータの配信を保証するためにブロッキング操作を使用する必要を排除します。
        </p>
        <p>以下は、<a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-navigator-sendbeacon-3"><code>sendBeacon()</code></a>が行わないこと、および解決を意図していないことです：</p>
        <ul>
            <li><a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                    id="ref-for-dom-navigator-sendbeacon-4"><code>sendBeacon()</code></a>メソッドは、オフラインストレージや配信の特別な処理を提供しません。ビーコンリクエストは他のリクエストと同様であり、必要に応じて[<cite><a
                        class="bibref" data-link-type="biblio" href="#bib-service-workers"
                        title="Service Workers 1">SERVICE-WORKERS</a></cite>]と組み合わせてオフライン機能を提供できます。</li>
            <li><a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                    id="ref-for-dom-navigator-sendbeacon-5"><code>sendBeacon()</code></a>メソッドは、バックグラウンド同期や転送機能を提供することを意図していません。ユーザーエージェントはビーコンリクエストが迅速かつタイムリーに完了できるよう、受け入れられるペイロードサイズを制限します。
            </li>
            <li><a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                    id="ref-for-dom-navigator-sendbeacon-6"><code>sendBeacon()</code></a>メソッドは、リクエストメソッドのカスタマイズ、カスタムリクエストヘッダーの提供、またはリクエストおよびレスポンスの<a
                    href="#sec-processing-model">処理プロパティ</a>の変更を提供しません。このようなリクエストに対してデフォルト設定以外が必要なアプリケーションは、[<cite><a
                        class="bibref" data-link-type="biblio" href="#bib-fetch"
                        title="Fetch Standard">FETCH</a></cite>] APIを<a data-link-type="dfn" data-type="dfn"
                    href="https://fetch.spec.whatwg.org/#request-keepalive-flag">keepalive</a>を<code>true</code>に設定して使用するべきです。
            </li>
        </ul>
    </section>
    <section id="conformance">
        <div class="header-wrapper">
            <h2 id="x2-conformance"><bdi class="secno">2. </bdi>適合性</h2><a class="self-link" href="#conformance"
                aria-label="セクション2の固定リンク"></a>
        </div>
        <p>非規範的とマークされたセクションと同様に、この仕様におけるすべての作成ガイドライン、図、例、および注記は非規範的です。それ以外のこの仕様の内容は規範的です。</p>
        <p>
            この文書内のキーワード<em class="rfc2119">MAY</em>、<em class="rfc2119">MUST</em>、<em class="rfc2119">SHOULD</em>、および<em
                class="rfc2119">SHOULD NOT</em>は、
            <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119"
                    title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a
                    class="bibref" data-link-type="biblio" href="#bib-rfc8174"
                    title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
            に記載されているように解釈されるべきです。ただし、これらがすべて大文字で表示されている場合に限ります。
        </p>
        <p>可読性を高めるため、この仕様ではこれらの単語をすべて大文字で表示していません。</p>
        <p>アルゴリズムの一部として命令形で記述された要件（例：「先頭のスペース文字をすべて削除する」や「falseを返してこれらの手順を中止する」）は、アルゴリズムの冒頭で使用されているキーワード（「must」、「should」、「may」など）の意味で解釈されるべきです。
        </p>
        <p>属性、メソッド、またはオブジェクトに関する要件として記述された適合要件は、ユーザーエージェントに対する要件として解釈されるべきです。</p>
        <p>アルゴリズムまたは特定の手順として記述された適合要件は、最終結果が同等である限り、任意の方法で実装することができます。（特に、この仕様で定義されているアルゴリズムは、フォローしやすいことを意図しており、パフォーマンスを目的としていません。）
        </p>
    </section>
    <section id="beacon">
        <div class="header-wrapper">
            <h2 id="x3-beacon"><bdi class="secno">3. </bdi>ビーコン</h2><a class="self-link" href="#beacon"
                aria-label="セクション3の固定リンク"></a>
        </div>

        <section data-dfn-for="Navigator" data-link-for="Navigator" id="sendbeacon-method">
            <div class="header-wrapper">
                <h3 id="x3-1-sendbeacon-method"><bdi class="secno">3.1
                    </bdi><code><dfn data-export="" data-dfn-type="method" id="dom-navigator-sendbeacon" data-idl="operation" data-title="sendBeacon()" data-dfn-for="Navigator" data-type="boolean" data-lt="sendBeacon()|sendBeacon(url)|sendBeacon(url, data)" data-local-lt="Navigator.sendBeacon|Navigator.sendBeacon()|sendBeacon" tabindex="0" aria-haspopup="dialog">sendBeacon()</dfn></code>
                    メソッド</h3><a class="self-link" href="#sendbeacon-method" aria-label="セクション3.1の固定リンク"></a>
            </div>

            <pre class="idl def" id="webidl-339285629"><span class="idlHeader"><a class="self-link" href="#webidl-339285629">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-navigator-partial-1" data-title="Navigator">partial interface <a data-idl="partial" data-link-type="interface" data-title="Navigator" class="idlID" data-dfn-for="Navigator" data-type="interface" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator">Navigator</a> {<span data-idl="" class="idlMethod" id="idl-def-navigator-sendbeacon-url-data" data-title="sendBeacon" data-dfn-for="Navigator"><span class="idlType">
    <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-navigator-sendbeacon" id="ref-for-dom-navigator-sendbeacon-7"><code>sendBeacon</code></a>(<span class="idlType"><a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString">USVString</a></span> <span class="idlParamName">url</span>, optional<span class="idlType"> <a data-type="typedef" href="https://fetch.spec.whatwg.org/#bodyinit">BodyInit</a>?</span> <span class="idlParamName">data</span> = null);</span>
};</span></code></pre>
            <p><a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                    id="ref-for-dom-navigator-sendbeacon-8"><code>sendBeacon()</code></a>メソッドは、<a href="#dfn-data"
                    class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-data-1"><code><code>data</code></code></a>パラメーターで提供されるデータを<a href="#url-parameter"
                    id="ref-for-url-parameter-1"><code>url</code></a>パラメーターで指定されたURLに送信します：
            </p>
            <ul>
                <li>ユーザーエージェントは<a data-link-type="dfn" data-type="dfn"
                        href="https://fetch.spec.whatwg.org/#request-keepalive-flag">keepalive</a>
                    フラグを設定してフェッチを開始<em
                        class="rfc2119">しなければなりません（MUST）</em>。これにより、このようなリクエストでキューに入れられるデータ量が制限され、ビーコンリクエストが迅速かつタイムリーに完了できるようになります。
                </li>
                <li>ドキュメントの<a data-link-type="idl" data-type="attribute"
                        href="https://html.spec.whatwg.org/multipage/interaction.html#dom-document-visibilitystate"><code>visibilityState</code></a>
                    が<a data-link-type="idl" data-type="attribute"
                        href="https://html.spec.whatwg.org/multipage/interaction.html#dom-document-hidden"><code>hidden</code></a>
                    に遷移した際に、すべてのビーコンリクエストを即座に送信するようスケジュールし、これらのリクエストが他の時間クリティカルな高優先度の作業をブロックすることなく完了できるようにしなければ<em
                        class="rfc2119">なりません（MUST）</em>。
                </li>
                <li>ユーザーエージェントは、提供されたデータの送信をスケジュールして、他の時間クリティカルで高優先度の作業とのリソース（CPUおよびネットワーク）競合を最小限に抑えるべき<em
                        class="rfc2119">です（SHOULD）</em>。</li>
                <li>ユーザーエージェントは、ネットワークがアクティブな場合に即座に配信する、あるいはネットワークインターフェースがアクティブになるまで待機するなどして、ネットワークおよびエネルギー効率を最適化するために提供されたデータの送信を遅らせても良い<em
                        class="rfc2119">です（MAY）</em>。ただし、送信を無期限に遅らせるべきでは<em class="rfc2119">ありません（SHOULD
                        NOT）</em>。ネットワーク活動がない場合でも、保留中の送信は定期的にフラッシュされるべきです。</li>
            </ul>
            <div class="note" role="note" id="issue-container-generatedID-0">
                <div role="heading" class="note-title marker" id="h-note-0" aria-level="4"><span>注記</span></div>
                <div class="">
                    Beacon
                    APIはレスポンスコールバックを提供しません。このようなリクエストに対するレスポンスボディを省略すること（例：<code>204 No Content</code>で応答する）が推奨されます。
                </div>
            </div>
            <div>
                <div class="header-wrapper">
                    <h3 id="parameters">パラメーター</h3><a class="self-link" href="#parameters"
                        aria-label="このセクションの固定リンク"></a>
                </div>
                <div class="header-wrapper">
                    <h4 id="url"><dfn id="url-parameter" data-lt-nodefault="" data-lt="url parameter" tabindex="0"
                            aria-haspopup="dialog" data-dfn-type="dfn"><code>url</code></dfn></h4><a class="self-link"
                        href="#url" aria-label="このセクションの固定リンク"></a>
                </div>
                <p><a href="#url-parameter" id="ref-for-url-parameter-2"><code>url</code></a>パラメーターは、データを送信するURLを示します。
                </p>
                <div class="header-wrapper">
                    <h4 id="data"><dfn id="dfn-data" tabindex="0" aria-haspopup="dialog"
                            data-dfn-type="dfn"><code>data</code></dfn></h4><a class="self-link" href="#data"
                        aria-label="このセクションの固定リンク"></a>
                </div>
                <p><a href="#dfn-data" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-data-2"><code><code>data</code></code></a>パラメーターは、送信される<a data-link-type="idl"
                        data-lt="BodyInit" data-type="typedef"
                        href="https://fetch.spec.whatwg.org/#bodyinit"><code>BodyInit</code></a>データです。</p>
            </div>
            <div>
                <div class="header-wrapper">
                    <h3 id="return-value">戻り値</h3><a class="self-link" href="#return-value"
                        aria-label="このセクションの固定リンク"></a>
                </div>
                <p><a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                        id="ref-for-dom-navigator-sendbeacon-9"><code>sendBeacon()</code></a>メソッドは、データを転送するために正常にキューに入れることができた場合はtrueを返します。それ以外の場合はfalseを返します。
                </p>
                <div class="note" role="note" id="issue-container-generatedID-1">
                    <div role="heading" class="note-title marker" id="h-note-1" aria-level="4"><span>注記</span></div>
                    <p class="">
                        ユーザーエージェントは、このAPIを介して送信できるデータ量に制限を課します。これにより、このようなリクエストが他のユーザーやブラウザのアクティビティに最小限の影響を与えながら、正常に配信されることが保証されます。キューに入れられる<var>data</var>の量がユーザーエージェントの制限を超えた場合（<a
                            href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch">HTTP-network-or-cache
                            fetch</a>で定義されているように）、このメソッドは<code>false</code>を返します。<code>true</code>の戻り値は、ブラウザがデータを転送のためにキューに入れたことを意味します。ただし、実際のデータ転送は非同期で行われるため、このメソッドはデータ転送が成功したかどうかについての情報を提供しません。
                    </p>
                </div>
            </div>
        </section>
        <section id="sec-processing-model">
            <div class="header-wrapper">
                <h3 id="x3-2-processing-model"><bdi class="secno">3.2 </bdi>処理モデル</h3><a class="self-link"
                    href="#sec-processing-model" aria-label="セクション3.2の固定リンク"></a>
            </div>

            <p><a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                    id="ref-for-dom-navigator-sendbeacon-10"><code>sendBeacon()</code></a>メソッドを<var>url</var>および
                必要に応じて<var>data</var>と共に呼び出したとき、次の手順を実行します：</p>
            <ol>
                <li>
                    <p><var>base</var>を<a data-link-type="dfn" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a data-link-type="dfn" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">関連設定オブジェクト</a>の
                        <a data-link-type="dfn" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url">API ベース
                            URL</a>に設定します。
                    </p>
                </li>
                <li>
                    <p><var>origin</var>を<a data-link-type="dfn" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a data-link-type="dfn" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">関連設定オブジェクト</a>の
                        <a data-link-type="dfn" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin">オリジン</a>に設定します。
                    </p>
                </li>
                <li>
                    <p><var>parsedUrl</var>を<var>url</var>および<var>base</var>で<a data-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-parser">URL
                            パーサー</a>手順を実行した結果に設定します。アルゴリズムがエラーを返す場合、または<var>parsedUrl</var>の<a data-link-type="dfn"
                            data-type="dfn"
                            href="https://url.spec.whatwg.org/#concept-url-scheme">スキーム</a>が"http"または"https"でない場合は、"<code><a data-link-type="idl" data-lt="TypeError" data-type="exception" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror"><code>TypeError</code></a></code>"例外をスローし、これらの手順を終了します。
                    </p>
                </li>
                <li><var>headerList</var>を空のリストに設定します。</li>
                <li><var>corsMode</var>を"<code>no-cors</code>"に設定します。</li>
                <li>
                    <p>もし<var>data</var>が<code>null</code>でない場合：</p>
                    <ol>
                        <li><var>transmittedData</var>および<var>contentType</var>を、<var>keepalive
                                flag</var>を設定して<var>data</var>のバイトストリームを<a data-link-type="dfn" data-lt="extract"
                                data-type="dfn"
                                href="https://fetch.spec.whatwg.org/#concept-bodyinit-extract">抽出</a>した結果に設定します。
                        </li>
                        <li><a data-link-type="dfn" data-type="dfn"
                                href="https://fetch.spec.whatwg.org/#request-keepalive-flag">keepalive</a>が有効なリクエストで送信キューに入れることができるデータ量を<var>transmittedData</var>のサイズが超える場合（<a
                                href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch">HTTP-network-or-cache
                                fetch</a>で定義されているように）、戻り値を<code>false</code>に設定し、これらの手順を終了します。
                            <div class="note" role="note" id="issue-container-generatedID-2">
                                <div role="heading" class="note-title marker" id="h-note-2" aria-level="4">
                                    <span>注記</span>
                                </div>
                                <p class="">Beacon APIによって開始されたリクエストは、自動的に<a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#request-keepalive-flag">keepalive</a>フラグを設定します。同様に、開発者はFetch
                                    APIを使用する際に同じフラグを手動で設定することもできます。このフラグが設定されたすべてのリクエストは、Fetch
                                    API内で適用される同じ進行中のクオータ制限を共有します。</p>
                            </div>
                        </li>
                        <li>もし<var>contentType</var>がnullでない場合：
                            <ul>
                                <li><var>corsMode</var>を"<code>cors</code>"に設定します。</li>
                                <li>もし<var>contentType</var>の値が<code>Content-Type</code>ヘッダーの<a data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header">CORS-safelisted
                                        request-header</a>値である場合、<var>corsMode</var>を"<code>no-cors</code>"に設定します。
                                </li>
                                <li><var>contentType</var>の値を持つ<code>Content-Type</code>ヘッダーを<var>headerList</var>に追加します。
                                </li>
                            </ul>
                        </li>
                    </ol>
                </li>
                <li>戻り値を<code>true</code>に設定し、<a href="#dom-navigator-sendbeacon" class="internalDFN"
                        data-link-type="idl"
                        id="ref-for-dom-navigator-sendbeacon-11"><code>sendBeacon()</code></a>呼び出しを返し、以下の手順を並行して実行します：
                    <ol>
                        <li>
                            <p><var>req</var>を次のように初期化された新しい<a data-type="dfn"
                                    href="https://fetch.spec.whatwg.org/#concept-request">リクエスト</a>に設定します：</p>
                            <dl>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-method">メソッド</a>
                                </dt>
                                <dd><code>POST</code></dd>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-client">クライアント</a>
                                </dt>
                                <dd><a data-link-type="dfn" data-type="dfn"
                                        href="https://webidl.spec.whatwg.org/#this">this</a>の<a data-link-type="dfn"
                                        data-type="dfn"
                                        href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">関連設定オブジェクト</a>
                                </dd>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-url">url</a>
                                </dt>
                                <dd><var>parsedUrl</var></dd>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-header-list">ヘッダーリスト</a>
                                </dt>
                                <dd><var>headerList</var></dd>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-origin">オリジン</a>
                                </dt>
                                <dd><i>origin</i></dd>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#request-keepalive-flag">keepalive</a>
                                </dt>
                                <dd><code>true</code></dd>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-body">ボディ</a>
                                </dt>
                                <dd><var>transmittedData</var></dd>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-mode">モード</a>
                                </dt>
                                <dd><var>corsMode</var></dd>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">資格情報モード</a>
                                </dt>
                                <dd><i>include</i></dd>
                                <dt>
                                    <a data-link-type="dfn" data-type="dfn"
                                        href="https://fetch.spec.whatwg.org/#request-initiator-type">発信者タイプ</a>
                                </dt>
                                <dd>"<code>beacon</code>"</dd>
                            </dl>
                        </li>
                        <li>
                            <a data-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch">Fetch</a>
                            <var>req</var>。
                        </li>
                    </ol>
                </li>
            </ol>
        </section>
    </section>
    <section id="privacy-and-security">
        <div class="header-wrapper">
            <h2 id="x4-privacy-and-security"><bdi class="secno">4. </bdi>プライバシーとセキュリティ</h2><a class="self-link"
                href="#privacy-and-security" aria-label="セクション4の固定リンク"></a>
        </div>

        <p><a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-navigator-sendbeacon-12"><code>sendBeacon()</code></a>インターフェースは、データを非同期かつ非ブロッキングで配信するメカニズムを提供します。このAPIを使用して以下を実現できます：
        </p>
        <ul>
            <li>クライアント側イベントをサーバーに報告します。配信はユーザーエージェントによって優先順位付けされ、スケジュールされるため、他のインタラクティブな作業を妨げず、システムリソースを効率よく利用します。</li>
            <li>ページがバックグラウンド状態に移行する際やアンロードされる際にセッションデータを報告しますが、ユーザーエージェントをブロックすることはありません。</li>
            <li>小さなペイロードの配信が必要で、レスポンスコールバックを期待しないその他のユースケース。</li>
        </ul>
        <p>配信されるデータには、例えば、ウェブページでのユーザーのアクティビティに関するデータなど、潜在的に機密性の高い情報が含まれる可能性があります。これはユーザーのプライバシーに影響を与える可能性がありますが、既存の方法（スクリプトによるフォーム送信、画像ビーコン、XHR/Fetchリクエストなど）も同様の機能を提供します。ただし、これらの方法にはさまざまな高コストなパフォーマンスのトレードオフがあります。リクエストはユーザーエージェントによって中断される可能性があり、開発者が同期リクエストを呼び出したり、空ループでスピンしたりすることでユーザーエージェントが他のイベントを処理するのを妨げない限り、リクエストは中断される可能性があります。また、ユーザーエージェントはこれらのリクエストを優先順位付けや統合してシステムリソースの使用を最適化することができません。
        </p>
        <p><a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-navigator-sendbeacon-13"><code>sendBeacon()</code></a>によって開始されたリクエストは以下の特性に従います：</p>
        <ul>
            <li>リクエストにペイロードが含まれていない場合、またはリクエストの<code>Content-Type</code>が<a data-type="dfn"
                    href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header">CORS-safelisted
                    request-header</a>である場合、そのリクエストモードは<code>no-cors</code>となります。これはそれぞれ画像ビーコンやフォーム投稿に似ています。
            </li>
            <li>それ以外の場合、CORSプリフライトが実行され、サーバーは適切なCORSヘッダーセットを返すことでそのようなリクエストを許可する必要があります：
                <a href="https://fetch.spec.whatwg.org/#http-access-control-allow-credentials">
                    <code>Access-Control-Allow-Credentials</code></a>,
                <a href="https://fetch.spec.whatwg.org/#http-access-control-allow-origin">
                    <code>Access-Control-Allow-Origin</code></a>,
                <a href="https://fetch.spec.whatwg.org/#http-access-control-allow-headers">
                    <code>Access-Control-Allow-Headers</code></a>。
            </li>
        </ul>
        <p>そのため、セキュリティの観点から見ると、Beacon
            APIは開発者が現在使用している方法と同じセキュリティポリシーに従います。同様に、プライバシーの観点から見ても、結果として得られるリクエストは、APIが呼び出された時点またはページの可視性が変化した時点で即座に開始されるため、開発者がアクセス可能な既存のライフサイクルイベントに限定して情報（例：ユーザーのIPアドレス）が公開されます。ただし、ユーザーエージェントはそのようなリクエストをユーザーに透明性を持って提示するための代替方法を検討する場合があります。
        </p>
        <p>代替手段と比較して、<a href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-navigator-sendbeacon-14"><code>sendBeacon()</code></a>
            APIには2つの制約が適用されます：コールバックメソッドが存在しないこと、およびペイロードサイズがユーザーエージェントによって制限される可能性があることです。それ以外の場合、<a
                href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-navigator-sendbeacon-15"><code>sendBeacon()</code></a> APIには追加の制限はありません。ユーザーエージェントは<a
                href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-navigator-sendbeacon-16"><code>sendBeacon()</code></a>呼び出しの処理をスキップしたり、スロットリングしたりすべきではありません。これらは重要なアプリケーションの状態、イベント、および分析データを含む可能性があるためです。同様に、ユーザーエージェントは「プライベートブラウジング」または同等のモードで<a
                href="#dom-navigator-sendbeacon" class="internalDFN" data-link-type="idl"
                id="ref-for-dom-navigator-sendbeacon-17"><code>sendBeacon()</code></a>を無効にすべきではありません。これは、アプリケーションを破壊することを避け、ユーザーがそのようなモードにいることを漏らさないようにするためです。
        </p>
    </section>
    <section class="appendix" id="acknowledgments">
        <div class="header-wrapper">
            <h2 id="a-acknowledgments"><bdi class="secno">A. </bdi>謝辞</h2><a class="self-link" href="#acknowledgments"
                aria-label="付録Aの固定リンク"></a>
        </div>

        <p>Alois Reitbauer、Arvind Jain、Anne van Kesteren、Boris Zbarsky、Chase Douglas、Daniel Austin、Jatinder Mann、James
            Simonsen、Jason Weber、Jonas Sicking、Nick Doty、Philippe Le Hegaret、Todd Reifsteck、Tony Gentilcore、William
            Chan、およびYoav Weissに、この作業への貢献に感謝します。</p>
    </section>


    <section id="references" class="appendix">
        <div class="header-wrapper">
            <h2 id="b-references"><bdi class="secno">B. </bdi>参考文献</h2><a class="self-link" href="#references"
                aria-label="付録Bの固定リンク"></a>
        </div>
        <section id="normative-references">
            <div class="header-wrapper">
                <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>規範的参考文献</h3><a class="self-link"
                    href="#normative-references" aria-label="付録B.1の固定リンク"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-fetch">[fetch]</dt>
                <dd>
                    <a href="https://fetch.spec.whatwg.org/"><cite>Fetch 現行標準</cite></a>。Anne van Kesteren。WHATWG。
                    現行標準。URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-html">[html]</dt>
                <dd>
                    <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML 現行標準</cite></a>。Anne van
                    Kesteren、Domenic Denicola、Ian Hickson、Philip Jägenstedt、Simon Pieters。WHATWG。現行標準。URL: <a
                        href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
                </dd>
                <dt id="bib-rfc2119">[RFC2119]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>RFCで要件レベルを示すためのキーワード</cite></a>。S.
                    Bradner。IETF。1997年3月。現行標準。URL: <a
                        href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
                </dd>
                <dt id="bib-rfc8174">[RFC8174]</dt>
                <dd>
                    <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>RFC 2119のキーワードにおける大文字と小文字の曖昧さ</cite></a>。B.
                    Leiba。IETF。2017年5月。現行標準。URL: <a
                        href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
                </dd>
                <dt id="bib-url">[url]</dt>
                <dd>
                    <a href="https://url.spec.whatwg.org/"><cite>URL 現行標準</cite></a>。Anne van Kesteren。WHATWG。
                    現行標準。URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-webidl">[webidl]</dt>
                <dd>
                    <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL 現行標準</cite></a>。Edgar Chen、Timothy Gu。
                    WHATWG。現行標準。URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
                </dd>
            </dl>
        </section>
        <section id="informative-references">
            <div class="header-wrapper">
                <h3 id="b-2-informative-references"><bdi class="secno">B.2 </bdi>参考情報文献</h3><a class="self-link"
                    href="#informative-references" aria-label="付録B.2の固定リンク"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-page-visibility-2">[PAGE-VISIBILITY-2]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/page-visibility-2/"><cite>ページ可視性 レベル2</cite></a>。Ilya Grigorik、Marcos
                    Caceres。W3C。2022年6月23日。W3C候補勧告。URL: <a
                        href="https://www.w3.org/TR/page-visibility-2/">https://www.w3.org/TR/page-visibility-2/</a>
                </dd>
                <dt id="bib-service-workers">[SERVICE-WORKERS]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/service-workers-1/"><cite>サービスワーカー 1</cite></a>。Alex Russell、Jungkee
                    Song、Jake Archibald、Marijn Kruisselbrink。W3C。2019年11月19日。W3C候補勧告。URL: <a
                        href="https://www.w3.org/TR/service-workers-1/">https://www.w3.org/TR/service-workers-1/</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="トップに戻る">↑</abbr></a>
    </p>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-navigator-sendbeacon"
        aria-label="Links in this document to definition: sendBeacon()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-navigator-sendbeacon"
                aria-label="Permalink for definition: sendBeacon(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-339285629">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-navigator-sendbeacon-1" title="§ 1. Introduction">§ 1. Introduction</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-2" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-3" title="Reference 3">(3)</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-5" title="Reference 5">(5)</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-6" title="Reference 6">(6)</a>
            </li>
            <li>
                <a href="#ref-for-dom-navigator-sendbeacon-7" title="§ 3.1 sendBeacon() Method">§ 3.1 sendBeacon()
                    Method</a> <a href="#ref-for-dom-navigator-sendbeacon-8" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-9" title="Reference 3">(3)</a>
            </li>
            <li>
                <a href="#ref-for-dom-navigator-sendbeacon-10" title="§ 3.2 Processing Model">§ 3.2 Processing Model</a>
                <a href="#ref-for-dom-navigator-sendbeacon-11" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-navigator-sendbeacon-12" title="§ 4. Privacy and Security">§ 4. Privacy and
                    Security</a> <a href="#ref-for-dom-navigator-sendbeacon-13" title="Reference 2">(2)</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-14" title="Reference 3">(3)</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-15" title="Reference 4">(4)</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-16" title="Reference 5">(5)</a> <a
                    href="#ref-for-dom-navigator-sendbeacon-17" title="Reference 6">(6)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-url-parameter"
        aria-label="Links in this document to definition: url">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#url-parameter"
                aria-label="Permalink for definition: url. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-url-parameter-1" title="§ 3.1 sendBeacon() Method">§ 3.1 sendBeacon() Method</a> <a
                    href="#ref-for-url-parameter-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-data"
        aria-label="Links in this document to definition: data">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-data"
                aria-label="Permalink for definition: data. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-data-1" title="§ 3.1 sendBeacon() Method">§ 3.1 sendBeacon() Method</a> <a
                    href="#ref-for-dfn-data-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <script id="respec-dfn-panel">(() => {
            // @ts-check
            if (document.respec) {
                document.respec.ready.then(setupPanel);
            } else {
                setupPanel();
            }

            function setupPanel() {
                const listener = panelListener();
                document.body.addEventListener("keydown", listener);
                document.body.addEventListener("click", listener);
            }

            function panelListener() {
                /** @type {HTMLElement} */
                let panel = null;
                return event => {
                    const { target, type } = event;

                    if (!(target instanceof HTMLElement)) return;

                    // For keys, we only care about Enter key to activate the panel
                    // otherwise it's activated via a click.
                    if (type === "keydown" && event.key !== "Enter") return;

                    const action = deriveAction(event);

                    switch (action) {
                        case "show": {
                            hidePanel(panel);
                            /** @type {HTMLElement} */
                            const dfn = target.closest("dfn, .index-term");
                            panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
                            const coords = deriveCoordinates(event);
                            displayPanel(dfn, panel, coords);
                            break;
                        }
                        case "dock": {
                            panel.style.left = null;
                            panel.style.top = null;
                            panel.classList.add("docked");
                            break;
                        }
                        case "hide": {
                            hidePanel(panel);
                            panel = null;
                            break;
                        }
                    }
                };
            }

            /**
             * @param {MouseEvent|KeyboardEvent} event
             */
            function deriveCoordinates(event) {
                const target = /** @type HTMLElement */ (event.target);

                // We prevent synthetic AT clicks from putting
                // the dialog in a weird place. The AT events sometimes
                // lack coordinates, so they have clientX/Y = 0
                const rect = target.getBoundingClientRect();
                if (
                    event instanceof MouseEvent &&
                    event.clientX >= rect.left &&
                    event.clientY >= rect.top
                ) {
                    // The event probably happened inside the bounding rect...
                    return { x: event.clientX, y: event.clientY };
                }

                // Offset to the middle of the element
                const x = rect.x + rect.width / 2;
                // Placed at the bottom of the element
                const y = rect.y + rect.height;
                return { x, y };
            }

            /**
             * @param {Event} event
             */
            function deriveAction(event) {
                const target = /** @type {HTMLElement} */ (event.target);
                const hitALink = !!target.closest("a");
                if (target.closest("dfn:not([data-cite]), .index-term")) {
                    return hitALink ? "none" : "show";
                }
                if (target.closest(".dfn-panel")) {
                    if (hitALink) {
                        return target.classList.contains("self-link") ? "hide" : "dock";
                    }
                    const panel = target.closest(".dfn-panel");
                    return panel.classList.contains("docked") ? "hide" : "none";
                }
                if (document.querySelector(".dfn-panel:not([hidden])")) {
                    return "hide";
                }
                return "none";
            }

            /**
             * @param {HTMLElement} dfn
             * @param {HTMLElement} panel
             * @param {{ x: number, y: number }} clickPosition
             */
            function displayPanel(dfn, panel, { x, y }) {
                panel.hidden = false;
                // distance (px) between edge of panel and the pointing triangle (caret)
                const MARGIN = 20;

                const dfnRects = dfn.getClientRects();
                // Find the `top` offset when the `dfn` can be spread across multiple lines
                let closestTop = 0;
                let minDiff = Infinity;
                for (const rect of dfnRects) {
                    const { top, bottom } = rect;
                    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
                    if (diffFromClickY < minDiff) {
                        minDiff = diffFromClickY;
                        closestTop = top;
                    }
                }

                const top = window.scrollY + closestTop + dfnRects[0].height;
                const left = x - MARGIN;
                panel.style.left = `${left}px`;
                panel.style.top = `${top}px`;

                // Find if the panel is flowing out of the window
                const panelRect = panel.getBoundingClientRect();
                const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
                if (panelRect.right > SCREEN_WIDTH) {
                    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
                    const newCaretOffset = left - newLeft;
                    panel.style.left = `${newLeft}px`;
                    /** @type {HTMLElement} */
                    const caret = panel.querySelector(".caret");
                    caret.style.left = `${newCaretOffset}px`;
                }

                // As it's a dialog, we trap focus.
                // TODO: when <dialog> becomes a implemented, we should really
                // use that.
                trapFocus(panel, dfn);
            }

            /**
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function trapFocus(panel, dfn) {
                /** @type NodeListOf<HTMLAnchorElement> elements */
                const anchors = panel.querySelectorAll("a[href]");
                // No need to trap focus
                if (!anchors.length) return;

                // Move focus to first anchor element
                const first = anchors.item(0);
                first.focus();

                const trapListener = createTrapListener(anchors, panel, dfn);
                panel.addEventListener("keydown", trapListener);

                // Hiding the panel releases the trap
                const mo = new MutationObserver(records => {
                    const [record] = records;
                    const target = /** @type HTMLElement */ (record.target);
                    if (target.hidden) {
                        panel.removeEventListener("keydown", trapListener);
                        mo.disconnect();
                    }
                });
                mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
            }

            /**
             *
             * @param {NodeListOf<HTMLAnchorElement>} anchors
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function createTrapListener(anchors, panel, dfn) {
                const lastIndex = anchors.length - 1;
                let currentIndex = 0;
                return event => {
                    switch (event.key) {
                        // Hitting "Tab" traps us in a nice loop around elements.
                        case "Tab": {
                            event.preventDefault();
                            currentIndex += event.shiftKey ? -1 : +1;
                            if (currentIndex < 0) {
                                currentIndex = lastIndex;
                            } else if (currentIndex > lastIndex) {
                                currentIndex = 0;
                            }
                            anchors.item(currentIndex).focus();
                            break;
                        }

                        // Hitting "Enter" on an anchor releases the trap.
                        case "Enter":
                            hidePanel(panel);
                            break;

                        // Hitting "Escape" returns focus to dfn.
                        case "Escape":
                            hidePanel(panel);
                            dfn.focus();
                            return;
                    }
                };
            }

            /** @param {HTMLElement} panel */
            function hidePanel(panel) {
                if (!panel) return;
                panel.hidden = true;
                panel.classList.remove("docked");
            }
        })()</script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <script src="https://htmlspecs.com/dropdown.js"></script>
</body>

</html>