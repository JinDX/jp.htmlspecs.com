<!doctype html>
<html lang="ja-JP">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>CSS ネスティング モジュール レベル 1</title>
    <meta content="WD" name="w3c-status">
    <!-- <meta content="Bikeshed version b25686b9f, updated Fri Mar 14 14:15:20 2025 -0700" name="generator"> -->
    <link href="https://www.w3.org/TR/css-nesting-1/" rel="canonical">
    <!-- <meta content="8f1d24afe5c80690ab20f7fc64851b854418938e" name="revision"> -->
    <meta content="dark light" name="color-scheme">
    <style>
        /* Boilerplate: style-autolinks */
        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --selflink-text: black;
                --selflink-bg: silver;
                --selflink-hover-text: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-colors */
        /* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
        :root {
            color-scheme: light dark;

            --text: black;
            --bg: white;

            --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

            --logo-bg: #1a5e9a;
            --logo-active-bg: #c00;
            --logo-text: white;

            --tocnav-normal-text: #707070;
            --tocnav-normal-bg: var(--bg);
            --tocnav-hover-text: var(--tocnav-normal-text);
            --tocnav-hover-bg: #f8f8f8;
            --tocnav-active-text: #c00;
            --tocnav-active-bg: var(--tocnav-normal-bg);

            --tocsidebar-text: var(--text);
            --tocsidebar-bg: #f7f8f9;
            --tocsidebar-shadow: rgba(0, 0, 0, .1);
            --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

            --toclink-text: var(--text);
            --toclink-underline: #3980b5;
            --toclink-visited-text: var(--toclink-text);
            --toclink-visited-underline: #054572;

            --heading-text: #005a9c;

            --hr-text: var(--text);

            --algo-border: #def;

            --del-text: red;
            --del-bg: transparent;
            --ins-text: #080;
            --ins-bg: transparent;

            --a-normal-text: #034575;
            --a-normal-underline: #bbb;
            --a-visited-text: var(--a-normal-text);
            --a-visited-underline: #707070;
            --a-hover-bg: rgba(75%, 75%, 75%, .25);
            --a-active-text: #c00;
            --a-active-underline: #c00;

            --blockquote-border: silver;
            --blockquote-bg: transparent;
            --blockquote-text: currentcolor;

            --issue-border: #e05252;
            --issue-bg: #fbe9e9;
            --issue-text: var(--text);
            --issueheading-text: #831616;

            --example-border: #e0cb52;
            --example-bg: #fcfaee;
            --example-text: var(--text);
            --exampleheading-text: #574b0f;

            --note-border: #52e052;
            --note-bg: #e9fbe9;
            --note-text: var(--text);
            --noteheading-text: hsl(120, 70%, 30%);
            --notesummary-underline: silver;

            --assertion-border: #aaa;
            --assertion-bg: #eee;
            --assertion-text: black;

            --advisement-border: orange;
            --advisement-bg: #fec;
            --advisement-text: var(--text);
            --advisementheading-text: #b35f00;

            --warning-border: red;
            --warning-bg: hsla(40, 100%, 50%, 0.95);
            --warning-text: var(--text);

            --amendment-border: #330099;
            --amendment-bg: #F5F0FF;
            --amendment-text: var(--text);
            --amendmentheading-text: #220066;

            --def-border: #8ccbf2;
            --def-bg: #def;
            --def-text: var(--text);
            --defrow-border: #bbd7e9;

            --datacell-border: silver;

            --indexinfo-text: #707070;

            --indextable-hover-text: black;
            --indextable-hover-bg: #f7f8f9;

            --outdatedspec-bg: rgba(0, 0, 0, .5);
            --outdatedspec-text: black;
            --outdated-bg: maroon;
            --outdated-text: white;
            --outdated-shadow: red;

            --editedrec-bg: darkorange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ddd;
                --bg: black;

                --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

                --logo-bg: #1a5e9a;
                --logo-active-bg: #c00;
                --logo-text: white;

                --tocnav-normal-text: #999;
                --tocnav-normal-bg: var(--bg);
                --tocnav-hover-text: var(--tocnav-normal-text);
                --tocnav-hover-bg: #080808;
                --tocnav-active-text: #f44;
                --tocnav-active-bg: var(--tocnav-normal-bg);

                --tocsidebar-text: var(--text);
                --tocsidebar-bg: #080808;
                --tocsidebar-shadow: rgba(255, 255, 255, .1);
                --tocsidebar-heading-text: hsla(203, 20%, 40%, .7);

                --toclink-text: var(--text);
                --toclink-underline: #6af;
                --toclink-visited-text: var(--toclink-text);
                --toclink-visited-underline: #054572;

                --heading-text: #8af;

                --hr-text: var(--text);

                --algo-border: #456;

                --del-text: #f44;
                --del-bg: transparent;
                --ins-text: #4a4;
                --ins-bg: transparent;

                --a-normal-text: #6af;
                --a-normal-underline: #555;
                --a-visited-text: var(--a-normal-text);
                --a-visited-underline: var(--a-normal-underline);
                --a-hover-bg: rgba(25%, 25%, 25%, .2);
                --a-active-text: #f44;
                --a-active-underline: var(--a-active-text);

                --borderedblock-bg: rgba(255, 255, 255, .05);

                --blockquote-border: silver;
                --blockquote-bg: var(--borderedblock-bg);
                --blockquote-text: currentcolor;

                --issue-border: #e05252;
                --issue-bg: var(--borderedblock-bg);
                --issue-text: var(--text);
                --issueheading-text: hsl(0deg, 70%, 70%);

                --example-border: hsl(50deg, 90%, 60%);
                --example-bg: var(--borderedblock-bg);
                --example-text: var(--text);
                --exampleheading-text: hsl(50deg, 70%, 70%);

                --note-border: hsl(120deg, 100%, 35%);
                --note-bg: var(--borderedblock-bg);
                --note-text: var(--text);
                --noteheading-text: hsl(120, 70%, 70%);
                --notesummary-underline: silver;

                --assertion-border: #444;
                --assertion-bg: var(--borderedblock-bg);
                --assertion-text: var(--text);

                --advisement-border: orange;
                --advisement-bg: #222218;
                --advisement-text: var(--text);
                --advisementheading-text: #f84;

                --warning-border: red;
                --warning-bg: hsla(40, 100%, 20%, 0.95);
                --warning-text: var(--text);

                --amendment-border: #330099;
                --amendment-bg: #080010;
                --amendment-text: var(--text);
                --amendmentheading-text: #cc00ff;

                --def-border: #8ccbf2;
                --def-bg: #080818;
                --def-text: var(--text);
                --defrow-border: #136;

                --datacell-border: silver;

                --indexinfo-text: #aaa;

                --indextable-hover-text: var(--text);
                --indextable-hover-bg: #181818;

                --outdatedspec-bg: rgba(255, 255, 255, .5);
                --outdatedspec-text: black;
                --outdated-bg: maroon;
                --outdated-text: white;
                --outdated-shadow: red;

                --editedrec-bg: darkorange;
            }

            /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
            img {
                background: white;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-counters */
        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* Boilerplate: style-dfn-panel */
        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
            --dfnpanel-target-bg: #ffc;
            --dfnpanel-target-outline: orange;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --dfnpanel-bg: #222;
                --dfnpanel-text: var(--text);
                --dfnpanel-target-bg: #333;
                --dfnpanel-target-outline: silver;
            }
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel a:focus {
            outline: 5px auto Highlight;
            outline: 5px auto -webkit-focus-ring-color;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0 0 0 1em;
            list-style: none;
        }

        .dfn-panel li a {
            max-width: calc(300px - 1.5em - 1em);
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: 8px;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
            transition: left 1s ease-out, bottom 1s ease-out;
        }

        .dfn-panel .link-item:hover {
            text-decoration: underline;
        }

        .dfn-panel .link-item .copy-icon {
            opacity: 0;
        }

        .dfn-panel .link-item:hover .copy-icon,
        .dfn-panel .link-item .copy-icon:focus {
            opacity: 1;
        }

        .dfn-panel .copy-icon {
            display: inline-block;
            margin-right: 0.5em;
            width: 0.85em;
            height: 1em;
            border-radius: 3px;
            background-color: #ccc;
            cursor: pointer;
        }

        .dfn-panel .copy-icon .icon {
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .dfn-panel .copy-icon .icon::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #ccc;
            opacity: 0.25;
            transform: translate(3px, -3px);
        }

        .dfn-panel .copy-icon:active .icon::before {
            opacity: 1;
        }

        .dfn-paneled[role="button"] {
            cursor: help;
        }

        .highlighted {
            animation: target-fade 3s;
        }

        @keyframes target-fade {
            from {
                background-color: var(--dfnpanel-target-bg);
                outline: 5px solid var(--dfnpanel-target-outline);
            }

            to {
                color: var(--a-normal-text);
                background-color: transparent;
                outline: transparent;
            }
        }
    </style>
    <style>
        /* Boilerplate: style-idl-highlighting */
        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }
    </style>
    <style>
        /* Boilerplate: style-issues */
        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* Boilerplate: style-md-lists */
        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* Boilerplate: style-ref-hints */
        :root {
            --ref-hint-bg: #ddd;
            --ref-hint-text: var(--text);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ref-hint-bg: #222;
                --ref-hint-text: var(--text);
            }
        }

        .ref-hint {
            display: inline-block;
            position: absolute;
            z-index: 35;
            width: 20em;
            width: 300px;
            height: auto;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.5em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--ref-hint-bg);
            color: var(--ref-hint-text);
            border: outset 0.2em;
            white-space: normal;
            /* in case it's moved into a pre */
        }

        .ref-hint * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .ref-hint ul {
            padding: 0 0 0 1em;
            list-style: none;
        }
    </style>
    <style>
        /* Boilerplate: style-selflinks */
        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* Boilerplate: style-syntax-highlighting */
        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */

        @media (prefers-color-scheme: dark) {
            .highlight:not(.idl) {
                background: rgba(255, 255, 255, .05);
            }

            c-[a] {
                color: #d33682
            }

            /* Keyword.Declaration */
            c-[b] {
                color: #d33682
            }

            /* Keyword.Type */
            c-[c] {
                color: #2aa198
            }

            /* Comment */
            c-[d] {
                color: #2aa198
            }

            /* Comment.Multiline */
            c-[e] {
                color: #268bd2
            }

            /* Name.Attribute */
            c-[f] {
                color: #b58900
            }

            /* Name.Tag */
            c-[g] {
                color: #cb4b16
            }

            /* Name.Variable */
            c-[k] {
                color: #d33682
            }

            /* Keyword */
            c-[l] {
                color: #657b83
            }

            /* Literal */
            c-[m] {
                color: #657b83
            }

            /* Literal.Number */
            c-[n] {
                color: #268bd2
            }

            /* Name */
            c-[o] {
                color: #657b83
            }

            /* Operator */
            c-[p] {
                color: #657b83
            }

            /* Punctuation */
            c-[s] {
                color: #6c71c4
            }

            /* Literal.String */
            c-[t] {
                color: #6c71c4
            }

            /* Literal.String.Single */
            c-[u] {
                color: #6c71c4
            }

            /* Literal.String.Double */
            c-[ch] {
                color: #2aa198
            }

            /* Comment.Hashbang */
            c-[cp] {
                color: #2aa198
            }

            /* Comment.Preproc */
            c-[cpf] {
                color: #2aa198
            }

            /* Comment.PreprocFile */
            c-[c1] {
                color: #2aa198
            }

            /* Comment.Single */
            c-[cs] {
                color: #2aa198
            }

            /* Comment.Special */
            c-[kc] {
                color: #d33682
            }

            /* Keyword.Constant */
            c-[kn] {
                color: #d33682
            }

            /* Keyword.Namespace */
            c-[kp] {
                color: #d33682
            }

            /* Keyword.Pseudo */
            c-[kr] {
                color: #d33682
            }

            /* Keyword.Reserved */
            c-[ld] {
                color: #657b83
            }

            /* Literal.Date */
            c-[nc] {
                color: #268bd2
            }

            /* Name.Class */
            c-[no] {
                color: #268bd2
            }

            /* Name.Constant */
            c-[nd] {
                color: #268bd2
            }

            /* Name.Decorator */
            c-[ni] {
                color: #268bd2
            }

            /* Name.Entity */
            c-[ne] {
                color: #268bd2
            }

            /* Name.Exception */
            c-[nf] {
                color: #268bd2
            }

            /* Name.Function */
            c-[nl] {
                color: #268bd2
            }

            /* Name.Label */
            c-[nn] {
                color: #268bd2
            }

            /* Name.Namespace */
            c-[py] {
                color: #268bd2
            }

            /* Name.Property */
            c-[ow] {
                color: #657b83
            }

            /* Operator.Word */
            c-[mb] {
                color: #657b83
            }

            /* Literal.Number.Bin */
            c-[mf] {
                color: #657b83
            }

            /* Literal.Number.Float */
            c-[mh] {
                color: #657b83
            }

            /* Literal.Number.Hex */
            c-[mi] {
                color: #657b83
            }

            /* Literal.Number.Integer */
            c-[mo] {
                color: #657b83
            }

            /* Literal.Number.Oct */
            c-[sa] {
                color: #6c71c4
            }

            /* Literal.String.Affix */
            c-[sb] {
                color: #6c71c4
            }

            /* Literal.String.Backtick */
            c-[sc] {
                color: #6c71c4
            }

            /* Literal.String.Char */
            c-[dl] {
                color: #6c71c4
            }

            /* Literal.String.Delimiter */
            c-[sd] {
                color: #6c71c4
            }

            /* Literal.String.Doc */
            c-[se] {
                color: #6c71c4
            }

            /* Literal.String.Escape */
            c-[sh] {
                color: #6c71c4
            }

            /* Literal.String.Heredoc */
            c-[si] {
                color: #6c71c4
            }

            /* Literal.String.Interpol */
            c-[sx] {
                color: #6c71c4
            }

            /* Literal.String.Other */
            c-[sr] {
                color: #6c71c4
            }

            /* Literal.String.Regex */
            c-[ss] {
                color: #6c71c4
            }

            /* Literal.String.Symbol */
            c-[fm] {
                color: #268bd2
            }

            /* Name.Function.Magic */
            c-[vc] {
                color: #cb4b16
            }

            /* Name.Variable.Class */
            c-[vg] {
                color: #cb4b16
            }

            /* Name.Variable.Global */
            c-[vi] {
                color: #cb4b16
            }

            /* Name.Variable.Instance */
            c-[vm] {
                color: #cb4b16
            }

            /* Name.Variable.Magic */
            c-[il] {
                color: #657b83
            }

            /* Literal.Number.Integer.Long */
        }
    </style>
    <style>
        /* Boilerplate: style-wpt */
        :root {
            --wpt-border: hsl(0, 0%, 60%);
            --wpt-bg: hsl(0, 0%, 95%);
            --wpt-text: var(--text);
            --wptheading-text: hsl(0, 0%, 30%);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --wpt-border: hsl(0, 0%, 30%);
                --wpt-bg: var(--borderedblock-bg);
                --wpt-text: var(--text);
                --wptheading-text: hsl(0, 0%, 60%);
            }
        }

        .wpt-tests-block {
            list-style: none;
            border-left: .5em solid var(--wpt-border);
            background: var(--wpt-bg);
            color: var(--wpt-text);
            margin: 1em auto;
            padding: .5em;
        }

        .wpt-tests-block summary {
            color: var(--wptheading-text);
            font-weight: normal;
            text-transform: uppercase;
        }

        .wpt-tests-block summary::marker {
            color: var(--wpt-border);
        }

        .wpt-tests-block summary:hover::marker {
            color: var(--wpt-text);
        }

        /*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
        .wpt-tests-block:not([open]) {
            padding: 0;
            border: none;
            background: none;
            font-size: 0.75em;
            line-height: 1;
            position: relative;
            margin: 1em 0 0;
        }

        .wpt-tests-block:not([open]) summary {
            position: absolute;
            right: 0;
            bottom: 0;
        }

        /*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
        .wpt-tests-block:not([open]):last-child {
            padding-bottom: 1px;
            margin-bottom: -1px;
        }

        /*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
        li:not(:last-child)>.wpt-tests-block:not([open]):last-child,
        dd:not(:last-child)>.wpt-tests-block:not([open]):last-child {
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .wpt-tests-block:not([open]):not(:hover) {
            opacity: 0.5;
        }

        .wpt-tests-list {
            list-style: none;
            display: grid;
            margin: 0;
            padding: 0;
            grid-template-columns: 1fr max-content auto auto;
            grid-column-gap: .5em;
        }

        .wpt-tests-block hr:last-child {
            display: none;
        }

        .wpt-test {
            display: contents;
        }

        .wpt-test>a {
            text-decoration: underline;
            border: none;
        }

        .wpt-test>.wpt-name {
            grid-column: 1;
        }

        .wpt-test>.wpt-results {
            grid-column: 2;
        }

        .wpt-test>.wpt-live {
            grid-column: 3;
        }

        .wpt-test>.wpt-source {
            grid-column: 4;
        }

        .wpt-test>.wpt-results {
            display: flex;
            gap: .1em;
        }

        .wpt-test .wpt-result {
            display: inline-block;
            height: 1em;
            width: 1em;
            border-radius: 50%;
            position: relative;
        }
    </style>
    <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD" rel="stylesheet">
    <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet"
        type="text/css">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">CSS ネスティング モジュール レベル 1</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types/#WD">W3C 作業草案</a>, <time class="dt-updated"
                datetime="2026-01-22">2026年1月22日</time></p>
        <details open>
            <summary>この文書の詳細</summary>
            <div data-fill-with="spec-metadata">
                <dl>
                    <dt>この版:
                    <dd><a class="u-url"
                            href="https://www.w3.org/TR/2026/WD-css-nesting-1-20260122/">https://www.w3.org/TR/2026/WD-css-nesting-1-20260122/</a>
                    <dt>最新の公開版:
                    <dd><a href="https://www.w3.org/TR/css-nesting-1/">https://www.w3.org/TR/css-nesting-1/</a>
                    <dt>編集者草案:
                    <dd><a href="https://drafts.csswg.org/css-nesting/">https://drafts.csswg.org/css-nesting/</a>
                    <dt>履歴:
                    <dd><a class="u-url"
                            href="https://www.w3.org/standards/history/css-nesting-1/">https://www.w3.org/standards/history/css-nesting-1/</a>
                    <dt>フィードバック:
                    <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-nesting-1">CSSWG Issue リポジトリ</a>
                    <dd><a href="#issues-index">仕様内インライン</a>
                    <dt class="editor">編集者:
                    <dd class="editor p-author h-card vcard" data-editor-id="42199"><a class="p-name fn u-url url"
                            href="http://xanthir.com/contact/">Tab Atkins-Bittner</a> (<span
                            class="p-org org">Google</span>)
                    <dt class="editor">前編集者:
                    <dd class="editor p-author h-card vcard" data-editor-id="112669"><a class="p-name fn u-url url"
                            href="https://nerdy.dev">Adam Argyle</a> (<span class="p-org org">Google</span>)
                    <dt>この仕様への編集提案:
                    <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-nesting-1/Overview.bs">GitHub
                            編集者</a>
                    <dt>テストスイート:
                    <dd class="wpt-overview"><a
                            href="https://wpt.fyi/results/css/css-nesting/">https://wpt.fyi/results/css/css-nesting/</a>
                </dl>
            </div>
        </details>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> ©
            2026 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr
                title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a
                href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/copyright/software-license/" rel="license"
                title="W3C Software and Document License">permissive document license</a> rules apply. </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">概要</span></h2>
        <p>このモジュールでは、1つのスタイルルールを別のルールの内部にネストする機能を導入します。子ルールのセレクターは親ルールのセレクターに対して相対的です。これにより、CSSスタイルシートのモジュール性と保守性が向上します。
        </p>
        <a href="https://www.w3.org/TR/CSS/">CSS</a>は、HTMLやXMLなどの構造化文書のレンダリングを画面上や紙上などで記述するための言語です。
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">この文書のステータス</span></h2>
    <div data-fill-with="status">
        <p><em>このセクションでは、文書公開時点でのステータスについて説明します。
                現在のW3C公開文書の一覧およびこの技術報告書の最新改訂版は
                <a href="https://www.w3.org/TR/">W3C 標準および草案インデックス</a>に掲載されています。</em> </p>
        <p>この文書は、<a href="https://www.w3.org/groups/wg/css">CSS ワーキンググループ</a>によって
            <strong>作業草案 (Working Draft)</strong> として
            <a href="https://www.w3.org/policies/process/20250818/#recs-and-notes">勧告トラック</a>を使用して公開されました。
            作業草案としての公開は、<abbr title="World Wide Web Consortium">W3C</abbr>およびそのメンバーによる承認を意味するものではありません。
        </p>
        <p>これは草案文書であり、随時更新、置換、または他の文書により廃止される可能性があります。
            進行中の作業以外の文書として引用することは不適切です。 </p>
        <p>フィードバックは、<a href="https://github.com/w3c/csswg-drafts/issues">GitHubでのIssue提出</a>（推奨）により送信してください。
            タイトルに仕様コード「css-nesting」を含めてください：
            「[css-nesting] <i>…コメントの概要…</i>」。
            すべてのIssueやコメントは<a href="https://lists.w3.org/Archives/Public/public-css-archive/">アーカイブ</a>されています。
            または、(<a href="https://lists.w3.org/Archives/Public/www-style/">アーカイブ済み</a>) 公開メーリングリスト <a
                href="mailto:www-style@w3.org?Subject=%5Bcss-nesting%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>
            でもフィードバックを送ることができます。
        </p>
        <p>この文書は <a href="https://www.w3.org/policies/process/20250818/" id="w3c_process_revision">2025年8月18日 W3C
                プロセス文書</a> に基づき運用されています。 </p>
        <p>この文書は、<a href="https://www.w3.org/policies/patent-policy/20200915/">W3C 特許ポリシー</a>の下で運営されるグループにより作成されました。
            W3Cは、グループの成果物に関連して行われた特許開示の<a href="https://www.w3.org/groups/wg/css/ipr"
                rel="disclosure">公開リスト</a>を維持しています。
            このページには特許開示の手順も含まれています。
            実際に特許を知っており、その特許が<a href="https://www.w3.org/policies/patent-policy/20200915/#def-essential">本質的請求項
                (Essential Claim)</a>を含むと考える個人は、
            <a
                href="https://www.w3.org/policies/patent-policy/20200915/#sec-Disclosure">W3C特許ポリシー第6節</a>に従って情報を開示する必要があります。
        </p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目次</h2>
        <ol class="toc" role="directory">
            <li>
                <a href="#intro"><span class="secno">1</span> <span class="content">導入</span></a>
                <ol class="toc">
                    <li><a href="#placement"><span class="secno">1.1</span> <span class="content">モジュールの相互作用</span></a>
                    <li><a href="#values"><span class="secno">1.2</span> <span class="content">値</span></a>
                </ol>
            <li><a href="#explainer"><span class="secno">2</span> <span class="content">解説</span></a>
            <li>
                <a href="#nesting"><span class="secno">3</span> <span class="content">ネストされたスタイル規則</span></a>
                <ol class="toc">
                    <li><a href="#syntax"><span class="secno">3.1</span> <span class="content">構文</span></a>
                    <li><a href="#syntax-examples"><span class="secno">3.2</span> <span class="content">例</span></a>
                    <li>
                        <a href="#conditionals"><span class="secno">3.3</span> <span
                                class="content">他のアットルールのネスト</span></a>
                        <ol class="toc">
                            <li><a href="#nesting-at-scope"><span class="secno">3.3.1</span> <span
                                        class="content">ネストされた <span class="css">@scope</span> 規則</span></a>
                        </ol>
                    <li><a href="#mixing"><span class="secno">3.4</span> <span class="content">ネスト規則と宣言の混在</span></a>
                </ol>
            <li><a href="#nest-selector"><span class="secno">4</span> <span class="content">ネストセレクター: <span
                            class="css">&amp;</span> セレクター</span></a>
            <li><a href="#nested-declarations"><span class="secno">5</span> <span class="content">ネストされた宣言ルール</span></a>
            <li>
                <a href="#cssom"><span class="secno">6</span> <span class="content">CSSOM</span></a>
                <ol class="toc">
                    <li><a href="#the-cssnestrule"><span class="secno">6.1</span> <span class="content"> <code
                                    class="idl"><span>CSSNestedDeclarations</span></code> インターフェイス</span></a>
                </ol>
            <li><a href="#privacy"><span class="secno"></span> <span class="content">プライバシー上の考慮事項</span></a>
            <li><a href="#security"><span class="secno"></span> <span class="content">セキュリティ上の考慮事項</span></a>
            <li><a href="#changes"><span class="secno">7</span> <span class="content">変更点</span></a>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">適合性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文書上の慣例</span></a>
                    <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span
                                class="content">適合クラス</span></a>
                    <li>
                        <a href="#w3c-partial"><span class="secno"></span> <span class="content">部分的実装</span></a>
                        <ol class="toc">
                            <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span
                                        class="content">不安定または独自機能の実装</span></a>
                        </ol>
                    <li><a href="#w3c-testing"><span class="secno"></span> <span class="content">実験的でない実装</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本仕様で定義された用語</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">参照で定義された用語</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">規範的参照</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">説明的参照</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">問題索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">
                導入</span><a class="self-link" href="#intro"></a></h2>
        <p><em>この節は規範的ではありません。</em></p>
        <p>このモジュールは、あるスタイル規則の内部に別のスタイル規則をネストすることをサポートする方法を説明します。内側の規則のセレクタは外側の規則で一致した要素を参照できるようになります。この機能により、関連するスタイルを
            CSS 文書内の単一の構造にまとめることができ、可読性と保守性が向上します。</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <p>ネストの一般的なテスト</p>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/block-skipping.html"
                        title="css/css-nesting/block-skipping.html">block-skipping.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/block-skipping.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/block-skipping.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/delete-other-rule-crash.html"
                        title="css/css-nesting/delete-other-rule-crash.html">delete-other-rule-crash.html</a> <a
                        class="wpt-live" href="http://wpt.live/css/css-nesting/delete-other-rule-crash.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/delete-other-rule-crash.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/double-parent-pseudo-in-placeholder-crash.html"
                        title="css/css-nesting/double-parent-pseudo-in-placeholder-crash.html">double-parent-pseudo-in-placeholder-crash.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/double-parent-pseudo-in-placeholder-crash.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/double-parent-pseudo-in-placeholder-crash.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-nesting/has-nesting.html"
                        title="css/css-nesting/has-nesting.html">has-nesting.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/has-nesting.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/has-nesting.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/invalidation-001.html"
                        title="css/css-nesting/invalidation-001.html">invalidation-001.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/invalidation-001.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/invalidation-001.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/invalidation-002.html"
                        title="css/css-nesting/invalidation-002.html">invalidation-002.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/invalidation-002.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/invalidation-002.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/invalidation-003.html"
                        title="css/css-nesting/invalidation-003.html">invalidation-003.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/invalidation-003.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/invalidation-003.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/invalidation-004.html"
                        title="css/css-nesting/invalidation-004.html">invalidation-004.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/invalidation-004.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/invalidation-004.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nested-error-recovery.html"
                        title="css/css-nesting/nested-error-recovery.html">nested-error-recovery.html</a> <a
                        class="wpt-live" href="http://wpt.live/css/css-nesting/nested-error-recovery.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nested-error-recovery.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nesting-basic.html"
                        title="css/css-nesting/nesting-basic.html">nesting-basic.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/nesting-basic.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nesting-basic.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nesting-revert-rule.tentative.html"
                        title="css/css-nesting/nesting-revert-rule.tentative.html">nesting-revert-rule.tentative.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/nesting-revert-rule.tentative.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nesting-revert-rule.tentative.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/parent-pseudo-in-placeholder-crash.html"
                        title="css/css-nesting/parent-pseudo-in-placeholder-crash.html">parent-pseudo-in-placeholder-crash.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/parent-pseudo-in-placeholder-crash.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/parent-pseudo-in-placeholder-crash.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/pseudo-part-crash.html"
                        title="css/css-nesting/pseudo-part-crash.html">pseudo-part-crash.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/pseudo-part-crash.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/pseudo-part-crash.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/pseudo-where-crash.html"
                        title="css/css-nesting/pseudo-where-crash.html">pseudo-where-crash.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/pseudo-where-crash.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/pseudo-where-crash.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/supports-is-consistent.html"
                        title="css/css-nesting/supports-is-consistent.html">supports-is-consistent.html</a> <a
                        class="wpt-live" href="http://wpt.live/css/css-nesting/supports-is-consistent.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/supports-is-consistent.html"><small>(ソース)</small></a>
            </ul>
            <hr>
        </details>
        <h3 class="heading settled" data-level="1.1" id="placement"><span class="secno">1.1. </span><span
                class="content"> モジュールの相互作用</span><a class="self-link" href="#placement"></a></h3>
        <p>このモジュールは <a data-link-type="biblio" href="#biblio-css21"
                title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS21]</a>
            パーサモデルを拡張する新しいパーサ規則を導入します。<br>
            また <a data-link-type="biblio" href="#biblio-selectors-4" title="Selectors Level 4">[SELECTORS-4]</a>
            モジュールを拡張するセレクタを導入します。<br>
            さらに <a data-link-type="biblio" href="#biblio-cssom-1" title="CSS Object Model (CSSOM)">[CSSOM-1]</a>
            モジュールで定義されたいくつかの IDL とアルゴリズムを拡張・変更します。</p>
        <h3 class="heading settled" data-level="1.2" id="values"><span class="secno">1.2. </span><span class="content">
                値</span><a class="self-link" href="#values"></a></h3>
        <p>この仕様は新しいプロパティや値を定義しません。</p>
        <h2 class="heading settled" data-level="2" id="explainer"><span class="secno">2. </span><span class="content">
                解説</span><a class="self-link" href="#explainer"></a></h2>
        <p><em>この節は非規範的です。</em></p>
        <p>よりコンパクトに書きたい CSS があると想像してください。</p>
        <pre class="highlight">.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> green<c- p>;</c->
<c- p>}</c->
.foo .bar <c- p>{</c->
  <c- k>font-size</c-><c- p>:</c-> <c- m>1.4</c-><c- k>rem</c-><c- p>;</c->
<c- p>}</c->
</pre>
        <p>ネストを使うと、このように書けます：</p>
        <pre class="highlight">.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> green<c- p>;</c->
  .bar <c- p>{</c->
    <c- k>font-size</c-><c- p>:</c-> <c- m>1.4</c-><c- k>rem</c-><c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
        <p>Sass や他の CSS プリプロセッサでスタイルをネストしてきたなら、とても馴染みがあるでしょう。</p>
        <p>親のスタイル規則の内部に任意の規則をネストできます：</p>
        <pre class="highlight">main <c- p>{</c->
  div <c- p>{</c-> ... <c- p>}</c->
  .bar <c- p>{</c-> ... <c- p>}</c->
  #baz <c- p>{</c-> ...<c- p>}</c->
  <c- nf>:has</c-><c- p>(</c->p<c- p>)</c-> <c- p>{</c-> ... <c- p>}</c->
  ::backdrop <c- p>{</c-> ... <c- p>}</c->
  <c- p>[</c->lang|=<c- s>"zh"</c-><c- p>]</c-> <c- p>{</c-> ... <c- p>}</c->
  * <c- p>{</c-> ... <c- p>}</c->
<c- p>}</c->
</pre>
        <p>デフォルトでは、子規則のセレクタは親規則に対して子孫結合子で接続されるものとみなされますが、ネストされたセレクタを任意の結合子で始めてその接続方法を変更することができます：</p>
        <pre class="highlight">main <c- p>{</c->
  + article <c- p>{</c-> ... <c- p>}</c->
  > p <c- p>{</c-> ... <c- p>}</c->
  ~ main <c- p>{</c-> ... <c- p>}</c->
<c- p>}</c->
</pre>
        <p>新しい <a class="css" data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-">&amp;</a>
            セレクタは親のセレクタで一致した要素を明示的に参照することを可能にします。したがって、前の例は次のようにも書けます：</p>
        <pre class="highlight">main <c- p>{</c->
  &amp; + article <c- p>{</c-> ... <c- p>}</c->
  &amp; > p <c- p>{</c-> ... <c- p>}</c->
  &amp; ~ main <c- p>{</c-> ... <c- p>}</c->
<c- p>}</c->
</pre>
        <p>しかし、ネストされたセレクタ内で <a class="css" data-link-type="maybe" href="#selectordef-"
                id="ref-for-selectordef-①">&amp;</a> を他の位置に置くことで、親と子の規則の間の別の種類の関係を示すこともできます。例えば、次の CSS：</p>
        <pre class="highlight">ul <c- p>{</c->
  <c- k>padding-left</c-><c- p>:</c-> <c- m>1</c-><c- k>em</c-><c- p>;</c->
<c- p>}</c->
.component ul <c- p>{</c->
  <c- k>padding-left</c-><c- p>:</c-> <c- m>0</c-><c- p>;</c->
<c- p>}</c->
</pre>
        <p>はネストを使って次のように書き換えられます：</p>
        <pre class="highlight">ul <c- p>{</c->
  <c- k>padding-left</c-><c- p>:</c-> <c- m>1</c-><c- k>em</c-><c- p>;</c->
  .component &amp; <c- p>{</c->
    <c- k>padding-left</c-><c- p>:</c-> <c- m>0</c-><c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
        <p>再び、<a class="css" data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-②">&amp;</a>
            は「ネストされたセレクタをここに置きたい」ということを示す方法を提供します。</p>
        <p>セレクタ同士の間にスペースを入れたくない場合にも便利です。例えば：</p>
        <pre class="highlight">a <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  &amp;:hover <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> lightblue<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
        <p>このようなコードは <code class="highlight"><c- k>a</c-><c- p>:</c->hover <c- p>{</c-></code> と同じ結果を生みます。<a class="css"
                data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-③">&amp;</a> がなければ、<code
                class="highlight"><c- k>a</c-> <c- p>:</c->hover <c- p>{</c-></code> となり、<code
                class="highlight">a</code> と <code class="highlight">:hover</code>
            の間にスペースが入ってしまい、ホバーリンクにスタイルを適用できなくなります。</p>
        <p>複数レイヤーでネストすることも可能です — 既にネストされた CSS の中にさらにネストすることが望む限り何層でもできます。ネストは Container Queries、Supports Queries、Media
            Queries、Cascade Layers と混在させて使用できます。ほとんど何でも何の中にも入れられます。</p>
        <h2 class="heading settled" data-level="3" id="nesting"><span class="secno">3. </span><span
                class="content">ネストされたスタイル規則</span><a class="self-link" href="#nesting"></a></h2>
        <p>スタイル規則は他のスタイル規則の内部にネストできます。これらの <dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                data-lt="nested style rule|nesting style rule" id="nested-style-rule">ネストされたスタイル規則</dfn>
            は通常のスタイル規則とまったく同じように動作します — セレクタを介して要素にプロパティを関連付けます —
            が、親規則のセレクタコンテキストを「継承」し、親のセレクタを繰り返すことなく（場合によっては複数回）そのセレクタに基づいてさらに構築できるようにします。</p>
        <p><a data-link-type="dfn" href="#nested-style-rule" id="ref-for-nested-style-rule">ネストされたスタイル規則</a>
            は通常のスタイル規則とまったく同じですが、<a data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#relative-selector"
                id="ref-for-relative-selector">相対セレクタ</a> を使用でき、それらは暗黙的に親規則で一致した要素に対して相対的です。</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/implicit-nesting.html"
                        title="css/css-nesting/implicit-nesting.html">implicit-nesting.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/implicit-nesting.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/implicit-nesting.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/implicit-nesting-ident.html"
                        title="css/css-nesting/implicit-nesting-ident.html">implicit-nesting-ident.html</a> <a
                        class="wpt-live" href="http://wpt.live/css/css-nesting/implicit-nesting-ident.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/implicit-nesting-ident.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/implicit-nesting-ident-recovery.html"
                        title="css/css-nesting/implicit-nesting-ident-recovery.html">implicit-nesting-ident-recovery.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/implicit-nesting-ident-recovery.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/implicit-nesting-ident-recovery.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/implicit-parent-insertion-crash.html"
                        title="css/css-nesting/implicit-parent-insertion-crash.html">implicit-parent-insertion-crash.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/implicit-parent-insertion-crash.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/implicit-parent-insertion-crash.html"><small>(ソース)</small></a>
            </ul>
        </details>
        <div class="example" id="example-82c7d228">
            <a class="self-link" href="#example-82c7d228"></a> つまり、
            次のようなネストされたスタイル規則は：
            <pre class="lang-css highlight">.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->

  a <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
            <p>は有効であり、次と同等です：</p>
            <pre class="lang-css highlight">.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->
<c- p>}</c->
.foo a <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
<c- p>}</c->
</pre>
            <p>ネストされた規則はまた <a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector">ネストセレクタ</a>
                を使って親規則で一致した要素を直接参照したり、<a data-link-type="dfn"
                    href="https://www.w3.org/TR/selectors-4/#relative-selector"
                    id="ref-for-relative-selector①">相対セレクタ</a> 構文を用いて「子孫」以外の関係を指定することもできます。</p>
            <pre class="lang-css highlight">.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->

  &amp;:hover <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->

<c- c>/* equivalent to: */</c->

.foo <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
.foo:hover <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
</pre>
            <pre class="lang-css highlight">.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->

  + .bar <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->

<c- c>/* equivalent to: */</c->

.foo <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
.foo + .bar <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
</pre>
        </div>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nested-rule-cssom-invalidation.html"
                        title="css/css-nesting/nested-rule-cssom-invalidation.html">nested-rule-cssom-invalidation.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/nested-rule-cssom-invalidation.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nested-rule-cssom-invalidation.html"><small>(ソース)</small></a>
            </ul>
        </details>
        <h3 class="heading settled" data-level="3.1" id="syntax"><span class="secno">3.1. </span><span
                class="content">構文</span><a class="self-link" href="#syntax"></a></h3>
        <p>スタイル規則の内容 (<a data-link-type="dfn" href="https://www.w3.org/TR/css-syntax-3/#style-rule"
                id="ref-for-style-rule">style rule</a>) は、既存の <a data-link-type="dfn"
                href="https://www.w3.org/TR/cssom-1/#cssstyledeclaration-declarations"
                id="ref-for-cssstyledeclaration-declarations">宣言</a> に加えて、<a data-link-type="dfn"
                href="#nested-style-rule" id="ref-for-nested-style-rule①">ネストされたスタイル規則</a> と <a data-link-type="dfn"
                href="https://www.w3.org/TR/css-syntax-3/#at-rule" id="ref-for-at-rule">アットルール</a> を受け入れるようになりました。</p>
        <p><a data-link-type="dfn" href="#nested-style-rule" id="ref-for-nested-style-rule②">ネストされたスタイル規則</a>
            は非ネスト規則と以下の点で異なります：</p>
        <ul>
            <li data-md>
                <p><a data-link-type="dfn" href="#nested-style-rule" id="ref-for-nested-style-rule③">ネストされたスタイル規則</a>
                    は、その前置部分として <a class="production css" data-link-type="type"
                        href="https://www.w3.org/TR/selectors-4/#typedef-relative-selector-list"
                        id="ref-for-typedef-relative-selector-list">&lt;relative-selector-list></a> を受け入れます（従来の <a
                        class="production css" data-link-type="type"
                        href="https://www.w3.org/TR/selectors-4/#typedef-selector-list"
                        id="ref-for-typedef-selector-list">&lt;selector-list></a> の代わりに）。任意の <a data-link-type="dfn"
                        href="https://www.w3.org/TR/selectors-4/#relative-selector"
                        id="ref-for-relative-selector②">相対セレクタ</a> は <a data-link-type="dfn" href="#nesting-selector"
                        id="ref-for-nesting-selector①">ネストセレクタ</a> で表される要素に対して相対的です。</p>
            <li data-md>
                <p>もし <a class="production css" data-link-type="type"
                        href="https://www.w3.org/TR/selectors-4/#typedef-relative-selector-list"
                        id="ref-for-typedef-relative-selector-list①">&lt;relative-selector-list></a> の中のセレクタが結合子で始まらず、かつ
                    <a data-link-type="dfn" href="#contain-the-nesting-selector"
                        id="ref-for-contain-the-nesting-selector">ネストセレクタを含む</a> 場合、それは非 <a data-link-type="dfn"
                        href="https://www.w3.org/TR/selectors-4/#relative-selector"
                        id="ref-for-relative-selector③">相対セレクタ</a> として解釈されます。
                </p>
        </ul>
        <p>ネストされたスタイル規則がどのように解析されるかの詳細は <a data-link-type="biblio" href="#biblio-css-syntax-3"
                title="CSS Syntax Module Level 3">[CSS-SYNTAX-3]</a> に定義されています。</p>
        <p>無効な <a data-link-type="dfn" href="#nested-style-rule" id="ref-for-nested-style-rule④">ネストされたスタイル規則</a>
            は、その内容とともに無視されますが、親規則自体を無効にすることはありません。</p>
        <p><a data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#relative-selector"
                id="ref-for-relative-selector④">相対セレクタ</a> を持つネスト規則は、暗黙的に含まれる <a data-link-type="dfn"
                href="#nesting-selector" id="ref-for-nesting-selector②">ネストセレクタ</a> の特異性を含みます。例えば、<span class="css">.foo
                { > .bar {...}}</span> と <span class="css">.foo { &amp; > .bar
                {...}}</span> は内側の規則に対して同じ特異性を持ちます。</p>
        <div class="note" role="note">
            一部の CSS 生成ツール（プリプロセッサ）はネストを文字列の連結として扱い、ネストレベルをまたいで単一の <em>simple selector</em> を構築することを許すものがあります。これは BEM
            のような階層的な命名パターンでファイル内の繰り返しを減らすために使われることがあります。
            <p>例えば、あるコンポーネントがクラス <span class="css">.foo</span> を使い、ネストされたコンポーネントが <span class="css">.fooBar</span>
                を使う場合、Sass では次のように書けます：</p>
            <pre class="lang-css highlight">.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  &amp;Bar <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* In Sass, this is equivalent to</c->
<c- c>  .foo { color: blue; }</c->
<c- c>  .fooBar { color: red; }</c->
<c- c>*/</c->
</pre>
            <p>これは CSS では許されません。ネストは構文変換ではなく、親セレクタが実際に一致する要素に対してマッチするためです。</p>
            <p>また、セレクタ <span class="css">&amp;Bar</span> はそもそも CSS では無効です。なぜなら <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-ui-4/#valdef-caret-shape-bar"
                    id="ref-for-valdef-caret-shape-bar">Bar</a> の部分はタイプセレクタであり、複合セレクタの中では先頭に来なければならないからです。（つまり <span
                    class="css">Bar&amp;</span> のように書く必要があります。）したがって幸いにも、CSS ネストとプリプロセッサ構文には重なりはありません。</p>
        </div>
        <div class="algorithm" data-algorithm="contain the nesting selector">
            セレクタが <dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="contain-the-nesting-selector">ネストセレクタを含む</dfn> とは、セレクタを任意のタイプのセレクタとして <a data-link-type="dfn"
                href="https://www.w3.org/TR/css-syntax-3/#css-parse-something-according-to-a-css-grammar"
                id="ref-for-css-parse-something-according-to-a-css-grammar">解析</a> したときに、値が "&amp;" (U+0026 AMPERSAND)
            である <a class="production css" data-link-type="type"
                href="https://www.w3.org/TR/css-syntax-3/#typedef-delim-token"
                id="ref-for-typedef-delim-token">&lt;delim-token></a> が出現した場合を指します。
            <p class="note" role="note"><span class="marker">注：</span> これは <span class="css">:is(:unknown(&amp;),
                    .bar)</span>
                のようなケースも検出するために明示的に表現されています。未知のセレクタ（未知であるため、その引数がセレクタとして解析される意図なのかどうかを知る手段がない）がネストセレクタを含む唯一の部分である場合でも、それは将来のブラウザで有効になる可能性があり、パースを無関係なバージョン依存にしたくないため、そのような場合もネストセレクタを含むものとして扱います。
            </p>
        </div>
        <p>もし <a class="production css" data-link-type="type"
                href="https://www.w3.org/TR/selectors-4/#typedef-forgiving-selector-list"
                id="ref-for-typedef-forgiving-selector-list">&lt;forgiving-selector-list></a> の項目が <a
                data-link-type="dfn" href="#contain-the-nesting-selector"
                id="ref-for-contain-the-nesting-selector②">ネストセレクタを含む</a>
            が無効である場合、その項目は破棄されずそのまま正確に保持されます。（これはセレクタのマッチ動作を変えるものではありません — 無効なセレクタは依然として何にもマッチしません —
            ただしシリアライズの結果が変わるだけです。）</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nest-containing-forgiving.html"
                        title="css/css-nesting/nest-containing-forgiving.html">nest-containing-forgiving.html</a> <a
                        class="wpt-live"
                        href="http://wpt.live/css/css-nesting/nest-containing-forgiving.html"><small>(ライブ
                            テスト)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nest-containing-forgiving.html"><small>(ソース)</small></a>
                <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-nesting/parsing.html"
                        title="css/css-nesting/parsing.html">parsing.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/parsing.html"><small>(ライブテスト)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/parsing.html"><small>(ソース)</small></a>
            </ul>
        </details>
        <p class="issue" id="issue-03f974e2"><a class="self-link" href="#issue-03f974e2"></a> 前の段落は <a class="css"
                data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-⑤">&amp;</a> 自体を Selectors に移動するときに
            Selectors 側に移す必要があります。ここでは便宜上モンキーパッチしています。</p>
        <h3 class="heading settled" data-level="3.2" id="syntax-examples"><span class="secno">3.2. </span><span
                class="content"> 例</span><a class="self-link" href="#syntax-examples"></a></h3>
        <pre class="lang-css highlight"><b><c- c>/* &amp; can be used on its own */</c-></b>
.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  &amp; > .bar <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
  > .baz <c- p>{</c-> <c- k>color</c-><c- p>:</c-> green<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .foo { color: blue; }</c->
<c- c>  .foo > .bar { color: red; }</c->
<c- c>  .foo > .baz { color: green; }</c->
<c- c>*/</c->


<b><c- c>/* or in a compound selector,</c->
<c- c>   refining the parent’s selector */</c-></b>
.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  &amp;.bar <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .foo { color: blue; }</c->
<c- c>  .foo.bar { color: red; }</c->
<c- c>*/</c->

<b><c- c>/* multiple selectors in the list are all</c->
<c- c>   relative to the parent */</c-></b>
.foo<c- p>,</c-> .bar <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  + .baz<c- p>,</c-> &amp;.qux <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .foo, .bar { color: blue; }</c->
<c- c>  :is(.foo, .bar) + .baz,</c->
<c- c>  :is(.foo, .bar).qux { color: red; }</c->
<c- c>*/</c->

<b><c- c>/* &amp; can be used multiple times in a single selector */</c-></b>
.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  &amp; .bar &amp; .baz &amp; .qux <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .foo { color: blue; }</c->
<c- c>  .foo .bar .foo .baz .foo .qux { color: red; }</c->
<c- c>*/</c->

<b><c- c>/* &amp; doesn’t have to be at the beginning of the selector */</c-></b>

.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->
  .parent &amp; <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .foo { color: red; }</c->
<c- c>  .parent .foo { color: blue; }</c->
<c- c>*/</c->

.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->
  <c- nf>:not</c-><c- p>(</c->&amp;<c- p>)</c-> <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .foo { color: red; }</c->
<c- c>  :not(.foo) { color: blue; }</c->
<c- c>*/</c->

<b><c- c>/* But if you use a </c-><a data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#relative-selector" id="ref-for-relative-selector⑤"><c- c>relative selector</c-></a><c- c>,</c->
<c- c>  an initial &amp; is implied automatically */</c-></b>

.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->
  + .bar + &amp; <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
<c- p>}</c->

<c- c>/* equivalent to</c->
<c- c>  .foo { color: red; }</c->
<c- c>  .foo + .bar + .foo { color: blue; }</c->
<c- c>*/</c->

<b><c- c>/* Somewhat silly, but &amp; can be used all on its own, as well. */</c-></b>
.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  &amp; <c- p>{</c-> <c- k>padding</c-><c- p>:</c-> <c- m>2</c-><c- k>ch</c-><c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .foo { color: blue; }</c->
<c- c>  .foo { padding: 2ch; }</c->

<c- c>  // or</c->

<c- c>  .foo {</c->
<c- c>    color: blue;</c->
<c- c>    padding: 2ch;</c->
<c- c>  }</c->
<c- c>*/</c->

<b><c- c>/* Again, silly, but can even be doubled up. */</c-></b>
.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  &amp;&amp; <c- p>{</c-> <c- k>padding</c-><c- p>:</c-> <c- m>2</c-><c- k>ch</c-><c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .foo { color: blue; }</c->
<c- c>  .foo.foo { padding: 2ch; }</c->
<c- c>*/</c->

<b><c- c>/* The parent selector can be arbitrarily complicated */</c-></b>
.error<c- p>,</c-> #404 <c- p>{</c->
  &amp;:hover > .baz <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  :is(.error, #404):hover > .baz { color: red; }</c->
<c- c>*/</c->

.ancestor .el <c- p>{</c->
  .other-ancestor &amp; <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .other-ancestor :is(.ancestor .el) { color: red; }</c->

<b><c- c>/* As can the nested selector */</c-></b>
.foo <c- p>{</c->
  &amp; <c- nf>:is</c-><c- p>(</c->.bar<c- p>,</c-> &amp;.baz<c- p>)</c-> <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  .foo :is(.bar, .foo.baz) { color: red; }</c->
<c- c>*/</c->

<b><c- c>/* Multiple levels of nesting "stack up" the selectors */</c-></b>
figure <c- p>{</c->
  <c- k>margin</c-><c- p>:</c-> <c- m>0</c-><c- p>;</c->

  > figcaption <c- p>{</c->
    <c- k>background</c-><c- p>:</c-> <c- nf>hsl</c-><c- p>(</c-><c- m>0</c-> <c- m>0</c-><c- k>%</c-> <c- m>0</c-><c- k>%</c-> / <c- m>50</c-><c- k>%</c-><c- p>);</c->

    > p <c- p>{</c->
      <c- k>font-size</c-><c- p>:</c-> <c- m>.9</c-><c- k>rem</c-><c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  figure { margin: 0; }</c->
<c- c>  figure > figcaption { background: hsl(0 0% 0% / 50%); }</c->
<c- c>  figure > figcaption > p { font-size: .9rem; }</c->
<c- c>*/</c->

<b><c- c>/* Example usage with Cascade Layers */</c-></b>
<c- n>@layer</c-> base <c- p>{</c->
  html <c- p>{</c->
    <c- k>block-size</c-><c- p>:</c-> <c- m>100</c-><c- k>%</c-><c- p>;</c->

    body <c- p>{</c->
      <c- k>min-block-size</c-><c- p>:</c-> <c- m>100</c-><c- k>%</c-><c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  @layer base {</c->
<c- c>    html { block-size: 100%; }</c->
<c- c>    html body { min-block-size: 100%; }</c->
<c- c>  }</c->
<c- c>*/</c->

<b><c- c>/* Example nesting Cascade Layers */</c-></b>
<c- n>@layer</c-> base <c- p>{</c->
  html <c- p>{</c->
    <c- k>block-size</c-><c- p>:</c-> <c- m>100</c-><c- k>%</c-><c- p>;</c->

    <c- n>@layer</c-> support <c- p>{</c->
      body <c- p>{</c->
        <c- k>min-block-size</c-><c- p>:</c-> <c- m>100</c-><c- k>%</c-><c- p>;</c->
      <c- p>}</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  @layer base {</c->
<c- c>    html { block-size: 100%; }</c->
<c- c>  }</c->
<c- c>  @layer base.support {</c->
<c- c>    html body { min-block-size: 100%; }</c->
<c- c>  }</c->
<c- c>*/</c->

<b><c- c>/* Example usage with Scoping */</c-></b>
<c- n>@scope</c-> <c- p>(</c->.card<c- p>)</c-> to <c- p>(</c->> header<c- p>)</c-> <c- p>{</c->
  :scope <c- p>{</c->
    <c- k>inline-size</c-><c- p>:</c-> <c- m>40</c-><c- k>ch</c-><c- p>;</c->
    <c- k>aspect-ratio</c-><c- p>:</c-> <c- m>3</c->/<c- m>4</c-><c- p>;</c->

    > header <c- p>{</c->
      <c- k>border-block-end</c-><c- p>:</c-> <c- m>1</c-><c- k>px</c-> solid white<c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->
<c- c>/* equivalent to</c->
<c- c>  @scope (.card) to (> header) {</c->
<c- c>    :scope { inline-size: 40ch; aspect-ratio: 3/4; }</c->
<c- c>    :scope > header { border-block-end: 1px solid white; }</c->
<c- c>  }</c->
<c- c>*/</c->

<b><c- c>/* Example nesting Scoping */</c-></b>
.card <c- p>{</c->
  <c- k>inline-size</c-><c- p>:</c-> <c- m>40</c-><c- k>ch</c-><c- p>;</c->
  <c- k>aspect-ratio</c-><c- p>:</c-> <c- m>3</c->/<c- m>4</c-><c- p>;</c->

  <c- n>@scope</c-> <c- p>(</c->&amp;<c- p>)</c-> to <c- p>(</c->> header > *<c- p>)</c-> <c- p>{</c->
    :scope > header <c- p>{</c->
      <c- k>border-block-end</c-><c- p>:</c-> <c- m>1</c-><c- k>px</c-> solid white<c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->

<c- c>/* equivalent to</c->
<c- c>  .card { inline-size: 40ch; aspect-ratio: 3/4; }</c->
<c- c>  @scope (.card) to (> header > *) {</c->
<c- c>    :scope > header { border-block-end: 1px solid white; }</c->
<c- c>  }</c->
<c- c>*/</c->
</pre>
        <h3 class="heading settled" data-level="3.3" id="conditionals"><span class="secno">3.3. </span><span
                class="content">他のアットルールのネスト</span><a class="self-link" href="#conditionals"></a></h3>
        <p> <a data-link-type="dfn" href="#nested-style-rule" id="ref-for-nested-style-rule⑤">ネストされたスタイル規則</a> に加えて、
            この仕様は <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="nested-group-rules">ネストされたグループ規則</dfn> を
            <a data-link-type="dfn" href="https://www.w3.org/TR/css-syntax-3/#style-rule"
                id="ref-for-style-rule①">スタイル規則</a> の内部に許可します：
            本文に <span id="ref-for-style-rule②">スタイル規則</span> を含む任意のアットルールは、
            別段の指定がない限り <span id="ref-for-style-rule③">スタイル規則</span> の内部にネストできます。
        </p>
        <p>このようにネストされた場合、
            <a data-link-type="dfn" href="#nested-group-rules" id="ref-for-nested-group-rules">ネストされたグループ規則</a>
            のブロックの内容は
            <a class="production css" data-link-type="type"
                href="https://drafts.csswg.org/css-syntax-3/#typedef-block-contents"
                id="ref-for-typedef-block-contents">&lt;block-contents></a> として解析され、<a class="production css"
                data-link-type="type" href="https://www.w3.org/TR/css-syntax-3/#typedef-rule-list"
                id="ref-for-typedef-rule-list">&lt;rule-list></a> とはなりません：
        </p>
        <ul>
            <li data-md>
                <p><a data-link-type="dfn" href="https://www.w3.org/TR/css-syntax-3/#style-rule"
                        id="ref-for-style-rule④">スタイル規則</a> は <a data-link-type="dfn" href="#nested-style-rule"
                        id="ref-for-nested-style-rule⑥">ネストされたスタイル規則</a> であり、
                    その <a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector③">ネストセレクタ</a>
                    は最も近い祖先の <span id="ref-for-style-rule⑤">スタイル規則</span> から定義を受けます。</p>
            <li data-md>
                <p>プロパティは直接使用でき、あたかも <a data-link-type="dfn" href="#nested-declarations-rule"
                        id="ref-for-nested-declarations-rule">ネストされた宣言規則</a> にネストされているかのように振る舞います。</p>
        </ul>
        <div class="note" role="note">
            具体的には、次の規則が <a data-link-type="dfn" href="#nested-group-rules"
                id="ref-for-nested-group-rules①">ネストされたグループ規則</a> になり得ます：
            <ul>
                <li data-md>
                    <p>すべての <a data-link-type="dfn"
                            href="https://www.w3.org/TR/css-conditional-3/#conditional-group-rule"
                            id="ref-for-conditional-group-rule">条件付きグループ規則</a>（<a class="css" data-link-type="maybe"
                            href="https://www.w3.org/TR/css-conditional-5/#at-ruledef-container"
                            id="ref-for-at-ruledef-container">@container</a>、<a class="css" data-link-type="maybe"
                            href="https://www.w3.org/TR/css-conditional-3/#at-ruledef-media"
                            id="ref-for-at-ruledef-media">@media</a>、<a class="css" data-link-type="maybe"
                            href="https://www.w3.org/TR/css-conditional-3/#at-ruledef-supports"
                            id="ref-for-at-ruledef-supports">@supports</a>）</p>
                <li data-md>
                    <p><a class="css" data-link-type="maybe"
                            href="https://www.w3.org/TR/css-cascade-5/#at-ruledef-layer"
                            id="ref-for-at-ruledef-layer">@layer</a></p>
                <li data-md>
                    <p><a class="css" data-link-type="maybe"
                            href="https://www.w3.org/TR/css-cascade-6/#at-ruledef-scope"
                            id="ref-for-at-ruledef-scope">@scope</a></p>
            </ul>
        </div>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/conditional-properties.html"
                        title="css/css-nesting/conditional-properties.html">conditional-properties.html</a> <a
                        class="wpt-live" href="http://wpt.live/css/css-nesting/conditional-properties.html"><small>(live
                            test)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/conditional-properties.html"><small>(source)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/conditional-rules.html"
                        title="css/css-nesting/conditional-rules.html">conditional-rules.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/conditional-rules.html"><small>(live test)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/conditional-rules.html"><small>(source)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/invalid-inner-rules.html"
                        title="css/css-nesting/invalid-inner-rules.html">invalid-inner-rules.html</a> <a
                        class="wpt-live" href="http://wpt.live/css/css-nesting/invalid-inner-rules.html"><small>(live
                            test)</small></a> <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/invalid-inner-rules.html"><small>(source)</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/supports-rule.html"
                        title="css/css-nesting/supports-rule.html">supports-rule.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/supports-rule.html"><small>(live test)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/supports-rule.html"><small>(source)</small></a>
            </ul>
        </details>
        <p>そのような <a data-link-type="dfn" href="#nested-group-rules" id="ref-for-nested-group-rules②">ネストされたグループ規則</a>
            の意味と挙動は、
            別段の指定がない限りそれ以外は変更されません。</p>
        <div class="example" id="example-81212ace">
            <a class="self-link" href="#example-81212ace"></a> 例えば、次の条件付きネストは有効です：
            <pre class="lang-css highlight"><b><c- c>/* プロパティは直接使用できます */</c-></b>
.foo <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> grid<c- p>;</c->

  <c- n>@media</c-> <c- p>(</c->orientation: landscape<c- p>)</c-> <c- p>{</c->
    <c- k>grid-auto-flow</c-><c- p>:</c-> column<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->

<c- c>/* 等価: */</c->
.foo <c- p>{</c-> <c- k>display</c-><c- p>:</c-> grid<c- p>;</c->
<c- p>}</c->
<c- n>@media</c-> <c- p>(</c->orientation: landscape<c- p>)</c-> <c- p>{</c->
  .foo <c- p>{</c->
    <c- k>grid-auto-flow</c-><c- p>:</c-> column
  <c- p>}</c->
<c- p>}</c->

<c- c>/* またネストされていないものとも等価: */</c->
.foo <c- p>{</c-> <c- k>display</c-><c- p>:</c-> grid<c- p>;</c->
<c- p>}</c->

<c- n>@media</c-> <c- p>(</c->orientation: landscape<c- p>)</c-> <c- p>{</c->
  .foo <c- p>{</c->
    <c- k>grid-auto-flow</c-><c- p>:</c-> column<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->

<b><c- c>/* 条件付きルールはさらにネストできます */</c-></b>
.foo <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> grid<c- p>;</c->

  <c- n>@media</c-> <c- p>(</c->orientation: landscape<c- p>)</c-> <c- p>{</c->
    <c- k>grid-auto-flow</c-><c- p>:</c-> column<c- p>;</c->

    <c- n>@media</c-> <c- p>(</c->min-width > <c- m>1024</c-><c- k>px</c-><c- p>)</c-> <c- p>{</c->
      <c- k>max-inline-size</c-><c- p>:</c-> <c- m>1024</c-><c- k>px</c-><c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->

<c- c>/* 等価 */</c->
.foo <c- p>{</c-> <c- k>display</c-><c- p>:</c-> grid<c- p>;</c->
<c- p>}</c->

<c- n>@media</c-> <c- p>(</c->orientation: landscape<c- p>)</c-> <c- p>{</c->
  .foo <c- p>{</c->
    <c- k>grid-auto-flow</c-><c- p>:</c-> column<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->

<c- n>@media</c-> <c- p>(</c->orientation: landscape<c- p>)</c-> and <c- p>(</c->min-width > <c- m>1024</c-><c- k>px</c-><c- p>)</c-> <c- p>{</c->
  .foo <c- p>{</c->
    <c- k>max-inline-size</c-><c- p>:</c-> <c- m>1024</c-><c- k>px</c-><c- p>;</c->
  <c- p>}</c->
<c- p>}</c->

<b><c- c>/* ネストされた Cascade Layers の例 */</c-></b>
html <c- p>{</c->
  <c- n>@layer</c-> base <c- p>{</c->
    <c- k>block-size</c-><c- p>:</c-> <c- m>100</c-><c- k>%</c-><c- p>;</c->

    <c- n>@layer</c-> support <c- p>{</c->
      &amp; body <c- p>{</c->
        <c- k>min-block-size</c-><c- p>:</c-> <c- m>100</c-><c- k>%</c-><c- p>;</c->
      <c- p>}</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->

<c- c>/* 等価 */</c->
<c- n>@layer</c-> base <c- p>{</c->
  html <c- p>{</c-> <c- k>block-size</c-><c- p>:</c-> <c- m>100</c-><c- k>%</c-><c- p>;</c-> <c- p>}</c->
<c- p>}</c->
<c- n>@layer</c-> base.support <c- p>{</c->
  html body <c- p>{</c-> <c- k>min-block-size</c-><c- p>:</c-> <c- m>100</c-><c- k>%</c-><c- p>;</c-> <c- p>}</c->
<c- p>}</c->

<b><c- c>/* ネストされた Scoping の例 */</c-></b>
.card <c- p>{</c->
  <c- k>inline-size</c-><c- p>:</c-> <c- m>40</c-><c- k>ch</c-><c- p>;</c->
  <c- k>aspect-ratio</c-><c- p>:</c-> <c- m>3</c->/<c- m>4</c-><c- p>;</c->

  <c- n>@scope</c-> <c- p>(</c->&amp;<c- p>)</c-> <c- p>{</c->
    :scope <c- p>{</c->
      <c- k>border</c-><c- p>:</c-> <c- m>1</c-><c- k>px</c-> solid white<c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->

<c- c>/* 等価 */</c->
.card <c- p>{</c-> <c- k>inline-size</c-><c- p>:</c-> <c- m>40</c-><c- k>ch</c-><c- p>;</c-> <c- k>aspect-ratio</c-><c- p>:</c-> <c- m>3</c->/<c- m>4</c-><c- p>;</c-> <c- p>}</c->
<c- n>@scope</c-> <c- p>(</c->.card<c- p>)</c-> <c- p>{</c->
  :scope <c- p>{</c-> <c- k>border-block-end</c-><c- p>:</c-> <c- m>1</c-><c- k>px</c-> solid white<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
</pre>
        </div>
        <p>直接ネストされたプロパティが連続している場合、それらは自動的に <a data-link-type="dfn" href="#nested-declarations-rule"
                id="ref-for-nested-declarations-rule①">ネストされた宣言規則</a> でラップされます。
            （これは CSSOM で観察できます。）</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nesting-layer.html"
                        title="css/css-nesting/nesting-layer.html">nesting-layer.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/nesting-layer.html"><small>(live test)</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nesting-layer.html"><small>(source)</small></a>
            </ul>
        </details>
        <h4 class="heading settled" data-level="3.3.1" id="nesting-at-scope"><span class="secno">3.3.1. </span><span
                class="content">ネストされた <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-cascade-6/#at-ruledef-scope"
                    id="ref-for-at-ruledef-scope①">@scope</a> 規則</span><a class="self-link"
                href="#nesting-at-scope"></a></h4>
        <p><a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-cascade-6/#at-ruledef-scope"
                id="ref-for-at-ruledef-scope②">@scope</a> ルールが <a data-link-type="dfn" href="#nested-group-rules"
                id="ref-for-nested-group-rules③">ネストされたグループ規則</a> である場合、
            <a class="css" data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-⑥">&amp;</a> が <a
                class="production css" data-link-type="type"
                href="https://www.w3.org/TR/css-cascade-6/#typedef-scope-start"
                id="ref-for-typedef-scope-start">&lt;scope-start></a> セレクタ内にあるとき、
            それは最も近い祖先スタイル規則で一致した要素を参照します。
        </p>
        <div class="example" id="example-d2d35473">
            <a class="self-link" href="#example-d2d35473"></a> つまり、次のコードは：
            <pre class="highlight">.parent <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->

  <c- n>@scope</c-> <c- p>(</c->&amp; > .scope<c- p>)</c-> to <c- p>(</c->&amp; .limit<c- p>)</c-> <c- p>{</c->
    &amp; .content <c- p>{</c->
      <c- k>color</c-><c- p>:</c-> red<c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
            <p>次と等価です：</p>
            <pre class="highlight">.parent <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
<c- n>@scope</c-> <c- p>(</c->.parent > .scope<c- p>)</c-> to <c- p>(</c-><c- nf>:where</c-><c- p>(</c->:scope<c- p>)</c-> .limit<c- p>)</c-> <c- p>{</c->
  <c- nf>:where</c-><c- p>(</c->:scope<c- p>)</c-> .content <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> red<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
        </div>
        <div class="note" role="note"> アンパサンド（<a class="css" data-link-type="maybe" href="#selectordef-"
                id="ref-for-selectordef-⑦">&amp;</a>）セレクタは <code
                class="highlight"><c- nf>:where</c-><c- p>(</c->:scope<c- p>)</c-></code> のように <a class="css"
                data-link-type="maybe" href="https://www.w3.org/TR/css-cascade-6/#at-ruledef-scope"
                id="ref-for-at-ruledef-scope③">@scope</a> ルール内で振る舞います。 </div>
        <h3 class="heading settled" data-level="3.4" id="mixing"><span class="secno">3.4. </span><span
                class="content">ネスト規則と宣言の混在</span><a class="self-link" href="#mixing"></a>
        </h3>
        <p>あるスタイル規則が宣言と <a data-link-type="dfn" href="#nested-style-rule"
                id="ref-for-nested-style-rule⑦">ネストされたスタイル規則</a>
            や <a data-link-type="dfn" href="#nested-group-rules" id="ref-for-nested-group-rules④">ネストされたグループ規則</a>
            の両方を含む場合、
            それら三者は任意に混在できます。
            規則の後や規則の間に来る宣言は、
            他の規則に対する順序を保持するために暗黙的に <a data-link-type="dfn" href="#nested-declarations-rule"
                id="ref-for-nested-declarations-rule②">ネストされた宣言規則</a> でラップされます。</p>
        <div class="example" id="example-de3f70c3">
            <a class="self-link" href="#example-de3f70c3"></a> 例えば、次のコードでは：
            <pre class="lang-css highlight">article <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> green<c- p>;</c->
  &amp; <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
  color: red<c- p>;</c->
<c- p>}</c->

<c- c>/* 等価 */</c->
article <c- p>{</c-> <c- k>color</c-><c- p>:</c-> green<c- p>;</c-> <c- p>}</c->
<c- nf>:is</c-><c- p>(</c->article<c- p>)</c-> <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
article <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->

<c- c>/* 等価ではない */</c->
article <c- p>{</c-> <c- k>color</c-><c- p>:</c-> green<c- p>;</c-> <c- p>}</c->
article <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- nf>:is</c-><c- p>(</c->article<c- p>)</c-> <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
</pre>
        </div>
        <p>「出現順序（Order Of Appearance）」を決定する目的のために、<a data-link-type="dfn" href="#nested-style-rule"
                id="ref-for-nested-style-rule⑧">ネストされたスタイル規則</a> と <a data-link-type="dfn" href="#nested-group-rules"
                id="ref-for-nested-group-rules⑤">ネストされたグループ規則</a> は、その親規則の後に来るものと見なされます。</p>
        <div>
            例えば：
            <pre class="lang-css highlight">article <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  &amp; <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
</pre>
            <p>両方の宣言は同じ特異性 (0,0,1) を持ちますが、
                ネストされた規則は親規則の後に来ると見なされるため、
                <a class="css" data-link-type="propdesc" href="https://www.w3.org/TR/css-color-4/#propdef-color"
                    id="ref-for-propdef-color">color: red</a> の宣言がカスケードで勝ちます。
            </p>
            <p>一方、次の例では：</p>
            <pre class="lang-css highlight">article <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
  <c- nf>:where</c-><c- p>(</c->&amp;<c- p>)</c-> <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
</pre>
            <p><a class="css" data-link-type="maybe" href="https://www.w3.org/TR/selectors-4/#where-pseudo"
                    id="ref-for-where-pseudo">:where()</a> 疑似クラスはネストセレクタの特異性を 0 に減らすため、
                <a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector④">ネストセレクタ</a> を含む宣言である <a
                    class="css" data-link-type="propdesc" href="https://www.w3.org/TR/css-color-4/#propdef-color"
                    id="ref-for-propdef-color①">color: red</a> は特異性が (0,0,0) となり、
                「出現順序」が考慮される前に <span class="css" id="ref-for-propdef-color②">color: blue</span> の宣言に負けます。
            </p>
        </div>
        <p class="note" role="note"><span class="marker">注意：</span>宣言とネストされたルールを自由に組み合わせることは<em>可能</em>ですが、
            後のプロパティが自動的に<a data-link-type="dfn" href="#nested-declarations-rule"
                id="ref-for-nested-declarations-rule③">ネストされた宣言ルール</a>に
            包まれるため、読みづらく多少混乱を招くことがあります。
            可読性のために、著者はスタイルルール内のすべてのプロパティを
            ネストルールの前に配置することを推奨します。
            （これは古いユーザーエージェントでも若干有利に働きます：
            パースやエラー回復の仕組みによって、ネストルールの後に出現するプロパティが
            スキップされることがあるためです。）</p>
        <h2 class="heading settled" data-level="4" id="nest-selector"><span class="secno">4. </span><span
                class="content">ネストセレクタ: <a class="css" data-link-type="maybe" href="#selectordef-"
                    id="ref-for-selectordef-⑧">&amp;</a> セレクタ</span><a class="self-link" href="#nest-selector"></a>
        </h2>
        <p>ネストされた<a data-link-type="dfn" href="#nested-style-rule" id="ref-for-nested-style-rule⑨">スタイル規則</a>を使用する際には、
            親規則で一致した要素を参照できる必要があります;
            それこそがネストの<em>目的の全て</em>です。
            それを実現するために、
            この仕様は新しいセレクタ、<dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="nesting-selector">ネストセレクタ</dfn>を定義します。
            表記は <dfn class="dfn-paneled css" data-dfn-type="selector" data-export id="selectordef-">&amp;</dfn>
            (U+0026 AMPERSAND) です。</p>
        <p><a data-link-type="dfn" href="#nested-style-rule" id="ref-for-nested-style-rule①⓪">ネストされたスタイル規則</a>
            のセレクタで使用された場合、
            <a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector⑤">ネストセレクタ</a>は
            親規則で一致した要素を表します。
            他の文脈で使用された場合は、
            その文脈における <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/selectors-4/#scope-pseudo"
                id="ref-for-scope-pseudo">:scope</a> と同じ要素を表します
            （別段の定義がない限り）。
        </p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/top-level-is-scope.html"
                        title="css/css-nesting/top-level-is-scope.html">top-level-is-scope.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/top-level-is-scope.html"><small>（ライブテスト）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/top-level-is-scope.html"><small>（ソース）</small></a>
            </ul>
        </details>
        <div class="note" role="note">
            <a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector⑥">ネストセレクタ</a>は、
            親のスタイル規則のセレクタで置き換え、<a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/selectors-4/#matches-pseudo" id="ref-for-matches-pseudo">:is()</a>
            セレクタでラップすることで展開（デシュガー）できます。
            例えば、
            <pre class="lang-css highlight">a<c- p>,</c-> b <c- p>{</c->
  &amp; c <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
</pre>
            <p>は次と等価です</p>
            <pre class="lang-css highlight"><c- nf>:is</c-><c- p>(</c->a<c- p>,</c-> b<c- p>)</c-> c <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
</pre>
        </div>
        <p><a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector⑦">ネストセレクタ</a>は
            疑似要素を表すことはできません
            （これは <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/selectors-4/#matches-pseudo"
                id="ref-for-matches-pseudo①">:is()</a>
            疑似クラスの挙動と同じです）。</p>
        <div class="example" id="example-7145ff1e">
            <a class="self-link" href="#example-7145ff1e"></a> 例えば、次のスタイル規則では：
            <pre class="lang-css highlight">.foo<c- p>,</c-> .foo::before<c- p>,</c-> .foo::after <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->

  &amp;:hover <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
</pre>
            <p>アンパサンド（<a class="css" data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-⑨">&amp;</a>）は
                <span class="css">.foo</span> にマッチする要素のみを表します;
                言い換えれば、次と等価です：
            </p>
            <pre class="lang-css highlight">.foo<c- p>,</c-> .foo::before<c- p>,</c-> .foo::after <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->
<c- p>}</c->
.foo:hover <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> blue<c- p>;</c->
<c- p>}</c->
</pre>
        </div>
        <p class="issue" id="issue-62c479a8"><a class="self-link" href="#issue-62c479a8"></a> この制限を緩和したいと考えていますが、
            <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/selectors-4/#matches-pseudo"
                id="ref-for-matches-pseudo②">:is()</a> と <a class="css" data-link-type="maybe" href="#selectordef-"
                id="ref-for-selectordef-①⓪">&amp;</a> の両方を同時に扱う必要があるため、
            それらは同じ内部メカニズムに基づいて意図的に構築されています。
            （<a href="https://github.com/w3c/csswg-drafts/issues/7433">Issue 7433</a>）
        </p>
        <p><a data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#specificity"
                id="ref-for-specificity">特異性</a>は、<a data-link-type="dfn" href="#nesting-selector"
                id="ref-for-nesting-selector⑧">ネストセレクタ</a>のものは、
            親スタイル規則のセレクタリスト内の複合セレクタ群のうち最大の特異性に等しいです
            （これは <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/selectors-4/#matches-pseudo"
                id="ref-for-matches-pseudo③">:is()</a> の挙動と同じです）、
            もしそのようなセレクタリストが存在しない場合は 0 になります。</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/top-level-parent-pseudo-specificity.html"
                        title="css/css-nesting/top-level-parent-pseudo-specificity.html">top-level-parent-pseudo-specificity.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/top-level-parent-pseudo-specificity.html"><small>（ライブテスト）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/top-level-parent-pseudo-specificity.html"><small>（ソース）</small></a>
            </ul>
        </details>
        <div class="example" id="example-a71fa710">
            <a class="self-link" href="#example-a71fa710"></a> 例えば、次のスタイル規則が与えられた場合：
            <pre class="lang-css highlight">#a<c- p>,</c-> b <c- p>{</c->
  &amp; c <c- p>{</c-> <c- k>color</c-><c- p>:</c-> blue<c- p>;</c-> <c- p>}</c->
<c- p>}</c->
.foo c <c- p>{</c-> <c- k>color</c-><c- p>:</c-> red<c- p>;</c-> <c- p>}</c->
</pre>
            <p>次のような DOM 構造では</p>
            <pre class="lang-html highlight"><c- p>&lt;</c-><c- f>b</c-> <c- e>class</c-><c- o>=</c-><c- s>foo</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>c</c-><c- p>></c->Blue text<c- p>&lt;/</c-><c- f>c</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>b</c-><c- p>></c->
</pre>
            <p>テキストは赤ではなく青になります。
                <a class="css" data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-①①">&amp;</a> の特異性は
                <span class="css">#a</span>（[1,0,0]）と <span class="css">b</span>（[0,0,1]）のうち大きい方であり、
                したがって [1,0,0] になり、
                全体の <span class="css">&amp; c</span> セレクタの特異性は [1,0,1] となり、
                <span class="css">.foo c</span>（[0,1,1]） より大きくなります。
            </p>
            <p>注目すべきは、これはネストを手動で展開して非ネスト規則にした場合とは<em>異なる</em>結果になる点です。
                その場合、<a class="css" data-link-type="propdesc" href="https://www.w3.org/TR/css-color-4/#propdef-color"
                    id="ref-for-propdef-color③">color: blue</a>
                の宣言は <span class="css">b c</span> セレクタ（[0,0,2]）によってマッチすることになり、
                <span class="css">#a c</span>（[1,0,1]）ではありません。
            </p>
        </div>
        <details class="note">
            <summary>なぜ特異性が非ネスト規則と異なるのか？</summary>
            <p><a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector⑨">ネストセレクタ</a>は意図的に
                <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/selectors-4/#matches-pseudo"
                    id="ref-for-matches-pseudo④">:is()</a> 疑似クラスと同じ特異性ルールを使用します。
                すなわち引数の中で最大の特異性を使用し、
                実際に<em>どの</em>セレクタがマッチしたかを追跡しません。
            </p>
            <p>これはパフォーマンス上の理由で必要です;
                セレクタがマッチした方法に応じて複数の可能な特異性を持つと、
                セレクタマッチの処理が非常に複雑かつ遅くなります。</p>
            <p>それでも疑問は残ります:
                なぜ <a class="css" data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-①②">&amp;</a> を <a
                    class="css" data-link-type="maybe" href="https://www.w3.org/TR/selectors-4/#matches-pseudo"
                    id="ref-for-matches-pseudo⑤">:is()</a> に基づいて定義するのでしょうか？
                Nesting っぽい機能を持つ一部の非ブラウザ実装は
                <span class="css" id="ref-for-matches-pseudo⑥">:is()</span> にデシュガーしないことがあり、
                主にそれらは <span class="css" id="ref-for-matches-pseudo⑦">:is()</span> の導入以前に存在したためです。
                代わりに直接展開（desugar）します;
                しかしそれは重大な問題をもたらします — いくつかの（比較的一般的な）ケースで
                可能性の組み合わせが指数的に爆発し、<em>巨大な</em>セレクタを偶然生成することがあるのです。
            </p>
            <pre class="lang-css highlight">.a1<c- p>,</c-> .a2<c- p>,</c-> .a3 <c- p>{</c->
  .b1<c- p>,</c-> .b2<c- p>,</c-> .b3 <c- p>{</c->
    .c1<c- p>,</c-> .c2<c- p>,</c-> .c3 <c- p>{</c->
      ...<c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->

<c- c>/* 単純にデシュガーすると */</c->
.a1 .b1 .c1<c- p>,</c->
.a1 .b1 .c2<c- p>,</c->
.a1 .b1 .c3<c- p>,</c->
.a1 .b2 .c1<c- p>,</c->
.a1 .b2 .c2<c- p>,</c->
.a1 .b2 .c3<c- p>,</c->
.a1 .b3 .c1<c- p>,</c->
.a1 .b3 .c2<c- p>,</c->
.a1 .b3 .c3<c- p>,</c->
.a2 .b1 .c1<c- p>,</c->
.a2 .b1 .c2<c- p>,</c->
.a2 .b1 .c3<c- p>,</c->
.a2 .b2 .c1<c- p>,</c->
.a2 .b2 .c2<c- p>,</c->
.a2 .b2 .c3<c- p>,</c->
.a2 .b3 .c1<c- p>,</c->
.a2 .b3 .c2<c- p>,</c->
.a2 .b3 .c3<c- p>,</c->
.a3 .b1 .c1<c- p>,</c->
.a3 .b1 .c2<c- p>,</c->
.a3 .b1 .c3<c- p>,</c->
.a3 .b2 .c1<c- p>,</c->
.a3 .b2 .c2<c- p>,</c->
.a3 .b2 .c3<c- p>,</c->
.a3 .b3 .c1<c- p>,</c->
.a3 .b3 .c2<c- p>,</c->
.a3 .b3 .c3 <c- p>{</c->...<c- p>}</c->
</pre>
            <p>ここでは、3 レベルのネストがあり、
                各レベルに 3 つのセレクタがあるため、
                27 個の展開セレクタが生成されました。
                リストにさらにセレクタを加えたり、
                ネストのレベルを増やしたり、
                ネスト規則をより複雑にすると、
                比較的小さな規則が数メガバイト（あるいはそれ以上）のセレクタに拡張されることがあります。</p>
            <p>一部の CSS ツールはヒューリスティックにいくつかの組み合わせを破棄することで最悪ケースを回避し、
                出力を減らして「おそらく」正しい結果にしますが、
                それは UA にとって許容できる選択肢ではありません。</p>
            <p><a class="css" data-link-type="maybe" href="https://www.w3.org/TR/selectors-4/#matches-pseudo"
                    id="ref-for-matches-pseudo⑧">:is()</a> を使ったデシュガーは
                この問題を完全に排除しますが、
                その代償として特異性が多少有用性を失うことになり、
                それが妥当なトレードオフだと判断されました。</p>
        </details>
        <p><a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector①⓪">ネストセレクタ</a>は、
            親規則でマッチしていた場合に限り、<a data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#featureless"
                id="ref-for-featureless">特徴のない（featureless）</a> 要素にもマッチできます。</p>
        <p><a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector①①">ネストセレクタ</a>が<a
                data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#compound"
                id="ref-for-compound">複合セレクタ</a>内にある位置は
            振る舞いに差を与えません
            （つまり <span class="css">&amp;.foo</span> と <span class="css">.foo&amp;</span> は同じ要素にマッチします）、
            ただし既存のルールである、<a data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#type-selector"
                id="ref-for-type-selector">タイプセレクタ</a> が存在する場合は複合セレクタの先頭に来なければならない
            という規則は引き続き適用されます
            （つまり <span class="css">&amp;div</span> は不正であり、代わりに <span class="css">div&amp;</span> と書く必要があります）。</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/contextually-invalid-selectors-001.html"
                        title="css/css-nesting/contextually-invalid-selectors-001.html">contextually-invalid-selectors-001.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/contextually-invalid-selectors-001.html"><small>（ライブテスト）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/contextually-invalid-selectors-001.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/contextually-invalid-selectors-002.html"
                        title="css/css-nesting/contextually-invalid-selectors-002.html">contextually-invalid-selectors-002.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/contextually-invalid-selectors-002.html"><small>（ライブテスト）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/contextually-invalid-selectors-002.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/contextually-invalid-selectors-003.html"
                        title="css/css-nesting/contextually-invalid-selectors-003.html">contextually-invalid-selectors-003.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/contextually-invalid-selectors-003.html"><small>（ライブテスト）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/contextually-invalid-selectors-003.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/host-nesting-001.html"
                        title="css/css-nesting/host-nesting-001.html">host-nesting-001.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/host-nesting-001.html"><small>（ライブテスト）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/host-nesting-001.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/host-nesting-002.html"
                        title="css/css-nesting/host-nesting-002.html">host-nesting-002.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/host-nesting-002.html"><small>（ライブテスト）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/host-nesting-002.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/host-nesting-003.html"
                        title="css/css-nesting/host-nesting-003.html">host-nesting-003.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/host-nesting-003.html"><small>（ライブテスト）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/host-nesting-003.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/host-nesting-004.html"
                        title="css/css-nesting/host-nesting-004.html">host-nesting-004.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/host-nesting-004.html"><small>（ライブテスト）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/host-nesting-004.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/host-nesting-005.html"
                        title="css/css-nesting/host-nesting-005.html">host-nesting-005.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/host-nesting-005.html"><small>（ライブテスト）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/host-nesting-005.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nesting-type-selector.html"
                        title="css/css-nesting/nesting-type-selector.html">nesting-type-selector.html</a> <a
                        class="wpt-live"
                        href="http://wpt.live/css/css-nesting/nesting-type-selector.html"><small>（ライブテスト）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nesting-type-selector.html"><small>（ソース）</small></a>
            </ul>
        </details>
        <h2 class="heading settled" data-level="5" id="nested-declarations"><span class="secno">5. </span><span
                class="content">ネストされた宣言ルール</span><a class="self-link" href="#nested-declarations"></a></h2>
        <p>やや技術的な理由から、
            スタイル規則の内容の先頭に現れるプロパティと
            他の規則と入り混じって現れるプロパティを区別できることが重要です。</p>
        <div class="example" id="example-b6fcbb18">
            <a class="self-link" href="#example-b6fcbb18"></a> 例えば、次の二つの規則では:
            <pre class="language-css highlight">.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->
  <c- n>@media</c-> <c- p>(</c->...<c- p>)</c-> <c- p>{</c->...<c- p>}</c->
  background: blue<c- p>;</c->
<c- p>}</c->
</pre>
            <p>我々は <a class="css" data-link-type="propdesc" href="https://www.w3.org/TR/css-color-4/#propdef-color"
                    id="ref-for-propdef-color④">color: red</a>
                と <a class="css" data-link-type="propdesc"
                    href="https://www.w3.org/TR/css-backgrounds-3/#propdef-background"
                    id="ref-for-propdef-background">background: blue</a> を少し異なって扱う必要があります。
                特に、CSSOM では、
                <span class="css" id="ref-for-propdef-color⑤">color: red</span> はスタイル規則の <code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/cssom-1/#dom-cssstylerule-style" id="ref-for-dom-cssstylerule-style">style</a></code>
                属性に公開されますが、
                <span class="css" id="ref-for-propdef-background①">background: blue</span> は代わりに
                <code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-cssrules" id="ref-for-dom-cssgroupingrule-cssrules">cssRules</a></code>
                リストに表示される必要があります。
            </p>
        </div>
        <p>これを実現するために、CSS の解析はこのようなプロパティを自動的に特別な子規則でラップします。
            しかし、それらを <a data-link-type="dfn" href="https://www.w3.org/TR/css-syntax-3/#style-rule"
                id="ref-for-style-rule⑥">スタイル規則</a> として、
            <a class="css" data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-①③">&amp;</a>
            セレクタでラップすると、
            いくつか望ましくない挙動が発生します:
        </p>
        <div class="example" id="example-a4638964">
            <a class="self-link" href="#example-a4638964"></a> 例えば、次の場合:
            <pre class="language-css highlight">.foo<c- p>,</c-> .foo::before <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> red<c- p>;</c->
  &amp; <c- p>{</c->
    <c- k>background</c-><c- p>:</c-> blue<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
            <p>ネストされた規則は <a class="property css" data-link-type="property"
                    href="https://www.w3.org/TR/css-backgrounds-3/#propdef-background"
                    id="ref-for-propdef-background②">background</a> を <span class="css">.foo::before</span> 要素に適用しません。
                その理由はアンパサンド（<a class="css" data-link-type="maybe" href="#selectordef-"
                    id="ref-for-selectordef-①④">&amp;</a>）が疑似要素を表せないためです。</p>
        </div>
        <p>同様に、ネストされた非スタイル規則の子宣言は何らかの方法で <a data-link-type="dfn" href="https://drafts.csswg.org/css-syntax-3/#css-rule"
                id="ref-for-css-rule">規則</a> として公開される必要があります。
            というのも、これらの種類の規則（例えば <a class="css" data-link-type="maybe"
                href="https://www.w3.org/TR/css-conditional-3/#at-ruledef-media"
                id="ref-for-at-ruledef-media①">@media</a>）はこれまで <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/cssom-1/#dom-cssstylerule-style" id="ref-for-dom-cssstylerule-style①">style</a></code>
            プロパティを持たなかったからです。
            これらは上記と同じ問題に直面します。</p>
        <p>これらすべての問題に対処するために、
            我々は直接ネストされた連続するプロパティの列を
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-export
                id="nested-declarations-rule">ネストされた宣言規則</dfn>でラップします。
        </p>
        <p>別段の指定がない限り、
            <a data-link-type="dfn" href="#nested-declarations-rule"
                id="ref-for-nested-declarations-rule④">ネストされた宣言規則</a>は
            <a data-link-type="dfn" href="#nested-style-rule" id="ref-for-nested-style-rule①①">ネストされたスタイル規則</a>であり、
            他のスタイル規則と同一に動作します。
            それは親スタイル規則とまったく同じ要素と疑似要素にマッチし、
            同じ特異性の振る舞いを持ちます。<span class="note">（これは <a class="css" data-link-type="maybe" href="#selectordef-"
                    id="ref-for-selectordef-①⑤">&amp;</a> セレクタを持つスタイル規則と<em>類似</em>していますが、上で説明したようにやや強力です。）</span>
        </p>
        <details class="note">
            <summary>なぜ <a data-link-type="dfn" href="#nested-declarations-rule"
                    id="ref-for-nested-declarations-rule⑤">ネストされた宣言規則</a> が存在するのか？</summary>
            <p>元々は、この仕様はスタイル規則内のすべての宣言をまとめ、
                それらを規則の先頭に置かれたかのように「移動」していました。
                また生の宣言を <a data-link-type="dfn" href="#nested-group-rules"
                    id="ref-for-nested-group-rules⑥">ネストされたグループ規則</a> の中で自動的に平文のスタイル規則でラップし、
                <a class="css" data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-①⑥">&amp;</a>
                セレクタを使用していました。
            </p>
            <p>我々が <a data-link-type="dfn" href="#nested-declarations-rule"
                    id="ref-for-nested-declarations-rule⑥">ネストされた宣言規則</a> に切り替えた理由は主に二つあります。</p>
            <p>第一に、<span class="css">&amp; {...}</span> 規則を使って暗黙的に宣言を <a data-link-type="dfn" href="#nested-group-rules"
                    id="ref-for-nested-group-rules⑦">ネストされたグループ規則</a> にラップすることは挙動を変えてしまいます。
                このノートの後の例に示されるように、
                親スタイル規則が疑似要素を含む場合に破綻し、
                それがない場合でもネストされた宣言の特異性の振る舞いを変える可能性があります。
                <a data-link-type="dfn" href="#nested-declarations-rule"
                    id="ref-for-nested-declarations-rule⑦">ネストされた宣言規則</a> に切り替えることでこれらの問題を避け、
                ネストされた <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-conditional-3/#at-ruledef-media"
                    id="ref-for-at-ruledef-media②">@media</a> 等の振る舞いを
                *非ネストの* <span class="css" id="ref-for-at-ruledef-media③">@media</span> 等と同一にします。
            </p>
            <p>第二に、将来の CSS 機能（特に「ミキシン」）のいくつかの詳細は、
                宣言が自動的にスタイル規則の先頭に移動されると正しく動作しません。
                我々はそれらの宣言を他の規則との相対的な順序を保持する必要があり、
                それを CSSOM で表現するためには何らかのルールでラップする必要があります。
                単に通常の <span class="css">&amp; {...}</span> 規則を使うと前段の問題が再発するため、
                <a data-link-type="dfn" href="#nested-declarations-rule"
                    id="ref-for-nested-declarations-rule⑧">ネストされた宣言規則</a> を用いることで副作用なしにこれを可能にしています。
            </p>
        </details>
        <div class="example" id="example-cef45fb3">
            <a class="self-link" href="#example-cef45fb3"></a> 例えば、次のスタイルシート断片では:
            <pre class="language-css highlight">.foo<c- p>,</c-> .foo::before<c- p>,</c-> .foo::after <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> black<c- p>;</c->
  <c- n>@media</c-> <c- p>(</c->prefers-color-scheme: dark<c- p>)</c-> <c- p>{</c->
    &amp; <c- p>{</c->
      <c- k>color</c-><c- p>:</c-> white<c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
            <p>ダークモードのページでは、
                <span class="css">.foo</span> 要素のテキスト色は白に変わりますが、
                <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-pseudo-4/#selectordef-before"
                    id="ref-for-selectordef-before">::before</a> と <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-pseudo-4/#selectordef-after"
                    id="ref-for-selectordef-after">::after</a> 疑似要素は黒のままになります。
                その理由は <a class="css" data-link-type="maybe" href="#selectordef-" id="ref-for-selectordef-①⑦">&amp;</a>
                セレクタが疑似要素を表せないためです。
            </p>
            <p>しかし、代わりに次のように書かれていた場合:</p>
            <pre class="language-css highlight">.foo<c- p>,</c-> .foo::before<c- p>,</c-> .foo::after <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> black<c- p>;</c->
  <c- n>@media</c-> <c- p>(</c->prefers-color-scheme: dark<c- p>)</c-> <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> white<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
            <p>その場合、<a class="css" data-link-type="propdesc" href="https://www.w3.org/TR/css-color-4/#propdef-color"
                    id="ref-for-propdef-color⑥">color: white</a> は暗黙的に <a data-link-type="dfn"
                    href="#nested-declarations-rule" id="ref-for-nested-declarations-rule⑨">ネストされた宣言規則</a>でラップされ、
                その子規則は親のスタイル規則と<em>正確に</em>同じものにマッチすることが保証されるため、
                要素とその疑似要素の両方がダークモード時に白いテキストになります。</p>
        </div>
        <div class="example" id="example-c3bca626">
            <a class="self-link" href="#example-c3bca626"></a> 規則と入り混じった宣言は暗黙的に
            <a data-link-type="dfn" href="#nested-declarations-rule"
                id="ref-for-nested-declarations-rule①⓪">ネストされた宣言規則</a>でラップされ、
            それらを別のスタイル規則の一部にします。
            例えば、次の CSS が与えられたとします:
            <pre class="language-css highlight">.foo <c- p>{</c->
  <c- k>color</c-><c- p>:</c-> black<c- p>;</c->
  <c- n>@media</c-> <c- p>(</c->...<c- p>)</c-> <c- p>{</c->...<c- p>}</c->
  background: silver<c- p>;</c->
<c- p>}</c->
</pre>
            <p>もし <span class="css">.foo</span> ルールの CSSOM オブジェクトを調べると、
                その <code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/cssom-1/#dom-cssstylerule-style" id="ref-for-dom-cssstylerule-style②">style</a></code>
                属性には宣言は一つだけ入っています:
                <a class="css" data-link-type="propdesc" href="https://www.w3.org/TR/css-color-4/#propdef-color"
                    id="ref-for-propdef-color⑦">color: black</a> です。
            </p>
            <p><a class="css" data-link-type="propdesc"
                    href="https://www.w3.org/TR/css-backgrounds-3/#propdef-background"
                    id="ref-for-propdef-background③">background: silver</a> の宣言は
                暗黙的に作成された <a data-link-type="dfn" href="#nested-declarations-rule"
                    id="ref-for-nested-declarations-rule①①">ネストされた宣言の子規則</a> に見つかります、
                位置は <code
                    class="highlight">fooRule<c- p>.</c->cssRules<c- p>[</c-><c- mf>1</c-><c- p>].</c->style</code> です。
            </p>
        </div>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><span class="wpt-name">mixed-declarations-rules.html (visual test) </span><a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/mixed-declarations-rules.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nested-declarations-cssom-whitespace.html"
                        title="css/css-nesting/nested-declarations-cssom-whitespace.html">nested-declarations-cssom-whitespace.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/nested-declarations-cssom-whitespace.html"><small>（ライブテスト）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nested-declarations-cssom-whitespace.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nested-declarations-cssom.html"
                        title="css/css-nesting/nested-declarations-cssom.html">nested-declarations-cssom.html</a> <a
                        class="wpt-live"
                        href="http://wpt.live/css/css-nesting/nested-declarations-cssom.html"><small>（ライブテスト）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nested-declarations-cssom.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/nested-declarations-matching.html"
                        title="css/css-nesting/nested-declarations-matching.html">nested-declarations-matching.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/nested-declarations-matching.html"><small>（ライブテスト）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/nested-declarations-matching.html"><small>（ソース）</small></a>
            </ul>
        </details>
        <h2 class="heading settled" data-level="6" id="cssom"><span class="secno">6. </span><span
                class="content">CSSOM</span><a class="self-link" href="#cssom"></a></h2>
        <p class="note" role="note"><span class="marker">注：</span> <a data-link-type="biblio" href="#biblio-cssom-1"
                title="CSS Object Model (CSSOM)">[CSSOM-1]</a> は現在、
            <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/cssom-1/#cssstylerule" id="ref-for-cssstylerule">CSSStyleRule</a></code>
            が子規則を持てることを定義しています。
        </p>
        <p>ネストされた <a data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#relative-selector"
                id="ref-for-relative-selector⑥">相対セレクタ</a> を <a data-link-type="dfn" href="#nested-style-rule"
                id="ref-for-nested-style-rule①②">ネストされたスタイル規則</a> 内でシリアライズする際、
            そのセレクタは絶対化され、
            暗黙の <a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector①②">ネストセレクタ</a>
            が挿入されなければなりません。</p>
        <div class="example" id="example-724b564c"><a class="self-link" href="#example-724b564c"></a> 例えば、セレクタ
            <span class="css">&gt; .foo</span> は <span class="css">&amp; &gt; .foo</span> としてシリアライズされます。
        </div>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-nesting/cssom.html"
                        title="css/css-nesting/cssom.html">cssom.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/cssom.html"><small>（ライブテスト）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/cssom.html"><small>（ソース）</small></a>
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/set-selector-text.html"
                        title="css/css-nesting/set-selector-text.html">set-selector-text.html</a> <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/set-selector-text.html"><small>（ライブテスト）</small></a> <a
                        class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/set-selector-text.html"><small>（ソース）</small></a>
            </ul>
        </details>
        <h3 class="heading settled" data-level="6.1" id="the-cssnestrule"><span class="secno">6.1. </span><span
                class="content">The <code
                    class="idl"><a data-link-type="idl" href="#cssnesteddeclarations" id="ref-for-cssnesteddeclarations">CSSNestedDeclarations</a></code>
                Interface</span><a class="self-link" href="#the-cssnestrule"></a></h3>
        <p>The <code
                class="idl"><a data-link-type="idl" href="#cssnesteddeclarations" id="ref-for-cssnesteddeclarations①">CSSNestedDeclarations</a></code>
            interface は <a data-link-type="dfn" href="#nested-declarations-rule"
                id="ref-for-nested-declarations-rule①②">ネストされた宣言規則</a> を表します。</p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="cssnesteddeclarations"><code class="highlight"><c- g>CSSNestedDeclarations</c-></code></dfn> : <a data-link-type="idl-name" href="https://www.w3.org/TR/cssom-1/#cssrule" id="ref-for-cssrule"><c- n>CSSRule</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#PutForwards" id="ref-for-PutForwards"><c- g>PutForwards</c-></a>=<a class="idl-code" data-link-type="attribute"><c- n>cssText</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://drafts.csswg.org/cssom-1/#cssstyleproperties" id="ref-for-cssstyleproperties"><c- n>CSSStyleProperties</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="CSSStyleProperties" href="#dom-cssnesteddeclarations-style" id="ref-for-dom-cssnesteddeclarations-style"><c- g>style</c-></a>;
};
</pre>
        <div class="algorithm" data-algorithm="style" data-algorithm-for="CSSNestedDeclarations">
            The <dfn class="dfn-paneled idl-code" data-dfn-for="CSSNestedDeclarations" data-dfn-type="attribute"
                data-export id="dom-cssnesteddeclarations-style"><code class="highlight">style</code></dfn> attribute
            はルールのための <code
                class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-1/#cssstyleproperties" id="ref-for-cssstyleproperties①">CSSStyleProperties</a></code>
            オブジェクトを返さなければならず、次のプロパティを持ちます:
            <dl>
                <dt data-md><a data-link-type="dfn"
                        href="https://www.w3.org/TR/cssom-1/#cssstyledeclaration-computed-flag"
                        id="ref-for-cssstyledeclaration-computed-flag">computed flag</a>
                <dd data-md>
                    <p>未設定</p>
                <dt data-md><a data-link-type="dfn"
                        href="https://drafts.csswg.org/cssom-1/#cssstyledeclaration-readonly-flag"
                        id="ref-for-cssstyledeclaration-readonly-flag">readonly flag</a>
                <dd data-md>
                    <p>未設定</p>
                <dt data-md><a data-link-type="dfn"
                        href="https://www.w3.org/TR/cssom-1/#cssstyledeclaration-declarations"
                        id="ref-for-cssstyledeclaration-declarations①">declarations</a>
                <dd data-md>
                    <p>ルール内の宣言。<a data-link-type="dfn"
                            href="https://www.w3.org/TR/cssom-1/#concept-declarations-specified-order"
                            id="ref-for-concept-declarations-specified-order">指定順序</a> に従います。</p>
                <dt data-md><a data-link-type="dfn"
                        href="https://www.w3.org/TR/cssom-1/#cssstyledeclaration-parent-css-rule"
                        id="ref-for-cssstyledeclaration-parent-css-rule">parent CSS rule</a>
                <dd data-md>
                    <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>
                    </p>
                <dt data-md><a data-link-type="dfn" href="https://www.w3.org/TR/cssom-1/#cssstyledeclaration-owner-node"
                        id="ref-for-cssstyledeclaration-owner-node">owner node</a>
                <dd data-md>
                    <p>Null</p>
            </dl>
        </div>
        <p>The <code
                class="idl"><a data-link-type="idl" href="#cssnesteddeclarations" id="ref-for-cssnesteddeclarations②">CSSNestedDeclarations</a></code>
            ルールは、その <a data-link-type="dfn" href="https://www.w3.org/TR/cssom-1/#css-declaration-block"
                id="ref-for-css-declaration-block">宣言ブロック</a> が直接 <a data-link-type="dfn"
                href="https://www.w3.org/TR/cssom-1/#serialize-a-css-declaration-block"
                id="ref-for-serialize-a-css-declaration-block">シリアライズ</a>されたかのように<a data-link-type="dfn"
                href="https://www.w3.org/TR/cssom-1/#serialize-a-css-rule"
                id="ref-for-serialize-a-css-rule">シリアライズ</a>されます。</p>
        <details class="wpt-tests-block" dir="ltr" lang="en" open>
            <summary>テスト</summary>
            <ul class="wpt-tests-list">
                <li class="wpt-test"><a class="wpt-name"
                        href="https://wpt.fyi/results/css/css-nesting/serialize-group-rules-with-decls.html"
                        title="css/css-nesting/serialize-group-rules-with-decls.html">serialize-group-rules-with-decls.html</a>
                    <a class="wpt-live"
                        href="http://wpt.live/css/css-nesting/serialize-group-rules-with-decls.html"><small>（ライブテスト）</small></a>
                    <a class="wpt-source"
                        href="https://github.com/web-platform-tests/wpt/blob/master/css/css-nesting/serialize-group-rules-with-decls.html"><small>（ソース）</small></a>
            </ul>
        </details>
        <p class="note" role="note"><span class="marker">注：</span> これは、隣接する複数の <a data-link-type="dfn"
                href="#nested-declarations-rule" id="ref-for-nested-declarations-rule①③">ネストされた宣言規則</a>（例えば <code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-insertrule" id="ref-for-dom-cssgroupingrule-insertrule">insertRule</a></code>
            で作成可能）が、
            シリアライズして再解析すると単一の規則に折りたたまれることを意味します。</p>
        <h2 class="no-num heading settled" id="privacy"><span class="content">プライバシー上の考慮事項</span><a class="self-link"
                href="#privacy"></a></h2>
        <p>この仕様に関して新たなプライバシー上の考慮事項は報告されていません。</p>
        <h2 class="no-num heading settled" id="security"><span class="content">セキュリティ上の考慮事項</span><a class="self-link"
                href="#security"></a></h2>
        <p>この仕様に関して新たなセキュリティ上の考慮事項は報告されていません。</p>
        <h2 class="heading settled" data-level="7" id="changes"><span class="secno">7. </span><span
                class="content">変更点</span><a class="self-link" href="#changes"></a></h2>
        <p>2023年2月14日の作業草案（<a href="https://www.w3.org/TR/2023/WD-css-nesting-1-20230214/">Feb 14, 2023
                Working Draft</a>）以降の主な変更点:</p>
        <ul>
            <li data-md>
                <p><a class="production css" data-link-type="type"
                        href="https://www.w3.org/TR/css-cascade-6/#typedef-scope-start"
                        id="ref-for-typedef-scope-start①">&lt;scope-start></a> セレクタを持つ <a class="css"
                        data-link-type="maybe" href="https://www.w3.org/TR/css-cascade-6/#at-ruledef-scope"
                        id="ref-for-at-ruledef-scope④">@scope</a> ルールは、
                    もはやネストにおける親規則として振る舞いません。
                    （<a href="https://github.com/w3c/csswg-drafts/issues/9740">Issue 9740</a>）</p>
            <li data-md>
                <p><a data-link-type="dfn" href="#nesting-selector" id="ref-for-nesting-selector①③">ネストセレクタ</a> が
                    featureless 要素にマッチ可能であることを明確化しました。</p>
            <li data-md>
                <p><span class="css">&amp;div</span> を無効に戻しました；
                    いまや Syntax が「無限ルックアヘッド」を行えるため、
                    これを許可する必要はなくなりました。
                    加えて、これによりプリプロセッサとの衝突を避けられます。
                    （<a href="https://github.com/w3c/csswg-drafts/issues/8662">Issue 8662</a>）</p>
            <li data-md>
                <p>CSSOM が CSSStyleRule を CSSGroupingRule のサブクラスとして定義するようになったため、
                    <code class="highlight">cssRules</code> 属性と関連の仕組みについて手動で定義していた部分を削除しました。
                    （<a href="https://github.com/w3c/csswg-drafts/issues/8940">Issue 8940</a>）
                </p>
            <li data-md>
                <p>特異性に対する（暗黙の）ネストセレクタの効果を明確化しました。
                    （<a href="https://github.com/w3c/csswg-drafts/issues/9069">Issue 9069</a>）</p>
            <li data-md>
                <p>規則と入り混じった宣言（またはネストされたグループ規則内のすべての宣言）は、
                    現在自動的に <code class="highlight"><c- n>@nest</c-></code> ルールでラップされます。
                    （また <code class="highlight"><c- n>@nest</c-></code> ルールが追加されました。）
                    （<a href="https://github.com/w3c/csswg-drafts/issues/8738">Issue 8738</a>）</p>
            <li data-md>
                <p><code class="highlight"><c- n>@nest</c-></code> を <a data-link-type="dfn"
                        href="#nested-declarations-rule" id="ref-for-nested-declarations-rule①④">ネストされた宣言規則</a>
                    に置き換えました。
                    （<a href="https://github.com/w3c/csswg-drafts/issues/10234">Issue 10234</a>）</p>
            <li data-md>
                <p>Web Platform Tests のカバレッジを追加しました。</p>
        </ul>
    </main>
    <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> 適合性 (Conformance)</span><a
            class="self-link" href="#w3c-conformance"></a></h2>
    <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> 文書上の慣例</span><a class="self-link"
            href="#w3c-conventions"></a></h3>
    <p>適合要件は記述的な断言と RFC 2119 用語の組み合わせで表現されています。キーワード “MUST”,
        “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
        “RECOMMENDED”, “MAY”, および “OPTIONAL” は、本書の規範的部分において RFC 2119 に従って解釈されます。
        ただし可読性のため、これらの語は本仕様ではすべて大文字で表記されない場合があります。</p>
    <p>本仕様の本文は、非規範と明示された節、例、および注を除きすべて規範的です。<a data-link-type="biblio" href="#biblio-rfc2119"
            title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
    <p>本仕様の例は “for example” という語で導入されるか、<code class="highlight">class=<c- s>"example"</c-></code> のように規範的な本文から区別されます。
    </p>
    <div class="example" id="w3c-example">
        <a class="self-link" href="#w3c-example"></a>
        <p>これは説明的な例の例です。</p>
    </div>
    <p>説明的注記は “Note” で始まり、<code class="highlight">class=<c- s>"note"</c-></code> で示されます。</p>
    <p class="note" role="note">注：これは説明的な注記です。</p>
    <p>助言的な節は注意を喚起するために様式化された規範節であり、<code class="highlight">&lt;strong class=<c- s>"advisement"</c->></code>
        で区別されます。例えば:
        <strong class="advisement"> UAs は必ず代替のアクセシビリティ手段を提供しなければなりません。 </strong>
    </p>
    <details class="wpt-tests-block" dir="ltr" lang="en" open>
        <summary>テスト</summary>
        <p>本仕様の内容に関連するテストは、このような “Tests” ブロックに記載されることがあります。
            そのようなブロックはすべて説明的です。</p>
        <ul class="wpt-tests-list"></ul>
        <hr>
    </details>
    <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> 適合クラス</span><a
            class="self-link" href="#w3c-conformance-classes"></a></h3>
    <p>本仕様への適合は三つの適合クラスで定義されます:</p>
    <dl>
        <dt>スタイルシート
        <dd><a href="https://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS スタイルシート</a>。
        <dt>レンダラ
        <dd>スタイルシートの意味を解釈し文書をレンダリングする <a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>。
        <dt>作成ツール
        <dd>スタイルシートを書く <a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>。
    </dl>
    <p>あるスタイルシートは、本モジュールで定義された構文を使用する全ての記述が汎用 CSS 文法および各機能の文法に従って有効である場合、本仕様に適合します。</p>
    <p>レンダラは、適切な仕様に従ってスタイルシートを解釈することに加え、本仕様で定義された全ての機能を正しく解析して文書をレンダリングすることで本仕様に適合します。なお、デバイスの制約により文書を正しくレンダリングできないことは
        UA を非適合にするものではありません（例: モノクロモニタで色をレンダリングする必要はありません）。</p>
    <p>作成ツールは、スタイルシートが汎用 CSS 文法および本モジュール内の各機能の個別文法に従って構文的に正しく、かつ本モジュールのスタイルシートに関する他の適合要件を満たす場合、本仕様に適合します。</p>
    <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> 部分的実装</span><a class="self-link"
            href="#w3c-partial"></a></h3>
    <p>フォワード互換の解析規則を利用してフォールバック値を割り当てられるようにするため、CSS
        レンダラはサポートがない構文上の構成要素（アットルール、プロパティ、値、キーワード等）を無効として扱い（かつ適切に無視）しなければなりません。特に、UA
        はサポートされていないコンポーネント値を選択的に無視して、同じ複数値プロパティ宣言の中でサポートされる値だけを適用してはなりません：もし任意の値が無効と見なされるなら（サポートされない値はそう扱われるべきです）、CSS
        はその宣言全体を無視することを要求します。</p>
    <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> 不安定または独自機能の実装</span><a
            class="self-link" href="#w3c-conform-future-proofing"></a></h4>
    <p>将来の安定した CSS 機能との衝突を避けるため、CSSWG は不安定機能や独自拡張の実装に関して <a
            href="https://www.w3.org/TR/CSS/#future-proofing">ベストプラクティスに従う</a> ことを推奨します。</p>
    <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> 実験的でない実装</span><a class="self-link"
            href="#w3c-testing"></a></h3>
    <p>仕様が Candidate Recommendation に達した場合、実験的でない実装が可能になり、実装者は CR レベルの機能を仕様に従って正しく実装できると示せるならば、プレフィックスなし実装をリリースすべきです。
    </p>
    <p>CSS の相互運用性を確立・維持するため、CSS Working Group は実験的でない CSS レンダラに対して、プレフィックスなし実装をリリースする前に実装報告書（必要ならばその実装で用いたテストケース）を W3C
        に提出することを要請します。提出されたテストケースは CSS Working Group によるレビューと修正の対象となります。</p>
    <p>テストケースと実装報告書の提出に関する詳細は CSS Working Group のサイト <a
            href="https://www.w3.org/Style/CSS/Test/">https://www.w3.org/Style/CSS/Test/</a> を参照してください。質問は <a
            href="https://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>
        メーリングリストへ送ってください。</p>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本仕様で定義された用語</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#selectordef-">&amp;</a><span>, in § 4</span>
        <li><a href="#contain-the-nesting-selector">contain the nesting selector</a><span>, in § 3.1</span>
        <li><a href="#cssnesteddeclarations">CSSNestedDeclarations</a><span>, in § 6.1</span>
        <li><a href="#nested-declarations-rule">nested declarations rule</a><span>, in § 5</span>
        <li><a href="#nested-group-rules">nested group rules</a><span>, in § 3.3</span>
        <li><a href="#nested-style-rule">nested style rule</a><span>, in § 3</span>
        <li><a href="#nesting-selector">nesting selector</a><span>, in § 4</span>
        <li><a href="#nested-style-rule">nesting style rule</a><span>, in § 3</span>
        <li><a href="#dom-cssnesteddeclarations-style">style</a><span>, in § 6.1</span>
    </ul>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">参照で定義された用語</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[CSS-BACKGROUNDS-3]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="db6870d5">background</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-CASCADE-5]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="08b3934a">@layer</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-CASCADE-6]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="a308d237">&lt;scope-start></span>
                <li><span class="dfn-paneled" id="aeedf61e">@scope</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-COLOR-4]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="bcdf9b19">color</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-CONDITIONAL-3]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="4397147f">@media</span>
                <li><span class="dfn-paneled" id="a5d6c9d2">@supports</span>
                <li><span class="dfn-paneled" id="f1a41224">conditional group rule</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-CONDITIONAL-5]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="d56fefb4">@container</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-PSEUDO-4]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="70503bd6">::after</span>
                <li><span class="dfn-paneled" id="7c6f51b7">::before</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-SYNTAX-3]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="b845e85c">&lt;block-contents></span>
                <li><span class="dfn-paneled" id="f9309bf7">&lt;delim-token></span>
                <li><span class="dfn-paneled" id="a8cb81d7">&lt;rule-list></span>
                <li><span class="dfn-paneled" id="b29fecf5">at-rule</span>
                <li><span class="dfn-paneled" id="67800454">parse</span>
                <li><span class="dfn-paneled" id="4fcdc12a">rule</span>
                <li><span class="dfn-paneled" id="87d90aed">style rule</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSS-UI-4]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="1279e2aa">bar</span>
            </ul>
        <li>
            <a data-link-type="biblio">[CSSOM-1]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="0f78dbdd">CSSRule</span>
                <li><span class="dfn-paneled" id="f9bcb636">CSSStyleProperties</span>
                <li><span class="dfn-paneled" id="d293a05b">CSSStyleRule</span>
                <li><span class="dfn-paneled" id="70899879">computed flag</span>
                <li><span class="dfn-paneled" id="ff26bbb9">CSS declaration block</span>
                <li><span class="dfn-paneled" id="c6758e4f">cssRules</span>
                <li><span class="dfn-paneled" id="9852f862">declarations</span>
                <li><span class="dfn-paneled" id="3f8f9b90">insertRule(rule)</span>
                <li><span class="dfn-paneled" id="451490eb">owner node</span>
                <li><span class="dfn-paneled" id="56031446">parent CSS rule</span>
                <li><span class="dfn-paneled" id="6eabcb67">readonly flag</span>
                <li><span class="dfn-paneled" id="4bdd675c">serialize a CSS declaration block</span>
                <li><span class="dfn-paneled" id="3f2d4635">serialize a CSS rule</span>
                <li><span class="dfn-paneled" id="ec9c26d7">specified order</span>
                <li><span class="dfn-paneled" id="5f56bd13">style</span>
            </ul>
        <li>
            <a data-link-type="biblio">[SELECTORS-4]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="e94d3b11">:is()</span>
                <li><span class="dfn-paneled" id="9fca4587">:scope</span>
                <li><span class="dfn-paneled" id="c77f7ef7">:where()</span>
                <li><span class="dfn-paneled" id="b7d040a0">&lt;forgiving-selector-list></span>
                <li><span class="dfn-paneled" id="0af7e6f0">&lt;relative-selector-list></span>
                <li><span class="dfn-paneled" id="1fd14124">&lt;selector-list></span>
                <li><span class="dfn-paneled" id="cc53c5e6">combinator</span>
                <li><span class="dfn-paneled" id="31c47bc6">compound selector</span>
                <li><span class="dfn-paneled" id="003a1eca">descendant combinator</span>
                <li><span class="dfn-paneled" id="09a6f82f">featureless</span>
                <li><span class="dfn-paneled" id="09bedad5">relative selector</span>
                <li><span class="dfn-paneled" id="76e5295f">simple selector</span>
                <li><span class="dfn-paneled" id="ba72ce8f">specificity</span>
                <li><span class="dfn-paneled" id="15e81c46">type selector</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
            <ul>
                <li><span class="dfn-paneled" id="889e932f">Exposed</span>
                <li><span class="dfn-paneled" id="21ecf38f">PutForwards</span>
                <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
                <li><span class="dfn-paneled" id="4013a022">this</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">規範的参照</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css-cascade-4">[CSS-CASCADE-4]
        <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-cascade-4/"><cite>CSS Cascading and
                    Inheritance Level 4</cite></a>. 13 January 2022. CR. URL: <a
                href="https://www.w3.org/TR/css-cascade-4/">https://www.w3.org/TR/css-cascade-4/</a>
        <dt id="biblio-css-cascade-6">[CSS-CASCADE-6]
        <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-cascade-6/"><cite>CSS
                    Cascading and Inheritance Level 6</cite></a>. 6 September 2024. WD. URL: <a
                href="https://www.w3.org/TR/css-cascade-6/">https://www.w3.org/TR/css-cascade-6/</a>
        <dt id="biblio-css-color-4">[CSS-COLOR-4]
        <dd>Chris Lilley; Tab Atkins Jr.; Lea Verou. <a href="https://www.w3.org/TR/css-color-4/"><cite>CSS Color Module
                    Level 4</cite></a>. 24 April 2025. CRD. URL: <a
                href="https://www.w3.org/TR/css-color-4/">https://www.w3.org/TR/css-color-4/</a>
        <dt id="biblio-css-conditional-3">[CSS-CONDITIONAL-3]
        <dd>Chris Lilley; David Baron; Elika Etemad. <a href="https://www.w3.org/TR/css-conditional-3/"><cite>CSS
                    Conditional Rules Module Level 3</cite></a>. 15 August 2024. CRD. URL: <a
                href="https://www.w3.org/TR/css-conditional-3/">https://www.w3.org/TR/css-conditional-3/</a>
        <dt id="biblio-css-syntax-3">[CSS-SYNTAX-3]
        <dd>Tab Atkins Jr.; Simon Sapin. <a href="https://www.w3.org/TR/css-syntax-3/"><cite>CSS Syntax Module Level
                    3</cite></a>. 24 December 2021. CRD. URL: <a
                href="https://www.w3.org/TR/css-syntax-3/">https://www.w3.org/TR/css-syntax-3/</a>
        <dt id="biblio-css21">[CSS21]
        <dd>Bert Bos; et al. <a href="https://www.w3.org/TR/CSS2/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS
                    2.1) Specification</cite></a>. 7 June 2011. REC. URL: <a
                href="https://www.w3.org/TR/CSS2/">https://www.w3.org/TR/CSS2/</a>
        <dt id="biblio-cssom-1">[CSSOM-1]
        <dd>Daniel Glazman; Emilio Cobos Álvarez. <a href="https://www.w3.org/TR/cssom-1/"><cite>CSS Object Model
                    (CSSOM)</cite></a>. 26 August 2021. WD. URL: <a
                href="https://www.w3.org/TR/cssom-1/">https://www.w3.org/TR/cssom-1/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to
                    Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-selectors-4">[SELECTORS-4]
        <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://www.w3.org/TR/selectors-4/"><cite>Selectors Level
                    4</cite></a>. 11 November 2022. WD. URL: <a
                href="https://www.w3.org/TR/selectors-4/">https://www.w3.org/TR/selectors-4/</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living
            Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">説明的参照</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-css-backgrounds-3">[CSS-BACKGROUNDS-3]
        <dd>Elika Etemad; Brad Kemper. <a href="https://www.w3.org/TR/css-backgrounds-3/"><cite>CSS Backgrounds and
                    Borders Module Level 3</cite></a>. 11 March 2024. CRD. URL: <a
                href="https://www.w3.org/TR/css-backgrounds-3/">https://www.w3.org/TR/css-backgrounds-3/</a>
        <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
        <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-cascade-5/"><cite>CSS
                    Cascading and Inheritance Level 5</cite></a>. 13 January 2022. CR. URL: <a
                href="https://www.w3.org/TR/css-cascade-5/">https://www.w3.org/TR/css-cascade-5/</a>
        <dt id="biblio-css-conditional-5">[CSS-CONDITIONAL-5]
        <dd>Chris Lilley; et al. <a href="https://www.w3.org/TR/css-conditional-5/"><cite>CSS Conditional Rules Module
                    Level 5</cite></a>. 30 October 2025. WD. URL: <a
                href="https://www.w3.org/TR/css-conditional-5/">https://www.w3.org/TR/css-conditional-5/</a>
        <dt id="biblio-css-pseudo-4">[CSS-PSEUDO-4]
        <dd>Elika Etemad; Alan Stearns. <a href="https://www.w3.org/TR/css-pseudo-4/"><cite>CSS Pseudo-Elements Module
                    Level 4</cite></a>. 27 June 2025. WD. URL: <a
                href="https://www.w3.org/TR/css-pseudo-4/">https://www.w3.org/TR/css-pseudo-4/</a>
        <dt id="biblio-css-ui-4">[CSS-UI-4]
        <dd>Tab Atkins Jr.; Florian Rivoal. <a href="https://www.w3.org/TR/css-ui-4/"><cite>CSS Basic User Interface
                    Module Level 4</cite></a>. 20 January 2026. WD. URL: <a
                href="https://www.w3.org/TR/css-ui-4/">https://www.w3.org/TR/css-ui-4/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL 索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#cssnesteddeclarations"><code class="highlight"><c- g>CSSNestedDeclarations</c-></code></a> : <a data-link-type="idl-name" href="https://www.w3.org/TR/cssom-1/#cssrule"><c- n>CSSRule</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#PutForwards"><c- g>PutForwards</c-></a>=<a class="idl-code" data-link-type="attribute"><c- n>cssText</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://drafts.csswg.org/cssom-1/#cssstyleproperties"><c- n>CSSStyleProperties</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="CSSStyleProperties" href="#dom-cssnesteddeclarations-style"><c- g>style</c-></a>;
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">問題索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> 前の段落は <a class="css" data-link-type="maybe" href="#selectordef-">&amp;</a> 自体を Selectors
            に移動するときに Selectors 側に移す必要があります。ここでは便宜上モンキーパッチしています。 <a class="issue-return" href="#issue-03f974e2"
                title="Jump to section">↵</a></div>
        <div class="issue"> 我々はこの制限を緩和したいと考えていますが、
            <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/selectors-4/#matches-pseudo">:is()</a> と
            <a class="css" data-link-type="maybe" href="#selectordef-">&amp;</a> の両方を同時に扱う必要があるため、
            それらは意図的に同じ基礎的メカニズムに基づいて構築されています。
            （<a href="https://github.com/w3c/csswg-drafts/issues/7433">Issue 7433</a>） <a class="issue-return"
                href="#issue-62c479a8" title="Jump to section">↵</a>
        </div>
    </div>
    <script>/* Boilerplate: script-dom-helper */
        "use strict";
        function query(sel) { return document.querySelector(sel); }

        function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

        function iter(obj) {
            if (!obj) return [];
            var it = obj[Symbol.iterator];
            if (it) return it;
            return Object.entries(obj);
        }

        function mk(tagname, attrs, ...children) {
            const el = document.createElement(tagname);
            for (const [k, v] of iter(attrs)) {
                if (k.slice(0, 3) == "_on") {
                    const eventName = k.slice(3);
                    el.addEventListener(eventName, v);
                } else if (k[0] == "_") {
                    // property, not attribute
                    el[k.slice(1)] = v;
                } else {
                    if (v === false || v == null) {
                        continue;
                    } else if (v === true) {
                        el.setAttribute(k, "");
                        continue;
                    } else {
                        el.setAttribute(k, v);
                    }
                }
            }
            append(el, children);
            return el;
        }

        /* Create shortcuts for every known HTML element */
        [
            "a",
            "abbr",
            "acronym",
            "address",
            "applet",
            "area",
            "article",
            "aside",
            "audio",
            "b",
            "base",
            "basefont",
            "bdo",
            "big",
            "blockquote",
            "body",
            "br",
            "button",
            "canvas",
            "caption",
            "center",
            "cite",
            "code",
            "col",
            "colgroup",
            "datalist",
            "dd",
            "del",
            "details",
            "dfn",
            "dialog",
            "div",
            "dl",
            "dt",
            "em",
            "embed",
            "fieldset",
            "figcaption",
            "figure",
            "font",
            "footer",
            "form",
            "frame",
            "frameset",
            "head",
            "header",
            "h1",
            "h2",
            "h3",
            "h4",
            "h5",
            "h6",
            "hr",
            "html",
            "i",
            "iframe",
            "img",
            "input",
            "ins",
            "kbd",
            "label",
            "legend",
            "li",
            "link",
            "main",
            "map",
            "mark",
            "meta",
            "meter",
            "nav",
            "nobr",
            "noscript",
            "object",
            "ol",
            "optgroup",
            "option",
            "output",
            "p",
            "param",
            "pre",
            "progress",
            "q",
            "s",
            "samp",
            "script",
            "section",
            "select",
            "small",
            "source",
            "span",
            "strike",
            "strong",
            "style",
            "sub",
            "summary",
            "sup",
            "table",
            "tbody",
            "td",
            "template",
            "textarea",
            "tfoot",
            "th",
            "thead",
            "time",
            "title",
            "tr",
            "u",
            "ul",
            "var",
            "video",
            "wbr",
            "xmp",
        ].forEach(tagname => {
            mk[tagname] = (...args) => mk(tagname, ...args);
        });

        function* nodesFromChildList(children) {
            for (const child of children.flat(Infinity)) {
                if (child instanceof Node) {
                    yield child;
                } else {
                    yield new Text(child);
                }
            }
        }
        function append(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                if (el instanceof Node) el.appendChild(child);
                else el.push(child);
            }
            return el;
        }

        function insertAfter(el, ...children) {
            for (const child of nodesFromChildList(children)) {
                el.parentNode.insertBefore(child, el.nextSibling);
            }
            return el;
        }

        function clearContents(el) {
            el.innerHTML = "";
            return el;
        }

        function parseHTML(markup) {
            if (markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
                const doc = document.implementation.createHTMLDocument("");
                doc.documentElement.innerHTML = markup;
                return doc;
            } else {
                const el = mk.template({});
                el.innerHTML = markup;
                return el.content;
            }
        }</script>
    <script>/* Boilerplate: script-dfn-panel */
        "use strict";
        {
            let dfnPanelData = {
                "003a1eca": { "dfnID": "003a1eca", "dfnText": "descendant combinator", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-descendant-combinator" }], "title": "2. \nExplainer" }], "url": "https://www.w3.org/TR/selectors-4/#descendant-combinator" },
                "08b3934a": { "dfnID": "08b3934a", "dfnText": "@layer", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-at-ruledef-layer" }], "title": "3.3. Nesting Other At-Rules" }], "url": "https://www.w3.org/TR/css-cascade-5/#at-ruledef-layer" },
                "09a6f82f": { "dfnID": "09a6f82f", "dfnText": "featureless", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-featureless" }], "title": "4. Nesting Selector: the & selector" }], "url": "https://www.w3.org/TR/selectors-4/#featureless" },
                "09bedad5": { "dfnID": "09bedad5", "dfnText": "relative selector", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-relative-selector" }, { "id": "ref-for-relative-selector\u2460" }], "title": "3. Nesting Style Rules" }, { "refs": [{ "id": "ref-for-relative-selector\u2461" }, { "id": "ref-for-relative-selector\u2462" }, { "id": "ref-for-relative-selector\u2463" }], "title": "3.1. Syntax" }, { "refs": [{ "id": "ref-for-relative-selector\u2464" }], "title": "3.2. \nExamples" }, { "refs": [{ "id": "ref-for-relative-selector\u2465" }], "title": "6. CSSOM" }], "url": "https://www.w3.org/TR/selectors-4/#relative-selector" },
                "0af7e6f0": { "dfnID": "0af7e6f0", "dfnText": "<relative-selector-list>", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-typedef-relative-selector-list" }, { "id": "ref-for-typedef-relative-selector-list\u2460" }], "title": "3.1. Syntax" }], "url": "https://www.w3.org/TR/selectors-4/#typedef-relative-selector-list" },
                "0f78dbdd": { "dfnID": "0f78dbdd", "dfnText": "CSSRule", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-cssrule" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#cssrule" },
                "1279e2aa": { "dfnID": "1279e2aa", "dfnText": "bar", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-valdef-caret-shape-bar" }], "title": "3.1. Syntax" }], "url": "https://www.w3.org/TR/css-ui-4/#valdef-caret-shape-bar" },
                "15e81c46": { "dfnID": "15e81c46", "dfnText": "type selector", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-type-selector" }], "title": "4. Nesting Selector: the & selector" }], "url": "https://www.w3.org/TR/selectors-4/#type-selector" },
                "1fd14124": { "dfnID": "1fd14124", "dfnText": "<selector-list>", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-typedef-selector-list" }], "title": "3.1. Syntax" }], "url": "https://www.w3.org/TR/selectors-4/#typedef-selector-list" },
                "21ecf38f": { "dfnID": "21ecf38f", "dfnText": "PutForwards", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-PutForwards" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://webidl.spec.whatwg.org/#PutForwards" },
                "31c47bc6": { "dfnID": "31c47bc6", "dfnText": "compound selector", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-compound" }, { "id": "ref-for-compound\u2460" }], "title": "4. Nesting Selector: the & selector" }], "url": "https://www.w3.org/TR/selectors-4/#compound" },
                "3f2d4635": { "dfnID": "3f2d4635", "dfnText": "serialize a CSS rule", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-serialize-a-css-rule" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#serialize-a-css-rule" },
                "3f8f9b90": { "dfnID": "3f8f9b90", "dfnText": "insertRule(rule)", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-cssgroupingrule-insertrule" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-insertrule" },
                "4013a022": { "dfnID": "4013a022", "dfnText": "this", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-this" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://webidl.spec.whatwg.org/#this" },
                "4397147f": { "dfnID": "4397147f", "dfnText": "@media", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-at-ruledef-media" }], "title": "3.3. Nesting Other At-Rules" }, { "refs": [{ "id": "ref-for-at-ruledef-media\u2460" }, { "id": "ref-for-at-ruledef-media\u2461" }, { "id": "ref-for-at-ruledef-media\u2462" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "https://www.w3.org/TR/css-conditional-3/#at-ruledef-media" },
                "451490eb": { "dfnID": "451490eb", "dfnText": "owner node", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-cssstyledeclaration-owner-node" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-owner-node" },
                "4bdd675c": { "dfnID": "4bdd675c", "dfnText": "serialize a CSS declaration block", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-serialize-a-css-declaration-block" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#serialize-a-css-declaration-block" },
                "4fcdc12a": { "dfnID": "4fcdc12a", "dfnText": "rule", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-css-rule" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "https://drafts.csswg.org/css-syntax-3/#css-rule" },
                "56031446": { "dfnID": "56031446", "dfnText": "parent CSS rule", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-cssstyledeclaration-parent-css-rule" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-parent-css-rule" },
                "5f56bd13": { "dfnID": "5f56bd13", "dfnText": "style", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-cssstylerule-style" }, { "id": "ref-for-dom-cssstylerule-style\u2460" }, { "id": "ref-for-dom-cssstylerule-style\u2461" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "https://www.w3.org/TR/cssom-1/#dom-cssstylerule-style" },
                "67800454": { "dfnID": "67800454", "dfnText": "parse", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-css-parse-something-according-to-a-css-grammar" }], "title": "3.1. Syntax" }], "url": "https://www.w3.org/TR/css-syntax-3/#css-parse-something-according-to-a-css-grammar" },
                "6eabcb67": { "dfnID": "6eabcb67", "dfnText": "readonly flag", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-cssstyledeclaration-readonly-flag" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://drafts.csswg.org/cssom-1/#cssstyledeclaration-readonly-flag" },
                "70503bd6": { "dfnID": "70503bd6", "dfnText": "::after", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-selectordef-after" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "https://www.w3.org/TR/css-pseudo-4/#selectordef-after" },
                "70899879": { "dfnID": "70899879", "dfnText": "computed flag", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-cssstyledeclaration-computed-flag" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-computed-flag" },
                "76e5295f": { "dfnID": "76e5295f", "dfnText": "simple selector", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-simple" }], "title": "3.1. Syntax" }], "url": "https://www.w3.org/TR/selectors-4/#simple" },
                "7c6f51b7": { "dfnID": "7c6f51b7", "dfnText": "::before", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-selectordef-before" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "https://www.w3.org/TR/css-pseudo-4/#selectordef-before" },
                "87d90aed": { "dfnID": "87d90aed", "dfnText": "style rule", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-style-rule" }], "title": "3.1. Syntax" }, { "refs": [{ "id": "ref-for-style-rule\u2460" }, { "id": "ref-for-style-rule\u2461" }, { "id": "ref-for-style-rule\u2462" }, { "id": "ref-for-style-rule\u2463" }, { "id": "ref-for-style-rule\u2464" }], "title": "3.3. Nesting Other At-Rules" }, { "refs": [{ "id": "ref-for-style-rule\u2465" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "https://www.w3.org/TR/css-syntax-3/#style-rule" },
                "889e932f": { "dfnID": "889e932f", "dfnText": "Exposed", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-Exposed" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "9852f862": { "dfnID": "9852f862", "dfnText": "declarations", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-cssstyledeclaration-declarations" }], "title": "3.1. Syntax" }, { "refs": [{ "id": "ref-for-cssstyledeclaration-declarations\u2460" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-declarations" },
                "9fca4587": { "dfnID": "9fca4587", "dfnText": ":scope", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-scope-pseudo" }], "title": "4. Nesting Selector: the & selector" }], "url": "https://www.w3.org/TR/selectors-4/#scope-pseudo" },
                "a308d237": { "dfnID": "a308d237", "dfnText": "<scope-start>", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-typedef-scope-start" }], "title": "3.3.1. \nNested @scope Rules" }, { "refs": [{ "id": "ref-for-typedef-scope-start\u2460" }], "title": "7. Changes" }], "url": "https://www.w3.org/TR/css-cascade-6/#typedef-scope-start" },
                "a5c91173": { "dfnID": "a5c91173", "dfnText": "SameObject", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-SameObject" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://webidl.spec.whatwg.org/#SameObject" },
                "a5d6c9d2": { "dfnID": "a5d6c9d2", "dfnText": "@supports", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-at-ruledef-supports" }], "title": "3.3. Nesting Other At-Rules" }], "url": "https://www.w3.org/TR/css-conditional-3/#at-ruledef-supports" },
                "a8cb81d7": { "dfnID": "a8cb81d7", "dfnText": "<rule-list>", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-typedef-rule-list" }], "title": "3.3. Nesting Other At-Rules" }], "url": "https://www.w3.org/TR/css-syntax-3/#typedef-rule-list" },
                "aeedf61e": { "dfnID": "aeedf61e", "dfnText": "@scope", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-at-ruledef-scope" }], "title": "3.3. Nesting Other At-Rules" }, { "refs": [{ "id": "ref-for-at-ruledef-scope\u2460" }, { "id": "ref-for-at-ruledef-scope\u2461" }, { "id": "ref-for-at-ruledef-scope\u2462" }], "title": "3.3.1. \nNested @scope Rules" }, { "refs": [{ "id": "ref-for-at-ruledef-scope\u2463" }], "title": "7. Changes" }], "url": "https://www.w3.org/TR/css-cascade-6/#at-ruledef-scope" },
                "b29fecf5": { "dfnID": "b29fecf5", "dfnText": "at-rule", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-at-rule" }], "title": "3.1. Syntax" }], "url": "https://www.w3.org/TR/css-syntax-3/#at-rule" },
                "b7d040a0": { "dfnID": "b7d040a0", "dfnText": "<forgiving-selector-list>", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-typedef-forgiving-selector-list" }], "title": "3.1. Syntax" }], "url": "https://www.w3.org/TR/selectors-4/#typedef-forgiving-selector-list" },
                "b845e85c": { "dfnID": "b845e85c", "dfnText": "<block-contents>", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-typedef-block-contents" }], "title": "3.3. Nesting Other At-Rules" }], "url": "https://drafts.csswg.org/css-syntax-3/#typedef-block-contents" },
                "ba72ce8f": { "dfnID": "ba72ce8f", "dfnText": "specificity", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-specificity" }], "title": "4. Nesting Selector: the & selector" }], "url": "https://www.w3.org/TR/selectors-4/#specificity" },
                "bcdf9b19": { "dfnID": "bcdf9b19", "dfnText": "color", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-propdef-color" }, { "id": "ref-for-propdef-color\u2460" }, { "id": "ref-for-propdef-color\u2461" }], "title": "3.4. Mixing Nesting Rules and Declarations" }, { "refs": [{ "id": "ref-for-propdef-color\u2462" }], "title": "4. Nesting Selector: the & selector" }, { "refs": [{ "id": "ref-for-propdef-color\u2463" }, { "id": "ref-for-propdef-color\u2464" }, { "id": "ref-for-propdef-color\u2465" }, { "id": "ref-for-propdef-color\u2466" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "https://www.w3.org/TR/css-color-4/#propdef-color" },
                "c6758e4f": { "dfnID": "c6758e4f", "dfnText": "cssRules", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-dom-cssgroupingrule-cssrules" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-cssrules" },
                "c77f7ef7": { "dfnID": "c77f7ef7", "dfnText": ":where()", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-where-pseudo" }], "title": "3.4. Mixing Nesting Rules and Declarations" }], "url": "https://www.w3.org/TR/selectors-4/#where-pseudo" },
                "cc53c5e6": { "dfnID": "cc53c5e6", "dfnText": "combinator", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-selector-combinator" }], "title": "3.1. Syntax" }], "url": "https://www.w3.org/TR/selectors-4/#selector-combinator" },
                "contain-the-nesting-selector": { "dfnID": "contain-the-nesting-selector", "dfnText": "contain the nesting selector", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-contain-the-nesting-selector" }, { "id": "ref-for-contain-the-nesting-selector\u2460" }, { "id": "ref-for-contain-the-nesting-selector\u2461" }], "title": "3.1. Syntax" }], "url": "#contain-the-nesting-selector" },
                "cssnesteddeclarations": { "dfnID": "cssnesteddeclarations", "dfnText": "CSSNestedDeclarations", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-cssnesteddeclarations" }, { "id": "ref-for-cssnesteddeclarations\u2460" }, { "id": "ref-for-cssnesteddeclarations\u2461" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "#cssnesteddeclarations" },
                "d293a05b": { "dfnID": "d293a05b", "dfnText": "CSSStyleRule", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-cssstylerule" }], "title": "6. CSSOM" }], "url": "https://www.w3.org/TR/cssom-1/#cssstylerule" },
                "d56fefb4": { "dfnID": "d56fefb4", "dfnText": "@container", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-at-ruledef-container" }], "title": "3.3. Nesting Other At-Rules" }], "url": "https://www.w3.org/TR/css-conditional-5/#at-ruledef-container" },
                "db6870d5": { "dfnID": "db6870d5", "dfnText": "background", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-propdef-background" }, { "id": "ref-for-propdef-background\u2460" }, { "id": "ref-for-propdef-background\u2461" }, { "id": "ref-for-propdef-background\u2462" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "https://www.w3.org/TR/css-backgrounds-3/#propdef-background" },
                "dom-cssnesteddeclarations-style": { "dfnID": "dom-cssnesteddeclarations-style", "dfnText": "style", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-dom-cssnesteddeclarations-style" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "#dom-cssnesteddeclarations-style" },
                "e94d3b11": { "dfnID": "e94d3b11", "dfnText": ":is()", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-matches-pseudo" }, { "id": "ref-for-matches-pseudo\u2460" }, { "id": "ref-for-matches-pseudo\u2461" }, { "id": "ref-for-matches-pseudo\u2462" }, { "id": "ref-for-matches-pseudo\u2463" }, { "id": "ref-for-matches-pseudo\u2464" }, { "id": "ref-for-matches-pseudo\u2465" }, { "id": "ref-for-matches-pseudo\u2466" }, { "id": "ref-for-matches-pseudo\u2467" }], "title": "4. Nesting Selector: the & selector" }], "url": "https://www.w3.org/TR/selectors-4/#matches-pseudo" },
                "ec9c26d7": { "dfnID": "ec9c26d7", "dfnText": "specified order", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-concept-declarations-specified-order" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#concept-declarations-specified-order" },
                "f1a41224": { "dfnID": "f1a41224", "dfnText": "conditional group rule", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-conditional-group-rule" }], "title": "3.3. Nesting Other At-Rules" }], "url": "https://www.w3.org/TR/css-conditional-3/#conditional-group-rule" },
                "f9309bf7": { "dfnID": "f9309bf7", "dfnText": "<delim-token>", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-typedef-delim-token" }], "title": "3.1. Syntax" }], "url": "https://www.w3.org/TR/css-syntax-3/#typedef-delim-token" },
                "f9bcb636": { "dfnID": "f9bcb636", "dfnText": "CSSStyleProperties", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-cssstyleproperties" }, { "id": "ref-for-cssstyleproperties\u2460" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://drafts.csswg.org/cssom-1/#cssstyleproperties" },
                "ff26bbb9": { "dfnID": "ff26bbb9", "dfnText": "CSS declaration block", "external": true, "refSections": [{ "refs": [{ "id": "ref-for-css-declaration-block" }], "title": "6.1. The CSSNestedDeclarations Interface" }], "url": "https://www.w3.org/TR/cssom-1/#css-declaration-block" },
                "nested-declarations-rule": { "dfnID": "nested-declarations-rule", "dfnText": "nested declarations rule", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-nested-declarations-rule" }, { "id": "ref-for-nested-declarations-rule\u2460" }], "title": "3.3. Nesting Other At-Rules" }, { "refs": [{ "id": "ref-for-nested-declarations-rule\u2461" }, { "id": "ref-for-nested-declarations-rule\u2462" }], "title": "3.4. Mixing Nesting Rules and Declarations" }, { "refs": [{ "id": "ref-for-nested-declarations-rule\u2463" }, { "id": "ref-for-nested-declarations-rule\u2464" }, { "id": "ref-for-nested-declarations-rule\u2465" }, { "id": "ref-for-nested-declarations-rule\u2466" }, { "id": "ref-for-nested-declarations-rule\u2467" }, { "id": "ref-for-nested-declarations-rule\u2468" }, { "id": "ref-for-nested-declarations-rule\u2460\u24ea" }, { "id": "ref-for-nested-declarations-rule\u2460\u2460" }], "title": "5. \nThe Nested Declarations Rule" }, { "refs": [{ "id": "ref-for-nested-declarations-rule\u2460\u2461" }, { "id": "ref-for-nested-declarations-rule\u2460\u2462" }], "title": "6.1. The CSSNestedDeclarations Interface" }, { "refs": [{ "id": "ref-for-nested-declarations-rule\u2460\u2463" }], "title": "7. Changes" }], "url": "#nested-declarations-rule" },
                "nested-group-rules": { "dfnID": "nested-group-rules", "dfnText": "nested group rules", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-nested-group-rules" }, { "id": "ref-for-nested-group-rules\u2460" }, { "id": "ref-for-nested-group-rules\u2461" }], "title": "3.3. Nesting Other At-Rules" }, { "refs": [{ "id": "ref-for-nested-group-rules\u2462" }], "title": "3.3.1. \nNested @scope Rules" }, { "refs": [{ "id": "ref-for-nested-group-rules\u2463" }, { "id": "ref-for-nested-group-rules\u2464" }], "title": "3.4. Mixing Nesting Rules and Declarations" }, { "refs": [{ "id": "ref-for-nested-group-rules\u2465" }, { "id": "ref-for-nested-group-rules\u2466" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "#nested-group-rules" },
                "nested-style-rule": { "dfnID": "nested-style-rule", "dfnText": "nested style rules", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-nested-style-rule" }], "title": "3. Nesting Style Rules" }, { "refs": [{ "id": "ref-for-nested-style-rule\u2460" }, { "id": "ref-for-nested-style-rule\u2461" }, { "id": "ref-for-nested-style-rule\u2462" }, { "id": "ref-for-nested-style-rule\u2463" }], "title": "3.1. Syntax" }, { "refs": [{ "id": "ref-for-nested-style-rule\u2464" }, { "id": "ref-for-nested-style-rule\u2465" }], "title": "3.3. Nesting Other At-Rules" }, { "refs": [{ "id": "ref-for-nested-style-rule\u2466" }, { "id": "ref-for-nested-style-rule\u2467" }], "title": "3.4. Mixing Nesting Rules and Declarations" }, { "refs": [{ "id": "ref-for-nested-style-rule\u2468" }, { "id": "ref-for-nested-style-rule\u2460\u24ea" }], "title": "4. Nesting Selector: the & selector" }, { "refs": [{ "id": "ref-for-nested-style-rule\u2460\u2460" }], "title": "5. \nThe Nested Declarations Rule" }, { "refs": [{ "id": "ref-for-nested-style-rule\u2460\u2461" }], "title": "6. CSSOM" }], "url": "#nested-style-rule" },
                "nesting-selector": { "dfnID": "nesting-selector", "dfnText": "nesting selector", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-nesting-selector" }], "title": "3. Nesting Style Rules" }, { "refs": [{ "id": "ref-for-nesting-selector\u2460" }, { "id": "ref-for-nesting-selector\u2461" }], "title": "3.1. Syntax" }, { "refs": [{ "id": "ref-for-nesting-selector\u2462" }], "title": "3.3. Nesting Other At-Rules" }, { "refs": [{ "id": "ref-for-nesting-selector\u2463" }], "title": "3.4. Mixing Nesting Rules and Declarations" }, { "refs": [{ "id": "ref-for-nesting-selector\u2464" }, { "id": "ref-for-nesting-selector\u2465" }, { "id": "ref-for-nesting-selector\u2466" }, { "id": "ref-for-nesting-selector\u2467" }, { "id": "ref-for-nesting-selector\u2468" }, { "id": "ref-for-nesting-selector\u2460\u24ea" }, { "id": "ref-for-nesting-selector\u2460\u2460" }], "title": "4. Nesting Selector: the & selector" }, { "refs": [{ "id": "ref-for-nesting-selector\u2460\u2461" }], "title": "6. CSSOM" }, { "refs": [{ "id": "ref-for-nesting-selector\u2460\u2462" }], "title": "7. Changes" }], "url": "#nesting-selector" },
                "selectordef-": { "dfnID": "selectordef-", "dfnText": "&", "external": false, "refSections": [{ "refs": [{ "id": "ref-for-selectordef-" }, { "id": "ref-for-selectordef-\u2460" }, { "id": "ref-for-selectordef-\u2461" }, { "id": "ref-for-selectordef-\u2462" }], "title": "2. \nExplainer" }, { "refs": [{ "id": "ref-for-selectordef-\u2463" }, { "id": "ref-for-selectordef-\u2464" }], "title": "3.1. Syntax" }, { "refs": [{ "id": "ref-for-selectordef-\u2465" }, { "id": "ref-for-selectordef-\u2466" }], "title": "3.3.1. \nNested @scope Rules" }, { "refs": [{ "id": "ref-for-selectordef-\u2467" }, { "id": "ref-for-selectordef-\u2468" }, { "id": "ref-for-selectordef-\u2460\u24ea" }, { "id": "ref-for-selectordef-\u2460\u2460" }, { "id": "ref-for-selectordef-\u2460\u2461" }], "title": "4. Nesting Selector: the & selector" }, { "refs": [{ "id": "ref-for-selectordef-\u2460\u2462" }, { "id": "ref-for-selectordef-\u2460\u2463" }, { "id": "ref-for-selectordef-\u2460\u2464" }, { "id": "ref-for-selectordef-\u2460\u2465" }, { "id": "ref-for-selectordef-\u2460\u2466" }], "title": "5. \nThe Nested Declarations Rule" }], "url": "#selectordef-" },
            };

            document.addEventListener("DOMContentLoaded", () => {
                genAllDfnPanels();

                document.body.addEventListener("click", (e) => {
                    // If not handled already, just hide all dfn panels.
                    hideAllDfnPanels();
                });
            });

            window.addEventListener("resize", () => {
                // Pin any visible dfn panel
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el => positionDfnPanel(el));
            });

            function genAllDfnPanels() {
                for (const panelData of Object.values(dfnPanelData)) {
                    const dfnID = panelData.dfnID;
                    const dfn = document.getElementById(dfnID);
                    if (!dfn) {
                        console.log(`Can't find dfn#${dfnID}.`, panelData);
                        continue;
                    }
                    dfn.panelData = panelData;
                    insertDfnPopupAction(dfn);
                }
            }

            function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
                const dfnPanel = mk.aside({
                    class: "dfn-panel on",
                    id: `infopanel-for-${dfnID}`,
                    "data-for": dfnID,
                    "aria-labelled-by": `infopaneltitle-for-${dfnID}`,
                },
                    mk.span({ id: `infopaneltitle-for-${dfnID}`, style: "display:none" },
                        `Info about the '${dfnText}' ${external ? "external" : ""} reference.`),
                    mk.a({ href: url, class: "dfn-link" }, url),
                    refSections.length == 0 ? [] :
                        mk.b({}, "Referenced in:"),
                    mk.ul({},
                        ...refSections.map(section =>
                            mk.li({},
                                ...section.refs.map((ref, refI) =>
                                    [
                                        mk.a({ href: `#${ref.id}` },
                                            (refI == 0) ? section.title : `(${refI + 1})`
                                        ),
                                        " ",
                                    ]
                                ),
                            ),
                        ),
                    ),
                    genLinkingSyntaxes(dfn),
                );

                dfnPanel.addEventListener('click', (event) => {
                    if (event.target.nodeName == 'A') {
                        scrollToTargetAndHighlight(event);
                        pinDfnPanel(dfnPanel);
                    }
                    event.stopPropagation();
                    refocusOnTarget(event);
                });
                dfnPanel.addEventListener('keydown', (event) => {
                    if (event.keyCode == 27) { // Escape key
                        hideDfnPanel({ dfnPanel });
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });

                dfnPanel.dfn = dfn;
                dfn.dfnPanel = dfnPanel;
                return dfnPanel;
            }



            function hideAllDfnPanels() {
                // Delete the currently-active dfn panel.
                queryAll(".dfn-panel").forEach(dfnPanel => hideDfnPanel({ dfnPanel }));
            }

            function showDfnPanel(dfn) {
                hideAllDfnPanels(); // Only display one at a time.

                dfn.setAttribute("aria-expanded", "true");

                const dfnPanel = genDfnPanel(dfn, dfn.panelData);

                // Give the dfn a unique tabindex, and then
                // give all the tabbable panel bits successive indexes.
                let tabIndex = 100;
                dfn.tabIndex = tabIndex++;
                const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
                for (const el of tabbable) {
                    el.tabIndex = tabIndex++;
                }

                append(document.body, dfnPanel);
                positionDfnPanel(dfnPanel);
            }

            function positionDfnPanel(dfnPanel) {
                const dfn = dfnPanel.dfn;
                const dfnPos = getBounds(dfn);
                dfnPanel.style.top = dfnPos.bottom + "px";
                dfnPanel.style.left = dfnPos.left + "px";

                const panelPos = dfnPanel.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
                    dfnPanel.style.left = newLeft + "px";
                }
            }

            function pinDfnPanel(dfnPanel) {
                // Switch it to "activated" state, which pins it.
                dfnPanel.classList.add("activated");
                dfnPanel.style.position = "fixed";
                dfnPanel.style.left = null;
                dfnPanel.style.top = null;
            }

            function hideDfnPanel({ dfn, dfnPanel }) {
                if (!dfnPanel) dfnPanel = dfn.dfnPanel;
                if (!dfn) dfn = dfnPanel.dfn;
                dfn.dfnPanel = undefined;
                dfnPanel.dfn = undefined;
                dfn.setAttribute("aria-expanded", "false");
                dfn.tabIndex = undefined;
                dfnPanel.remove()
            }

            function toggleDfnPanel(dfn) {
                if (dfn.dfnPanel) {
                    hideDfnPanel(dfn);
                } else {
                    showDfnPanel(dfn);
                }
            }

            function insertDfnPopupAction(dfn) {
                dfn.setAttribute('role', 'button');
                dfn.setAttribute('aria-expanded', 'false')
                dfn.tabIndex = 0;
                dfn.classList.add('has-dfn-panel');
                dfn.addEventListener('click', (event) => {
                    toggleDfnPanel(dfn);
                    event.stopPropagation();
                });
                dfn.addEventListener('keypress', (event) => {
                    const kc = event.keyCode;
                    // 32->Space, 13->Enter
                    if (kc == 32 || kc == 13) {
                        toggleDfnPanel(dfn);
                        event.stopPropagation();
                        event.preventDefault();
                    }
                });
            }

            function refocusOnTarget(event) {
                const target = event.target;
                setTimeout(() => {
                    // Refocus on the event.target element.
                    // This is needed after browser scrolls to the destination.
                    target.focus();
                });
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function scrollToTargetAndHighlight(event) {
                let hash = event.target.hash;
                if (hash) {
                    hash = decodeURIComponent(hash.substring(1));
                    const dest = document.getElementById(hash);
                    if (dest) {
                        dest.classList.add('highlighted');
                        setTimeout(() => dest.classList.remove('highlighted'), 1000);
                    }
                }
            }

            // Functions, divided by link type, that wrap an autolink's
            // contents with the appropriate outer syntax.
            // Alternately, a string naming another type they format
            // the same as.
            function needsFor(type) {
                switch (type) {
                    case "descriptor":
                    case "value":
                    case "element-attr":
                    case "attr-value":
                    case "element-state":
                    case "method":
                    case "constructor":
                    case "argument":
                    case "attribute":
                    case "const":
                    case "dict-member":
                    case "event":
                    case "enum-value":
                    case "stringifier":
                    case "serializer":
                    case "iterator":
                    case "maplike":
                    case "setlike":
                    case "state":
                    case "mode":
                    case "context":
                    case "facet": return true;

                    default: return false;
                }
            }
            function refusesFor(type) {
                switch (type) {
                    case "property":
                    case "element":
                    case "interface":
                    case "namespace":
                    case "callback":
                    case "dictionary":
                    case "enum":
                    case "exception":
                    case "typedef":
                    case "http-header":
                    case "permission": return true;

                    default: return false;
                }
            }
            function linkFormatterFromType(type) {
                switch (type) {
                    case 'scheme':
                    case 'permission':
                    case 'dfn': return (text) => `[=${text}=]`;

                    case 'abstract-op': return (text) => `[\$${text}\$]`;

                    case 'function':
                    case 'at-rule':
                    case 'selector':
                    case 'value': return (text) => `''${text}''`;

                    case 'http-header': return (text) => `[:${text}:]`;

                    case 'interface':
                    case 'constructor':
                    case 'method':
                    case 'argument':
                    case 'attribute':
                    case 'callback':
                    case 'dictionary':
                    case 'dict-member':
                    case 'enum':
                    case 'enum-value':
                    case 'exception':
                    case 'const':
                    case 'typedef':
                    case 'stringifier':
                    case 'serializer':
                    case 'iterator':
                    case 'maplike':
                    case 'setlike':
                    case 'extended-attribute':
                    case 'event':
                    case 'idl': return (text) => `{{${text}}}`;

                    case 'element-state':
                    case 'element-attr':
                    case 'attr-value':
                    case 'element': return (element) => `<{${element}}>`;

                    case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

                    case 'type': return (text) => `<<${text}>>`;

                    case 'descriptor':
                    case 'property': return (text) => `'${text}'`;

                    default: return;
                };
            };

            function genLinkingSyntaxes(dfn) {
                if (dfn.tagName != "DFN") return;

                const type = dfn.getAttribute('data-dfn-type');
                if (!type) {
                    console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
                    return [];
                }

                // Return a function that wraps link text based on the type
                const linkFormatter = linkFormatterFromType(type);
                if (!linkFormatter) {
                    console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
                    return [];
                }

                let ltAlts;
                if (dfn.hasAttribute('data-lt')) {
                    ltAlts = dfn.getAttribute('data-lt')
                        .split("|")
                        .map(x => x.trim());
                } else {
                    ltAlts = [dfn.textContent.trim()];
                }
                if (type == "type") {
                    // lt of "<foo>", but "foo" is the interior;
                    // <<foo/bar>> is how you write it with a for,
                    // not <foo/<bar>> or whatever.
                    for (var i = 0; i < ltAlts.length; i++) {
                        const lt = ltAlts[i];
                        const match = /<(.*)>/.exec(lt);
                        if (match) { ltAlts[i] = match[1]; }
                    }
                }

                let forAlts;
                if (dfn.hasAttribute('data-dfn-for')) {
                    forAlts = dfn.getAttribute('data-dfn-for')
                        .split(",")
                        .map(x => x.trim());
                } else {
                    forAlts = [''];
                }

                let linkingSyntaxes = [];
                if (!needsFor(type)) {
                    for (const lt of ltAlts) {
                        linkingSyntaxes.push(linkFormatter(lt));
                    }
                }
                if (!refusesFor(type)) {
                    for (const f of forAlts) {
                        linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
                    }
                }
                return [
                    mk.b({}, 'Possible linking syntaxes:'),
                    mk.ul({},
                        ...linkingSyntaxes.map(link => {
                            const copyLink = async () =>
                                await navigator.clipboard.writeText(link);
                            return mk.li({},
                                mk.div({ class: 'link-item' },
                                    mk.button({
                                        class: 'copy-icon', title: 'Copy',
                                        type: 'button',
                                        _onclick: copyLink,
                                        tabindex: 0,
                                    }, mk.span({ class: 'icon' })),
                                    mk.span({}, link)
                                )
                            );
                        })
                    )
                ];
            }
        }
    </script>
    <script>/* Boilerplate: script-ref-hints */
        "use strict";
        {
            let refsData = {
                "#contain-the-nesting-selector": { "displayText": "contain the nesting selector", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "css-nesting", "spec": "css-nesting-1", "status": "local", "text": "contain the nesting selector", "type": "dfn", "url": "#contain-the-nesting-selector" },
                "#cssnesteddeclarations": { "displayText": "CSSNestedDeclarations", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "css-nesting", "spec": "css-nesting-1", "status": "local", "text": "CSSNestedDeclarations", "type": "interface", "url": "#cssnesteddeclarations" },
                "#dom-cssnesteddeclarations-style": { "displayText": "style", "export": true, "for_": ["CSSNestedDeclarations"], "level": "1", "normative": true, "shortname": "css-nesting", "spec": "css-nesting-1", "status": "local", "text": "style", "type": "attribute", "url": "#dom-cssnesteddeclarations-style" },
                "#nested-declarations-rule": { "displayText": "nested declarations rule", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "css-nesting", "spec": "css-nesting-1", "status": "local", "text": "nested declarations rule", "type": "dfn", "url": "#nested-declarations-rule" },
                "#nested-group-rules": { "displayText": "nested group rules", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "css-nesting", "spec": "css-nesting-1", "status": "local", "text": "nested group rules", "type": "dfn", "url": "#nested-group-rules" },
                "#nested-style-rule": { "displayText": "nested style rule", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "css-nesting", "spec": "css-nesting-1", "status": "local", "text": "nested style rule", "type": "dfn", "url": "#nested-style-rule" },
                "#nesting-selector": { "displayText": "nesting selector", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "css-nesting", "spec": "css-nesting-1", "status": "local", "text": "nesting selector", "type": "dfn", "url": "#nesting-selector" },
                "#selectordef-": { "displayText": "&", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "css-nesting", "spec": "css-nesting-1", "status": "local", "text": "&", "type": "selector", "url": "#selectordef-" },
                "https://drafts.csswg.org/css-syntax-3/#css-rule": { "displayText": "rule", "export": true, "for_": ["CSS"], "level": "3", "normative": true, "shortname": "css-syntax", "spec": "css-syntax-3", "status": "current", "text": "rule", "type": "dfn", "url": "https://drafts.csswg.org/css-syntax-3/#css-rule" },
                "https://drafts.csswg.org/css-syntax-3/#typedef-block-contents": { "displayText": "<block-contents>", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "css-syntax", "spec": "css-syntax-3", "status": "current", "text": "<block-contents>", "type": "type", "url": "https://drafts.csswg.org/css-syntax-3/#typedef-block-contents" },
                "https://drafts.csswg.org/cssom-1/#cssstyledeclaration-readonly-flag": { "displayText": "readonly flag", "export": true, "for_": ["CSSStyleDeclaration"], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "current", "text": "readonly flag", "type": "dfn", "url": "https://drafts.csswg.org/cssom-1/#cssstyledeclaration-readonly-flag" },
                "https://drafts.csswg.org/cssom-1/#cssstyleproperties": { "displayText": "CSSStyleProperties", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "current", "text": "CSSStyleProperties", "type": "interface", "url": "https://drafts.csswg.org/cssom-1/#cssstyleproperties" },
                "https://webidl.spec.whatwg.org/#Exposed": { "displayText": "Exposed", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "Exposed", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#Exposed" },
                "https://webidl.spec.whatwg.org/#PutForwards": { "displayText": "PutForwards", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "PutForwards", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#PutForwards" },
                "https://webidl.spec.whatwg.org/#SameObject": { "displayText": "SameObject", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "SameObject", "type": "extended-attribute", "url": "https://webidl.spec.whatwg.org/#SameObject" },
                "https://webidl.spec.whatwg.org/#this": { "displayText": "this", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "webidl", "spec": "webidl", "status": "current", "text": "this", "type": "dfn", "url": "https://webidl.spec.whatwg.org/#this" },
                "https://www.w3.org/TR/css-backgrounds-3/#propdef-background": { "displayText": "background", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "css-backgrounds", "spec": "css-backgrounds-3", "status": "snapshot", "text": "background", "type": "property", "url": "https://www.w3.org/TR/css-backgrounds-3/#propdef-background" },
                "https://www.w3.org/TR/css-cascade-5/#at-ruledef-layer": { "displayText": "@layer", "export": true, "for_": [], "level": "5", "normative": true, "shortname": "css-cascade", "spec": "css-cascade-5", "status": "snapshot", "text": "@layer", "type": "at-rule", "url": "https://www.w3.org/TR/css-cascade-5/#at-ruledef-layer" },
                "https://www.w3.org/TR/css-cascade-6/#at-ruledef-scope": { "displayText": "@scope", "export": true, "for_": [], "level": "6", "normative": true, "shortname": "css-cascade", "spec": "css-cascade-6", "status": "snapshot", "text": "@scope", "type": "at-rule", "url": "https://www.w3.org/TR/css-cascade-6/#at-ruledef-scope" },
                "https://www.w3.org/TR/css-cascade-6/#typedef-scope-start": { "displayText": "<scope-start>", "export": true, "for_": [], "level": "6", "normative": true, "shortname": "css-cascade", "spec": "css-cascade-6", "status": "snapshot", "text": "<scope-start>", "type": "type", "url": "https://www.w3.org/TR/css-cascade-6/#typedef-scope-start" },
                "https://www.w3.org/TR/css-color-4/#propdef-color": { "displayText": "color", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "css-color", "spec": "css-color-4", "status": "snapshot", "text": "color", "type": "property", "url": "https://www.w3.org/TR/css-color-4/#propdef-color" },
                "https://www.w3.org/TR/css-conditional-3/#at-ruledef-media": { "displayText": "@media", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "css-conditional", "spec": "css-conditional-3", "status": "snapshot", "text": "@media", "type": "at-rule", "url": "https://www.w3.org/TR/css-conditional-3/#at-ruledef-media" },
                "https://www.w3.org/TR/css-conditional-3/#at-ruledef-supports": { "displayText": "@supports", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "css-conditional", "spec": "css-conditional-3", "status": "snapshot", "text": "@supports", "type": "at-rule", "url": "https://www.w3.org/TR/css-conditional-3/#at-ruledef-supports" },
                "https://www.w3.org/TR/css-conditional-3/#conditional-group-rule": { "displayText": "conditional group rule", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "css-conditional", "spec": "css-conditional-3", "status": "snapshot", "text": "conditional group rule", "type": "dfn", "url": "https://www.w3.org/TR/css-conditional-3/#conditional-group-rule" },
                "https://www.w3.org/TR/css-conditional-5/#at-ruledef-container": { "displayText": "@container", "export": true, "for_": [], "level": "5", "normative": true, "shortname": "css-conditional", "spec": "css-conditional-5", "status": "snapshot", "text": "@container", "type": "at-rule", "url": "https://www.w3.org/TR/css-conditional-5/#at-ruledef-container" },
                "https://www.w3.org/TR/css-pseudo-4/#selectordef-after": { "displayText": "::after", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "css-pseudo", "spec": "css-pseudo-4", "status": "snapshot", "text": "::after", "type": "selector", "url": "https://www.w3.org/TR/css-pseudo-4/#selectordef-after" },
                "https://www.w3.org/TR/css-pseudo-4/#selectordef-before": { "displayText": "::before", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "css-pseudo", "spec": "css-pseudo-4", "status": "snapshot", "text": "::before", "type": "selector", "url": "https://www.w3.org/TR/css-pseudo-4/#selectordef-before" },
                "https://www.w3.org/TR/css-syntax-3/#at-rule": { "displayText": "at-rule", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "css-syntax", "spec": "css-syntax-3", "status": "snapshot", "text": "at-rule", "type": "dfn", "url": "https://www.w3.org/TR/css-syntax-3/#at-rule" },
                "https://www.w3.org/TR/css-syntax-3/#css-parse-something-according-to-a-css-grammar": { "displayText": "parse", "export": true, "for_": ["CSS"], "level": "3", "normative": true, "shortname": "css-syntax", "spec": "css-syntax-3", "status": "snapshot", "text": "parse", "type": "dfn", "url": "https://www.w3.org/TR/css-syntax-3/#css-parse-something-according-to-a-css-grammar" },
                "https://www.w3.org/TR/css-syntax-3/#style-rule": { "displayText": "style rule", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "css-syntax", "spec": "css-syntax-3", "status": "snapshot", "text": "style rule", "type": "dfn", "url": "https://www.w3.org/TR/css-syntax-3/#style-rule" },
                "https://www.w3.org/TR/css-syntax-3/#typedef-delim-token": { "displayText": "<delim-token>", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "css-syntax", "spec": "css-syntax-3", "status": "snapshot", "text": "<delim-token>", "type": "type", "url": "https://www.w3.org/TR/css-syntax-3/#typedef-delim-token" },
                "https://www.w3.org/TR/css-syntax-3/#typedef-rule-list": { "displayText": "<rule-list>", "export": true, "for_": [], "level": "3", "normative": true, "shortname": "css-syntax", "spec": "css-syntax-3", "status": "snapshot", "text": "<rule-list>", "type": "type", "url": "https://www.w3.org/TR/css-syntax-3/#typedef-rule-list" },
                "https://www.w3.org/TR/css-ui-4/#valdef-caret-shape-bar": { "displayText": "bar", "export": true, "for_": ["caret-shape"], "level": "4", "normative": true, "shortname": "css-ui", "spec": "css-ui-4", "status": "snapshot", "text": "bar", "type": "value", "url": "https://www.w3.org/TR/css-ui-4/#valdef-caret-shape-bar" },
                "https://www.w3.org/TR/cssom-1/#concept-declarations-specified-order": { "displayText": "specified order", "export": false, "for_": [], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "specified order", "type": "dfn", "url": "https://www.w3.org/TR/cssom-1/#concept-declarations-specified-order" },
                "https://www.w3.org/TR/cssom-1/#css-declaration-block": { "displayText": "CSS declaration block", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "css declaration block", "type": "dfn", "url": "https://www.w3.org/TR/cssom-1/#css-declaration-block" },
                "https://www.w3.org/TR/cssom-1/#cssrule": { "displayText": "CSSRule", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "CSSRule", "type": "interface", "url": "https://www.w3.org/TR/cssom-1/#cssrule" },
                "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-computed-flag": { "displayText": "computed flag", "export": true, "for_": ["CSSStyleDeclaration"], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "computed flag", "type": "dfn", "url": "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-computed-flag" },
                "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-declarations": { "displayText": "declarations", "export": true, "for_": ["CSSStyleDeclaration"], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "declarations", "type": "dfn", "url": "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-declarations" },
                "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-owner-node": { "displayText": "owner node", "export": true, "for_": ["CSSStyleDeclaration"], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "owner node", "type": "dfn", "url": "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-owner-node" },
                "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-parent-css-rule": { "displayText": "parent CSS rule", "export": true, "for_": ["CSSStyleDeclaration"], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "parent css rule", "type": "dfn", "url": "https://www.w3.org/TR/cssom-1/#cssstyledeclaration-parent-css-rule" },
                "https://www.w3.org/TR/cssom-1/#cssstylerule": { "displayText": "CSSStyleRule", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "CSSStyleRule", "type": "interface", "url": "https://www.w3.org/TR/cssom-1/#cssstylerule" },
                "https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-cssrules": { "displayText": "cssRules", "export": true, "for_": ["CSSGroupingRule"], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "cssRules", "type": "attribute", "url": "https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-cssrules" },
                "https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-insertrule": { "displayText": "insertRule(rule)", "export": true, "for_": ["CSSGroupingRule"], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "insertRule(rule)", "type": "method", "url": "https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-insertrule" },
                "https://www.w3.org/TR/cssom-1/#dom-cssstylerule-style": { "displayText": "style", "export": true, "for_": ["CSSStyleRule"], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "style", "type": "attribute", "url": "https://www.w3.org/TR/cssom-1/#dom-cssstylerule-style" },
                "https://www.w3.org/TR/cssom-1/#serialize-a-css-declaration-block": { "displayText": "serialize a CSS declaration block", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "serialize a css declaration block", "type": "dfn", "url": "https://www.w3.org/TR/cssom-1/#serialize-a-css-declaration-block" },
                "https://www.w3.org/TR/cssom-1/#serialize-a-css-rule": { "displayText": "serialize a CSS rule", "export": true, "for_": [], "level": "1", "normative": true, "shortname": "cssom", "spec": "cssom-1", "status": "snapshot", "text": "serialize a css rule", "type": "dfn", "url": "https://www.w3.org/TR/cssom-1/#serialize-a-css-rule" },
                "https://www.w3.org/TR/selectors-4/#compound": { "displayText": "compound selector", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "compound selector", "type": "dfn", "url": "https://www.w3.org/TR/selectors-4/#compound" },
                "https://www.w3.org/TR/selectors-4/#descendant-combinator": { "displayText": "descendant combinator", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "descendant combinator", "type": "dfn", "url": "https://www.w3.org/TR/selectors-4/#descendant-combinator" },
                "https://www.w3.org/TR/selectors-4/#featureless": { "displayText": "featureless", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "featureless", "type": "dfn", "url": "https://www.w3.org/TR/selectors-4/#featureless" },
                "https://www.w3.org/TR/selectors-4/#matches-pseudo": { "displayText": ":is()", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": ":is()", "type": "selector", "url": "https://www.w3.org/TR/selectors-4/#matches-pseudo" },
                "https://www.w3.org/TR/selectors-4/#relative-selector": { "displayText": "relative selector", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "relative selector", "type": "dfn", "url": "https://www.w3.org/TR/selectors-4/#relative-selector" },
                "https://www.w3.org/TR/selectors-4/#scope-pseudo": { "displayText": ":scope", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": ":scope", "type": "selector", "url": "https://www.w3.org/TR/selectors-4/#scope-pseudo" },
                "https://www.w3.org/TR/selectors-4/#selector-combinator": { "displayText": "combinator", "export": true, "for_": ["selector"], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "combinator", "type": "dfn", "url": "https://www.w3.org/TR/selectors-4/#selector-combinator" },
                "https://www.w3.org/TR/selectors-4/#simple": { "displayText": "simple selector", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "simple selector", "type": "dfn", "url": "https://www.w3.org/TR/selectors-4/#simple" },
                "https://www.w3.org/TR/selectors-4/#specificity": { "displayText": "specificity", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "specificity", "type": "dfn", "url": "https://www.w3.org/TR/selectors-4/#specificity" },
                "https://www.w3.org/TR/selectors-4/#type-selector": { "displayText": "type selector", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "type selector", "type": "dfn", "url": "https://www.w3.org/TR/selectors-4/#type-selector" },
                "https://www.w3.org/TR/selectors-4/#typedef-forgiving-selector-list": { "displayText": "<forgiving-selector-list>", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "<forgiving-selector-list>", "type": "type", "url": "https://www.w3.org/TR/selectors-4/#typedef-forgiving-selector-list" },
                "https://www.w3.org/TR/selectors-4/#typedef-relative-selector-list": { "displayText": "<relative-selector-list>", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "<relative-selector-list>", "type": "type", "url": "https://www.w3.org/TR/selectors-4/#typedef-relative-selector-list" },
                "https://www.w3.org/TR/selectors-4/#typedef-selector-list": { "displayText": "<selector-list>", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": "<selector-list>", "type": "type", "url": "https://www.w3.org/TR/selectors-4/#typedef-selector-list" },
                "https://www.w3.org/TR/selectors-4/#where-pseudo": { "displayText": ":where()", "export": true, "for_": [], "level": "4", "normative": true, "shortname": "selectors", "spec": "selectors-4", "status": "snapshot", "text": ":where()", "type": "selector", "url": "https://www.w3.org/TR/selectors-4/#where-pseudo" },
            };

            function mkRefHint(link, ref) {
                const linkText = link.textContent;
                let dfnTextElements = '';
                if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
                    // Give the original term if it's being displayed in a different way.
                    // But allow casing differences, they're insignificant.
                    dfnTextElements =
                        mk.li({},
                            mk.b({}, "Term: "),
                            mk.span({}, ref.displayText)
                        );
                }
                const forList = ref.for_;
                let forListElements;
                if (forList.length == 0) {
                    forListElements = [];
                } else if (forList.length == 1) {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.span({}, forList[0]),
                    );
                } else {
                    forListElements = mk.li({},
                        mk.b({}, "For: "),
                        mk.ul({},
                            ...forList.map(forItem =>
                                mk.li({},
                                    mk.span({}, forItem)
                                ),
                            ),
                        ),
                    );
                }
                const url = ref.url;
                const safeUrl = encodeURIComponent(url);
                const hintPanel = mk.aside({
                    class: "ref-hint",
                    id: `ref-hint-for-${safeUrl}`,
                    "data-for": url,
                    "aria-labelled-by": `ref-hint-for-${safeUrl}`,
                },
                    mk.ul({},
                        dfnTextElements,
                        mk.li({},
                            mk.b({}, "URL: "),
                            mk.a({ href: url, class: "ref" }, url),
                        ),
                        mk.li({},
                            mk.b({}, "Type: "),
                            mk.span({}, `${ref.type}`),
                        ),
                        mk.li({},
                            mk.b({}, "Spec: "),
                            mk.span({}, `${ref.spec ? ref.spec : ''}`),
                        ),
                        forListElements
                    ),
                );
                hintPanel.forLink = link;
                setupRefHintEventListeners(link, hintPanel);
                return hintPanel;
            }

            function hideAllRefHints() {
                queryAll(".ref-hint").forEach(el => hideRefHint(el));
            }

            function hideRefHint(refHint) {
                const link = refHint.forLink;
                link.setAttribute("aria-expanded", "false");
                if (refHint.teardownEventListeners) {
                    refHint.teardownEventListeners();
                }
                refHint.remove();
            }

            function showRefHint(link) {
                if (link.classList.contains("dfn-link")) return;
                const url = link.getAttribute("href");
                const refHintKey = link.getAttribute("data-refhint-key");
                let key = url;
                if (refHintKey) {
                    key = refHintKey + "_" + url;
                }
                const ref = refsData[key];
                if (!ref) return;

                hideAllRefHints(); // Only display one at this time.

                const refHint = mkRefHint(link, ref);
                append(document.body, refHint);
                link.setAttribute("aria-expanded", "true");
                positionRefHint(refHint);
            }

            function setupRefHintEventListeners(link, refHint) {
                if (refHint.teardownEventListeners) return;
                // Add event handlers to hide the refHint after the user moves away
                // from both the link and refHint, if not hovering either within one second.
                let timeout = null;
                const startHidingRefHint = (event) => {
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                    timeout = setTimeout(() => {
                        hideRefHint(refHint);
                    }, 1000);
                }
                const resetHidingRefHint = (event) => {
                    if (timeout) clearTimeout(timeout);
                    timeout = null;
                };
                link.addEventListener("mouseleave", startHidingRefHint);
                link.addEventListener("mouseenter", resetHidingRefHint);
                link.addEventListener("blur", startHidingRefHint);
                link.addEventListener("focus", resetHidingRefHint);
                refHint.addEventListener("mouseleave", startHidingRefHint);
                refHint.addEventListener("mouseenter", resetHidingRefHint);
                refHint.addEventListener("blur", startHidingRefHint);
                refHint.addEventListener("focus", resetHidingRefHint);

                refHint.teardownEventListeners = () => {
                    // remove event listeners
                    resetHidingRefHint();
                    link.removeEventListener("mouseleave", startHidingRefHint);
                    link.removeEventListener("mouseenter", resetHidingRefHint);
                    link.removeEventListener("blur", startHidingRefHint);
                    link.removeEventListener("focus", resetHidingRefHint);
                    refHint.removeEventListener("mouseleave", startHidingRefHint);
                    refHint.removeEventListener("mouseenter", resetHidingRefHint);
                    refHint.removeEventListener("blur", startHidingRefHint);
                    refHint.removeEventListener("focus", resetHidingRefHint);
                };
            }

            function positionRefHint(refHint) {
                const link = refHint.forLink;
                const linkPos = getBounds(link);
                refHint.style.top = linkPos.bottom + "px";
                refHint.style.left = linkPos.left + "px";

                const panelPos = refHint.getBoundingClientRect();
                const panelMargin = 8;
                const maxRight = document.body.parentNode.clientWidth - panelMargin;
                if (panelPos.right > maxRight) {
                    const overflowAmount = panelPos.right - maxRight;
                    const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
                    refHint.style.left = newLeft + "px";
                }
            }

            // TODO: shared util
            // Returns the root-level absolute position {left and top} of element.
            function getBounds(el, relativeTo = document.body) {
                const relativeRect = relativeTo.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const top = elRect.top - relativeRect.top;
                const left = elRect.left - relativeRect.left;
                return {
                    top,
                    left,
                    bottom: top + elRect.height,
                    right: left + elRect.width,
                }
            }

            function showRefHintListener(e) {
                // If the target isn't in a link (or is a link),
                // just ignore it.
                let link = e.target.closest("a");
                if (!link) return;

                // If the target is in a ref-hint panel
                // (aka a link in the already-open one),
                // also just ignore it.
                if (link.closest(".ref-hint")) return;

                // Otherwise, show the panel for the link.
                showRefHint(link);
            }

            function hideAllHintsListener(e) {
                // If the click is inside a ref-hint panel, ignore it.
                if (e.target.closest(".ref-hint")) return;
                // Otherwise, close all the current panels.
                hideAllRefHints();
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("mousedown", showRefHintListener);
                document.body.addEventListener("focus", showRefHintListener);

                document.body.addEventListener("click", hideAllHintsListener);
            });

            window.addEventListener("resize", () => {
                // Hide any open ref hint.
                hideAllRefHints();
            });
        }
    </script>
    <script>/* Boilerplate: script-wpt */
        "use strict";
        {
            let wptData = {
                "paths": ["/css/css-nesting/"],
            };

            document.addEventListener("DOMContentLoaded", async () => {
                if (wptData.paths.length == 0) return;

                const runsUrl = "https://wpt.fyi/api/runs?label=master&label=stable&max-count=1&product=chrome&product=firefox&product=safari&product=edge";
                const runs = await (await fetch(runsUrl)).json();

                let testResults = [];
                for (const pathPrefix of wptData.paths) {
                    const pathResults = await (await fetch("https://wpt.fyi/api/search", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            "run_ids": runs.map(x => x.id),
                            "query": { "path": pathPrefix },
                        })
                    })).json();
                    testResults = testResults.concat(pathResults.results);
                }

                const browsers = runs.map(x => ({ name: x.browser_name, version: x.browser_version, passes: 0, total: 0 }));
                const resultsFromPath = new Map(testResults.map(result => {
                    const testPath = result.test;
                    const passes = result.legacy_status.map(x => [x.passes, x.total]);
                    return [testPath, passes];
                }));
                const seenTests = new Set();
                document.querySelectorAll(".wpt-name").forEach(nameEl => {
                    const passData = resultsFromPath.get("/" + nameEl.getAttribute("title"));
                    if (!passData) {
                        console.log("Couldn't find test in results:", nameEl);
                        return
                    }
                    const numTests = passData[0][1];
                    if (numTests > 1) {
                        nameEl.insertAdjacentElement("beforeend",
                            mk.small({}, ` (${numTests} tests)`));
                    }
                    if (passData == undefined) return;
                    const resultsEl = mk.span({ "class": "wpt-results" },
                        ...passData.map((p, i) => mk.span(
                            {
                                "title": `${browsers[i].name} ${p[0]}/${p[1]}`,
                                "class": "wpt-result",
                                "style": `background: conic-gradient(forestgreen ${p[0] / p[1] * 360}deg, darkred 0deg);`,
                            })),
                    );
                    nameEl.insertAdjacentElement("afterend", resultsEl);

                    // Only update the summary pass/total count if we haven't seen this
                    // test before, to support authors listing the same test multiple times
                    // in a spec.
                    if (!seenTests.has(nameEl.getAttribute("title"))) {
                        seenTests.add(nameEl.getAttribute("title"));
                        passData.forEach((p, i) => {
                            browsers[i].passes += p[0];
                            browsers[i].total += p[1];
                        });
                    }
                });
                const overview = document.querySelector(".wpt-overview");
                if (overview) {
                    overview.appendChild(mk.ul({}, ...browsers.map(formatWptResult)));
                    document.head.appendChild(mk.style({},
                        `.wpt-overview ul { display: flex; flex-flow: row wrap; gap: .2em; justify-content: start; list-style: none; padding: 0; margin: 0;}
             .wpt-overview li { padding: .25em 1em; color: black; text-align: center; }
             .wpt-overview img { height: 1.5em; height: max(1.5em, 32px); background: transparent; }
             .wpt-overview .browser { font-weight: bold; }
             .wpt-overview .passes-none { background: #e57373; }
             .wpt-overview .passes-hardly { background: #ffb74d; }
             .wpt-overview .passes-a-few { background: #ffd54f; }
             .wpt-overview .passes-half { background: #fff176; }
             .wpt-overview .passes-lots { background: #dce775; }
             .wpt-overview .passes-most { background: #aed581; }
             .wpt-overview .passes-all { background: #81c784; }`));
                }
            });

            function formatWptResult({ name, version, passes, total }) {
                const passRate = passes / total;
                let passClass = "";
                if (passRate == 0) passClass = "passes-none";
                else if (passRate < .2) passClass = "passes-hardly";
                else if (passRate < .4) passClass = "passes-a-few";
                else if (passRate < .6) passClass = "passes-half";
                else if (passRate < .8) passClass = "passes-lots";
                else if (passRate < 1) passClass = "passes-most";
                else passClass = "passes-all";

                name = name[0].toUpperCase() + name.slice(1);
                const shortVersion = /^\d+/.exec(version);
                const icon = []

                if (name == "Chrome") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/chrome_64x64.png" }));
                if (name == "Edge") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/edge_64x64.png" }));
                if (name == "Safari") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/safari_64x64.png" }));
                if (name == "Firefox") icon.push(mk.img({ alt: "", src: "https://wpt.fyi/static/firefox_64x64.png" }));

                return mk.li({ "class": passClass },
                    mk.nobr({ 'class': 'browser' }, ...icon, ` ${name} ${shortVersion}`),
                    mk.br(),
                    mk.nobr({ 'class': 'pass-rate' }, `${passes}/${total}`)
                );
            }
        }
    </script>
    <script src="https://htmlspecs.com/dropdown.js"></script>
