<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="ja-JP">

<HEAD>
    <TITLE>スタッキングコンテキストの詳細な説明</TITLE>
    <link rel="stylesheet" href="https://www.w3.org/TR/CSS22/style/default.css" type="text/css">
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/W3C-WD.css" type="text/css">
    <link rel="prev" href="sample.html">
    <link rel="next" href="propidx.html">
    <link rel="contents" href="index.html#minitoc">
    <link rel="CSS-properties" href="propidx.html" title="properties">
    <link rel="index" href="indexlist.html" title="index">
    <link rel="first" href="index.html">
    <script type="text/javascript" src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

</HEAD>

<BODY>
    <div class="navbar">
        <p><a href="sample.html">前へ</a> &nbsp;
            <a href="propidx.html">次へ</a> &nbsp;
            <a href="index.html#minitoc">目次</a> &nbsp;
            <a href="propidx.html">プロパティ</a> &nbsp;
            <a href="indexlist.html">索引</a> &nbsp;
    </div>
    <hr class="navbar">

    <H1><a name="q0">付録E. スタッキングコンテキストの詳細な説明</a></H1>
    <div id="toc" class="subtoc">
        <p><strong>目次</strong>
        <ul class="toc">
            <li><a href="zindex.html#stacking-defs" class="tocxref">E.1 定義</a>
            <li><a href="zindex.html#painting-order" class="tocxref">E.2 描画順序</a>
            <li><a href="zindex.html#stacking-notes" class="tocxref">E.3 注意事項</a>
        </ul>
    </div>


    <p>この章は、CSS&nbsp;2.2の描画順序について、仕様書の他の部分で説明されている以上に詳細に定義しています。</p>

    <h2>E.1 <a name="stacking-defs">定義</a></h2>

    <dl>

        <dt>ツリー順序</dt>

        <dd><em>レンダリング</em>ツリーの、ボックスを移動させるプロパティを考慮した後の、論理的（ビジュアルではない）順序での前順深さ優先探索。</dd>

        <dt>要素</dt>

        <dd>この説明において、「要素」とは実際の要素、疑似要素、および匿名ボックスを指します。疑似要素および匿名ボックスは適切な位置で子孫として扱われます。例えば、外側のリストマーカーはラインボックス内で隣接する
            ':before' ボックスの前にあり、その後にそのボックスの内容が続きます。</dd>

    </dl>

    <h2>E.2 <a name="painting-order">描画順序</a></h2>

    <p>スタックの底はユーザーから最も遠く、スタックの上はユーザーに最も近い位置にあります:

    <pre>
	     |	   |	     |	  |
	     |		|    |	  |	&#8678; &#9787;
	     |		|	  |	ユーザー
z-index:  canvas  -1	0    1	  2
</pre>

    <p>スタッキングコンテキストの背景と最も負の位置にあるスタッキングコンテキストはスタックの底にあり、最も正の位置にあるスタッキングコンテキストはスタックの上にあります。

    <p>キャンバスは、別のものに含まれている場合は透明で、含まれていない場合はUAによって定義された色を持ちます。それは無限の広がりを持ち、ルート要素を含みます。初期状態では、ビューポートはその左上隅がキャンバスの原点に固定されています。

    <p>スタッキングコンテキストを生成する要素の子孫の描画順序（<a href="visuren.html#propdef-z-index" class="noxref"><span
                class="propinst-z-index">'z-index'</span></a> プロパティを参照）は次の通りです:

    <ol class=stack>
        <li>
            <p>要素がルート要素である場合:
            <ol>
                <li>要素の背景色がキャンバス全体にわたって適用されます。

                <li>要素の背景画像がキャンバス全体にわたって適用され、ルート要素のために描画される場合に使用される原点で固定されます。
            </ol>

        <li>
            <p>要素がブロック、リストアイテム、またはその他のブロック等価物である場合:
            <ol>
                <li>要素がルート要素でない場合、その背景色。

                <li>要素がルート要素でない場合、その背景画像。

                <li>要素のボーダー。
            </ol>

            <p>それ以外の場合、要素がブロックレベルのテーブルである場合:
            <ol>
                <li>要素がルート要素でない場合、テーブル背景（色、その後に画像）。
                <li>カラムグループの背景（色、その後に画像）。
                <li>カラムの背景（色、その後に画像）。
                <li>行グループの背景（色、その後に画像）。
                <li>行の背景（色、その後に画像）。
                <li>セルの背景（色、その後に画像）。
                <li>すべてのテーブルボーダー（分離されたボーダーの場合はツリー順）。
            </ol>

        <li>
            <p>負のz-index（0を除く）を持つ位置指定された子孫によって形成されるスタッキングコンテキストを、z-indexの順（最も負のものから順番に）で、その後ツリー順で描画。

        <li>
            <p>ツリー順における、すべてのインフローで位置指定されていないブロックレベルの子孫について: 要素がブロック、リストアイテム、またはその他のブロック等価物である場合:
            <ol>
                <li>要素の背景色。
                <li>要素の背景画像。
                <li>要素のボーダー。
            </ol>

            <p>それ以外の場合、要素がテーブルである場合:
            <ol>
                <li>テーブル背景（色、その後に画像）。
                <li>カラムグループの背景（色、その後に画像）。
                <li>カラムの背景（色、その後に画像）。
                <li>行グループの背景（色、その後に画像）。
                <li>行の背景（色、その後に画像）。
                <li>セルの背景（色、その後に画像）。
                <li>すべてのテーブルボーダー（分離されたボーダーの場合はツリー順）。
            </ol>

        <li>
            <p>すべての位置指定されていない浮遊子孫をツリー順で描画。それぞれについて、その要素が新たなスタッキングコンテキストを作成したかのように扱いますが、位置指定された子孫および実際に新しいスタッキングコンテキストを作成する子孫は、この新しいものではなく親スタッキングコンテキストの一部と見なされるべきです。

        <li>
            <p>要素がスタッキングコンテキストを生成するインライン要素である場合:
            <ol>
                <li>
                    <p>要素が含まれる各ラインボックスについて:
                    <ol>
                        <li>そのラインボックスにおける要素のボックス（ツリー順）については、<a href="#each-box">7.2.1</a> にジャンプ。
                    </ol>
            </ol>

        <li>
            <p>それ以外の場合: 最初に要素について、その後ツリー順におけるすべてのインフローで位置指定されていないブロックレベルの子孫について:
            <ol>
                <li>
                    <p>要素がブロックレベルの置換要素である場合、置換コンテンツを一括して描画。

                <li>
                    <p>それ以外の場合、その要素の各ラインボックスについて:
                    <ol>
                        <li id=each-box>
                            <p>そのラインボックス内で、その要素の子である各ボックスについてツリー順で描画:
                            <ol>
                                <li>
                                    <p>要素の背景色。
                                <li>
                                    <p>要素の背景画像。
                                <li>
                                    <p>要素のボーダー。
                                <li>
                                    <p>インライン要素の場合:
                                    <ol>
                                        <li>
                                            <p>その要素のすべてのインフローで位置指定されていないインラインレベルの子がこのラインボックス内にある場合、またその要素内のこのラインボックス上にあるすべてのテキストのランについてツリー順で描画:
                                            <ol>
                                                <li>
                                                    <p>これがテキストランである場合:
                                                    <ol>
                                                        <li>その要素のテキストに影響を与えるすべての下線を、下線を適用する要素のツリー順（最も深い要素の下線が最上部に描画され、ルート要素の下線が最下部に描画されるように）で描画。

                                                        <li>その要素のテキストに影響を与えるすべての上線を、上線を適用する要素のツリー順（最も深い要素の上線が最上部に描画され、ルート要素の上線が最下部に描画されるように）で描画。

                                                        <li>テキスト。

                                                        <li>その要素のテキストに影響を与えるすべての打ち消し線を、打ち消し線を適用する要素のツリー順（最も深い要素の打ち消し線が最上部に描画され、ルート要素の打ち消し線が最下部に描画されるように）で描画。
                                                    </ol>

                                                <li>
                                                    <p>それ以外の場合、その要素について <a href="#each-box">7.2.1</a> にジャンプ。
                                            </ol>
                                    </ol>

                                    <p>インラインブロックおよびインラインテーブル要素について:
                                    <ol>
                                        <li>それぞれについて、その要素が新たなスタッキングコンテキストを作成したかのように扱いますが、位置指定された子孫および実際に新しいスタッキングコンテキストを作成する子孫は、この新しいものではなく親スタッキングコンテキストの一部と見なされるべきです。
                                    </ol>

                                    <p>インラインレベルの置換要素について:
                                    <ol>
                                        <li>置換コンテンツを一括して描画。
                                    </ol>
                            </ol>

                            <p class=note>一部のボックスはライン分割やUnicodeの双方向アルゴリズムによって生成された可能性があります。

                        <li>
                            <p>オプションで、その要素のアウトライン（<a href="#outlines">10 以下</a>を参照）を描画。
                    </ol>

                <li>
                    <p>オプションで、要素がブロックレベルである場合、その要素のアウトライン（<a href="#outlines">10 以下</a>を参照）を描画。
            </ol>

        <li>
            <p>すべての 'z-index: auto' または 'z-index: 0' を持つ位置指定された子孫をツリー順で描画。'z-index: auto'
                を持つものについては、その要素が新たなスタッキングコンテキストを作成したかのように扱いますが、位置指定された子孫および実際に新しいスタッキングコンテキストを作成する子孫は、この新しいものではなく親スタッキングコンテキストの一部と見なされるべきです。'z-index:
                0' を持つものについては、生成されたスタッキングコンテキストを一括して処理。

        <li>
            <p>z-indexが1以上の値を持つ位置指定された子孫によって形成されるスタッキングコンテキストを、z-indexの順（最小から順）で、その後ツリー順で描画。

        <li id=outlines>
            <p>最後に、上記の手順でアウトラインを描画しなかった実装は、この段階でこのスタッキングコンテキストからアウトラインを描画しなければならない。（このステップでアウトラインを描画し、上記の手順では描画しないことを推奨する。）
    </ol>

    <h2>E.3 <a name="stacking-notes">注意事項</a></h2>

    <p>ルート要素の背景は、キャンバス全体にわたって一度だけ描画されます。

    <p>双方向インラインの背景はツリー順で描画されますが、それらはビジュアル順で配置されます。インライン背景の配置はCSS&nbsp;2.2では指定されていないため、これらの2つの要件の正確な結果はUAによって定義されます。CSS3ではこれがさらに詳細に定義される可能性があります。

        <hr class="navbar">

    <div class="navbar">
        <p><a href="sample.html">前へ</a> &nbsp;
            <a href="propidx.html">次へ</a> &nbsp;
            <a href="index.html#minitoc">目次</a> &nbsp;
            <a href="propidx.html">プロパティ</a> &nbsp;
            <a href="indexlist.html">索引</a> &nbsp;
    </div>
    <script src="https://htmlspecs.com/dropdown.js"></script>

</BODY>

</HTML>