<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="ja-JP">

<HEAD>
  <TITLE>CSS 2.2の文法</TITLE>
  <link rel="stylesheet" href="https://www.w3.org/TR/CSS22/style/default.css" type="text/css">
  <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/W3C-WD.css" type="text/css">
  <link rel="prev" href="propidx.html">
  <link rel="next" href="leftblank.html">
  <link rel="contents" href="index.html#minitoc">
  <link rel="CSS-properties" href="propidx.html" title="properties">
  <link rel="index" href="indexlist.html" title="index">
  <link rel="first" href="index.html">
  <script type="text/javascript" src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

</HEAD>

<BODY>
  <div class="navbar">
    <p><a href="propidx.html">前へ</a> &nbsp;
      <a href="leftblank.html">次へ</a> &nbsp;
      <a href="index.html#minitoc">目次</a> &nbsp;
      <a href="propidx.html">プロパティ</a> &nbsp;
      <a href="indexlist.html">索引</a> &nbsp;
  </div>
  <hr class="navbar">

  <H1><a name="q0">付録 G. 現行標準の文法</a></H1>
  <div id="toc" class="subtoc">
    <p><strong>目次</strong>
    <ul class="toc">
      <li><a href="grammar.html#grammar" class="tocxref">G.1 文法</a>
      <li><a href="grammar.html#scanner" class="tocxref">G.2 字句スキャナー</a>
      <li><a href="grammar.html#tokenizer-diffs" class="tocxref">G.3 現行標準とCSS1のトークン化の比較</a>
      <li><a href="grammar.html#q4" class="tocxref">G.4 実装メモ</a>
    </ul>
  </div>


  <p>この付録は規範的ではありません。

  <P>以下の文法は現行標準の構文を定義しています。ただし、この文法は現行標準のスーパーセットとも言えるものであり、この仕様は文法では表現されていない追加の意味的制約を課しています。適合するUAは、<a
      href="./syndata.html#syntax">
      前方互換パーシング規則</a>、セレクタの記法、<a href="./about.html#property-defs">プロパティと値の記法</a>、
    および単位の記法にも従う必要があります。ただし、文法的に正しいすべてのCSSが有効になるわけではありません。例えば、HTMLは"クラス"属性の可能な値に制限を課しており、それがCSSには含まれない場合があります。

  <h2>G.1 <a name="grammar">文法</a></h2>

  <P> 以下の文法は <a name="x0"><span class="index-inst" title="LALR(1)">LALR(1)</span></a> です
    (ただし、ほとんどのUAは直接使用すべきではありません。この文法は<a
      href="syndata.html#parsing-errors">パーシング規則</a>ではなく、現行標準の構文のみを表現しています)。生成規則の形式は人間が読むのに最適化されており、Yacc (参照 <a
      href="refs.html#ref-YACC" rel="biblioentry" class="noxref"><span class="normref">[YACC]</span></a>)
    を超えた省略記法が使用されています:</P>

  <ul>
    <li><strong>*</strong>: 0回以上
    <li><strong>+</strong>: 1回以上
    <li><strong>?</strong>: 0回または1回
    <li><strong>|</strong>: 選択肢の区切り
    <li><strong>[&nbsp;]</strong>: グループ化
  </ul>

  <p>生成規則は以下の通りです:

  <pre>
stylesheet
  : [ CHARSET_SYM STRING ';' ]?
    [S|CDO|CDC]* [ import [ CDO S* | CDC S* ]* ]*
    [ [ ruleset | media | page ] [ CDO S* | CDC S* ]* ]*
  ;
import
  : IMPORT_SYM S*
    [STRING|URI] S* media_list? ';' S*
  ;
media
  : MEDIA_SYM S* media_list '{' S* ruleset* '}' S*
  ;
media_list
  : medium [ COMMA S* medium]*
  ;
medium
  : IDENT S*
  ;
page
  : PAGE_SYM S* pseudo_page?
    '{' S* declaration? [ ';' S* declaration? ]* '}' S*
  ;
pseudo_page
  : ':' IDENT S*
  ;
operator
  : '/' S* | ',' S*
  ;
combinator
  : '+' S*
  | '>' S*
  ;
property
  : IDENT S*
  ;
ruleset
  : selector [ ',' S* selector ]*
    '{' S* declaration? [ ';' S* declaration? ]* '}' S*
  ;
<a name="x1"><span class="index-inst" title="selector">selector</span></a>
  : simple_selector [ combinator selector | S+ [ combinator? selector ]? ]?
  ;
simple_selector
  : element_name [ HASH | class | attrib | pseudo ]*
  | [ HASH | class | attrib | pseudo ]+
  ;
class
  : '.' IDENT
  ;
element_name
  : IDENT | '*'
  ;
attrib
  : '[' S* IDENT S* [ [ '=' | INCLUDES | DASHMATCH ] S*
    [ IDENT | STRING ] S* ]? ']'
  ;
pseudo
  : ':' [ IDENT | FUNCTION S* [IDENT S*]? ')' ]
  ;
declaration
  : property ':' S* expr prio?
  ;
prio
  : IMPORTANT_SYM S*
  ;
expr
  : term [ operator? term ]*
  ;
term
  : [ NUMBER S* | PERCENTAGE S* | LENGTH S* | EMS S* | EXS S* | ANGLE S* |
      TIME S* | FREQ S* ]
  | STRING S* | IDENT S* | URI S* | hexcolor | function
  ;
function
  : FUNCTION S* expr ')' S*
  ;
/*
 * <a name="x2"><span class="index-inst" title="color">color</span></a>には、"#"の後に3または6桁の16進数 (例: [0-9a-fA-F]) が必要です。
 * 例: "#000" はOKですが、"#abcd" はNGです。
 */
hexcolor
  : HASH S*
  ;
</pre>

  <h2>G.2 <a name="scanner">字句スキャナー</a></h2>

  <p> 以下は<a name="x3"><span class="index-def" title="tokenizer">トークナイザー</span></a>であり、Flex (参照<a
      href="refs.html#ref-FLEX" rel="biblioentry" class="noxref"><span class="normref">[FLEX]</span></a>)
    記法で記述されています。トークナイザーは大文字小文字を区別しません。

  <p>"\377" は、現在のFlexバージョンが扱える最大文字番号 (10進数で255) を表します。これは "\4177777" (10進数で1114111) として読み替えるべきで、これは<a name="x4"><span
        class="index-inst" title="unicode">Unicode</span></a>/<a name="x5"><span class="index-inst"
        title="iso-10646">ISO-10646</span></a>の最大可能コードポイントです。

    <pre>
%option case-insensitive

h		[0-9a-f]
nonascii	[\240-\377]
unicode		\\{h}{1,6}(\r\n|[ \t\r\n\f])?
escape		{unicode}|\\[^\r\n\f0-9a-f]
nmstart		[_a-z]|{nonascii}|{escape}
nmchar		[_a-z0-9-]|{nonascii}|{escape}
string1		\"([^\n\r\f\\"]|\\{nl}|{escape})*\"
string2		\'([^\n\r\f\\']|\\{nl}|{escape})*\'
badstring1      \"([^\n\r\f\\"]|\\{nl}|{escape})*\\?
badstring2      \'([^\n\r\f\\']|\\{nl}|{escape})*\\?
badcomment1     \/\*[^*]*\*+([^/*][^*]*\*+)*
badcomment2     \/\*[^*]*(\*+[^/*][^*]*)*
baduri1         {U}{R}{L}\({w}([!#$%&amp;*-\[\]-~]|{nonascii}|{escape})*{w}
baduri2         {U}{R}{L}\({w}{string}{w}
baduri3         {U}{R}{L}\({w}{badstring}
comment		\/\*[^*]*\*+([^/*][^*]*\*+)*\/
ident		-?{nmstart}{nmchar}*
name		{nmchar}+
num		[-+]?[0-9]+|[-+]?[0-9]*"."[0-9]+
string		{string1}|{string2}
badstring       {badstring1}|{badstring2}
badcomment      {badcomment1}|{badcomment2}
baduri          {baduri1}|{baduri2}|{baduri3}
url		([!#$%&amp;*-~]|{nonascii}|{escape})*
s		[ \t\r\n\f]+
w		{s}?
nl		\n|\r\n|\r|\f

A		a|\\0{0,4}(41|61)(\r\n|[ \t\r\n\f])?
C		c|\\0{0,4}(43|63)(\r\n|[ \t\r\n\f])?
D		d|\\0{0,4}(44|64)(\r\n|[ \t\r\n\f])?
E		e|\\0{0,4}(45|65)(\r\n|[ \t\r\n\f])?
G		g|\\0{0,4}(47|67)(\r\n|[ \t\r\n\f])?|\\g
H		h|\\0{0,4}(48|68)(\r\n|[ \t\r\n\f])?|\\h
I		i|\\0{0,4}(49|69)(\r\n|[ \t\r\n\f])?|\\i
K		k|\\0{0,4}(4b|6b)(\r\n|[ \t\r\n\f])?|\\k
L               l|\\0{0,4}(4c|6c)(\r\n|[ \t\r\n\f])?|\\l
M		m|\\0{0,4}(4d|6d)(\r\n|[ \t\r\n\f])?|\\m
N		n|\\0{0,4}(4e|6e)(\r\n|[ \t\r\n\f])?|\\n
O		o|\\0{0,4}(4f|6f)(\r\n|[ \t\r\n\f])?|\\o
P		p|\\0{0,4}(50|70)(\r\n|[ \t\r\n\f])?|\\p
R		r|\\0{0,4}(52|72)(\r\n|[ \t\r\n\f])?|\\r
S		s|\\0{0,4}(53|73)(\r\n|[ \t\r\n\f])?|\\s
T		t|\\0{0,4}(54|74)(\r\n|[ \t\r\n\f])?|\\t
U               u|\\0{0,4}(55|75)(\r\n|[ \t\r\n\f])?|\\u
X		x|\\0{0,4}(58|78)(\r\n|[ \t\r\n\f])?|\\x
Z		z|\\0{0,4}(5a|7a)(\r\n|[ \t\r\n\f])?|\\z

%%

{s}			{return S;}

\/\*[^*]*\*+([^/*][^*]*\*+)*\/		/* ignore comments */
{badcomment}                         /* unclosed comment at EOF */

"&lt;!--"		{return CDO;}
"-->"			{return CDC;}
"~="			{return INCLUDES;}
"|="			{return DASHMATCH;}

{string}		{return STRING;}
{badstring}             {return BAD_STRING;}

{ident}			{return IDENT;}

"#"{name}		{return HASH;}

@{I}{M}{P}{O}{R}{T}	{return IMPORT_SYM;}
@{P}{A}{G}{E}		{return PAGE_SYM;}
@{M}{E}{D}{I}{A}	{return MEDIA_SYM;}
"@charset "		{return CHARSET_SYM;}

"!"({w}|{comment})*{I}{M}{P}{O}{R}{T}{A}{N}{T}	{return IMPORTANT_SYM;}

{num}{E}{M}		{return EMS;}
{num}{E}{X}		{return EXS;}
{num}{P}{X}		{return LENGTH;}
{num}{C}{M}		{return LENGTH;}
{num}{M}{M}		{return LENGTH;}
{num}{I}{N}		{return LENGTH;}
{num}{P}{T}		{return LENGTH;}
{num}{P}{C}		{return LENGTH;}
{num}{D}{E}{G}		{return ANGLE;}
{num}{R}{A}{D}		{return ANGLE;}
{num}{G}{R}{A}{D}	{return ANGLE;}
{num}{M}{S}		{return TIME;}
{num}{S}		{return TIME;}
{num}{H}{Z}		{return FREQ;}
{num}{K}{H}{Z}		{return FREQ;}
{num}{ident}		{return DIMENSION;}

{num}%			{return PERCENTAGE;}
{num}			{return NUMBER;}

{U}{R}{L}"("{w}{string}{w}")" {return URI;}
{U}{R}{L}"("{w}{url}{w}")"    {return URI;}
{baduri}                {return BAD_URI;}

{ident}"("		{return FUNCTION;}

.			{return *yytext;}
</pre>

  <h2>G.3 <a name="tokenizer-diffs">現行標準とCSS1のトークン化の比較</a></h2>

  <p>CSS1推奨仕様 (<a href="refs.html#ref-CSS1" rel="biblioentry" class="noxref"><span class="informref">[CSS1]</span></a>)
    と上記の構文にはいくつかの違いがあります。これらの多くはCSS2で新たに追加されたトークンによるものです。他の違いは、文法がより読みやすく書き直されたためです。ただし、一部の互換性のない変更は、CSS1構文における誤りと見なされました。以下に説明します。

  <ul>
    <li>CSS1スタイルシートは1バイト文字エンコーディング (例: ASCIIおよびISO-8859-1)
      のみを使用していましたが、現行標準にはそのような制限はありません。実際には、CSS1トークナイザーを推測するのに大きな困難はなく、一部のUAは2バイトエンコーディングを受け入れています。

    <li>CSS1では、バックスラッシュ (\) の後に最大4桁の16進数を指定してUnicode文字を参照することができましたが、CSS2では<a
        href="syndata.html#escaped-characters">6桁を許可</a>しています。さらに、CSS2ではエスケープシーケンスを区切るために空白文字を使用できます。例: CSS1では文字列
      "\abcdef" は3文字 (\abcd, e, f) で構成されますが、CSS2では1文字 (\abcdef) になります。

    <li>タブ文字 (ASCII 9)
      は文字列内で許可されていませんでした。ただし、CSS1では文字列はフォント名およびURLのためにのみ使用されていたため、スタイルシートにタブを含むフォントファミリー名が記載されている場合にのみCSS1とCSS2の間で非互換性が生じます。

    <li>同様に、新しい行 (<a href="syndata.html#strings">バックスラッシュでエスケープ</a>) はCSS1では文字列内で許可されていませんでした。

    <li>CSS2では、識別子に続く数値をDIMENSIONトークン (未知の単位) として解析しますが、CSS1では数値と識別子として解析していました。これにより、CSS1では宣言 'font: 10pt/1.2serif'
      は正しいものでしたが、CSS2では "serif" の前にスペースが必要です。

    <li>CSS1では、クラス名は数字で始めることができました (".55ft") が、CSS2ではそのようなクラスは未知の寸法として解析されます。CSS2では、".55ft"
      を有効なクラスとするには、最初の数字をエスケープする必要があります (".\35 5ft")。
  </ul>

  <h2><a name="q4">G.4 実装メモ</a></h2>

  <p><a
      href="syndata.html#tokenization">セクション&nbsp;4.1.1</a>でのCSSコア構文の字句スキャナーは、バックアップなしのスキャナーとして実装できます。Lex記法では、以下のパターンを追加する必要があります
    (これにより返されるトークンは変わりませんが、スキャナーの効率が向上します):

    <pre>
{ident}/\\          return IDENT;
#{name}/\\          return HASH;
@{ident}/\\         return ATKEYWORD;
#/\\                return DELIM;
@/\\                return DELIM;
@/-                 return DELIM;
@/-\\               return DELIM;
-/\\                return DELIM;
-/-                 return DELIM;
\&lt;/!                return DELIM;
\&lt;/!-               return DELIM;
{num}{ident}/\\     return DIMENSION;
{num}/\\            return NUMBER;
{num}/-             return NUMBER;
{num}/-\\           return NUMBER;
[0-9]+/\.           return NUMBER;
u/\+                return IDENT;
u\+[0-9a-f?]{1,6}/- return UNICODE_RANGE;
</pre>

  <hr class="navbar">

  <div class="navbar">
    <p><a href="propidx.html">前へ</a> &nbsp;
      <a href="leftblank.html">次へ</a> &nbsp;
      <a href="index.html#minitoc">目次</a> &nbsp;
      <a href="propidx.html">プロパティ</a> &nbsp;
      <a href="indexlist.html">索引</a> &nbsp;
  </div>
</body>

</html>