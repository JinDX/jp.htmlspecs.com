<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="ja-JP">

<HEAD>
    <TITLE>プロパティ値の割り当て、カスケーディング、および継承</TITLE>
    <link rel="stylesheet" href="https://www.w3.org/TR/CSS22/style/default.css" type="text/css">
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/W3C-WD.css" type="text/css">
    <link rel="prev" href="selector.html">
    <link rel="next" href="media.html">
    <link rel="contents" href="index.html#minitoc">
    <link rel="CSS-properties" href="propidx.html" title="properties">
    <link rel="index" href="indexlist.html" title="index">
    <link rel="first" href="index.html">
    <script type="text/javascript" src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

</HEAD>

<BODY>
    <div class="navbar">
        <p><a href="selector.html">前へ</a> &nbsp;
            <a href="media.html">次へ</a> &nbsp;
            <a href="index.html#minitoc">目次</a> &nbsp;
            <a href="propidx.html">プロパティ</a> &nbsp;
            <a href="indexlist.html">索引</a> &nbsp;
    </div>
    <hr class="navbar">


    <h1><a name="q0">6 プロパティ値の割り当て、カスケーディング、および継承</a></h1>
    <div id="toc" class="subtoc">
        <p><strong>目次</strong>
        <ul class="toc">
            <li><a href="cascade.html#value-stages" class="tocxref">6.1 指定値、計算値、および実際の値</a>
                <ul class="toc">
                    <li><a href="cascade.html#specified-value" class="tocxref">6.1.1 <span class="index-def"
                                title="specified value"> 指定値</span></a>
                    <li><a href="cascade.html#computed-value" class="tocxref">6.1.2 <span class="index-def"
                                title="computed value"> 計算値</span></a>
                    <li><a href="cascade.html#used-value" class="tocxref">6.1.3 <span class="index-def"
                                title="used value"> 使用値</span></a>
                    <li><a href="cascade.html#actual-value" class="tocxref">6.1.4 <span class="index-def"
                                title="actual value"> 実際の値</span></a>
                </ul>
            <li><a href="cascade.html#inheritance" class="tocxref">6.2 継承</a>
                <ul class="toc">
                    <li><a href="cascade.html#value-def-inherit" class="tocxref">6.2.1 <span class="index-def"
                                title="inherit, definition of">'inherit'</span>値</a>
                </ul>
            <li><a href="cascade.html#at-import" class="tocxref">6.3 @import ルール</a>
            <li><a href="cascade.html#cascade" class="tocxref">6.4 カスケード</a>
                <ul class="toc">
                    <li><a href="cascade.html#cascading-order" class="tocxref">6.4.1 カスケード順序</a>
                    <li><a href="cascade.html#important-rules" class="tocxref">6.4.2 !important ルール</a>
                    <li><a href="cascade.html#specificity" class="tocxref">6.4.3 セレクターの特異性の計算</a>
                    <li><a href="cascade.html#preshint" class="tocxref">6.4.4 非CSSのプレゼンテーショナルヒントの優先順位</a>
                </ul>
        </ul>
    </div>


    <h2>6.1 <a name="value-stages">指定値、計算値、および実際の値</a></h2>

    <p>ユーザーエージェントが文書を解析し、<a href="conform.html#doctree">文書ツリー</a>を構築した後、ツリー内のすべての要素に対して、対象の<a
            href="media.html">メディアタイプ</a>に適用されるすべてのプロパティに値を割り当てる必要があります。</p>

    <p>プロパティの最終的な値は、4段階の計算の結果です。この値は、指定（「指定値」）によって決定され、継承に使用される値（「計算値」）に解決され、必要に応じて絶対値（「使用値」）に変換され、最後にローカル環境の制限に基づいて変換されます（「実際の値」）。
    </p>

    <h3>6.1.1 <span class="index-def" title="specified value">
            <a name="specified-value">指定値</a></span></h3>

    <p>ユーザーエージェントは、以下のメカニズム（優先順位順）に基づいて各プロパティに指定値を割り当てる必要があります:</p>

    <ol>
        <li><a href="#cascade">カスケード</a>の結果として値が得られる場合、それを使用します。ただし、値が 'inherit' の場合、指定値は以下の<a
                href="#value-def-inherit">「'inherit' 値」</a>で定義されます。</li>
        <li>それ以外の場合、プロパティが<a href="#inheritance">継承</a>され、その要素が<a>文書ツリー</a>のルートでない場合、親要素の計算値を使用します。</li>
        <li>それ以外の場合、プロパティの<a name="x1"><span class="index-def"
                    title="initial value">初期値</span></a>を使用します。各プロパティの初期値は、そのプロパティの定義に示されています。</li>
    </ol>

    <h3>6.1.2 <span class="index-def" title="computed value">
            <a name="computed-value">計算値</a></span></h3>

    <p>指定値はカスケード中に計算値に解決されます。例えば、URIは絶対URIに変換され、'em'や'ex'単位はピクセルや絶対長さに計算されます。値の計算には文書のレンダリングを必要としません。</p>

    <p>絶対URIに解決できないURIの計算値は、指定値となります。</p>

    <p>プロパティの計算値は、そのプロパティの定義の計算値ラインで指定された方法で決定されます。指定値が 'inherit' の場合の計算値の定義については、<a
            href="#inheritance">継承</a>のセクションを参照してください。</p>

    <p>プロパティが適用されない場合でも、計算値は存在します（<a
            href="about.html#applies-to">'適用対象'</a>ラインで定義されています）。ただし、一部のプロパティでは、プロパティがその要素に適用されるかどうかに応じて計算値が異なる場合があります。
    </p>

    <h3>6.1.3 <span class="index-def" title="used value">
            <a name="used-value">使用値</a></span></h3>

    <p>計算値は文書をフォーマットすることなく可能な限り処理されます。ただし、一部の値は文書のレイアウト中にのみ決定できます。例えば、要素の幅が包含ブロックの一定割合に設定されている場合、包含ブロックの幅が決定されるまで幅を決定できません。<dfn
            id="usedValue">使用値</dfn>は、計算値を取得し、残りの依存関係を絶対値に解決した結果です。</p>

    <h3>6.1.4 <span class="index-def" title="actual value">
            <a name="actual-value">実際の値</a></span></h3>

    <p>使用値は原則としてレンダリングに使用される値ですが、ユーザーエージェントは特定の環境でその値を利用できない場合があります。例えば、ユーザーエージェントが整数ピクセル幅でのみ境界線を描画できる場合、計算幅を近似する必要があるか、またはフルカラーではなく白黒の色合いのみを使用する必要がある場合があります。実際の値は、近似が適用された後の使用値です。
    </p>

    <h2>6.2 <a name="inheritance">継承</a></h2>

    <p>一部の値は<a href="conform.html#doctree">文書ツリー</a>内の要素の子孫に継承されます。<a
            href="#specified-value">前述</a>の通りです。各プロパティは、それが継承可能かどうかを<a href="about.html#property-defs">定義</a>しています。</p>

    <div class="html example">
        <P>
            H1要素の中に強調要素（EM）があると仮定します:</p>

        <pre>
&lt;H1&gt;見出し &lt;EM&gt;は&lt;/EM&gt; 重要です！&lt;/H1&gt;
</pre>

        <p>EM要素に色が割り当てられていない場合、強調された "は" は親要素の色を継承します。したがって、H1が青色の場合、EM要素も青色になります。</p>
    </div>

    <p>継承が発生するとき、要素は計算値を継承します。親要素の計算値は、子要素の指定値および計算値の両方になります。</p>

    <div class="example">
        <P style="display:none">例:</P>
        <P>次のスタイルシートを考えます:</P>

        <pre>
body { font-size: 10pt }
h1 { font-size: 130% }
</pre>

        <p>この文書フラグメントの場合:

        <pre>
&lt;BODY&gt;
  &lt;H1&gt;大きな &lt;EM&gt;見出し&lt;/EM&gt;&lt;/H1&gt;
&lt;/BODY&gt;
</pre>

        <p>H1要素の<span class="prop-inst-font-size">'font-size'</span>プロパティは計算値として'13pt'（130% × 10pt、親の値）を持ちます。<a
                href="fonts.html#propdef-font-size" class="noxref"><span
                    class="propinst-font-size">'font-size'</span></a>の計算値は継承されるため、EM要素も計算値として'13pt'を持ちます。ユーザーエージェントに13ptのフォントがない場合、H1とEMの<a
                href="fonts.html#propdef-font-size" class="noxref"><span
                    class="propinst-font-size">'font-size'</span></a>の実際の値は例えば'12pt'になる可能性があります。</p>
    </div>

    <p class=note>継承は文書ツリーに従い、<span class=index-inst><a name="x5"
                href="visuren.html#box-gen">匿名ボックス</a></span>によって中断されることはありません。</p>

    <h3>6.2.1 <span class="index-def" title="inherit, definition
of"><a name="value-def-inherit">'inherit'</a></span>
        値</h3>

    <P>各プロパティには 'inherit' というカスケード値を持つことができます。この値は、特定の要素について、そのプロパティが親要素の計算値を指定値として取ることを意味します。'inherit'
        値は値の継承を強制するために使用でき、通常は継承されないプロパティにも使用できます。</p>

    <p>ルート要素に 'inherit' 値が設定されている場合、プロパティには初期値が割り当てられます。</p>

    <div class="example">
        <P style="display:none">例:</P>
        <P>以下の例では、<a href="colors.html#propdef-color" class="noxref"><span
                    class="propinst-color">'color'</span></a>および<a href="colors.html#propdef-background"
                class="noxref"><span
                    class="propinst-background">'background'</span></a>プロパティがBODY要素に設定されています。他のすべての要素では、'color'
            値は継承され、背景は透明になります。これらのルールがユーザーのスタイルシートの一部である場合、文書全体で白い背景に黒いテキストが強制されます。</p>

        <PRE>
body {
  color: black !important; 
  background: white !important;
}

* { 
  color: inherit !important; 
  background: transparent !important;
}
</PRE>

    </div>




    <H2>6.3 <a name="at-import">@importルール</a></H2>

    <P><a name="x7"><span class="index-def"
                title="@import"><dfn>'@import'</dfn></span></a>ルールは、他のスタイルシートからスタイルルールをインポートするために使用されます。CSS
        2.2では、@importルールは他のすべてのルール（存在する場合は@charsetルールを除く）に先行する必要があります。@importルールを無視する必要がある場合については、<a
            href="syndata.html#at-rules">解析のセクション</a>を参照してください。'@import'キーワードの後には、インクルードするスタイルシートのURIが続かなければなりません。文字列も許可されており、それはurl(...)で囲まれているかのように解釈されます。
    </P>

    <div class="example">
        <P style="display:none">例:</P>
        <P>
            以下の行は意味的に等しく、'@import'の2つの構文（"url()"を使用したものと、単なる文字列を使用したもの）を示しています:</P>

        <PRE>
@import "mystyle.css";
@import url("mystyle.css");
</PRE>
    </div>

    <p>ユーザーエージェントがサポートされていない<a href="media.html">メディアタイプ</a>のリソースを取得するのを回避できるように、作成者はメディア依存の<a name="x8"><span
                class="index-inst" title="@import">@import</span></a>ルールを指定できます。これらの<a name="x9"><span class="index-def"
                title="conditional import|media-dependent import">条件付きインポート</span></a>では、URIの後にカンマ区切りのメディアタイプを指定します。</p>

    <div class="example">
        <P style="display:none">例:</P>
        <p>以下のルールは、@importルールがどのようにメディア依存にできるかを示しています:</p>

        <pre>
@import url("fineprint.css") print;
@import url("bluish.css") projection, tv;
</pre>
    </div>

    <p>メディアタイプが指定されていない場合、インポートは無条件になります。メディアとして'all'を指定することも同じ効果を持ちます。ターゲットメディアがメディアリストに一致する場合にのみ、インポートが有効になります。</p>

    <p>ターゲットメディアがメディアリストに一致するのは、メディアリスト内のアイテムの1つがターゲットメディアまたは'all'である場合です。</p>

    <p class=note>メディアクエリは<a href="refs.html#ref-MEDIAQ" rel="biblioentry" class="noxref"><span
                class="informref">[MEDIAQ]</span></a>で、メディアリストの構文と一致の定義を拡張しています。</p>

    <p>同じスタイルシートが文書内の複数の場所でインポートまたはリンクされている場合、ユーザーエージェントは各リンクを別々のスタイルシートへのリンクであるかのように処理（またはそのように振る舞う）する必要があります。</p>

    <H2>6.4 <a name="cascade">カスケード</a></H2>

    <P>スタイルシートには、作成者、ユーザー、ユーザーエージェントの3つの異なる起源が考えられます。</P>

    <ul>
        <li><strong>作成者</strong>: 作成者は、文書言語の規約に従ってソース文書のスタイルシートを指定します。例えば、HTMLでは、スタイルシートを文書に含めたり、外部にリンクしたりできます。</li>
        <li><strong>ユーザー</strong>:
            ユーザーは特定の文書に対するスタイル情報を指定することができます。例えば、スタイルシートを含むファイルを指定したり、ユーザーエージェントがユーザースタイルシートを生成するインターフェースを提供する場合があります。
        </li>
        <li><strong>ユーザーエージェント</strong>: <a href="conform.html#conformance">準拠するユーザーエージェント</a>は、<span class="index-def"
                title="default style sheet"><a
                    name="default-style-sheet"><dfn>デフォルトスタイルシート</dfn></a></span>を適用する必要があります（またはそのように振る舞います）。ユーザーエージェントのデフォルトスタイルシートは、文書言語に対する一般的な表示期待に合致する方法で文書要素を提示する必要があります（例えば、視覚的ブラウザでは、HTMLのEM要素がイタリックフォントで表示されます）。HTML文書の推奨デフォルトスタイルシートについては、<a
                href="sample.html">HTMLのサンプルスタイルシート</a>を参照してください。</li>
    </ul>

    <P>これら3つの起源からのスタイルシートは、範囲が重なり、カスケードに従って相互作用します。</P>

    <P>CSSの<a name="x12"><span class="index-def"
                title="cascade">カスケード</span></a>は、各スタイルルールに重みを割り当てます。複数のルールが適用される場合、最も重みのあるものが優先されます。</P>

    <P>デフォルトでは、作成者のスタイルシート内のルールは、ユーザースタイルシート内のルールよりも重みがあります。ただし、"!important"ルールの場合、優先順位が逆になります。すべてのユーザーおよび作成者のルールは、UAのデフォルトスタイルシート内のルールよりも重みがあります。
    </P>


    <H3>6.4.1 <a name="cascading-order">カスケード順序</a></H3>

    <P>要素/プロパティの組み合わせの値を見つけるために、ユーザーエージェントは以下のソート順を適用する必要があります:</p>

    <OL>
        <LI>
            対象の<a href="media.html">メディアタイプ</a>に対して、その要素およびプロパティに適用されるすべての宣言を見つけます。
            宣言は、関連するセレクターがその要素に<A HREF="selector.html">一致する</A>
            こと、および対象メディアが宣言を含むすべての@mediaルールやスタイルシートへのパス上のすべてのリンクのメディアリストに一致する場合に適用されます。

        <LI>重要度（normalまたはimportant）および起源（作成者、ユーザー、またはユーザーエージェント）に基づいてソートします。優先順位の昇順は以下の通りです:

            <ol>
                <li>ユーザーエージェントの宣言
                <li>ユーザーの通常の宣言
                <li>作成者の通常の宣言
                <li>作成者のimportant宣言
                <li>ユーザーのimportant宣言
            </ol>

        <LI>
            同じ重要度と起源を持つルールをセレクターの<a
                href="#specificity">特異性</a>でソートします。より具体的なセレクターが、より一般的なものを上書きします。疑似要素と疑似クラスは、それぞれ通常の要素とクラスとしてカウントされます。

        <LI>最後に指定順でソートします。同じ重み、起源、特異性を持つ2つの宣言がある場合、後に指定された方が勝ちます。インポートされたスタイルシート内の宣言は、スタイルシート自体の宣言の前にあると見なされます。

    </OL>

    <P>個々の宣言に設定された"!important"を除いて、この戦略では作成者のスタイルシートが読者のものより高い重みを持ちます。ユーザーエージェントは、特定の作成者スタイルシートの影響をオフにする機能を提供する必要があります（例えば、プルダウンメニューを通じて）。UAAG
        1.0 チェックポイント4.14への準拠がこの条件を満たします<a href="refs.html#ref-UAAG10" rel="biblioentry" class="noxref"><span
                class="normref">[UAAG10]</span></a>。

    <H3>6.4.2 <a name="important-rules">!importantルール</a></H3>

    <P>CSSは、作成者とユーザーのスタイルシート間のバランスを取ろうとします。デフォルトでは、作成者のスタイルシート内のルールはユーザーのスタイルシート内のルールを上書きします（カスケードルール3を参照）。

    <P>しかし、バランスを取るために、"!important"宣言（区切りトークン"!"およびキーワード"important"が宣言に続く）は通常の宣言よりも優先されます。作成者とユーザーのスタイルシートの両方が"!important"宣言を含むことができ、ユーザーの"!important"ルールは作成者の"!important"ルールを上書きします。このCSS機能により、特別な要件（大きなフォント、色の組み合わせなど）を持つユーザーがプレゼンテーションを制御することで、文書のアクセシビリティが向上します。

    <P><a name="x13"><span class="index-inst" title="shorthand
property">ショートハンドプロパティ</span></a>（例: <a href="colors.html#propdef-background" class="noxref"><span
                class="propinst-background">'background'</span></a>）を"!important"として宣言することは、そのすべてのサブプロパティを"!important"として宣言することと同等です。

    <div class="example">
        <P style="display:none">例:</P>
        <P>次の例では、ユーザーのスタイルシートの最初のルールが"!important"宣言を含んでおり、作成者のスタイルシート内の対応する宣言を上書きします。2番目の宣言も"!important"としてマークされているため、勝ちます。しかし、3番目のルールは"!important"ではないため、作成者のスタイルシート内の2番目のルールに負けます（これはショートハンドプロパティにスタイルを設定しています）。また、作成者の3番目のルールは、2番目のルールが"!important"であるため負けます。これにより、"!important"宣言が作成者スタイルシート内でも機能を持つことが示されています。

        <PRE>
/* ユーザーのスタイルシート */
p { text-indent: 1em ! important }
p { font-style: italic ! important }
p { font-size: 18pt }

/* 作成者のスタイルシート */
p { text-indent: 1.5em !important }
p { font: normal 12pt sans-serif !important }
p { font-size: 24pt }
</PRE>
    </div>

    <H3>6.4.3 <a name="specificity">セレクターの特異性の計算</a></H3>

    <P>セレクターの特異性は以下のように計算されます:</p>

    <ul>
        <li>宣言がセレクターを持つルールではなく'style'属性からのものである場合は1をカウントし、それ以外の場合は0をカウントします（=
            a）。（HTMLでは、要素の"style"属性の値はスタイルシートルールです。これらのルールにはセレクターがないため、a=1, b=0, c=0, d=0です。）

        <li>セレクター内のID属性の数をカウントします（= b）

        <li>セレクター内のその他の属性および疑似クラスの数をカウントします（= c）

        <li>セレクター内の要素名および疑似要素の数をカウントします（= d）
    </ul>

    <p>特異性はセレクターの形式のみに基づいています。特に、"[id=p33]"の形式のセレクターは、ソース文書のDTDでid属性が"ID"として定義されている場合でも、属性セレクターとしてカウントされます（a=0, b=0,
        c=1, d=0）。

    <P>4つの数値a-b-c-dを連結することで（大きな基数を持つ数値システムで）、特異性が決まります。

    <div class="example">
        <P style="display:none">例:</P>
        <P>
            一部の例:

        <PRE>
 *             {}  /* a=0 b=0 c=0 d=0 -> 特異性 = 0,0,0,0 */
 li            {}  /* a=0 b=0 c=0 d=1 -> 特異性 = 0,0,0,1 */
 li:first-line {}  /* a=0 b=0 c=0 d=2 -> 特異性 = 0,0,0,2 */
 ul li         {}  /* a=0 b=0 c=0 d=2 -> 特異性 = 0,0,0,2 */
 ul ol+li      {}  /* a=0 b=0 c=0 d=3 -> 特異性 = 0,0,0,3 */
 h1 + *[rel=up]{}  /* a=0 b=0 c=1 d=1 -> 特異性 = 0,0,1,1 */
 ul ol li.red  {}  /* a=0 b=0 c=1 d=3 -> 特異性 = 0,0,1,3 */
 li.red.level  {}  /* a=0 b=0 c=2 d=1 -> 特異性 = 0,0,2,1 */
 #x34y         {}  /* a=0 b=1 c=0 d=0 -> 特異性 = 0,1,0,0 */
 style=""          /* a=1 b=0 c=0 d=0 -> 特異性 = 1,0,0,0 */
</PRE>
    </div>

    <div class="html example">

        <pre>
&lt;HEAD&gt;
&lt;STYLE type="text/css"&gt;
  #x97z { color: red }
&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;P ID=x97z style="color: green"&gt;
&lt;/BODY&gt;
</pre>

        <P>上記の例では、P要素の色は緑になります。"style"属性内の宣言は、より高い特異性を持つため、STYLE要素内の宣言を上書きします。
    </div>

    <H3>6.4.4 <a name="preshint">非CSSプレゼンテーションのヒントの優先順位</a></H3>

    <P>ユーザーエージェントはHTMLソース文書内のプレゼンテーション属性を尊重することを選択できます。その場合、これらの属性は特異性が0の対応するCSSルールに変換され、作成者のスタイルシートの先頭に挿入されたかのように扱われます。したがって、後続のスタイルシートルールによって上書きされる可能性があります。この移行段階では、スタイル属性がスタイルシートと共存しやすくなります。

    <P>HTMLの場合、以下のリストにない属性はプレゼンテーションと見なされます: abbr, accept-charset, accept, accesskey, action, alt, archive, axis,
        charset, checked, cite, class, classid, code, codebase, codetype, colspan, coords, data, datetime, declare,
        defer, dir, disabled, enctype, for, headers, href, hreflang, http-equiv, id, ismap, label, lang, language,
        longdesc, maxlength, media, method, multiple, name, nohref, object, onblur, onchange, onclick, ondblclick,
        onfocus, onkeydown, onkeypress, onkeyup, onload, onload, onmousedown, onmousemove, onmouseout, onmouseover,
        onmouseup, onreset, onselect, onsubmit, onunload, onunload, profile, prompt, readonly, rel, rev, rowspan,
        scheme, scope, selected, shape, span, src, standby, start, style, summary, title, type (LI, OLおよびUL要素を除く),
        usemap, value, valuetype, version.

    <P>他の言語では、すべての文書言語ベースのスタイリングは対応するCSSに変換され、ユーザーエージェントレベルでカスケードに入るか、HTMLのプレゼンテーションヒントと同様に、作成者レベルのルールとして特異性0で作成者スタイルシートの先頭に配置される必要があります。

    <div class="example">
        <P style="display:none">例:</P>

        <p>次のユーザースタイルシートは、すべての文書内の'b'要素のフォントウェイトを上書きし、XML文書内の'font'要素のcolor属性を持つものの色を上書きします。ただし、HTML文書内のcolor属性を持つ'font'要素の色には影響しません:

        <pre>
b { font-weight: normal; }
font[color] { color: orange; }
</pre>

        <P>しかし、次の例では、すべての文書内のfont要素の色を上書きします:

        <pre>
font[color] { color: orange ! important; }
</pre>
    </div>

    <hr class="navbar">

    <div class="navbar">
        <p><a href="selector.html">前へ</a> &nbsp;
            <a href="media.html">次へ</a> &nbsp;
            <a href="index.html#minitoc">目次</a> &nbsp;
            <a href="propidx.html">プロパティ</a> &nbsp;
            <a href="indexlist.html">索引</a> &nbsp;
    </div>
</BODY>

</html>