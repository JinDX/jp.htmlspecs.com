<!doctype html>
<html lang="ja-JP">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>CSSカスタムハイライトAPIモジュール レベル1</title>
    <meta content="WD" name="w3c-status">
    <meta content="Bikeshed version 4f3d0b2d0, updated Wed Dec 1 15:41:36 2021 -0800" name="generator">
    <link href="https://www.w3.org/TR/css-highlight-api-1/" rel="canonical">
    <meta content="0a0f76a6474c033587a4e23225986e334e38d02a" name="document-revision">
    <style>
        .sample-out {
            background: white;
            padding: 0.5ch;
            border: solid 1px;
            font-size: 2em;
        }
    </style>
    <style>
        /* style-autolinks */

        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }
    </style>
    <style>
        /* style-counters */

        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* style-dfn-panel */

        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0;
        }

        .dfn-panel li {
            list-style: inside;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled {
            cursor: pointer;
        }
    </style>
    <style>
        /* style-issues */

        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* style-md-lists */

        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* style-selflinks */

        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* style-syntax-highlighting */

        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }

        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */
    </style>
    <style>
        /* style-var-click-highlighting */

        var {
            cursor: pointer;
        }

        var.selected0 {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var.selected1 {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var.selected2 {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var.selected3 {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var.selected4 {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var.selected5 {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var.selected6 {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>
    <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD" rel="stylesheet">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">CSSカスタムハイライトAPIモジュール レベル1</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C作業草案</a>、<time class="dt-updated"
                datetime="2021-12-15">2021年12月15日</time></p>
        <details open>
            <summary>この文書の詳細</summary>
            <div data-fill-with="spec-metadata">
                <dl>
                    <dt>このバージョン:
                    <dd><a class="u-url"
                            href="https://www.w3.org/TR/2021/WD-css-highlight-api-1-20211215/">https://www.w3.org/TR/2021/WD-css-highlight-api-1-20211215/</a>
                    <dt>最新版:
                    <dd><a
                            href="https://www.w3.org/TR/css-highlight-api-1/">https://www.w3.org/TR/css-highlight-api-1/</a>
                    <dt>編集者ドラフト:
                    <dd><a
                            href="https://drafts.csswg.org/css-highlight-api-1/">https://drafts.csswg.org/css-highlight-api-1/</a>
                    <dt>以前のバージョン:
                    <dd><a href="https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201022/"
                            rel="prev">https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201022/</a>
                    <dd><a href="https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201208/"
                            rel="prev">https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201208/</a>
                    <dt>履歴:
                    <dd><a class="u-url"
                            href="https://www.w3.org/standards/history/css-highlight-api-1">https://www.w3.org/standards/history/css-highlight-api-1</a>
                    <dt>フィードバック:
                    <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-highlight-api-1">CSSWG課題リポジトリ</a>
                    <dd><a href="#issues-index">仕様内インライン</a>
                    <dt class="editor">編集者:
                    <dd class="editor p-author h-card vcard" data-editor-id="43241"><a class="p-name fn u-url url"
                            href="https://florian.rivoal.net/">Florian Rivoal</a> (<span
                            class="p-org org">Bloomberg代表</span>)
                    <dd class="editor p-author h-card vcard" data-editor-id="115721"><a class="p-name fn u-url url"
                            href="https://github.com/sanketj">Sanket Joshi</a> (<a class="p-org org"
                            href="https://www.microsoft.com">Microsoft Corporation</a>)
                    <dd class="editor p-author h-card vcard" data-editor-id="110930"><span class="p-name fn">Megan
                            Gardner</span> (<a class="p-org org" href="https://apple.com/">Apple Inc.</a>)
                    <dt>この仕様の編集提案:
                    <dd><a
                            href="https://github.com/w3c/csswg-drafts/blob/main/css-highlight-api-1/Overview.bs">GitHubエディター</a>
                </dl>
            </div>
        </details>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2021 <a
                href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
                href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a
                href="https://www.ercim.eu/"><abbr
                    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a
                href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive
                document license</a> rules apply. </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">概要</span></h2>
        <p>このCSSモジュールは、スクリプトによって識別された文書内の任意の範囲をスタイル設定する仕組みを説明します。</p>
        <a href="https://www.w3.org/TR/CSS/">CSS</a>は、構造化文書（HTMLやXMLなど）の画面表示、印刷などのレンダリングを記述する言語です。
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">この文書のステータス</span></h2>
    <div data-fill-with="status">
        <p><em>このセクションは、本書の発行時点でのステータスを説明します。
                現在のW3C出版物およびこの技術レポートの最新版は
                <a href="https://www.w3.org/TR/">W3C技術レポート索引 https://www.w3.org/TR/</a> でご覧いただけます。</em> </p>
        <p> この文書は、<a href="https://www.w3.org/groups/wg/css">CSSワーキンググループ</a>が
            <strong>作業草案</strong>として
            <a href="https://www.w3.org/2021/Process-20211102/#recs-and-notes">勧告トラック</a>を用いて発行しました。
            作業草案としての公開は
            <abbr title="World Wide Web Consortium">W3C</abbr>およびその会員による承認を意味するものではありません。
        </p>
        <p> この文書はドラフトであり、随時更新、置換、または他の文書によって廃止される可能性があります。
            この文書を進行中の作業以外として引用することは適切ではありません。 </p>
        <p>フィードバックは
            <a href="https://github.com/w3c/csswg-drafts/issues">GitHubでissueを提出</a>（推奨）してください。
            タイトルに仕様コード「css-highlight-api」を含めてください（例: “[css-highlight-api] <i>…コメント要約…</i>”）。
            すべての課題とコメントは<a href="https://lists.w3.org/Archives/Public/public-css-archive/">アーカイブ</a>されています。
            または、(<a href="https://lists.w3.org/Archives/Public/www-style/">アーカイブ</a>) 公開メーリングリスト <a
                href="mailto:www-style@w3.org?Subject=%5Bcss-highlight-api%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>へ送ってください。
        </p>
        <p>この文書は <a href="https://www.w3.org/2021/Process-20211102/" id="w3c_process_revision">2021年11月2日
                W3Cプロセス文書</a>に準拠しています。 </p>
        <p>この文書は、<a href="https://www.w3.org/Consortium/Patent-Policy-20200915/">W3C特許ポリシー</a>の下で活動するグループによって作成されました。
            W3Cは、グループの成果物に関連して提出された特許開示の
            <a href="https://www.w3.org/2004/01/pp-impl/32061/status" rel="disclosure">公開リスト</a>を管理しています。
            このページには特許開示方法の案内も掲載されています。
            個人が特許に関する実質的な知識を有し、その特許が<a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#def-essential">必須クレーム</a>を含むと考える場合、
            <a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#sec-Disclosure">W3C特許ポリシー第6節</a>に従って情報開示しなければなりません。
        </p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目次</h2>
        <ol class="toc" role="directory">
            <li><a href="#intro"><span class="secno">1</span> <span class="content"> はじめに</span></a>
            <li><a href="#interaction"><span class="secno">2</span> <span class="content"> モジュールの相互作用</span></a>
            <li>
                <a href="#highlights-set-up"><span class="secno">3</span> <span class="content"> カスタムハイライトの設定</span></a>
                <ol class="toc">
                    <li><a href="#creation"><span class="secno">3.1</span> <span class="content">
                                カスタムハイライトの作成</span></a>
                    <li><a href="#registration"><span class="secno">3.2</span> <span class="content">
                                カスタムハイライトの登録</span></a>
                </ol>
            <li>
                <a href="#styling-highlights"><span class="secno">4</span> <span class="content">
                        カスタムハイライトのスタイリング</span></a>
                <ol class="toc">
                    <li><a href="#custom-highlight-pseudo"><span class="secno">4.1</span> <span class="content">
                                カスタムハイライト疑似要素: <span class="css">::highlight()</span></span></a>
                    <li>
                        <a href="#processing-model"><span class="secno">4.2</span> <span class="content">
                                処理モデル</span></a>
                        <ol class="toc">
                            <li><a href="#applicable-properties"><span class="secno">4.2.1</span> <span class="content">
                                        適用可能なプロパティ</span></a>
                            <li><a href="#default-styles"><span class="secno">4.2.2</span> <span class="content">
                                        デフォルトスタイル</span></a>
                            <li><a href="#c-and-h"><span class="secno">4.2.3</span> <span class="content">
                                        カスケードと継承</span></a>
                            <li><a href="#painting"><span class="secno">4.2.4</span> <span class="content">
                                        ペインティング</span></a>
                            <li><a href="#priorities"><span class="secno">4.2.5</span> <span class="content">
                                        重複ハイライトの優先順位</span></a>
                            <li><a href="#highlight-types"><span class="secno">4.2.6</span> <span class="content">
                                        ハイライトタイプ</span></a>
                        </ol>
                </ol>
            <li>
                <a href="#responding-to-changes"><span class="secno">5</span> <span class="content"> 変更への対応</span></a>
                <ol class="toc">
                    <li><a href="#repaint"><span class="secno">5.1</span> <span class="content"> 再描画</span></a>
                    <li><a href="#range-invalidation"><span class="secno">5.2</span> <span class="content">
                                範囲の更新と無効化</span></a>
                </ol>
            <li><a href="#events"><span class="secno">6</span> <span class="content"> イベント処理</span></a>
            <li><a href="#priv-sec"><span class="secno"></span> <span class="content"> 付録A.
                        プライバシーとセキュリティに関する考慮事項</span></a>
            <li><a href="#credits"><span class="secno"></span> <span class="content"> 付録B. 謝辞</span></a>
            <li>
                <a href="#changes"><span class="secno"></span> <span class="content"> 付録C. 変更履歴</span></a>
                <ol class="toc">
                    <li><a href="#changes-since-20201208"><span class="secno"></span> <span class="content">
                                <span>2020年12月8日 作業草案</span>以降の変更点</span></a>
                    <li><a href="#changes-since-20201022"><span class="secno"></span> <span class="content">
                                <span>2020年10月22日 作業草案</span>以降の変更点</span></a>
                </ol>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content"> 適合性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content"> 文書の規約</span></a>
                    <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content">
                                適合クラス</span></a>
                    <li>
                        <a href="#w3c-partial"><span class="secno"></span> <span class="content"> 部分実装</span></a>
                        <ol class="toc">
                            <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span
                                        class="content"> 不安定および独自機能の実装</span></a>
                        </ol>
                    <li><a href="#w3c-testing"><span class="secno"></span> <span class="content"> 非実験的実装</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本仕様で定義される用語</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">参照によって定義される用語</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">規範参照</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">課題索引</span></a>
        </ol>
    </nav>
    <main>
        <div class="non-normative">
            <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">
                    はじめに</span><a class="self-link" href="#intro"></a></h2>
            <p><em>このセクションは非規範です</em>。</p>
            <p>カスタムハイライトAPIは、<a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                    id="ref-for-highlight-pseudo-element">ハイライト疑似要素</a>（<a
                    href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudos"><cite>CSS Pseudo-Elements 4</cite> § 3
                    ハイライト疑似要素</a>参照）の概念を拡張し、
                ウェブ開発者が任意のRangeオブジェクトのテキストをスタイルできるようにします。
                これは、ユーザーエージェントによって定義される<a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-pseudo-4/#selectordef-selection"
                    id="ref-for-selectordef-selection">::selection</a>、<span class="css">::inactive-selection</span>、
                <a class="css" data-link-type="maybe"
                    href="https://www.w3.org/TR/css-pseudo-4/#selectordef-spelling-error"
                    id="ref-for-selectordef-spelling-error">::spelling-error</a>、
                および<span class="css">'::grammar-error</span>'に限定されずに利用できます。
                これは、独自の選択範囲を実装する編集フレームワークや、
                仮想化された文書上のページ内検索、
                オンライン共同編集を表現する複数選択、
                またはスペルチェックフレームワークなど、様々なシナリオで有用です。
            </p>
            <p>カスタムハイライトAPIは、DOM構造に影響を与えず、
                Rangeオブジェクトに基づいてテキストにスタイルを適用するプログラム的なハイライト追加・削除方法を提供します。
                これは<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                    id="ref-for-concept-range">range</a>オブジェクトを利用し、
                <a class="css" data-link-type="maybe" href="#selectordef-highlight-custom-highlight-name"
                    id="ref-for-selectordef-highlight-custom-highlight-name">::highlight()</a>疑似要素を介してアクセスできます。
            </p>
            <div class="example" id="intro-ex">
                <a class="self-link" href="#intro-ex"></a> 以下のコードは<a class="css" data-link-type="maybe"
                    href="#selectordef-highlight-custom-highlight-name"
                    id="ref-for-selectordef-highlight-custom-highlight-name①">::highlight()</a>疑似要素を使い、
                テキスト<q>One two</q>に黄色の背景色と青色の前景色を適用しています。
                これは、<code
                    class="idl"><a data-link-type="idl" href="#highlight" id="ref-for-highlight">Highlight</a></code>を
                <code
                    class="idl"><a data-link-type="idl" href="#highlightregistry" id="ref-for-highlightregistry">HighlightRegistry</a></code>
                に追加することで実現します（どちらも本仕様で新しく導入された概念です）。
                <code
                    class="idl"><a data-link-type="idl" href="#highlight" id="ref-for-highlight①">Highlight</a></code>は
                <code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range">Range</a></code>
                を含み、その境界点は<q>One two</q>のテキストを囲みます。
                <pre class="highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>:</c-><c- nd>root</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>example-highlight</c-><c- o>)</c-> <c- p>{</c->
    <c- k>background-color</c-><c- p>:</c-> <c- kc>yellow</c-><c- p>;</c->
    <c- k>color</c-><c- p>:</c-> <c- kc>blue</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>body</c-><c- p>>&lt;</c-><c- f>span</c-><c- p>></c->One <c- p>&lt;/</c-><c- f>span</c-><c- p>>&lt;</c-><c- f>span</c-><c- p>></c->two <c- p>&lt;/</c-><c- f>span</c-><c- p>>&lt;</c-><c- f>span</c-><c- p>></c->three…<c- p>&lt;/</c-><c- f>span</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>let</c-> r <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r<c- p>.</c->setStart<c- p>(</c->document<c- p>.</c->body<c- p>,</c-> <c- mf>0</c-><c- p>);</c->
  r<c- p>.</c->setEnd<c- p>(</c->document<c- p>.</c->body<c- p>,</c-> <c- mf>2</c-><c- p>);</c->

  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- u>"example-highlight"</c-><c- p>,</c-> <c- k>new</c-> Highlight<c- p>(</c->r<c- p>));</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
                <p>結果イメージ：</p>
                <div class="sample-out"> <span style="background-color:yellow;color:blue;">One Two </span>three… </div>
            </div>
        </div>
        <h2 class="heading settled" data-level="2" id="interaction"><span class="secno">2. </span><span class="content">
                モジュールの相互作用</span><a class="self-link" href="#interaction"></a></h2>
        <p>このモジュールはInfra標準<a data-link-type="biblio" href="#biblio-infra">[INFRA]</a>とWebIDL<a data-link-type="biblio"
                href="#biblio-webidl">[WebIDL]</a>に依存します。</p>
        <p>CSSおよびDOM標準<a data-link-type="biblio" href="#biblio-dom">[DOM]</a>に関する一般的な知識を前提とし、
            特にCSS Pseudo-Elements Module Level 4<a data-link-type="biblio"
                href="#biblio-css-pseudo-4">[css-pseudo-4]</a>で定義された仕組みを
            <a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                id="ref-for-highlight-pseudo-element①">ハイライト疑似要素</a>の扱いに拡張します。
            Selectors Level 4<a data-link-type="biblio" href="#biblio-selectors-4">[selectors-4]</a>仕様は、
            <a data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#pseudo-element"
                id="ref-for-pseudo-element">疑似要素</a>の一般動作を定義しています。
        </p>
        <p>依存関係の全リストは<a href="#references">参考文献</a>を参照してください。</p>
        <p class="note" role="note"><span>注:</span> このドラフトは初期バージョンです。
            今後成熟するにつれ、CSS-WGは独立したモジュールとして維持するか、
            <a data-link-type="biblio" href="#biblio-css-pseudo-4">[css-pseudo-4]</a>またはその後継バージョンに統合することを選択する可能性があります。
        </p>
        <h2 class="heading settled" data-level="3" id="highlights-set-up"><span class="secno">3. </span><span
                class="content"> カスタムハイライトの設定</span><a class="self-link" href="#highlights-set-up"></a>
        </h2>
        <h3 class="heading settled" data-level="3.1" id="creation"><span class="secno">3.1. </span><span
                class="content"> カスタムハイライトの作成</span><a class="self-link" href="#creation"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="custom-highlight">カスタムハイライト</dfn>は、ドキュメントの一部を表す<a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range" id="ref-for-concept-range①">Range</a>の集合です。
            必ずしも要素ツリーに収まる必要はなく、
            ネスト構造を無視して任意に要素境界をまたぐことができます。
            これらのドキュメント部分の外観に影響を与えたり
            （<a href="#styling-highlights">§ 4 カスタムハイライトのスタイリング</a>参照）、
            関連するイベントを処理したりするために利用できます
            （<a href="#events">§ 6 イベント処理</a>参照）。</p>
        <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight">カスタムハイライト</a>は、<dfn
                class="dfn-paneled idl-code" data-dfn-type="interface" data-export
                id="highlight"><code>Highlight</code></dfn>オブジェクト、つまり<a data-link-type="dfn"
                href="https://webidl.spec.whatwg.org/#dfn-setlike" id="ref-for-dfn-setlike">setlike</a>オブジェクトであり、その<a
                data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-set-entries"
                id="ref-for-dfn-set-entries">セットエントリ</a>は<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abstractrange" id="ref-for-abstractrange">AbstractRange</a></code>オブジェクトです。<a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                id="ref-for-concept-range②">Range</a>は、コンストラクタに渡すことで<span
                id="ref-for-custom-highlight①">カスタムハイライト</span>に追加することができ、
            または<span id="ref-for-dfn-setlike①">setlike</span>オブジェクトの通常のAPIを使って
            その<span id="ref-for-dfn-set-entries①">セットエントリ</span>を操作することもできます。</p>
        <p class="note" role="note"><span>注:</span> <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range" id="ref-for-concept-range③">カスタムハイライト</a>内の<a
                data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight②">range</a>は<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abstractrange" id="ref-for-abstractrange①">AbstractRange</a></code>
            オブジェクトなので、作者は<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range①">Range</a></code>
            オブジェクトと<code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange">StaticRange</a></code>
            オブジェクトのどちらを使うか選択できます。
            詳細とその影響については<a href="#range-invalidation">§ 5.2 範囲の更新と無効化</a>を参照してください。
        </p>
        <pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-highlighttype"><code><c- g>HighlightType</c-></code></dfn> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="HighlightType" data-dfn-type="enum-value" data-export id="dom-highlighttype-highlight"><code><c- s>"highlight"</c-></code></dfn>,
  <dfn class="dfn-paneled idl-code" data-dfn-for="HighlightType" data-dfn-type="enum-value" data-export id="dom-highlighttype-spelling-error"><code><c- s>"spelling-error"</c-></code></dfn>,
  <dfn class="dfn-paneled idl-code" data-dfn-for="HighlightType" data-dfn-type="enum-value" data-export id="dom-highlighttype-grammar-error"><code><c- s>"grammar-error"</c-></code></dfn>
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#highlight" id="ref-for-highlight②"><c- g>Highlight</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-highlight-highlight" id="ref-for-dom-highlight-highlight"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abstractrange" id="ref-for-abstractrange②"><c- n>AbstractRange</c-></a>... <dfn class="dfn-paneled idl-code" data-dfn-for="Highlight/Highlight(...initialRanges), Highlight/constructor(...initialRanges), Highlight/Highlight(), Highlight/constructor()" data-dfn-type="argument" data-export id="dom-highlight-highlight-initialranges-initialranges"><code><c- g>initialRanges</c-></code></dfn>);
  <c- b>setlike</c->&lt;<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abstractrange" id="ref-for-abstractrange③"><c- n>AbstractRange</c-></a>>;
  <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long"><c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Highlight" data-dfn-type="attribute" data-export data-type="long" id="dom-highlight-priority"><code><c- g>priority</c-></code></dfn>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-highlighttype" id="ref-for-enumdef-highlighttype"><c- n>HighlightType</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Highlight" data-dfn-type="attribute" data-export data-type="HighlightType" id="dom-highlight-type"><code><c- g>type</c-></code></dfn>;
};
</pre>
        <p><code
                class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority">priority</a></code>
            属性の詳細は<a href="#priorities">§ 4.2.5 重複ハイライトの優先順位</a>を参照してください。</p>
        <p><code
                class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type">type</a></code>
            属性の詳細は<a href="#highlight-types">§ 4.2.6 ハイライトタイプ</a>を参照してください。</p>
        <div class="algorithm" data-algorithm="to create a custom highlight">
            <dfn class="dfn-paneled idl-code" data-dfn-for="Highlight" data-dfn-type="constructor" data-export
                data-lt="Highlight(...initialRanges)|constructor(...initialRanges)|Highlight()|constructor()"
                id="dom-highlight-highlight"><code>Highlight(AbstractRange... initialRanges)</code></dfn>
            コンストラクタが呼び出されたとき、次の手順を実行します:
            <ol>
                <li><var>highlight</var>を新しい<code
                        class="idl"><a data-link-type="idl" href="#highlight" id="ref-for-highlight③">Highlight</a></code>
                    オブジェクトとする。
                <li><var>highlight</var>の<code
                        class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority①">priority</a></code>
                    を<code>0</code>に設定する。
                <li><var>highlight</var>の<code
                        class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type①">type</a></code>
                    を<code
                        class="idl"><a data-link-type="idl" href="#dom-highlighttype-highlight" id="ref-for-dom-highlighttype-highlight">highlight</a></code>に設定する。
                <li><code
                        class="idl"><a data-link-type="idl" href="#dom-highlight-highlight-initialranges-initialranges" id="ref-for-dom-highlight-highlight-initialranges-initialranges">initialRanges</a></code>
                    の各<var>range</var>について、
                    <var>rangeArg</var>を<a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#dfn-convert-idl-to-ecmascript-value"
                        id="ref-for-dfn-convert-idl-to-ecmascript-value">IDL値をECMAScript値に変換</a>した結果とし、
                    <a href="https://webidl.spec.whatwg.org/#es-add-delete">組み込みsetlikeのadd関数の手順</a>を
                    <var>highlight</var>を<code>this</code>値とし、<var>rangeArg</var>を引数として実行する。
                <li><var>highlight</var>を返す。
            </ol>
        </div>
        <h3 class="heading settled" data-level="3.2" id="registration"><span class="secno">3.2. </span><span
                class="content"> カスタムハイライトの登録</span><a class="self-link" href="#registration"></a></h3>
        <p>効果を持たせるためには、<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight③">カスタムハイライト</a>を<a
                data-link-type="dfn" href="#registered" id="ref-for-registered">登録</a>し、<a data-link-type="dfn"
                href="#highlight-registry" id="ref-for-highlight-registry">ハイライトレジストリ</a>に入れる必要があります。</p>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="highlight-registry">ハイライトレジストリ</dfn>は、<code
                class="idl"><a data-link-type="idl" href="#dom-css-highlights" id="ref-for-dom-css-highlights">highlights</a></code>
            属性を介して<code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css">CSS</a></code>
            名前空間からアクセスでき、
            <a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight④">登録済みカスタムハイライト</a>全てを表します。
            これは<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object"
                id="ref-for-current-global-object">現在のグローバルオブジェクト</a>の<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window"
                id="ref-for-concept-document-window">関連付けられたDocument</a>に対して有効です。
            <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-maplike"
                id="ref-for-dfn-maplike">maplike</a>であり、通常のメソッドで更新できます。
            <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-map-entries"
                id="ref-for-dfn-map-entries">map entries</a>は初期状態では空です。
        </p>
        <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight⑤">カスタムハイライト</a>が<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport id="registered">登録済み</dfn>であると言うのは、それが<a
                data-link-type="dfn" href="#highlight-registry"
                id="ref-for-highlight-registry①">ハイライトレジストリ</a>に存在する場合です。
            後で削除された場合、<a data-link-type="dfn" href="#registered" id="ref-for-registered②">登録済み</a>ではなくなります。</p>
        <pre class="idl highlight def"><c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://www.w3.org/TR/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css①"><c- g>CSS</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#highlightregistry" id="ref-for-highlightregistry①"><c- n>HighlightRegistry</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="CSS" data-dfn-type="attribute" data-export data-readonly data-type="HighlightRegistry" id="dom-css-highlights"><code><c- g>highlights</c-></code></dfn>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="highlightregistry"><code><c- g>HighlightRegistry</c-></code></dfn> {
  <c- b>maplike</c->&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a>, <a data-link-type="idl-name" href="#highlight" id="ref-for-highlight④"><c- n>Highlight</c-></a>>;
};
</pre>
        <div class="algorithm" data-algorithm="to register a custom highlight">
            <a data-link-type="dfn" href="#registered" id="ref-for-registered③">カスタムハイライトを登録する</a>には、
            <a data-link-type="dfn" href="#highlight-registry"
                id="ref-for-highlight-registry②">ハイライトレジストリ</a>の<code>set</code>メソッドを呼び出します。
            これにより、<a href="https://webidl.spec.whatwg.org/#es-map-set">組み込みmaplikeのset関数の手順</a>が
            <code>this</code>値としてコンテキストオブジェクトを、
            <var>keyArg</var>として渡された<a data-link-type="dfn" href="#custom-highlight-name"
                id="ref-for-custom-highlight-name">カスタムハイライト名</a>、
            <var>valueArg</var>として渡されたハイライトを使って実行されます。
            <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight⑦">カスタムハイライト</a>を<a
                    data-link-type="dfn" href="#registered" id="ref-for-registered④">登録</a>する際に割り当てる<dfn
                    class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="custom-highlight-name">カスタムハイライト名</dfn>は、スタイリング時（<a href="#styling-highlights">§ 4
                    カスタムハイライトのスタイリング</a>参照）にハイライトを識別するために使われます。</p>
            <p class="note" role="note"><span>注:</span> <a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight⑧">カスタムハイライト</a>を登録する際、
                作者は<a data-link-type="dfn" href="#custom-highlight-name"
                    id="ref-for-custom-highlight-name①">カスタムハイライト名</a>に有効なCSS<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-syntax-3/#identifier" id="ref-for-identifier">識別子</a>を使うことを推奨します。
                有効な識別子でない名前を使うと、CSSでハイライトをスタイルするのが困難、場合によっては不可能になります。</p>
            <p class="note" role="note"><span>注:</span> 1つの<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight⑨">カスタムハイライト</a>に複数の<a data-link-type="dfn"
                    href="#custom-highlight-name" id="ref-for-custom-highlight-name②">カスタムハイライト名</a>を登録することも可能です。
                しかし、1つのハイライトに複数の名前でスタイルを当てると、
                それぞれ独立したスタイルセットが割り当てられ、<a href="#painting">ペインティング</a>時にそれらの競合するスタイルの重ね順を制御できません。
                これは作者にとって制限となり、混乱するペインティング結果になる可能性があります（詳細は下記<a
                    href="#styling-problems-with-multiple-names-per-highlight">例</a>参照）。
                よって、<b>スタイリング時はハイライトにつき1つの名前のみ使用することを推奨します</b>。</p>
            <div class="example" id="styling-problems-with-multiple-names-per-highlight">
                <a class="self-link" href="#styling-problems-with-multiple-names-per-highlight"></a>
                <pre class="highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- f>div</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>bar</c-><c- o>)</c-> <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> <c- kc>red</c-><c- p>;</c->
  <c- p>}</c->
  <c- f>div</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>foo</c-><c- o>)</c-> <c- p>{</c->
    <c- k>color</c-><c- p>:</c-> <c- kc>green</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>body</c-><c- p>>&lt;</c-><c- f>div</c-><c- p>></c->abc<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>let</c-> div <c- o>=</c-> document<c- p>.</c->body<c- p>.</c->firstChild<c- p>;</c->
  <c- a>let</c-> r <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r<c- p>.</c->setStart<c- p>(</c->div<c- p>,</c-> <c- mf>0</c-><c- p>);</c->
  r<c- p>.</c->setEnd<c- p>(</c->div<c- p>,</c-> <c- mf>1</c-><c- p>);</c->
  <c- a>let</c-> h <c- o>=</c-> <c- k>new</c-> Highlight<c- p>(</c->r<c- p>);</c->
  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- t>'foo'</c-><c- p>,</c-> h<c- p>);</c->
  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- t>'bar'</c-><c- p>,</c-> h<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
                <p>上記の例では、同じ<a data-link-type="dfn" href="#custom-highlight"
                        id="ref-for-custom-highlight①⓪">カスタムハイライト</a>オブジェクトが<code>foo</code>と<code>bar</code>という名前で<a
                        data-link-type="dfn" href="#registered" id="ref-for-registered⑥">登録</a>されています。
                    それぞれの<a data-link-type="dfn" href="https://www.w3.org/TR/css-syntax-3/#style-rule"
                        id="ref-for-style-rule">スタイルルール</a>は同じハイライトを対象とし、<a data-link-type="dfn"
                        href="https://www.w3.org/TR/selectors-4/#specificity" id="ref-for-specificity">詳細度</a>も同じなので、
                    作者はカスケード順で最後のルールが優先され、ハイライト部分が緑色になると予想するかもしれません。
                    しかし、各ハイライト名は独立したスタイルセットを持ち、ハイライトは名前ごとに描画されます。
                    この場合、<code>foo</code>が<code>bar</code>より先に登録されたため、
                    まず<code>foo</code>の色（緑）で描画され、次に<code>bar</code>の色（赤）で描画されます。
                    その結果、ハイライト部分は赤色に見えます。</p>
            </div>
            <h2 class="heading settled" data-level="4" id="styling-highlights"><span class="secno">4. </span><span
                    class="content">カスタムハイライトのスタイリング</span><a class="self-link" href="#styling-highlights"></a></h2>
            <h3 class="heading settled" data-level="4.1" id="custom-highlight-pseudo"><span class="secno">4.1.
                </span><span class="content">カスタムハイライト疑似要素：<a class="css" data-link-type="maybe"
                        href="#selectordef-highlight-custom-highlight-name"
                        id="ref-for-selectordef-highlight-custom-highlight-name②">::highlight()</a></span><a
                    class="self-link" href="#custom-highlight-pseudo"></a></h3>
            <p><dfn class="dfn-paneled css" data-dfn-type="selector" data-export
                    id="selectordef-highlight-custom-highlight-name">::highlight(<a class="production css"
                        data-link-type="type" href="#typedef-custom-highlight-name"
                        id="ref-for-typedef-custom-highlight-name">&lt;custom-highlight-name></a>)</dfn>疑似要素（<dfn
                    class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="custom-highlight-pseudo-element">カスタムハイライト疑似要素</dfn>とも呼ばれる）は、
                文書内で<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#contained"
                    id="ref-for-contained">含まれる</a>または<a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#partially-contained"
                    id="ref-for-partially-contained">部分的に含まれる</a>
                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                    id="ref-for-concept-range④">range</a>のすべての<a data-link-type="dfn" href="#registered"
                    id="ref-for-registered⑦">登録済み</a><a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight①①">カスタムハイライト</a>（<a data-link-type="dfn" href="#custom-highlight-name"
                    id="ref-for-custom-highlight-name③">カスタムハイライト名</a>
                <a class="production css" data-link-type="type" href="#typedef-custom-highlight-name"
                    id="ref-for-typedef-custom-highlight-name①">&lt;custom-highlight-name></a>）があれば、それを表します。
                <dfn class="dfn-paneled css" data-dfn-type="type" data-export id="typedef-custom-highlight-name"><a
                        class="production css" data-link-type="type" href="#typedef-custom-highlight-name"
                        id="ref-for-typedef-custom-highlight-name②">&lt;custom-highlight-name></a></dfn>は有効なCSS
                <a class="production css" data-link-type="type"
                    href="https://www.w3.org/TR/css-syntax-3/#typedef-ident-token"
                    id="ref-for-typedef-ident-token">&lt;ident-token></a>でなければなりません。
            </p>
            <h3 class="heading settled" data-level="4.2" id="processing-model"><span class="secno">4.2. </span><span
                    class="content">処理モデル</span><a class="self-link" href="#processing-model"></a></h3>
            <h4 class="heading settled" data-level="4.2.1" id="applicable-properties"><span class="secno">4.2.1.
                </span><span class="content">適用可能なプロパティ</span><a class="self-link" href="#applicable-properties"></a>
            </h4>
            <p><a data-link-type="dfn" href="#custom-highlight-pseudo-element"
                    id="ref-for-custom-highlight-pseudo-element">カスタムハイライト疑似要素</a>は、
                組み込みの<a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                    id="ref-for-highlight-pseudo-element②">ハイライト疑似要素</a>と同様に、
                限定されたプロパティのみでスタイリングできます。
                詳細なリストは<a href="https://www.w3.org/TR/css-pseudo-4/#highlight-styling"><cite>CSS Pseudo-Elements
                        4</cite> § 3.2 ハイライトのスタイリング</a>を参照してください。</p>
            <h4 class="heading settled" data-level="4.2.2" id="default-styles"><span class="secno">4.2.2. </span><span
                    class="content">デフォルトスタイル</span><a class="self-link" href="#default-styles"></a></h4>
            <p>UAは<a data-link-type="dfn" href="#custom-highlight-pseudo-element"
                    id="ref-for-custom-highlight-pseudo-element①">カスタムハイライト疑似要素</a>に対してUAデフォルトスタイルシートでスタイルを定義してはなりません。
                <span id="ref-for-custom-highlight-pseudo-element②">カスタムハイライト疑似要素</span>は、その<a data-link-type="dfn"
                    href="https://www.w3.org/TR/selectors-4/#originating-element"
                    id="ref-for-originating-element">発生元要素</a>のスタイルを継承します。
            </p>
            <h4 class="heading settled" data-level="4.2.3" id="c-and-h"><span class="secno">4.2.3. </span><span
                    class="content">カスケードと継承</span><a class="self-link" href="#c-and-h"></a></h4>
            <p><a data-link-type="dfn" href="https://www.w3.org/TR/css-cascade-5/#cascade"
                    id="ref-for-cascade">カスケード</a>および<a data-link-type="dfn"
                    href="https://www.w3.org/TR/css-cascade-5/#inheritance" id="ref-for-inheritance">継承</a>は、
                <a data-link-type="dfn" href="#custom-highlight-pseudo-element"
                    id="ref-for-custom-highlight-pseudo-element③">カスタムハイライト疑似要素</a>においても
                組み込みの<a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                    id="ref-for-highlight-pseudo-element③">ハイライト疑似要素</a>と同様に扱われます。
                詳細は<a href="https://www.w3.org/TR/css-pseudo-4/#highlight-cascade"><cite>CSS Pseudo-Elements 4</cite>
                    § 3.5 カスケードと要素ごとのハイライトスタイル</a>で定義されています。
            </p>
            <h4 class="heading settled" data-level="4.2.4" id="painting"><span class="secno">4.2.4. </span><span
                    class="content">ペインティング</span><a class="self-link" href="#painting"></a></h4>
            <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight①②">カスタムハイライト</a>の描画も
                組み込みの<a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                    id="ref-for-highlight-pseudo-element④">ハイライト疑似要素</a>と同様に処理されます。
                詳細は<a href="https://www.w3.org/TR/css-pseudo-4/#highlight-bounds"><cite>CSS Pseudo-Elements 4</cite>
                    § 3.4 ハイライト領域</a>および<a href="https://www.w3.org/TR/css-pseudo-4/#highlight-painting"><cite>CSS
                        Pseudo-Elements 4</cite>
                    § 3.6 ハイライトのペインティング</a>で指定されています。
                なお、以下の補足があります：</p>
            <ul>
                <li> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#range-collapsed"
                        id="ref-for-range-collapsed">collapsed</a>な<a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range" id="ref-for-concept-range⑤">range</a>は描画されません。
                <li>
                    1つの<a data-link-type="dfn" href="#custom-highlight"
                        id="ref-for-custom-highlight①③">カスタムハイライト</a>内で重複する<a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range"
                        id="ref-for-concept-range⑥">range</a>は、重なった部分が単一の統合されたrangeとして描画されたかのように扱われます。
                    <div class="example" id="overlap-ranges-ex">
                        <a class="self-link" href="#overlap-ranges-ex"></a>
                        以下の例では、半透明の青背景で単一のハイライトが描画され、重なり部分が透けて二重に見えることはありません。
                        <pre class="highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>sample</c-><c- o>)</c-> <c- p>{</c-> <c- k>background-color</c-><c- p>:</c-> rgba<c- p>(</c-><c- mi>0</c-><c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>255</c-><c- p>,</c-> <c- mf>0.3</c-><c- p>);</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>body</c-><c- p>></c->Lorem Ipsum.
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>let</c-> textNode <c- o>=</c-> document<c- p>.</c->body<c- p>.</c->firstChild<c- p>;</c->

  <c- a>let</c-> r1 <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r1<c- p>.</c->setStart<c- p>(</c->textNode<c- p>,</c-> <c- mf>1</c-><c- p>);</c->
  r1<c- p>.</c->setEnd<c- p>(</c->textNode<c- p>,</c-> <c- mf>5</c-><c- p>);</c->

  <c- a>let</c-> r2 <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r2<c- p>.</c->setStart<c- p>(</c->textNode<c- p>,</c-> <c- mf>3</c-><c- p>);</c->
  r2<c- p>.</c->setEnd<c- p>(</c->textNode<c- p>,</c-> <c- mf>7</c-><c- p>);</c->

  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- u>"sample"</c-><c- p>,</c-> <c- k>new</c-> Highlight<c- p>(</c->r1<c- p>,</c-> r2<c- p>));</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
                        <p>つまり、正しいレンダリングは次のようになります：</p>
                        <div class="sample-out"> L<span style="background-color: rgba(0, 0, 255, 0.3)">orem
                                I</span>psum. </div>
                        <p>しかし、次のような重複描画は誤りです：</p>
                        <div class="sample-out"> L<span style="background-color: rgba(0, 0, 255, 0.3)">or<span
                                    style="background-color: rgba(0, 0, 255, 0.3)">em</span> I</span>psum. </div>
                    </div>
                <li> <a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-overlay"
                        id="ref-for-highlight-overlay">ハイライトオーバーレイ</a>の重なり順は、<a data-link-type="dfn"
                        href="#custom-highlight" id="ref-for-custom-highlight①④">カスタムハイライト</a>が組み込みの<a
                        data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element"
                        id="ref-for-highlight-pseudo-element⑤">ハイライト疑似要素</a>よりも下になるように、
                    <a href="https://www.w3.org/TR/css-pseudo-4/#highlight-painting"><cite>CSS Pseudo-Elements 4</cite>
                        § 3.6 ハイライトのペインティング</a>で定義されたスタッキング順で描画されます。
                <li>複数の<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight①⑤">カスタムハイライト</a>の<a
                        data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-overlay"
                        id="ref-for-highlight-overlay①">ハイライトオーバーレイ</a>同士の相対的な重なり順は、
                    それらの<a data-link-type="dfn" href="#priority" id="ref-for-priority">priority</a>値で決まります（<a
                        href="#priorities">§ 4.2.5 重複ハイライトの優先順位</a>参照）。
            </ul>
            <h4 class="heading settled" data-level="4.2.5" id="priorities"><span class="secno">4.2.5. </span><span
                    class="content">重複ハイライトの優先順位</span><a class="self-link" href="#priorities"></a></h4>
            <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight①⑥">カスタムハイライト</a>の
                <code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority②">priority</a></code>
                属性は、その<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="priority">優先順位</dfn>を定義します。
                これはペインティング時の<a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#highlight-overlay"
                    id="ref-for-highlight-overlay②">ハイライトオーバーレイ</a>の重なり順を決めるために使われます（<a href="#painting">§ 4.2.4
                    ペインティング</a>参照）。
                より高い<a data-link-type="dfn" href="#priority" id="ref-for-priority①">priority</a>値ほど重なり順が上になります。
                <code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority③">priority</a></code>
                属性が明示的に設定されていない場合、デフォルトは数値0です。
            </p>
            <p>2つ以上の<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight①⑦">カスタムハイライト</a>が同じ数値priorityの場合、
                より最近<a data-link-type="dfn" href="#registered" id="ref-for-registered⑧">登録</a>された方が有効priorityが高くなります。
            </p>
            <div class="example" id="overlap-highlight-ex">
                <a class="self-link" href="#overlap-highlight-ex"></a>
                <pre class="highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>:</c-><c- nd>root</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>foo</c-><c- o>)</c-> <c- p>{</c->
    <c- k>color</c-><c- p>:</c-><c- kc>blue</c-><c- p>;</c->
    <c- k>background-color</c-><c- p>:</c-><c- kc>yellow</c-><c- p>;</c->
  <c- p>}</c->
  <c- p>:</c-><c- nd>root</c-><c- p>::</c-><c- nd>highlight</c-><c- o>(</c-><c- f>bar</c-><c- o>)</c-> <c- p>{</c->
    <c- k>background-color</c-><c- p>:</c-><c- kc>orange</c-><c- p>;</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>body</c-><c- p>></c->Some text
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>let</c-> textNode <c- o>=</c-> document<c- p>.</c->body<c- p>.</c->firstChild<c- p>;</c->

  <c- a>let</c-> r1 <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r1<c- p>.</c->setStart<c- p>(</c->textNode<c- p>,</c-> <c- mf>0</c-><c- p>);</c->
  r1<c- p>.</c->setEnd<c- p>(</c->textNode<c- p>,</c-> <c- mf>6</c-><c- p>);</c->

  <c- a>let</c-> r2 <c- o>=</c-> <c- k>new</c-> Range<c- p>();</c->
  r2<c- p>.</c->setStart<c- p>(</c->textNode<c- p>,</c-> <c- mf>3</c-><c- p>);</c->
  r2<c- p>.</c->setEnd<c- p>(</c->textNode<c- p>,</c-> <c- mf>9</c-><c- p>);</c->

  <c- a>let</c-> h1 <c- o>=</c-> <c- k>new</c-> Highlight<c- p>(</c->r1<c- p>);</c->
  <c- a>let</c-> h2 <c- o>=</c-> <c- k>new</c-> Highlight<c- p>(</c->r2<c- p>);</c->

  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- u>"foo"</c-><c- p>,</c-> h1<c- p>);</c->
  CSS<c- p>.</c->highlights<c- p>.</c->set<c- p>(</c-><c- u>"bar"</c-><c- p>,</c-> h2<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
                <p>priorityが設定されていない（h1とh2が同順位）の場合、
                    カスタムハイライトのスタイルは<a data-link-type="dfn" href="#highlight-registry"
                        id="ref-for-highlight-registry③">ハイライトレジストリ</a>への挿入順で重ねられます。
                    描画結果は「Som」が青文字・黄背景、「e t」が青文字・オレンジ背景、「ext」がデフォルト色・オレンジ背景になります。</p>
                <div class="sample-out"> <span style="background:yellow;color:blue;">Som</span><span
                        style="background:orange;color:blue;">e t</span><span style="background:orange;">ext</span>
                </div>
                <p><code class="highlight">h1<c- p>.</c->priority <c- o>=</c-> <c- mf>1</c-><c- p>;</c-></code>
                    を設定すると、h1がh2より上位になり、「Some t」が青文字・黄背景、「ext」がデフォルト色・オレンジ背景になります。</p>
                <div class="sample-out"> <span style="background:yellow;color:blue;">Some t</span><span
                        style="background:orange;">ext</span> </div>
            </div>
            <h4 class="heading settled" data-level="4.2.6" id="highlight-types"><span class="secno">4.2.6. </span><span
                    class="content">ハイライトタイプ</span><a class="self-link" href="#highlight-types"></a></h4>
            <p><a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight①⑧">カスタムハイライト</a>の
                <code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type②">type</a></code>
                属性は、作者がハイライトの意味的役割を指定するために使います。
                これにより、支援技術がユーザーに意味を伝えることができます。
            </p>
            <p>type属性を明示的に設定しなかった場合、デフォルトは<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-highlight" id="ref-for-dom-highlighttype-highlight①">highlight</a></code>です。
            </p>
            <p class="note" role="note"><span>注:</span>作者はミススペル強調には
                <a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight①⑨">カスタムハイライト</a>の<code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type④">type</a></code>
                を<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-spelling-error" id="ref-for-dom-highlighttype-spelling-error">spelling-error</a></code>に、
                文法誤り強調には<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-grammar-error" id="ref-for-dom-highlighttype-grammar-error">grammar-error</a></code>に設定することを推奨します。
                その他用途ではtypeは<code
                    class="idl"><a data-link-type="idl" href="#dom-highlighttype-highlight" id="ref-for-dom-highlighttype-highlight②">highlight</a></code>のままで問題ありません。
            </p>
            <p>UAは<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight②③">カスタムハイライト</a>を支援技術へ提供すべきです。
                ハイライトをプラットフォームのアクセシビリティAPIで公開する際、
                UAはtype属性で指定された意味を可能な限り具体的に伝える必要があります。</p>
            <p class="note" role="note"><span>注:</span>例えば、プラットフォームのアクセシビリティAPIがスペルミスや文法誤りを明示できる場合は、
                UAはtype=spelling-errorやtype=grammar-errorの意味をそのまま使います。
                スペルミスのみ表現可能なAPIなら、spelling-errorとgrammar-error両方をスペルミスとして扱います。
                どちらも表現できないAPIなら、すべてのハイライトはtype属性に関係なくhighlightとして公開されます。
            </p>
            <p class="note" role="note"><span>注:</span>この初期タイプセットは、Highlight
                APIでよく使われるであろうケースと、現行のアクセシビリティAPIに一部サポートがあることから選定されました。
                他のHighlight API用途には現状アクセシビリティAPIで表現手段がありません。
                今後、新たな用途が普及しアクセシビリティAPIで表現可能になれば、<code
                    class="idl"><a data-link-type="idl" href="#enumdef-highlighttype" id="ref-for-enumdef-highlighttype①">HighlightType</a></code>にタイプ追加される可能性があります。
            </p>
            <h2 class="heading settled" data-level="5" id="responding-to-changes"><span class="secno">5. </span><span
                    class="content">変更への対応</span><a class="self-link" href="#responding-to-changes"></a>
            </h2>
            <h3 class="heading settled" data-level="5.1" id="repaint"><span class="secno">5.1. </span><span
                    class="content">再描画</span><a class="self-link" href="#repaint"></a></h3>
            <p><a data-link-type="dfn" href="#highlight-registry" id="ref-for-highlight-registry④">ハイライトレジストリ</a>内の<a
                    data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight②④">カスタムハイライト</a>の追加や削除、
                または<a data-link-type="dfn" href="#registered" id="ref-for-registered⑨">登録済み</a><span
                    id="ref-for-custom-highlight②⑤">カスタムハイライト</span>内の<a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-range" id="ref-for-concept-range⑦">range</a>の追加や削除は、
                ユーザーエージェントがレンダリングを再評価し、必要に応じて再描画する原因となります。</p>
            <p>また、作者による<code
                    class="idl"><a data-link-type="idl" href="#dom-highlight-priority" id="ref-for-dom-highlight-priority④">priority</a></code>
                の変更や、<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp"
                    id="ref-for-concept-range-bp">境界点</a>による<a data-link-type="idl"
                    href="https://dom.spec.whatwg.org/#range" id="ref-for-range②">Range</a>の変更に応じても
                ユーザーエージェントはハイライトを再描画しなければなりません。
            </p>
            <p class="issue" id="issue-a4ade514"><a class="self-link" href="#issue-a4ade514"></a>
                この再評価のタイミング（同期性含む）をどう規定すべきか？ <a href="https://github.com/w3c/csswg-drafts/issues/4596">[Issue #4596]</a>
            </p>
            <h3 class="heading settled" data-level="5.2" id="range-invalidation"><span class="secno">5.2. </span><span
                    class="content">範囲の更新と無効化</span><a class="self-link" href="#range-invalidation"></a></h3>
            <p>作者は<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight②⑦">カスタムハイライト</a>を<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range③">Range</a></code>
                または<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange①">StaticRange</a></code>で構築できます。
            </p>
            <p>結果として得られる<a data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight②⑧">カスタムハイライト</a>は
                同じ文書部分を表し、同じようにスタイリングできます。
                ただし、基礎となる文書が変更された場合の挙動は異なります。</p>
            <p><code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range④">Range</a></code>は<a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-live-range"
                    id="ref-for-concept-live-range">ライブ範囲</a>です。
                ユーザーエージェントは、範囲またはその境界に重なるDOM変更に応じて<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range⑤">Range</a></code>の<a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp"
                    id="ref-for-concept-range-bp①">境界点</a>を調整し、
                それに応じて<a href="#repaint">再描画</a>します。<span
                    id="ref-for-concept-range-bp②">ライブ範囲</span>の境界点は作者によって変更することもできます。</p>
            <p>一方、ユーザーエージェントは<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange②">StaticRange</a></code>の<a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp"
                    id="ref-for-concept-range-bp③">境界点</a>を
                DOM変更に応じて調整してはならず、作成後に作者が変更することもできません。
                ユーザーエージェントは実際の<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange③">StaticRange</a></code>を保持し、
                ライブ<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range⑥">Range</a></code>によるバックアップはしません。
            </p>
            <div class="advisement">
                DOMが変更されるたびに全ての<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#range" id="ref-for-range⑦">Range</a></code>
                オブジェクトを更新することは大きなパフォーマンスコストになります。
                DOM変更を監視して反応し、<a data-link-type="dfn" href="#custom-highlight"
                    id="ref-for-custom-highlight②⑨">カスタムハイライト</a>内の範囲を調整・再作成したい作者は、
                不要なコストを避けるため<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange④">StaticRange</a></code>の利用を強く推奨します。
                <p>逆に、<code
                        class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange⑤">StaticRange</a></code>を使う作者は、
                    DOM変更を監視して反応し、
                    古くなった<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range"
                        id="ref-for-concept-range⑧">range</a>や<a data-link-type="dfn" href="#custom-highlight"
                        id="ref-for-custom-highlight③⓪">カスタムハイライト</a>を破棄し新たに作成すべきです。</p>
            </div>
            <p>文書のレンダリング計算時、
                その文書ウィンドウに関連付けられた<a data-link-type="dfn" href="#highlight-registry"
                    id="ref-for-highlight-registry⑤">ハイライトレジストリ</a>内の
                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start-node"
                    id="ref-for-concept-range-start-node">開始ノード</a>や<a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-range-end-node"
                    id="ref-for-concept-range-end-node">終了ノード</a>
                が、その文書でない<a data-link-type="idl" href="https://dom.spec.whatwg.org/#node" id="ref-for-node">Node</a>の<a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-including-root"
                    id="ref-for-concept-shadow-including-root">shadow-including root</a>を参照する場合、
                ユーザーエージェントはその<span id="ref-for-concept-range①⓪">range</span>を無視しなければなりません。
                また、その文書ウィンドウに関連付けられた<span id="ref-for-highlight-registry⑥">ハイライトレジストリ</span>内の<code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange⑥">StaticRange</a></code>が<a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#staticrange-valid"
                    id="ref-for-staticrange-valid">有効</a>でない場合も、
                ユーザーエージェントはその<span id="ref-for-concept-range①①">range</span>を無視しなければなりません。
            </p>
            <p class="issue" id="issue-d5e91a86"><a class="self-link" href="#issue-d5e91a86"></a> <code
                    class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange" id="ref-for-staticrange⑦">StaticRange</a></code>を含む<a
                    data-link-type="dfn" href="#custom-highlight" id="ref-for-custom-highlight③①">カスタムハイライト</a>と<a
                    data-link-type="biblio" href="#biblio-css-contain-2">[css-contain-2]</a>との相互作用は問題があるように思われる:
                完全に包含された要素であれば、その子孫へのDOM変更は外部要素の無効化や再描画を引き起こさないはずだが、
                static rangeの境界点が包含サブツリー内と外部両方にあり、
                包含サブツリー内のDOMが変更されて境界点が有効ノードでなくなった場合、
                範囲全体が無視され、外部サブツリーの描画にも影響する。
                これは<a data-link-type="dfn" href="https://drafts.csswg.org/css-contain-2/#style-containment"
                    id="ref-for-style-containment">スタイル包含</a>の弱点か、
                それとも上記無効化ロジックの弱点か、あるいは他の問題か？ <a href="https://github.com/w3c/csswg-drafts/issues/4598">[Issue #4598]</a>
            </p>
            <h2 class="heading settled" data-level="6" id="events"><span class="secno">6. </span><span class="content">
                    イベント処理</span><a class="self-link" href="#events"></a></h2>
            <p class="issue" id="issue-3d1f5f66"><a class="self-link" href="#issue-3d1f5f66"></a>
                イベントに関するセクションは未定です。https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/master/highlight/events-explainer.md
                を参照してください。</p>
            <p class="issue" id="issue-230bd93b"><a class="self-link" href="#issue-230bd93b"></a>
                カスタムハイライト専用のイベント処理機構を持つべきか、疑似要素全般に追加すべきか検討中です。</p>
            <div class="non-normative">
                <h2 class="no-num heading settled" id="priv-sec"><span class="content">付録A.
                        プライバシーとセキュリティに関する考慮事項</span><a class="self-link" href="#priv-sec"></a></h2>
                <p><em>このセクションは非規範です</em>。</p>
                <p>本仕様が新たなセキュリティやプライバシー上の懸念を引き起こすとは考えられていません。
                    もしそうでない疑いがある場合は、CSSワーキンググループまたは共同編集者までご連絡ください。</p>
            </div>
            <div class="non-normative">
                <h2 class="no-num heading settled" id="credits"><span class="content">付録B. 謝辞</span><a class="self-link"
                        href="#credits"></a></h2>
                <p><em>このセクションは非規範です</em>。</p>
                <p class="issue" id="issue-f0ab6bff"><a class="self-link" href="#issue-f0ab6bff"></a>
                    編集者以外で謝辞を述べるべき人物を記載してください。</p>
            </div>
            <div class="non-normative">
                <h2 class="no-num heading settled" id="changes"><span class="content">付録C. 変更履歴</span><a
                        class="self-link" href="#changes"></a></h2>
                <p><em>このセクションは非規範です</em>。</p>
                <h3 class="no-num&quot; heading settled" id="changes-since-20201208"><span
                        class="content">2020年12月8日作業草案以降の変更点 <a
                            href="https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201208/">8 December 2020 Working
                            Draft</a></span><a class="self-link" href="#changes-since-20201208"></a></h3>
                <p>様々な編集改善や細かな調整に加え、主な変更点は以下の通りです：</p>
                <ul>
                    <li data-md>
                        <p><code>HighlightsRegister</code>を<code
                                class="idl"><a data-link-type="idl" href="#highlightregistry" id="ref-for-highlightregistry②">HighlightRegistry</a></code>に名称変更
                        </p>
                    <li data-md>
                        <p><code
                                class="idl"><a data-link-type="idl" href="#highlightregistry" id="ref-for-highlightregistry③">HighlightRegistry</a></code>から冗長な<code>add()</code>メソッドを削除
                            （<a href="https://github.com/w3c/csswg-drafts/pull/6092">Issue 6092</a>参照）</p>
                    <li data-md>
                        <p>カスタムハイライトオーバーレイがネイティブハイライトオーバーレイより下に重なるように変更
                            （<a href="https://github.com/w3c/csswg-drafts/pull/4595">Issue 4595</a>参照）</p>
                    <li data-md>
                        <p>ハイライトの優先順位をfloat型から整数型で扱うように変更
                            （<a href="https://github.com/w3c/csswg-drafts/pull/4592">Issue 4592</a>参照）</p>
                    <li data-md>
                        <p>ハイライトの優先順位のデフォルト値を0に定義
                            （<a href="https://github.com/w3c/csswg-drafts/pull/6136">Issue 6136</a>参照）</p>
                    <li data-md>
                        <p>HighlightRegistryをsetlikeからmaplikeに変更し、Highlightから<code>name</code>プロパティを削除
                            （<a href="https://github.com/w3c/csswg-drafts/pull/5910">Issue 5910</a>参照）</p>
                    <li data-md>
                        <p>異なるwindowのrangeは描画されないことを明確化
                            （<a href="https://github.com/w3c/csswg-drafts/pull/6417">Issue 6417</a>参照）</p>
                    <li data-md>
                        <p>カスタムハイライトはUAスタイルを持たないことを明記
                            （<a href="https://github.com/w3c/csswg-drafts/pull/6375">Issue 6375</a>参照）</p>
                    <li data-md>
                        <p>rangeの無効化は<a data-link-type="biblio" href="#biblio-dom">[DOM]</a>仕様に委譲
                            （<a href="https://github.com/w3c/csswg-drafts/pull/4597">Issue 4597</a>参照）</p>
                    <li data-md>
                        <p><code
                                class="idl"><a data-link-type="idl" href="#dom-highlight-type" id="ref-for-dom-highlight-type⑨">type</a></code>属性を<code
                                class="idl"><a data-link-type="idl" href="#highlight" id="ref-for-highlight⑤">Highlight</a></code>に追加し、
                            ハイライトの意味を明確化、アクセシビリティツールへの公開をサポート
                            （<a href="https://github.com/w3c/csswg-drafts/pull/6498">Issue 6498</a>参照）</p>
                </ul>
                <h3 class="no-num&quot; heading settled" id="changes-since-20201022"><span
                        class="content">2020年10月22日作業草案以降の変更点 <a
                            href="https://www.w3.org/TR/2020/WD-css-highlight-api-1-20201022/">22 October 2020 Working
                            Draft</a></span><a class="self-link" href="#changes-since-20201022"></a></h3>
                <p>2020年10月22日作業草案以降は編集上の変更のみです。
                    詳細は<a
                        href="https://services.w3.org/htmldiff?doc1=https%3A%2F%2Fwww.w3.org%2FTR%2F2020%2FWD-css-highlight-api-1-20201022%2F&amp;doc2=https%3A%2F%2Fwww.w3.org%2FTR%2Fcss-highlight-api-1%2F">差分</a>を参照してください。
                </p>
            </div>
        </div>
    </main>
    <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">適合性</span><a class="self-link"
            href="#w3c-conformance"></a></h2>
    <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content">文書の規約</span><a class="self-link"
            href="#w3c-conventions"></a></h3>
    <p>適合性要件は、記述的な断定とRFC 2119の用語を組み合わせて表現されます。「MUST」「MUST NOT」「REQUIRED」「SHALL」「SHALL NOT」「SHOULD」「SHOULD
        NOT」「RECOMMENDED」「MAY」「OPTIONAL」は、本仕様の規範部分ではRFC 2119に従って解釈されます。ただし、可読性のため、これらの語はすべて大文字ではなく記述されています。</p>
    <p>本仕様の文書本文は、明示的に非規範と記載されたセクション、例、注記を除き、すべて規範的です。<a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
    <p>この仕様の例は「例えば」で始まるか、<code>class="example"</code>で規範本文から分離されており、次のように記載されます：</p>
    <div class="example" id="w3c-example">
        <a class="self-link" href="#w3c-example"></a>
        <p>これは参考例の一例です。</p>
    </div>
    <p>参考注記は「注」で始まり、<code>class="note"</code>で規範本文から分離されています。次のようになります：</p>
    <p class="note" role="note">注：これは参考注記です。</p>
    <p>勧告事項は特別な注意を喚起するスタイルで規範的セクションとして示され、他の規範本文と区別するために<code>&lt;strong class="advisement"></code>で記載されます。例えば：<strong
            class="advisement"> UAは必ずアクセシブルな代替手段を提供しなければなりません。</strong></p>
    <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content">適合クラス</span><a
            class="self-link" href="#w3c-conformance-classes"></a></h3>
    <p>本仕様への適合性は、以下の3つの適合クラスで定義されます：</p>
    <dl>
        <dt>スタイルシート
        <dd><a href="https://www.w3.org/TR/CSS21/conform.html#style-sheet">CSSスタイルシート</a>。
        <dt>レンダラー
        <dd>スタイルシートの意味を解釈し、それを利用する文書をレンダリングする<a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>。
        <dt>オーサリングツール
        <dd>スタイルシートを作成する<a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>。
    </dl>
    <p>スタイルシートは、このモジュールで定義された構文を使うすべての文が、汎用CSS文法および本モジュールで定義された各機能の個別文法に従って有効であれば、本仕様に適合します。</p>
    <p>レンダラーは、スタイルシートを関連する仕様で定義された通りに解釈することに加え、本仕様で定義された全機能を正しくパースし、文書を適切にレンダリングしていれば適合とみなされます。ただし、デバイスの制限によりUAが文書を正しくレンダリングできない場合でも、非適合とはなりません。（例えば、UAはモノクロモニターで色をレンダリングする必要はありません。）
    </p>
    <p>オーサリングツールは、汎用CSS文法および本モジュールで定義された各機能の個別文法に従って構文的に正しいスタイルシートを書き、本モジュールで規定されるスタイルシートの他の適合要件も満たしていれば適合とみなされます。</p>
    <h3 class="no-ref heading settled" id="w3c-partial"><span class="content">部分実装</span><a class="self-link"
            href="#w3c-partial"></a></h3>
    <p>作者が将来互換性のあるパース規則を活用してフォールバック値を指定できるように、CSSレンダラーは、利用可能なレベルのサポートがない@ルール、プロパティ、プロパティ値、キーワード、その他の構文要素を<strong>無効</strong>として扱い、<a
            href="https://www.w3.org/TR/CSS21/conform.html#ignore">適切に無視</a>しなければなりません。特に、ユーザーエージェントは、未サポートの値がある場合に、マルチ値プロパティ宣言でサポートされる値だけを選択的に適用しては<strong>なりません</strong>。どれか一つでも値が無効と見なされる場合（未サポート値は必ず無効）、CSSは宣言全体を無視することを要求します。
    </p>
    <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content">不安定および独自機能の実装</span><a
            class="self-link" href="#w3c-conform-future-proofing"></a></h4>
    <p>将来の安定したCSS機能との衝突を避けるため、CSSWGは<a href="https://www.w3.org/TR/CSS/#future-proofing">ベストプラクティス</a>に従って、<a
            href="https://www.w3.org/TR/CSS/#unstable">不安定</a>機能および<a
            href="https://www.w3.org/TR/CSS/#proprietary-extension">独自拡張</a>の実装を推奨します。</p>
    <h3 class="no-ref heading settled" id="w3c-testing"><span class="content">非実験的実装</span><a class="self-link"
            href="#w3c-testing"></a></h3>
    <p>仕様がCandidate Recommendation段階に達したら、非実験的な実装が可能となり、実装者は正しく仕様通り実装できたCRレベルの機能について、プレフィックスなしの実装をリリースするべきです。</p>
    <p>CSSの実装間の相互運用性を確立・維持するため、CSSワーキンググループは、非実験的CSSレンダラーがCSS機能のプレフィックスなし実装をリリースする前に、W3Cへ実装報告書（必要に応じてその報告書用のテストケースも）を提出することを推奨します。提出されたテストケースはCSSワーキンググループによって審査・修正される場合があります。
    </p>
    <p>テストケースや実装報告書の提出についてはCSSワーキンググループのウェブサイト<a
            href="https://www.w3.org/Style/CSS/Test/">https://www.w3.org/Style/CSS/Test/</a>で詳細をご覧ください。ご質問は<a
            href="https://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>のメーリングリストまで。
    </p>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本仕様で定義される用語</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#dom-highlight-highlight">constructor()</a><span>、§ 3.1で</span>
        <li><a href="#dom-highlight-highlight">constructor(...initialRanges)</a><span>、§ 3.1で</span>
        <li><a href="#custom-highlight">カスタムハイライト</a><span>、§ 3.1で</span>
        <li><a href="#typedef-custom-highlight-name">&lt;custom-highlight-name></a><span>、§ 4.1で</span>
        <li><a href="#custom-highlight-name">カスタムハイライト名</a><span>、§ 3.2で</span>
        <li><a href="#custom-highlight-pseudo-element">カスタムハイライト疑似要素</a><span>、§ 4.1で</span>
        <li><a href="#dom-highlighttype-grammar-error">"grammar-error"</a><span>、§ 3.1で</span>
        <li><a href="#dom-highlighttype-highlight">"highlight"</a><span>、§ 3.1で</span>
        <li><a href="#highlight">Highlight</a><span>、§ 3.1で</span>
        <li><a href="#dom-highlight-highlight">Highlight()</a><span>、§ 3.1で</span>
        <li><a
                href="#selectordef-highlight-custom-highlight-name">::highlight(&lt;custom-highlight-name>)</a><span>、§ 4.1で</span>
        <li><a href="#dom-highlight-highlight">Highlight(...initialRanges)</a><span>、§ 3.1で</span>
        <li><a href="#highlight-registry">ハイライトレジストリ</a><span>、§ 3.2で</span>
        <li><a href="#highlightregistry">HighlightRegistry</a><span>、§ 3.2で</span>
        <li><a href="#dom-css-highlights">highlights</a><span>、§ 3.2で</span>
        <li><a href="#enumdef-highlighttype">HighlightType</a><span>、§ 3.1で</span>
        <li>
            優先順位
            <ul>
                <li><a href="#dom-highlight-priority">Highlightの属性</a><span>、§ 3.1で</span>
                <li><a href="#priority">定義</a><span>、§ 4.2.5で</span>
            </ul>
        <li><a href="#registered">登録済み</a><span>、§ 3.2で</span>
        <li><a href="#dom-highlighttype-spelling-error">"spelling-error"</a><span>、§ 3.1で</span>
        <li><a href="#dom-highlight-type">type</a><span>、§ 3.1で</span>
    </ul>
    <aside class="dfn-panel" data-for="term-for-cascade">
        <a href="https://www.w3.org/TR/css-cascade-5/#cascade">https://www.w3.org/TR/css-cascade-5/#cascade</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-cascade">4.2.3.
                    Cascading and Inheritance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-inheritance">
        <a
            href="https://www.w3.org/TR/css-cascade-5/#inheritance">https://www.w3.org/TR/css-cascade-5/#inheritance</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-inheritance">4.2.3.
                    Cascading and Inheritance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-style-containment">
        <a
            href="https://drafts.csswg.org/css-contain-2/#style-containment">https://drafts.csswg.org/css-contain-2/#style-containment</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-style-containment">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-selectordef-selection">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#selectordef-selection">https://www.w3.org/TR/css-pseudo-4/#selectordef-selection</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-selectordef-selection">1.
                    Introduction</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-selectordef-spelling-error">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#selectordef-spelling-error">https://www.w3.org/TR/css-pseudo-4/#selectordef-spelling-error</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-selectordef-spelling-error">1.
                    Introduction</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-highlight-overlay">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#highlight-overlay">https://www.w3.org/TR/css-pseudo-4/#highlight-overlay</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-highlight-overlay">4.2.4.
                    Painting</a> <a href="#ref-for-highlight-overlay①">(2)</a>
            <li><a href="#ref-for-highlight-overlay②">4.2.5.
                    Priority of Overlapping Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-highlight-pseudo-element">
        <a
            href="https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element">https://www.w3.org/TR/css-pseudo-4/#highlight-pseudo-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-highlight-pseudo-element">1.
                    Introduction</a>
            <li><a href="#ref-for-highlight-pseudo-element①">2.
                    Module Interactions</a>
            <li><a href="#ref-for-highlight-pseudo-element②">4.2.1.
                    Applicable Properties</a>
            <li><a href="#ref-for-highlight-pseudo-element③">4.2.3.
                    Cascading and Inheritance</a>
            <li><a href="#ref-for-highlight-pseudo-element④">4.2.4.
                    Painting</a> <a href="#ref-for-highlight-pseudo-element⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-typedef-ident-token">
        <a
            href="https://www.w3.org/TR/css-syntax-3/#typedef-ident-token">https://www.w3.org/TR/css-syntax-3/#typedef-ident-token</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-typedef-ident-token">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-identifier">
        <a href="https://www.w3.org/TR/css-syntax-3/#identifier">https://www.w3.org/TR/css-syntax-3/#identifier</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-identifier">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-style-rule">
        <a href="https://www.w3.org/TR/css-syntax-3/#style-rule">https://www.w3.org/TR/css-syntax-3/#style-rule</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-style-rule">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-namespacedef-css">
        <a href="https://www.w3.org/TR/cssom-1/#namespacedef-css">https://www.w3.org/TR/cssom-1/#namespacedef-css</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-namespacedef-css">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-namespacedef-css①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abstractrange">
        <a href="https://dom.spec.whatwg.org/#abstractrange">https://dom.spec.whatwg.org/#abstractrange</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abstractrange">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-abstractrange①">(2)</a> <a
                    href="#ref-for-abstractrange②">(3)</a> <a href="#ref-for-abstractrange③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-node">
        <a href="https://dom.spec.whatwg.org/#node">https://dom.spec.whatwg.org/#node</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-node">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-range">
        <a href="https://dom.spec.whatwg.org/#range">https://dom.spec.whatwg.org/#range</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-range">1.
                    Introduction</a>
            <li><a href="#ref-for-range①">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-range②">5.1.
                    Repaints</a>
            <li><a href="#ref-for-range③">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-range④">(2)</a> <a
                    href="#ref-for-range⑤">(3)</a> <a href="#ref-for-range⑥">(4)</a> <a href="#ref-for-range⑦">(5)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-staticrange">
        <a href="https://dom.spec.whatwg.org/#staticrange">https://dom.spec.whatwg.org/#staticrange</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-staticrange">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-staticrange①">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-staticrange②">(2)</a> <a
                    href="#ref-for-staticrange③">(3)</a> <a href="#ref-for-staticrange④">(4)</a> <a
                    href="#ref-for-staticrange⑤">(5)</a> <a href="#ref-for-staticrange⑥">(6)</a> <a
                    href="#ref-for-staticrange⑦">(7)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-range-bp">
        <a href="https://dom.spec.whatwg.org/#concept-range-bp">https://dom.spec.whatwg.org/#concept-range-bp</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-range-bp">5.1.
                    Repaints</a>
            <li><a href="#ref-for-concept-range-bp①">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-concept-range-bp②">(2)</a> <a
                    href="#ref-for-concept-range-bp③">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-range-collapsed">
        <a href="https://dom.spec.whatwg.org/#range-collapsed">https://dom.spec.whatwg.org/#range-collapsed</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-range-collapsed">4.2.4.
                    Painting</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-contained">
        <a href="https://dom.spec.whatwg.org/#contained">https://dom.spec.whatwg.org/#contained</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-contained">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-range-end-node">
        <a
            href="https://dom.spec.whatwg.org/#concept-range-end-node">https://dom.spec.whatwg.org/#concept-range-end-node</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-range-end-node">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-live-range">
        <a href="https://dom.spec.whatwg.org/#concept-live-range">https://dom.spec.whatwg.org/#concept-live-range</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-live-range">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-concept-live-range①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-partially-contained">
        <a
            href="https://dom.spec.whatwg.org/#partially-contained">https://dom.spec.whatwg.org/#partially-contained</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-partially-contained">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-range">
        <a href="https://dom.spec.whatwg.org/#concept-range">https://dom.spec.whatwg.org/#concept-range</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-range">1.
                    Introduction</a>
            <li><a href="#ref-for-concept-range①">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-concept-range②">(2)</a> <a
                    href="#ref-for-concept-range③">(3)</a>
            <li><a href="#ref-for-concept-range④">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
            <li><a href="#ref-for-concept-range⑤">4.2.4.
                    Painting</a> <a href="#ref-for-concept-range⑥">(2)</a>
            <li><a href="#ref-for-concept-range⑦">5.1.
                    Repaints</a>
            <li><a href="#ref-for-concept-range⑧">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-concept-range⑨">(2)</a> <a
                    href="#ref-for-concept-range①⓪">(3)</a> <a href="#ref-for-concept-range①①">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-shadow-including-root">
        <a
            href="https://dom.spec.whatwg.org/#concept-shadow-including-root">https://dom.spec.whatwg.org/#concept-shadow-including-root</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-shadow-including-root">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-range-start-node">
        <a
            href="https://dom.spec.whatwg.org/#concept-range-start-node">https://dom.spec.whatwg.org/#concept-range-start-node</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-range-start-node">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-staticrange-valid">
        <a href="https://dom.spec.whatwg.org/#staticrange-valid">https://dom.spec.whatwg.org/#staticrange-valid</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-staticrange-valid">5.2.
                    Range Updating and Invalidation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-document-window">
        <a
            href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window">https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-document-window">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-current-global-object">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object">https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-current-global-object">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-originating-element">
        <a
            href="https://www.w3.org/TR/selectors-4/#originating-element">https://www.w3.org/TR/selectors-4/#originating-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-originating-element">4.2.2.
                    Default Styles</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-pseudo-element">
        <a
            href="https://www.w3.org/TR/selectors-4/#pseudo-element">https://www.w3.org/TR/selectors-4/#pseudo-element</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-pseudo-element">2.
                    Module Interactions</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-specificity">
        <a href="https://www.w3.org/TR/selectors-4/#specificity">https://www.w3.org/TR/selectors-4/#specificity</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-specificity">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-DOMString">
        <a href="https://webidl.spec.whatwg.org/#idl-DOMString">https://webidl.spec.whatwg.org/#idl-DOMString</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-DOMString">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-Exposed">
        <a href="https://webidl.spec.whatwg.org/#Exposed">https://webidl.spec.whatwg.org/#Exposed</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-Exposed">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-Exposed①">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-convert-idl-to-ecmascript-value">
        <a
            href="https://webidl.spec.whatwg.org/#dfn-convert-idl-to-ecmascript-value">https://webidl.spec.whatwg.org/#dfn-convert-idl-to-ecmascript-value</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-convert-idl-to-ecmascript-value">3.1.
                    Creating Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-long">
        <a href="https://webidl.spec.whatwg.org/#idl-long">https://webidl.spec.whatwg.org/#idl-long</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-long">3.1.
                    Creating Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-map-entries">
        <a href="https://webidl.spec.whatwg.org/#dfn-map-entries">https://webidl.spec.whatwg.org/#dfn-map-entries</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-map-entries">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-maplike">
        <a href="https://webidl.spec.whatwg.org/#dfn-maplike">https://webidl.spec.whatwg.org/#dfn-maplike</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-maplike">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-set-entries">
        <a href="https://webidl.spec.whatwg.org/#dfn-set-entries">https://webidl.spec.whatwg.org/#dfn-set-entries</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-set-entries">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-dfn-set-entries①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-setlike">
        <a href="https://webidl.spec.whatwg.org/#dfn-setlike">https://webidl.spec.whatwg.org/#dfn-setlike</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-setlike">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-dfn-setlike①">(2)</a>
        </ul>
    </aside>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">参照によって定義される用語</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[css-cascade-5]</a>は以下の用語を定義しています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-cascade">カスケード</span>
                <li><span class="dfn-paneled" id="term-for-inheritance">継承</span>
            </ul>
        <li>
            <a data-link-type="biblio">[css-contain-2]</a>は以下の用語を定義しています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-style-containment">スタイルコンテインメント</span>
            </ul>
        <li>
            <a data-link-type="biblio">[css-pseudo-4]</a>は以下の用語を定義しています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-selectordef-selection">::selection</span>
                <li><span class="dfn-paneled" id="term-for-selectordef-spelling-error">::spelling-error</span>
                <li><span class="dfn-paneled" id="term-for-highlight-overlay">ハイライトオーバーレイ</span>
                <li><span class="dfn-paneled" id="term-for-highlight-pseudo-element">ハイライト疑似要素</span>
            </ul>
        <li>
            <a data-link-type="biblio">[css-syntax-3]</a>は以下の用語を定義しています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-typedef-ident-token">&lt;ident-token></span>
                <li><span class="dfn-paneled" id="term-for-identifier">識別子</span>
                <li><span class="dfn-paneled" id="term-for-style-rule">スタイルルール</span>
            </ul>
        <li>
            <a data-link-type="biblio">[cssom-1]</a>は以下の用語を定義しています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-namespacedef-css">CSS</span>
            </ul>
        <li>
            <a data-link-type="biblio">[DOM]</a>は以下の用語を定義しています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-abstractrange">AbstractRange</span>
                <li><span class="dfn-paneled" id="term-for-node">Node</span>
                <li><span class="dfn-paneled" id="term-for-range">Range</span>
                <li><span class="dfn-paneled" id="term-for-staticrange">StaticRange</span>
                <li><span class="dfn-paneled" id="term-for-concept-range-bp">境界点</span>
                <li><span class="dfn-paneled" id="term-for-range-collapsed">折りたたみ済み</span>
                <li><span class="dfn-paneled" id="term-for-contained">包含されている</span>
                <li><span class="dfn-paneled" id="term-for-concept-range-end-node">終了ノード</span>
                <li><span class="dfn-paneled" id="term-for-concept-live-range">ライブレンジ</span>
                <li><span class="dfn-paneled" id="term-for-partially-contained">部分的に包含</span>
                <li><span class="dfn-paneled" id="term-for-concept-range">レンジ</span>
                <li><span class="dfn-paneled" id="term-for-concept-shadow-including-root">シャドウを含むルート</span>
                <li><span class="dfn-paneled" id="term-for-concept-range-start-node">開始ノード</span>
                <li><span class="dfn-paneled" id="term-for-staticrange-valid">有効</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a>は以下の用語を定義しています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-concept-document-window">関連ドキュメント</span>
                <li><span class="dfn-paneled" id="term-for-current-global-object">現在のグローバルオブジェクト</span>
            </ul>
        <li>
            <a data-link-type="biblio">[selectors-4]</a>は以下の用語を定義しています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-originating-element">発生元要素</span>
                <li><span class="dfn-paneled" id="term-for-pseudo-element">疑似要素</span>
                <li><span class="dfn-paneled" id="term-for-specificity">詳細度</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WebIDL]</a>は以下の用語を定義しています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
                <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
                <li><span class="dfn-paneled" id="term-for-dfn-convert-idl-to-ecmascript-value">ECMAScript値へ変換</span>
                <li><span class="dfn-paneled" id="term-for-idl-long">long</span>
                <li><span class="dfn-paneled" id="term-for-dfn-map-entries">マップエントリ</span>
                <li><span class="dfn-paneled" id="term-for-dfn-maplike">maplike</span>
                <li><span class="dfn-paneled" id="term-for-dfn-set-entries">セットエントリ</span>
                <li><span class="dfn-paneled" id="term-for-dfn-setlike">setlike</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">規範参照</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
        <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-cascade-5/"><cite>CSS
                    カスケードおよび継承 レベル5</cite></a>. 2021年12月3日. 作業草案. URL: <a
                href="https://www.w3.org/TR/css-cascade-5/">https://www.w3.org/TR/css-cascade-5/</a>
        <dt id="biblio-css-contain-2">[CSS-CONTAIN-2]
        <dd>Tab Atkins Jr.; Florian Rivoal; Vladimir Levin. <a href="https://www.w3.org/TR/css-contain-2/"><cite>CSS
                    コンテインメントモジュール レベル2</cite></a>. 2020年12月16日. 作業草案. URL: <a
                href="https://www.w3.org/TR/css-contain-2/">https://www.w3.org/TR/css-contain-2/</a>
        <dt id="biblio-css-pseudo-4">[CSS-PSEUDO-4]
        <dd>Daniel Glazman; Elika Etemad; Alan Stearns. <a href="https://www.w3.org/TR/css-pseudo-4/"><cite>CSS
                    疑似要素モジュール レベル4</cite></a>. 2020年12月31日. 作業草案. URL: <a
                href="https://www.w3.org/TR/css-pseudo-4/">https://www.w3.org/TR/css-pseudo-4/</a>
        <dt id="biblio-css-syntax-3">[CSS-SYNTAX-3]
        <dd>Tab Atkins Jr.; Simon Sapin. <a href="https://www.w3.org/TR/css-syntax-3/"><cite>CSS構文モジュール レベル3</cite></a>.
            2019年7月16日. 勧告候補. URL: <a href="https://www.w3.org/TR/css-syntax-3/">https://www.w3.org/TR/css-syntax-3/</a>
        <dt id="biblio-cssom-1">[CSSOM-1]
        <dd>Daniel Glazman; Emilio Cobos Álvarez. <a href="https://www.w3.org/TR/cssom-1/"><cite>CSSオブジェクトモデル
                    (CSSOM)</cite></a>. 2021年8月26日. 作業草案. URL: <a
                href="https://www.w3.org/TR/cssom-1/">https://www.w3.org/TR/cssom-1/</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM現行標準</cite></a>. 現行標準.
            URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML標準</cite></a>.
            現行標準. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra
                    現行標準</cite></a>. 現行標準. URL: <a
                href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>RFCで要求レベルを示すキーワード</cite></a>.
            1997年3月. Best Current Practice. URL: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-selectors-4">[SELECTORS-4]
        <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://www.w3.org/TR/selectors-4/"><cite>セレクター レベル4</cite></a>.
            2018年11月21日. 作業草案. URL: <a href="https://www.w3.org/TR/selectors-4/">https://www.w3.org/TR/selectors-4/</a>
        <dt id="biblio-webidl">[WebIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL現行標準</cite></a>. 現行標準. URL:
            <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-highlighttype"><code><c- g>HighlightType</c-></code></a> {
  <a href="#dom-highlighttype-highlight"><code><c- s>"highlight"</c-></code></a>,
  <a href="#dom-highlighttype-spelling-error"><code><c- s>"spelling-error"</c-></code></a>,
  <a href="#dom-highlighttype-grammar-error"><code><c- s>"grammar-error"</c-></code></a>
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#highlight"><c- g>Highlight</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-highlight-highlight"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abstractrange"><c- n>AbstractRange</c-></a>... <a href="#dom-highlight-highlight-initialranges-initialranges"><code><c- g>initialRanges</c-></code></a>);
  <c- b>setlike</c->&lt;<a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abstractrange"><c- n>AbstractRange</c-></a>>;
  <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a> <a data-type="long" href="#dom-highlight-priority"><code><c- g>priority</c-></code></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-highlighttype"><c- n>HighlightType</c-></a> <a data-type="HighlightType" href="#dom-highlight-type"><code><c- g>type</c-></code></a>;
};

<c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://www.w3.org/TR/cssom-1/#namespacedef-css"><c- g>CSS</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#highlightregistry"><c- n>HighlightRegistry</c-></a> <a data-readonly data-type="HighlightRegistry" href="#dom-css-highlights"><code><c- g>highlights</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#highlightregistry"><code><c- g>HighlightRegistry</c-></code></a> {
  <c- b>maplike</c->&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>, <a data-link-type="idl-name" href="#highlight"><c- n>Highlight</c-></a>>;
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">課題索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> この再評価のタイミング（同期性含む）をどう規定すべきか？ <a
                href="https://github.com/w3c/csswg-drafts/issues/4596">[Issue #4596]</a> <a class="issue-return"
                href="#issue-a4ade514" title="Jump to section">↵</a></div>
        <div class="issue"> <code
                class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#staticrange">StaticRange</a></code>を含む<a
                data-link-type="dfn" href="#custom-highlight">カスタムハイライト</a>と<a data-link-type="biblio"
                href="#biblio-css-contain-2">[css-contain-2]</a>との相互作用は問題があるように思われる:
            完全に包含された要素であれば、その子孫へのDOM変更は外部要素の無効化や再描画を引き起こさないはずだが、
            static rangeの境界点が包含サブツリー内と外部両方にあり、
            包含サブツリー内のDOMが変更されて境界点が有効ノードでなくなった場合、
            範囲全体が無視され、外部サブツリーの描画にも影響する。
            これは<a data-link-type="dfn" href="https://drafts.csswg.org/css-contain-2/#style-containment">スタイル包含</a>の弱点か、
            それとも上記無効化ロジックの弱点か、あるいは他の問題か？ <a href="https://github.com/w3c/csswg-drafts/issues/4598">[Issue #4598]</a> <a
                class="issue-return" href="#issue-d5e91a86" title="Jump to section">↵</a></div>
        <div class="issue">
            イベントに関するセクションは未定です。https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/master/highlight/events-explainer.md
            を参照してください。 <a class="issue-return" href="#issue-3d1f5f66" title="Jump to section">↵</a></div>
        <div class="issue"> カスタムハイライト専用のイベント処理機構を持つべきか、疑似要素全般に追加すべきか検討中です。 <a class="issue-return"
                href="#issue-230bd93b" title="Jump to section">↵</a></div>
        <div class="issue"> 編集者以外で謝辞を述べるべき人物を記載してください。 <a class="issue-return" href="#issue-f0ab6bff"
                title="Jump to section">↵</a></div>
    </div>
    <aside class="dfn-panel" data-for="custom-highlight">
        <b><a href="#custom-highlight">#custom-highlight</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-custom-highlight">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-custom-highlight①">(2)</a> <a
                    href="#ref-for-custom-highlight②">(3)</a>
            <li><a href="#ref-for-custom-highlight③">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-custom-highlight④">(2)</a> <a
                    href="#ref-for-custom-highlight⑤">(3)</a> <a href="#ref-for-custom-highlight⑥">(4)</a> <a
                    href="#ref-for-custom-highlight⑦">(5)</a> <a href="#ref-for-custom-highlight⑧">(6)</a> <a
                    href="#ref-for-custom-highlight⑨">(7)</a> <a href="#ref-for-custom-highlight①⓪">(8)</a>
            <li><a href="#ref-for-custom-highlight①①">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
            <li><a href="#ref-for-custom-highlight①②">4.2.4.
                    Painting</a> <a href="#ref-for-custom-highlight①③">(2)</a> <a
                    href="#ref-for-custom-highlight①④">(3)</a> <a href="#ref-for-custom-highlight①⑤">(4)</a>
            <li><a href="#ref-for-custom-highlight①⑥">4.2.5.
                    Priority of Overlapping Highlights</a> <a href="#ref-for-custom-highlight①⑦">(2)</a>
            <li><a href="#ref-for-custom-highlight①⑧">4.2.6.
                    Highlight types</a> <a href="#ref-for-custom-highlight①⑨">(2)</a> <a
                    href="#ref-for-custom-highlight②⓪">(3)</a> <a href="#ref-for-custom-highlight②①">(4)</a> <a
                    href="#ref-for-custom-highlight②②">(5)</a> <a href="#ref-for-custom-highlight②③">(6)</a>
            <li><a href="#ref-for-custom-highlight②④">5.1.
                    Repaints</a> <a href="#ref-for-custom-highlight②⑤">(2)</a> <a
                    href="#ref-for-custom-highlight②⑥">(3)</a>
            <li><a href="#ref-for-custom-highlight②⑦">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-custom-highlight②⑧">(2)</a> <a
                    href="#ref-for-custom-highlight②⑨">(3)</a> <a href="#ref-for-custom-highlight③⓪">(4)</a> <a
                    href="#ref-for-custom-highlight③①">(5)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="highlight">
        <b><a href="#highlight">#highlight</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-highlight">1.
                    Introduction</a> <a href="#ref-for-highlight①">(2)</a>
            <li><a href="#ref-for-highlight②">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-highlight③">(2)</a>
            <li><a href="#ref-for-highlight④">3.2.
                    Registering Custom Highlights</a>
            <li><a href="#ref-for-highlight⑤"> Changes since the 8 December 2020 Working Draft</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="enumdef-highlighttype">
        <b><a href="#enumdef-highlighttype">#enumdef-highlighttype</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-enumdef-highlighttype">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-enumdef-highlighttype①">4.2.6.
                    Highlight types</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlighttype-highlight">
        <b><a href="#dom-highlighttype-highlight">#dom-highlighttype-highlight</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlighttype-highlight">3.1.
                    Creating Custom Highlights</a>
            <li><a href="#ref-for-dom-highlighttype-highlight①">4.2.6.
                    Highlight types</a> <a href="#ref-for-dom-highlighttype-highlight②">(2)</a> <a
                    href="#ref-for-dom-highlighttype-highlight③">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlighttype-spelling-error">
        <b><a href="#dom-highlighttype-spelling-error">#dom-highlighttype-spelling-error</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlighttype-spelling-error">4.2.6.
                    Highlight types</a> <a href="#ref-for-dom-highlighttype-spelling-error①">(2)</a> <a
                    href="#ref-for-dom-highlighttype-spelling-error②">(3)</a> <a
                    href="#ref-for-dom-highlighttype-spelling-error③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlighttype-grammar-error">
        <b><a href="#dom-highlighttype-grammar-error">#dom-highlighttype-grammar-error</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlighttype-grammar-error">4.2.6.
                    Highlight types</a> <a href="#ref-for-dom-highlighttype-grammar-error①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlight-highlight-initialranges-initialranges">
        <b><a
                href="#dom-highlight-highlight-initialranges-initialranges">#dom-highlight-highlight-initialranges-initialranges</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlight-highlight-initialranges-initialranges">3.1.
                    Creating Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlight-priority">
        <b><a href="#dom-highlight-priority">#dom-highlight-priority</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlight-priority">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-dom-highlight-priority①">(2)</a>
            <li><a href="#ref-for-dom-highlight-priority②">4.2.5.
                    Priority of Overlapping Highlights</a> <a href="#ref-for-dom-highlight-priority③">(2)</a>
            <li><a href="#ref-for-dom-highlight-priority④">5.1.
                    Repaints</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlight-type">
        <b><a href="#dom-highlight-type">#dom-highlight-type</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlight-type">3.1.
                    Creating Custom Highlights</a> <a href="#ref-for-dom-highlight-type①">(2)</a>
            <li><a href="#ref-for-dom-highlight-type②">4.2.6.
                    Highlight types</a> <a href="#ref-for-dom-highlight-type③">(2)</a> <a
                    href="#ref-for-dom-highlight-type④">(3)</a> <a href="#ref-for-dom-highlight-type⑤">(4)</a> <a
                    href="#ref-for-dom-highlight-type⑥">(5)</a> <a href="#ref-for-dom-highlight-type⑦">(6)</a> <a
                    href="#ref-for-dom-highlight-type⑧">(7)</a>
            <li><a href="#ref-for-dom-highlight-type⑨"> Changes since the 8 December 2020 Working Draft</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-highlight-highlight">
        <b><a href="#dom-highlight-highlight">#dom-highlight-highlight</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-highlight-highlight">3.1.
                    Creating Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="highlight-registry">
        <b><a href="#highlight-registry">#highlight-registry</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-highlight-registry">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-highlight-registry①">(2)</a> <a
                    href="#ref-for-highlight-registry②">(3)</a>
            <li><a href="#ref-for-highlight-registry③">4.2.5.
                    Priority of Overlapping Highlights</a>
            <li><a href="#ref-for-highlight-registry④">5.1.
                    Repaints</a>
            <li><a href="#ref-for-highlight-registry⑤">5.2.
                    Range Updating and Invalidation</a> <a href="#ref-for-highlight-registry⑥">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="registered">
        <b><a href="#registered">#registered</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-registered">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-registered①">(2)</a> <a
                    href="#ref-for-registered②">(3)</a> <a href="#ref-for-registered③">(4)</a> <a
                    href="#ref-for-registered④">(5)</a> <a href="#ref-for-registered⑤">(6)</a> <a
                    href="#ref-for-registered⑥">(7)</a>
            <li><a href="#ref-for-registered⑦">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
            <li><a href="#ref-for-registered⑧">4.2.5.
                    Priority of Overlapping Highlights</a>
            <li><a href="#ref-for-registered⑨">5.1.
                    Repaints</a> <a href="#ref-for-registered①⓪">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-css-highlights">
        <b><a href="#dom-css-highlights">#dom-css-highlights</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-css-highlights">3.2.
                    Registering Custom Highlights</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="highlightregistry">
        <b><a href="#highlightregistry">#highlightregistry</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-highlightregistry">1.
                    Introduction</a>
            <li><a href="#ref-for-highlightregistry①">3.2.
                    Registering Custom Highlights</a>
            <li><a href="#ref-for-highlightregistry②"> Changes since the 8 December 2020 Working Draft</a> <a
                    href="#ref-for-highlightregistry③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="custom-highlight-name">
        <b><a href="#custom-highlight-name">#custom-highlight-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-custom-highlight-name">3.2.
                    Registering Custom Highlights</a> <a href="#ref-for-custom-highlight-name①">(2)</a> <a
                    href="#ref-for-custom-highlight-name②">(3)</a>
            <li><a href="#ref-for-custom-highlight-name③">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="selectordef-highlight-custom-highlight-name">
        <b><a
                href="#selectordef-highlight-custom-highlight-name">#selectordef-highlight-custom-highlight-name</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-selectordef-highlight-custom-highlight-name">1.
                    Introduction</a> <a href="#ref-for-selectordef-highlight-custom-highlight-name①">(2)</a>
            <li><a href="#ref-for-selectordef-highlight-custom-highlight-name②">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="custom-highlight-pseudo-element">
        <b><a href="#custom-highlight-pseudo-element">#custom-highlight-pseudo-element</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-custom-highlight-pseudo-element">4.2.1.
                    Applicable Properties</a>
            <li><a href="#ref-for-custom-highlight-pseudo-element①">4.2.2.
                    Default Styles</a> <a href="#ref-for-custom-highlight-pseudo-element②">(2)</a>
            <li><a href="#ref-for-custom-highlight-pseudo-element③">4.2.3.
                    Cascading and Inheritance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="typedef-custom-highlight-name">
        <b><a href="#typedef-custom-highlight-name">#typedef-custom-highlight-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-typedef-custom-highlight-name">4.1.
                    The Custom Highlight Pseudo-element: ::highlight()</a> <a
                    href="#ref-for-typedef-custom-highlight-name①">(2)</a> <a
                    href="#ref-for-typedef-custom-highlight-name②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="priority">
        <b><a href="#priority">#priority</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-priority">4.2.4.
                    Painting</a>
            <li><a href="#ref-for-priority①">4.2.5.
                    Priority of Overlapping Highlights</a> <a href="#ref-for-priority②">(2)</a>
        </ul>
    </aside>
    <script>/* script-dfn-panel */

        document.body.addEventListener("click", function (e) {
            var queryAll = function (sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while (el.parentElement) {
                if (el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if (el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if (el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if (target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function (el) {
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if (target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if (dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if (panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if (target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
    </script>
    <script>/* script-var-click-highlighting */

        document.addEventListener("click", e => {
            if (e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        {
            const indexCounts = new Map();
            const indexNames = new Map();
            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = null;
                let searchEl = v;
                while (algoContainer == null && searchEl != document.body) {
                    searchEl = searchEl.parentNode;
                    if (searchEl.hasAttribute("data-algorithm")) {
                        algoContainer = searchEl;
                    }
                }

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const algoName = algoContainer.getAttribute("data-algorithm");
                const varName = getVarName(v);
                const addClass = !v.classList.contains("selected");
                let highlightClass = null;
                if (addClass) {
                    const index = chooseHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] += 1;
                    indexNames.set(algoName + "///" + varName, index);
                    highlightClass = nameFromIndex(index);
                } else {
                    const index = previousHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] -= 1;
                    highlightClass = nameFromIndex(index);
                }

                // Find all same-name vars, and toggle their class appropriately.
                for (const el of algoContainer.querySelectorAll("var")) {
                    if (getVarName(el) == varName) {
                        el.classList.toggle("selected", addClass);
                        el.classList.toggle(highlightClass, addClass);
                    }
                }
            }
            function getVarName(el) {
                return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
            }
            function chooseHighlightIndex(algoName, varName) {
                let indexes = null;
                if (indexCounts.has(algoName)) {
                    indexes = indexCounts.get(algoName);
                } else {
                    // 7 classes right now
                    indexes = [0, 0, 0, 0, 0, 0, 0];
                    indexCounts.set(algoName, indexes);
                }

                // If the element was recently unclicked,
                // *and* that color is still unclaimed,
                // give it back the same color.
                const lastIndex = previousHighlightIndex(algoName, varName);
                if (indexes[lastIndex] === 0) return lastIndex;

                // Find the earliest index with the lowest count.
                const minCount = Math.min.apply(null, indexes);
                let index = null;
                for (var i = 0; i < indexes.length; i++) {
                    if (indexes[i] == minCount) {
                        return i;
                    }
                }
            }
            function previousHighlightIndex(algoName, varName) {
                return indexNames.get(algoName + "///" + varName);
            }
            function nameFromIndex(index) {
                return "selected" + index;
            }
        }
    </script>
    <script src="https://htmlspecs.com/dropdown.js"></script>