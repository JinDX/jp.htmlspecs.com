<!doctype html>
<html lang="ja-JP">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>CSSアニメーションワークレットAPI</title>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="WD" name="w3c-status">
    <link href="https://www.w3.org/TR/css-animation-worklet-1/default.css" rel="stylesheet" type="text/css">
    <meta content="Bikeshed version a8675e8c315faa3f78e47e67c76649fa9a07ee9b" name="generator">
    <link href="https://www.w3.org/TR/css-animation-worklet-1/" rel="canonical">
    <style>
        /* style-md-lists */

        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* style-selflinks */

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: gray;
            color: white;
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: black;
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* style-counters */

        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* style-var-click-highlighting */

        var {
            cursor: pointer;
        }

        var.selected0 {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var.selected1 {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var.selected2 {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var.selected3 {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var.selected4 {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var.selected5 {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var.selected6 {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>
    <style>
        /* style-autolinks */

        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: #005a9c;
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }
    </style>
    <style>
        /* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: black;
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0;
        }

        .dfn-panel li {
            list-style: inside;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled {
            cursor: pointer;
        }
    </style>
    <style>
        /* style-syntax-highlighting */
        pre.idl.highlight {
            color: #708090;
        }

        .highlight:not(.idl) {
            background: hsl(24, 20%, 95%);
        }

        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */
    </style>
    <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-WD" rel="stylesheet" type="text/css">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">CSSアニメーションワークレットAPI</h1>
        <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">W3C 初公開ワーキングドラフト, <time
                    class="dt-updated" datetime="2019-06-25">2019年6月25日</time></span></h2>
        <div data-fill-with="spec-metadata">
            <dl>
                <dt>このバージョン:
                <dd><a class="u-url"
                        href="https://www.w3.org/TR/2019/WD-css-animation-worklet-1-20190625/">https://www.w3.org/TR/2019/WD-css-animation-worklet-1-20190625/</a>
                <dt>最新公開バージョン:
                <dd><a
                        href="https://www.w3.org/TR/css-animation-worklet-1/">https://www.w3.org/TR/css-animation-worklet-1/</a>
                <dt>編集者ドラフト:
                <dd><a
                        href="https://drafts.css-houdini.org/css-animationworklet-1/">https://drafts.css-houdini.org/css-animationworklet-1/</a>
                <dt>フィードバック:
                <dd><span><a
                            href="mailto:public-houdini@w3.org?subject=%5Bcss-animation-worklet%5D%20YOUR%20TOPIC%20HERE">public-houdini@w3.org</a>
                        件名 “<kbd>[css-animation-worklet] <i data-lt>… メッセージのトピック …</i></kbd>” (<a
                            href="https://lists.w3.org/Archives/Public/public-houdini/"
                            rel="discussion">アーカイブ</a>)</span>
                <dt>課題追跡:
                <dd><a href="#issues-index">仕様内インライン</a>
                <dd><a href="https://github.com/w3c/css-houdini-drafts/labels/css-animation-worklet-1">GitHub Issues</a>
                <dt class="editor">編集者:
                <dd class="editor p-author h-card vcard" data-editor-id="81464"><a class="p-name fn u-email email"
                        href="mailto:majidvp@google.com">Majid Valipour</a>
                <dd class="editor p-author h-card vcard" data-editor-id="98451"><a class="p-name fn u-email email"
                        href="mailto:flackr@chromium.org">Robert Flack</a>
                <dd class="editor p-author h-card vcard" data-editor-id="96463"><a class="p-name fn u-email email"
                        href="mailto:smcgruer@chromium.org">Stephen McGruer</a>
            </dl>
        </div>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2019 <a
                href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
                href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a
                href="https://www.ercim.eu/"><abbr
                    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a
                href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">概要</span></h2>
        <p><a href="#animation-worklet">Animation Worklet</a> APIは、一連の<a
                href="https://w3c.github.io/web-animations/#animation-effect">アニメーション効果</a>を制御するスクリプトアニメーションを作成するための方法を提供します。このAPIは、ユーザーエージェントがそのようなアニメーションを専用スレッドで実行し、メインスレッドから分離したパフォーマンスを一定程度確保できるように設計されています。
        </p>
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">この文書のステータス</span>
    </h2>
    <div data-fill-with="status">
        <p><em>このセクションでは、公開時点の文書のステータスについて説明します。他の文書が本書に取って代わる場合があります。現在のW3Cの出版物一覧およびこの技術レポートの最新の改訂版は、<a
                    href="https://www.w3.org/TR/">W3C技術レポート一覧（https://www.w3.org/TR/）</a>で確認できます。</em> </p>
        <p>この文書は<b>最初の公開ワーキングドラフト</b>です。</p>
        <p>最初の公開ワーキングドラフトとして公開されたことは、W3Cメンバーシップによる承認を意味するものではありません。この文書はドラフトであり、随時更新・差し替え・廃止される可能性があります。進行中の作業以外としてこの文書を引用するのは不適切です。
        </p>
        <p>この仕様の議論には<a href="https://github.com/w3c/css-houdini-drafts/issues">GitHub
                Issues</a>をご利用ください。課題を提出する際は、タイトルに「css-animation-worklet」という文字列を含めてください。例：「[css-animation-worklet]
            <i>…コメント概要…</i>」。すべての課題やコメントは<a
                href="https://lists.w3.org/Archives/Public/public-houdini-archive/">アーカイブ</a>されています。
        </p>
        <p>この文書は<a href="https://www.w3.org/Style/CSS/members">CSSワーキンググループ</a>によって作成されました。</p>
        <p>この文書は、<a
                href="https://www.w3.org/Consortium/Patent-Policy/">W3C特許ポリシー</a>の下で活動するグループによって作成されました。W3Cは、そのグループの成果物に関連する特許開示の<a
                href="https://www.w3.org/2004/01/pp-impl/32061/status"
                rel="disclosure">公開リスト</a>を維持しています。そのページには特許開示の方法についても記載されています。ある個人が、<a
                href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">必須クレーム</a>を含むと信じる特許について実際に知っている場合、その情報を<a
                href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">W3C特許ポリシー第6節</a>に従って開示しなければなりません。</p>
        <p>この文書は、<a href="https://www.w3.org/2019/Process-20190301/"
                id="w3c_process_revision">2019年3月1日版W3Cプロセス文書</a>に従って管理されています。</p>
        <p></p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目次</h2>
        <ol class="toc" role="directory">
            <li>
                <a href="#intro"><span class="secno">1</span> <span class="content">はじめに</span></a>
                <ol class="toc">
                    <li><a href="#relationship-to-web-animations"><span class="secno">1.1</span> <span
                                class="content">Web Animations APIとの関係</span></a>
                </ol>
            <li><a href="#animation-worklet-desc"><span class="secno">2</span> <span class="content">Animation
                        Worklet</span></a>
            <li>
                <a href="#animator-desc"><span class="secno">3</span> <span class="content">Animator</span></a>
                <ol class="toc">
                    <li><a href="#stateless-animator-desc"><span class="secno">3.1</span> <span
                                class="content">StatelessAnimatorインターフェイス</span></a>
                    <li><a href="#stateful-animator-desc"><span class="secno">3.2</span> <span
                                class="content">StatefulAnimatorインターフェイス</span></a>
                    <li><a href="#animator-definition-desc"><span class="secno">3.3</span> <span
                                class="content">アニメーター定義</span></a>
                    <li><a href="#registering-animator-definition"><span class="secno">3.4</span> <span
                                class="content">アニメーター定義の登録</span></a>
                </ol>
            <li>
                <a href="#animator-instance-section"><span class="secno">4</span> <span
                        class="content">アニメーターインスタンス</span></a>
                <ol class="toc">
                    <li><a href="#creating-animator-instance"><span class="secno">4.1</span> <span
                                class="content">アニメーターインスタンスの作成</span></a>
                    <li><a href="#running-animators"><span class="secno">4.2</span> <span
                                class="content">アニメーターの実行</span></a>
                    <li><a href="#removing-animator"><span class="secno">4.3</span> <span
                                class="content">アニメーターインスタンスの削除</span></a>
                    <li><a href="#migrating-animator"><span class="secno">4.4</span> <span
                                class="content">アニメーターインスタンスの移行</span></a>
                    <li><a href="#requesting-animation-frames"><span class="secno">4.5</span> <span
                                class="content">アニメーションフレームのリクエスト</span></a>
                </ol>
            <li>
                <a href="#web-animation-integration"><span class="secno">5</span> <span class="content">Web
                        Animations統合</span></a>
                <ol class="toc">
                    <li><a href="#worklet-animation-desc"><span class="secno">5.1</span> <span class="content">Worklet
                                Animation</span></a>
                    <li><a href="#creating-worklet-animation"><span class="secno">5.2</span> <span
                                class="content">Worklet Animationの作成</span></a>
                    <li><a href="#timing-model"><span class="secno">5.3</span> <span class="content">Worklet
                                Animationのタイミングモデル</span></a>
                    <li><a href="#worklet-animation-animator-instances"><span class="secno">5.4</span> <span
                                class="content">アニメーターインスタンスとの連携</span></a>
                    <li><a href="#scroll-timeline"><span class="secno">5.5</span> <span
                                class="content">ScrollTimeline</span></a>
                    <li><a href="#worklet-group-effect"><span class="secno">5.6</span> <span
                                class="content">WorkletGroupEffect</span></a>
                    <li><a href="#effect-stack-composite-order"><span class="secno">5.7</span> <span
                                class="content">エフェクトスタックと合成順序</span></a>
                </ol>
            <li><a href="#security-considerations"><span class="secno">6</span> <span
                        class="content">セキュリティの考慮事項</span></a>
            <li><a href="#privacy-considerations"><span class="secno">7</span> <span
                        class="content">プライバシーの考慮事項</span></a>
            <li>
                <a href="#examples"><span class="secno">8</span> <span class="content">例</span></a>
                <ol class="toc">
                    <li><a href="#example-1"><span class="secno">8.1</span> <span
                                class="content">例1：Twitterヘッダー</span></a>
                    <li><a href="#example-2"><span class="secno">8.2</span> <span class="content">例2：パララックス背景</span></a>
                </ol>
            <li>
                <a href="#conformance"><span class="secno"></span> <span class="content">適合性</span></a>
                <ol class="toc">
                    <li><a href="#conventions"><span class="secno"></span> <span class="content">文書の規則</span></a>
                    <li><a href="#conformance-classes"><span class="secno"></span> <span
                                class="content">適合クラス</span></a>
                    <li>
                        <a href="#partial"><span class="secno"></span> <span class="content">部分的な実装</span></a>
                        <ol class="toc">
                            <li><a href="#conform-future-proofing"><span class="secno"></span> <span class="content">
                                        不安定および独自機能の実装</span></a>
                        </ol>
                    <li><a href="#testing"><span class="secno"></span> <span class="content">非実験的な実装</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">この仕様で定義されている用語</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">参照によって定義される用語</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">規範参考文献</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">参考情報</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">課題索引</span></a>
        </ol>
    </nav>
    <main>
        <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span
                class="content">はじめに</span><a class="self-link" href="#intro"></a></h2>
        <em>このセクションは規範的ではありません。</em>
        <p>この文書では、ウェブアニメーションの拡張性を提供し、ウェブ上で高パフォーマンスなインタラクティブな手続き型アニメーションを可能にする新しいプリミティブを紹介します。詳細な動機や背景については <a
                data-link-type="biblio" href="#biblio-explainer">[explainer]</a> および <a data-link-type="biblio"
                href="#biblio-principles">[principles]</a> を参照してください。</p>
        <p><a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet">Animation Worklet</a>
            APIは、一連の<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect"
                id="ref-for-animation-effect">アニメーション効果</a>を制御するスクリプトアニメーションを作成するための方法を提供します。このAPIは、ユーザーエージェントがそのようなアニメーションを専用スレッドで実行し、メインスレッドから分離したパフォーマンスを一定程度確保できるように設計されています。
        </p>
        <h3 class="heading settled" data-level="1.1" id="relationship-to-web-animations"><span class="secno">1.1.
            </span><span class="content">Web Animations APIとの関係</span><a class="self-link"
                href="#relationship-to-web-animations"></a></h3>
        <em>このセクションは規範的ではありません。</em>
        <p><a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet①">Animation
                Worklet</a>実行コンテキスト内で動作するアニメーションは、メインのJavaScript実行コンテキスト上でWeb Animations仕様の<code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#animation" id="ref-for-animation">Animation</a></code>
            インターフェイスを公開します。つまり、メインスレッドから同じWeb Animation APIを使って制御や検査が可能です。</p>
        <h2 class="heading settled" data-level="2" id="animation-worklet-desc"><span class="secno">2. </span><span
                class="content">Animation Worklet</span><a class="self-link" href="#animation-worklet-desc"></a></h2>
        <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animation-worklet">Animation Worklet</dfn>は、
        <code
            class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#worklet" id="ref-for-worklet">Worklet</a></code>
        であり、カスタムアニメーションに関連するすべてのクラスを管理します。このworkletは<code
            class="idl"><a data-link-type="idl" href="#dom-css-animationworklet" id="ref-for-dom-css-animationworklet">animationWorklet</a></code>
        属性からアクセスできます。
        <p><code
                class="idl"><a data-link-type="idl" href="#dom-css-animationworklet" id="ref-for-dom-css-animationworklet①">animationWorklet</a></code>の
            <a data-link-type="dfn" href="https://www.w3.org/TR/worklets-1/#worklet-global-scope-type"
                id="ref-for-worklet-global-scope-type">workletグローバルスコープ型</a>は<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope">AnimationWorkletGlobalScope</a></code>です。
        </p>
        <p><code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①">AnimationWorkletGlobalScope</a></code>
            は<code
                class="idl"><a data-link-type="idl" href="#dom-css-animationworklet" id="ref-for-dom-css-animationworklet②">animationWorklet</a></code>のグローバルな実行コンテキストを表します。
        </p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/worklets-1/#worklet" id="ref-for-worklet①"><c- n>Worklet</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="CSS" data-dfn-type="attribute" data-export data-readonly data-type="Worklet" id="dom-css-animationworklet"><code><c- g>animationWorklet</c-></code></dfn>;
};
</pre>
        <h2 class="heading settled" data-level="3" id="animator-desc"><span class="secno">3. </span><span
                class="content">Animator</span><a class="self-link" href="#animator-desc"></a></h2>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="animator">Animator</dfn>は、アニメーションスレッド上で動作するアニメーションインスタンスを表します。
            Animatorは一意の名前によって識別され、現在の入力時間に応じてアニメーションのキーフレーム効果がどのように進行するかを決定します。<a data-link-type="dfn" href="#animator"
                id="ref-for-animator">Animator</a>インスタンスは<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope②">AnimationWorkletGlobalScope</a></code>
            内に存在し、各インスタンスは<code
                class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation">WorkletAnimation</a></code>
            インスタンスに関連付けられています。Animatorは<code
                class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation①">WorkletAnimation</a></code>
            の構築によってのみインスタンス化されます。
        </p>
        <p>2種類のAnimatorがサポートされています：<code
                class="idl"><a data-link-type="idl" href="#statelessanimator" id="ref-for-statelessanimator">StatelessAnimator</a></code>
            と <code
                class="idl"><a data-link-type="idl" href="#statefulanimator" id="ref-for-statefulanimator">StatefulAnimator</a></code>であり、
            それぞれ異なる状態管理戦略を提供します。</p>
        <h3 class="heading settled" data-level="3.1" id="stateless-animator-desc"><span class="secno">3.1. </span><span
                class="content">StatelessAnimatorインターフェイス</span><a class="self-link"
                href="#stateless-animator-desc"></a></h3>
        <p>このインターフェイスはステートレスなアニメーターを表します。このタイプのアニメーターは、インスタンスやグローバルスコープに保存されるローカル状態に依存しません。実質的に、<code
                class="idl"><a data-link-type="idl" href="#statelessanimator" id="ref-for-statelessanimator①">StatelessAnimator</a></code>
            のanimate関数は、同じ入力に対して常に同じ出力を生成する純粋関数として扱うことができます。</p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>, <dfn class="idl-code" data-dfn-for="StatelessAnimator" data-dfn-type="constructor" data-export data-lt="StatelessAnimator(options)|StatelessAnimator()" id="dom-statelessanimator-statelessanimator"><code><c- g>Constructor</c-></code><a class="self-link" href="#dom-statelessanimator-statelessanimator"></a></dfn> (<c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="StatelessAnimator/StatelessAnimator(options)" data-dfn-type="argument" data-export id="dom-statelessanimator-statelessanimator-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-statelessanimator-statelessanimator-options-options"></a></dfn>)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="statelessanimator"><code><c- g>StatelessAnimator</c-></code></dfn> {
};
</pre>
        <div class="note" role="note">
            クラスの例は以下の通りです。
            <pre class="lang-javascript highlight"><c- kr>class</c-> FooAnimator <c- kr>extends</c-> StatelessAnimator <c- p>{</c->
    constructor<c- p>(</c->options<c- p>)</c-> <c- p>{</c->
        <c- c1>// 新しいアニメーターがインスタンス化されたときに呼び出されます。</c->
    <c- p>}</c->
    animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
        <c- c1>// アニメーションフレームのロジックはここに記述します。</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
        </div>
        <p class="note" role="note"><span>注:</span>
            ステートレスであることで、アニメーションワークレットは複数のアニメーションフレームを並列に生成したり、非常に安価な初期化・解体処理などの最適化が可能です。このような最適化を可能にするため、StatelessAnimatorの利用が強く推奨されます。
        </p>
        <h3 class="heading settled" data-level="3.2" id="stateful-animator-desc"><span class="secno">3.2. </span><span
                class="content">StatefulAnimatorインターフェイス</span><a class="self-link" href="#stateful-animator-desc"></a>
        </h3>
        <p>このインターフェイスはステートフルなアニメーターを表します。このアニメーターはローカル状態を持つことができ、アニメーションワークレットは、このインターフェイスが要求する契約を満たす限り状態の維持を保証します。</p>
        <p><a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet②">Animation worklet</a>
            は、異なるスレッドやプロセスにまたがって存在する可能性がある複数の<code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope">WorkletGlobalScope</a></code>を管理します。アニメーションワークレットは、（例：リソースを節約するため）グローバルスコープを一時的に終了したり、（例：特定のスレッドでのみエフェクトが変更可能な場合）実行中の<a
                data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance">アニメーターインスタンス</a>を異なるグローバルスコープへ移行させることがあります。アニメーションワークレットは、ステートフルアニメーターインスタンスの状態が、インスタンスが異なるグローバルスコープで再生成されても保持されることを保証します。
        </p>
        <p>状態維持の基本的な仕組みは、アニメーションワークレットがlocal stateとして<code
                class="idl"><a data-link-type="idl" href="#dom-statefulanimator-state" id="ref-for-dom-statefulanimator-state">state</a></code>
            関数を通じて公開される情報をスナップショットし、後で異なるグローバルスコープでインスタンスが再生成される際に、コンストラクタに渡せるように再現することです。<a data-link-type="dfn"
                href="#migrate-an-animator-instance"
                id="ref-for-migrate-an-animator-instance">アニメーターインスタンスの移行</a>アルゴリズムは、このプロセスの詳細を記載しています。</p>
        <p>ユーザー定義のステートフルアニメーターは、state関数が構造化複製アルゴリズムでシリアライズ可能な状態オブジェクトを返し、同じオブジェクトがコンストラクタに渡された場合に状態を再現できることが契約として求められます。
        </p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global①"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>,
<dfn class="idl-code" data-dfn-for="StatefulAnimator" data-dfn-type="constructor" data-export data-lt="StatefulAnimator(options, state)|StatefulAnimator(options)|StatefulAnimator()" id="dom-statefulanimator-statefulanimator"><code><c- g>Constructor</c-></code><a class="self-link" href="#dom-statefulanimator-statefulanimator"></a></dfn> (<c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="StatefulAnimator/StatefulAnimator(options, state)" data-dfn-type="argument" data-export id="dom-statefulanimator-statefulanimator-options-state-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-statefulanimator-statefulanimator-options-state-options"></a></dfn>, <c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="StatefulAnimator/StatefulAnimator(options, state)" data-dfn-type="argument" data-export id="dom-statefulanimator-statefulanimator-options-state-state"><code><c- g>state</c-></code><a class="self-link" href="#dom-statefulanimator-statefulanimator-options-state-state"></a></dfn>)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="statefulanimator"><code><c- g>StatefulAnimator</c-></code></dfn> {
  <c- b>any</c-> <dfn class="dfn-paneled idl-code" data-dfn-for="StatefulAnimator" data-dfn-type="method" data-export data-lt="state()" id="dom-statefulanimator-state"><code><c- g>state</c-></code></dfn>();
};
</pre>
        <div class="note" role="note">
            このクラスは次のようになります。
            <pre class="lang-javascript highlight"><c- kr>class</c-> BarAnimator <c- kr>extends</c-> StatefulAnimator <c- p>{</c->
    constructor<c- p>(</c->options<c- p>,</c-> state<c- p>)</c-> <c- p>{</c->
      <c- c1>// 新しいアニメーターがインスタンス化されたとき（初回または再生成時）に呼び出されます。</c->
      <c- k>this</c-><c- p>.</c->currentVelocity  <c- o>=</c-> state <c- o>?</c-> state<c- p>.</c->velocity <c- o>:</c-> <c- mi>0</c-><c- p>;</c->
    <c- p>}</c->
    animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
        <c- c1>// アニメーションフレームのロジックはここに記述され、this.currentVelocityに依存できます。</c->
        <c- k>this</c-><c- p>.</c->currentVelocity <c- o>+=</c-> <c- mf>0.1</c-><c- p>;</c->
    <c- p>}</c->
    state<c- p>()</c-> <c- p>{</c->
      <c- c1>// 返されるオブジェクトは構造化可能なクローンアルゴリズムでシリアライズできる必要があります。</c->
      <c- k>return</c-> <c- p>{</c->
        velocity<c- o>:</c-> <c- k>this</c-><c- p>.</c->currentVelocity<c- p>;</c->
      <c- p>}</c->
    <c- p>}</c->
<c- p>}</c->
</pre>
        </div>
        <h3 class="heading settled" data-level="3.3" id="animator-definition-desc"><span class="secno">3.3. </span><span
                class="content">アニメーター定義</span><a class="self-link" href="#animator-definition-desc"></a>
        </h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-definition">アニメーター定義</dfn>は、<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">構造体</a>であり、<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope③">AnimationWorkletGlobalScope</a></code>によって必要とされる、著者定義のカスタムアニメーションを記述します。アニメーター定義は以下を含みます：
        </p>
        <ul>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-name">アニメーター名</dfn>
                    <a class="production css" data-link-type="type"
                        href="https://www.w3.org/TR/css-values-4/#typedef-ident"
                        id="ref-for-typedef-ident">&lt;ident></a>#。
                </p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="class-constructor">クラスコンストラクター</dfn>は、<code
                        class="idl"><a data-link-type="idl" href="#callbackdef-animatorinstanceconstructor" id="ref-for-callbackdef-animatorinstanceconstructor">AnimatorInstanceConstructor</a></code>
                    <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-function"
                        id="ref-for-dfn-callback-function">コールバック関数</a>型です。
                </p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animate-function">animate関数</dfn>は、<a
                        data-link-type="dfn" href="https://heycam.github.io/webidl/#Function"
                        id="ref-for-Function">Function</a> <a data-link-type="dfn"
                        href="https://heycam.github.io/webidl/#dfn-callback-function"
                        id="ref-for-dfn-callback-function①">コールバック関数</a>型です。</p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="stateful-flag">ステートフルフラグ</dfn></p>
        </ul>
        <h3 class="heading settled" data-level="3.4" id="registering-animator-definition"><span class="secno">3.4.
            </span><span class="content">アニメーター定義の登録</span><a class="self-link"
                href="#registering-animator-definition"></a></h3>
        <code
            class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope④">AnimationWorkletGlobalScope</a></code>は<dfn
            class="dfn-paneled" data-dfn-type="dfn" data-noexport
            id="animator-name-to-animator-definition-map">アニメーター名とアニメーター定義のマップ</dfn>を持ちます。
        このマップは、<code
            class="idl"><a data-link-type="idl" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator">registerAnimator(name, animatorCtor)</a></code>
        が呼び出されたときに登録されます。
        <pre class="idl highlight def">[ <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global②"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a> ]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="animationworkletglobalscope"><code><c- g>AnimationWorkletGlobalScope</c-></code></dfn> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope①"><c- n>WorkletGlobalScope</c-></a> {
    <c- b>void</c-> <a class="idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator①"><c- g>registerAnimator</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"></a></dfn>, <a class="n" data-link-type="idl-name" href="#callbackdef-animatorinstanceconstructor" id="ref-for-callbackdef-animatorinstanceconstructor①"><c- n>AnimatorInstanceConstructor</c-></a> <dfn class="idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"><code><c- g>animatorCtor</c-></code><a class="self-link" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"></a></dfn>);
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-animatorinstanceconstructor"><code><c- g>AnimatorInstanceConstructor</c-></code></dfn> = <c- b>any</c-> (<c- b>any</c-> <dfn class="idl-code" data-dfn-for="AnimatorInstanceConstructor" data-dfn-type="argument" data-export id="dom-animatorinstanceconstructor-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-animatorinstanceconstructor-options"></a></dfn>, <c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="AnimatorInstanceConstructor" data-dfn-type="argument" data-export id="dom-animatorinstanceconstructor-state"><code><c- g>state</c-></code><a class="self-link" href="#dom-animatorinstanceconstructor-state"></a></dfn>);

</pre>
        <div class="algorithm" data-algorithm="register-animator">
            <p><dfn class="dfn-paneled idl-code" data-dfn-for="AnimationWorkletGlobalScope" data-dfn-type="method"
                    data-export
                    id="dom-animationworkletglobalscope-registeranimator"><code>registerAnimator(<var>name</var>, <var>animatorCtor</var>)</code></dfn>
                メソッドが<code
                    class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑤">AnimationWorkletGlobalScope</a></code>で呼び出されたとき、ユーザーエージェントは
                次のステップを<em>必ず</em>実行しなければなりません：</p>
            <ol>
                <li data-md>
                    <p><var>name</var>が有効な<a class="production css" data-link-type="type"
                            href="https://www.w3.org/TR/css-values-4/#typedef-ident"
                            id="ref-for-typedef-ident①">&lt;ident></a>でない場合、<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw">throw</a>で<a
                            data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"
                            id="ref-for-sec-native-error-types-used-in-this-standard-typeerror">TypeError</a>を投げ、すべてのステップを中止する。
                    </p>
                <li data-md>
                    <p><var>name</var>が<a data-link-type="dfn" href="#animator-name-to-animator-definition-map"
                            id="ref-for-animator-name-to-animator-definition-map">アニメーター名とアニメーター定義のマップ</a>のキーとして存在する場合、<a
                            data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw"
                            id="ref-for-dfn-throw①">throw</a>で<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#notsupportederror"
                            id="ref-for-notsupportederror">NotSupportedError</a>を投げ、すべてのステップを中止する。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-isconstructor"
                            id="ref-for-sec-isconstructor">IsConstructor</a>(<var>animatorCtor</var>)の結果が<b>false</b>の場合、<a
                            data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw"
                            id="ref-for-dfn-throw②">throw</a>で<a data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"
                            id="ref-for-sec-native-error-types-used-in-this-standard-typeerror①">TypeError</a>を投げ、すべてのステップを中止する。
                    </p>
                <li data-md>
                    <p><var>prototype</var>を<a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p"
                            id="ref-for-sec-get-o-p">Get</a>(<var>animatorCtor</var>, "prototype")の結果とする。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-samevalue"
                            id="ref-for-sec-samevalue">SameValue</a>(<var>prototype</var>, <code
                            class="idl"><a data-link-type="idl" href="#statelessanimator" id="ref-for-statelessanimator②">StatelessAnimator</a></code>)
                        が<b>true</b>の場合、<var>stateful</var>を<b>false</b>にする。そうでなく<a data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-samevalue"
                            id="ref-for-sec-samevalue①">SameValue</a>(<var>prototype</var>, <code
                            class="idl"><a data-link-type="idl" href="#statefulanimator" id="ref-for-statefulanimator①">StatefulAnimator</a></code>)
                        が<b>true</b>の場合、<var>stateful</var>を<b>true</b>にする。それ以外の場合は<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw③">throw</a>で<a
                            data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"
                            id="ref-for-sec-native-error-types-used-in-this-standard-typeerror②">TypeError</a>を投げ、すべてのステップを中止する。
                    </p>
                <li data-md>
                    <p><var>animateValue</var>を<a data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#sec-get-o-p"
                            id="ref-for-sec-get-o-p①">Get</a>(<var>prototype</var>, "animate")の結果とする。</p>
                <li data-md>
                    <p><var>animate</var>を<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#es-type-mapping"
                            id="ref-for-es-type-mapping">変換</a>して<var>animateValue</var>を<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#Function" id="ref-for-Function①">Function</a> <a
                            data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-function"
                            id="ref-for-dfn-callback-function②">コールバック関数</a>型にする。例外が投げられた場合は、その例外を再スローし、すべてのステップを中止する。
                    </p>
                <li data-md>
                    <p><var>definition</var>を新しい<a data-link-type="dfn" href="#animator-definition"
                            id="ref-for-animator-definition">アニメーター定義</a>とし、次の内容を持つ：</p>
                    <ul>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-name"
                                    id="ref-for-animator-name">アニメーター名</a>は<var>name</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#class-constructor"
                                    id="ref-for-class-constructor">クラスコンストラクター</a>は<var>animatorCtor</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animate-function"
                                    id="ref-for-animate-function">animate関数</a>は<var>animate</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#stateful-flag"
                                    id="ref-for-stateful-flag">ステートフルフラグ</a>は<var>stateful</var></p>
                    </ul>
                <li data-md>
                    <p>キーと値のペア(<var>name</var> - <var>definition</var>)を<a data-link-type="dfn"
                            href="#animator-name-to-animator-definition-map"
                            id="ref-for-animator-name-to-animator-definition-map①">アニメーター名とアニメーター定義のマップ</a>に追加する。</p>
            </ol>
        </div>
        <h2 class="heading settled" data-level="4" id="animator-instance-section"><span class="secno">4. </span><span
                class="content">アニメーターインスタンス</span><a class="self-link" href="#animator-instance-section"></a></h2>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-instance">アニメーターインスタンス</dfn>は、<a
                data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">構造体</a>であり、<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑥">AnimationWorkletGlobalScope</a></code>内で完全に実現されたカスタムアニメーションインスタンスを記述します。
            <a data-link-type="dfn" href="#animator-definition"
                id="ref-for-animator-definition①">アニメーター定義</a>への参照を持ち、アニメーション効果やタイムラインなどインスタンス固有の状態を所有します。以下を含みます：
        </p>
        <ul>
            <li data-md>
                <p><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name①">アニメーター名</a></p>
            <li data-md>
                <p><a data-link-type="dfn" href="#animation-requested-flag"
                        id="ref-for-animation-requested-flag">アニメーションリクエストフラグ</a></p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animator-effect">アニメーター効果</dfn>（<a
                        data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect"
                        id="ref-for-animation-effect①">animation effect</a>）</p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="animator-current-time">アニメーター現在時刻</dfn>（対応する<a data-link-type="dfn"
                        href="#worklet-animation" id="ref-for-worklet-animation">worklet animation</a>の現在時刻）</p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="animator-timeline">アニメータ―タイムライン</dfn>（<a data-link-type="dfn"
                        href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timeline">timeline</a>）</p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                        id="animator-serialized-options">アニメーターシリアライズオプション</dfn>（シリアライズ可能なオブジェクト）</p>
        </ul>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="stateful-animator-instance">ステートフルアニメーターインスタンス</dfn>は、対応する<a data-link-type="dfn"
                href="#animator-instance" id="ref-for-animator-instance①">アニメーターインスタンス</a>の<a data-link-type="dfn"
                href="#animator-definition" id="ref-for-animator-definition②">アニメーター定義</a>の<a data-link-type="dfn"
                href="#stateful-flag" id="ref-for-stateful-flag①">ステートフルフラグ</a>が<b>true</b>のものです。
        </p>
        <h3 class="heading settled" data-level="4.1" id="creating-animator-instance"><span class="secno">4.1.
            </span><span class="content">アニメーターインスタンスの作成</span><a class="self-link"
                href="#creating-animator-instance"></a></h3>
        <p>各<a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance②">アニメーターインスタンス</a>は<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑦">AnimationWorkletGlobalScope</a></code>内に存在します。
        </p>
        <p>各<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑧">AnimationWorkletGlobalScope</a></code>は<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="animator-instance-set">アニメーターインスタンス集合</dfn>を持ちます。この集合は、ユーザーエージェントが<code
                class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope⑨">AnimationWorkletGlobalScope</a></code>スコープ内で新しい<a
                data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance③">アニメーターインスタンス</a>を構築した時に登録されます。各<a data-link-type="dfn"
                href="#animator-instance" id="ref-for-animator-instance④">アニメーターインスタンス</a>はドキュメントスコープ内のworklet
            animationに対応します。</p>
        <div class="algorithm" data-algorithm="create-animator">
            <p><var>name</var>、<var>timeline</var>、<var>effect</var>、<var>serializedOptions</var>、<var>serializedState</var>、<var>workletGlobalScope</var>が与えられた時、<dfn
                    class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="create-a-new-animator-instance">新しいアニメーターインスタンスを作成する</dfn>ために、ユーザーエージェントは以下の手順を<em>必ず</em>実行します：
            </p>
            <ol>
                <li data-md>
                    <p><var>definition</var>を<var>workletGlobalScope</var>の<a data-link-type="dfn"
                            href="#animator-name-to-animator-definition-map"
                            id="ref-for-animator-name-to-animator-definition-map②">アニメーター名とアニメーター定義のマップ</a>から<var>name</var>で検索した結果とする。
                    </p>
                    <p><var>definition</var>が存在しない場合、以降の手順を中止する。</p>
                <li data-md>
                    <p><var>animatorCtor</var>を<var>definition</var>の<a data-link-type="dfn" href="#class-constructor"
                            id="ref-for-class-constructor①">クラスコンストラクター</a>とする。</p>
                <li data-md>
                    <p><var>options</var>を<a data-link-type="dfn"
                            href="http://w3c.github.io/html/infrastructure.html#structureddeserialize"
                            id="ref-for-structureddeserialize">StructuredDeserialize</a>(<var>serializedOptions</var>)とする。
                    </p>
                <li data-md>
                    <p><var>state</var>を<a data-link-type="dfn"
                            href="http://w3c.github.io/html/infrastructure.html#structureddeserialize"
                            id="ref-for-structureddeserialize①">StructuredDeserialize</a>(<var>serializedState</var>)とする。
                    </p>
                <li data-md>
                    <p><var>animatorInstance</var>を<a data-link-type="dfn"
                            href="https://heycam.github.io/webidl/#construct-a-callback-function"
                            id="ref-for-construct-a-callback-function">animatorCtorの構築</a>（引数は«<var>options</var>,
                        <var>state</var>»）の結果とする。例外が発生した場合は再スローし、すべての手順を中止する。
                    </p>
                <li data-md>
                    <p><var>animatorInstance</var>に以下を設定する：</p>
                    <ul>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name②">アニメーター名</a>:
                                <var>name</var>
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animation-requested-flag"
                                    id="ref-for-animation-requested-flag①">アニメーションリクエストフラグ</a>: <a data-link-type="dfn"
                                    href="#frame-current" id="ref-for-frame-current">frame-current</a></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-current-time"
                                    id="ref-for-animator-current-time">アニメーター現在時刻</a>: 未解決</p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-effect"
                                    id="ref-for-animator-effect">アニメーター効果</a>: <var>effect</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-timeline"
                                    id="ref-for-animator-timeline">アニメータ―タイムライン</a>: <var>timeline</var></p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#animator-serialized-options"
                                    id="ref-for-animator-serialized-options">アニメーターシリアライズオプション</a>: <var>options</var>
                            </p>
                    </ul>
                <li data-md>
                    <p><var>animatorInstance</var>を<var>workletGlobalScope</var>の<a data-link-type="dfn"
                            href="#animator-instance-set" id="ref-for-animator-instance-set">アニメーターインスタンス集合</a>に追加する。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.2" id="running-animators"><span class="secno">4.2. </span><span
                class="content">アニメーターの実行</span><a class="self-link" href="#running-animators"></a></h3>
        <p>ユーザーエージェントが新しいアニメーションフレームを生成しようとする時、任意の<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance⑤">アニメーターインスタンス</a>の関連する<a data-link-type="dfn"
                href="#animation-requested-flag" id="ref-for-animation-requested-flag②">アニメーションリクエストフラグ</a>が<a
                data-link-type="dfn" href="#frame-requested"
                id="ref-for-frame-requested">frame-requested</a>であれば、ユーザーエージェントはそのフレームで<em>必ず</em><a
                data-link-type="dfn" href="#run-animators" id="ref-for-run-animators">アニメーターを実行</a>しなければなりません。</p>
        <p class="note" role="note"><span>注:</span>
            ユーザーエージェントは全ての表示フレームでアニメーションを実行する必要はありません。後のフレームまでアニメーションフレームの生成を延期することは許容されます。これにより、ユーザーエージェントはポリシーに応じて異なるサービスレベルを提供できます。
        </p>
        <div class="algorithm" data-algorithm="run-animators">
            <p>ユーザーエージェントが<var>workletGlobalScope</var>内で<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="run-animators">アニメーターを実行する</dfn>場合、<var>workletGlobalScope</var>の<a data-link-type="dfn"
                    href="#animator-instance-set" id="ref-for-animator-instance-set①">アニメーターインスタンス集合</a>内の全ての<a
                    data-link-type="dfn" href="#animator-instance"
                    id="ref-for-animator-instance⑥">アニメーターインスタンス</a>を反復します。各<var>instance</var>に対して、ユーザーエージェントは以下の手順を<em>必ず</em>実行します：
            </p>
            <ol>
                <li data-md>
                    <p><var>animatorName</var>を<var>instance</var>の<a data-link-type="dfn" href="#animator-name"
                            id="ref-for-animator-name③">アニメーター名</a>とする</p>
                <li data-md>
                    <p><var>definition</var>を<var>workletGlobalScope</var>の<a data-link-type="dfn"
                            href="#animator-name-to-animator-definition-map"
                            id="ref-for-animator-name-to-animator-definition-map③">アニメーター名とアニメーター定義のマップ</a>から<var>animatorName</var>で検索した結果とする。
                    </p>
                    <p><var>definition</var>が存在しない場合、以降の手順を中止する。</p>
                <li data-md>
                    <p><var>instance</var>の<a data-link-type="dfn" href="#animation-requested-flag"
                            id="ref-for-animation-requested-flag③">アニメーションリクエストフラグ</a>が<a data-link-type="dfn"
                            href="#frame-current"
                            id="ref-for-frame-current①">frame-current</a>である、もしくは<var>instance</var>の効果が現在のフレームのビジュアルビューポート内に表示されない場合、ユーザーエージェントは以降の手順を<em>省略可能</em>です。
                    </p>
                    <p class="issue" id="issue-6d334361"><a class="self-link" href="#issue-6d334361"></a>
                        ユーザーエージェントが遅いアニメーターをスロットルするために実行をスキップする権限を与えることを検討してください。</p>
                <li data-md>
                    <p><var>animateFunction</var>を<var>definition</var>の<a data-link-type="dfn" href="#animate-function"
                            id="ref-for-animate-function①">animate関数</a>とする。</p>
                <li data-md>
                    <p><var>currentTime</var>を<var>instance</var>の<a data-link-type="dfn" href="#animator-current-time"
                            id="ref-for-animator-current-time①">アニメーター現在時刻</a>とする。</p>
                <li data-md>
                    <p><var>effect</var>を<var>instance</var>の<a data-link-type="dfn" href="#animator-effect"
                            id="ref-for-animator-effect①">アニメーター効果</a>とする。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#invoke-a-callback-function"
                            id="ref-for-invoke-a-callback-function">animateFunctionをコールバックとして呼び出す</a>（引数は«<var>currentTime</var>,
                        <var>effect</var>»、コールバックthis値は<var>instance</var>）。
                    </p>
            </ol>
        </div>
        注: 非効率的ではありますが、同じフレーム内でユーザーエージェントが<a data-link-type="dfn" href="#run-animators"
            id="ref-for-run-animators①">アニメーターを複数回実行</a>することは合法です。
        <p class="issue" id="issue-84eae255"><a class="self-link" href="#issue-84eae255"></a>
            animateFunctionが例外を投げた場合の挙動を明示するべきです。少なくとも、キー フレームのlocalTime値は無視されるため、誤った部分更新が発生しない旨の文言が必要です。</p>
        <h3 class="heading settled" data-level="4.3" id="removing-animator"><span class="secno">4.3. </span><span
                class="content">アニメーターインスタンスの削除</span><a class="self-link" href="#removing-animator"></a>
        </h3>
        <div class="algorithm" data-algorithm="remove-animator">
            <p><var>instance</var>と<var>workletGlobalScope</var>が与えられたとき、<dfn class="dfn-paneled" data-dfn-type="dfn"
                    data-noexport
                    id="remove-an-animator-instance">アニメーターインスタンスを削除する</dfn>には、ユーザーエージェントは以下の手順を<em>必ず</em>実行します：
            </p>
            <ol>
                <li data-md>
                    <p><var>instance</var>を<var>workletGlobalScope</var>の<a data-link-type="dfn"
                            href="#animator-instance-set" id="ref-for-animator-instance-set②">アニメーターインスタンス集合</a>から削除する。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.4" id="migrating-animator"><span class="secno">4.4. </span><span
                class="content">アニメーターインスタンスの移行</span><a class="self-link" href="#migrating-animator"></a></h3>
        <p>移行プロセスでは、<a data-link-type="dfn" href="#stateful-animator-instance"
                id="ref-for-stateful-animator-instance">ステートフルアニメーターインスタンス</a>を別の<code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope②">WorkletGlobalScope</a></code>にローカル状態を失うことなく移行できます。
        </p>
        <div class="algorithm" data-algorithm="migrate-animator">
            <p>ある <code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope③">WorkletGlobalScope</a></code>
                から別の <code class="idl">WorkletGlobalScope</code> へ <dfn class="dfn-paneled" data-dfn-type="dfn"
                    data-noexport
                    id="migrate-an-animator-instance">アニメーターインスタンスを移行する</dfn>には、<var>instance</var>、<var>sourceWorkletGlobalScope</var>、<var>destinationWorkletGlobalScope</var>
                が与えられた場合、ユーザーエージェントは以下の手順を <em>必ず</em> 実行しなければならない：</p>
            <ol>
                <li data-md>
                    <p><var>serializedState</var>を未定義とする。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                            id="ref-for-queue-a-task">タスクをキュー</a>し、<var>sourceWorkletGlobalScope</var>で以下の手順を実行する：</p>
                    <ol>
                        <li data-md>
                            <p><var>animatorName</var>を<var>instance</var>の<a data-link-type="dfn" href="#animator-name"
                                    id="ref-for-animator-name④">アニメーター名</a>とする。</p>
                        <li data-md>
                            <p><var>definition</var>を<var>sourceWorkletGlobalScope</var>の<a data-link-type="dfn"
                                    href="#animator-name-to-animator-definition-map"
                                    id="ref-for-animator-name-to-animator-definition-map④">アニメーター名とアニメーター定義のマップ</a>から検索した結果とする。
                            </p>
                            <p><var>definition</var>が存在しなければ、以降の手順を中止する。</p>
                        <li data-md>
                            <p><var>stateful</var>を<var>definition</var>の<a data-link-type="dfn" href="#stateful-flag"
                                    id="ref-for-stateful-flag②">ステートフルフラグ</a>とする。</p>
                        <li data-md>
                            <p><var>stateful</var>が<b>false</b>なら、以降の手順を中止する。</p>
                        <li data-md>
                            <p><var>stateFunction</var>を取得する。</p>
                        <li data-md>
                            <p><var>state</var>を<a data-link-type="dfn"
                                    href="https://heycam.github.io/webidl/#invoke-a-callback-function"
                                    id="ref-for-invoke-a-callback-function①">stateFunctionを呼び出し</a>、コールバックthis値として<var>instance</var>を渡す結果とする。例外が発生した場合は再スローし、以降の手順を中止する。
                            </p>
                        <li data-md>
                            <p><var>serializedState</var>を<a data-link-type="dfn"
                                    href="http://w3c.github.io/html/infrastructure.html#structuredserialize"
                                    id="ref-for-structuredserialize">StructuredSerialize</a>(<var>state</var>)の結果とする。
                                例外が発生した場合、以降の手順を中止する。</p>
                        <li data-md>
                            <p><var>instance</var>と<var>sourceWorkletGlobalScope</var>を指定して<a data-link-type="dfn"
                                    href="#remove-an-animator-instance"
                                    id="ref-for-remove-an-animator-instance">アニメーターインスタンスの削除</a>手順を実行する。
                            </p>
                    </ol>
                <li data-md>
                    <p>上記タスクの完了を待つ。タスクが中止された場合、以降の手順を中止する。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                            id="ref-for-queue-a-task①">タスクをキュー</a>し、<var>destinationWorkletGlobalScope</var>で以下の手順を実行する：
                    </p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#create-a-new-animator-instance"
                                    id="ref-for-create-a-new-animator-instance">新しいアニメーターインスタンスの作成</a>手順を以下の引数で実行する：</p>
                            <ul>
                                <li data-md>
                                    <p><var>instance</var>の<a data-link-type="dfn" href="#animator-name"
                                            id="ref-for-animator-name⑤">アニメーター名</a>（name）</p>
                                <li data-md>
                                    <p><var>instance</var>の<a data-link-type="dfn" href="#animator-timeline"
                                            id="ref-for-animator-timeline①">アニメータータイムライン</a>（timeline）</p>
                                <li data-md>
                                    <p><var>instance</var>の<a data-link-type="dfn" href="#animator-effect"
                                            id="ref-for-animator-effect②">アニメーター効果</a>（effect）</p>
                                <li data-md>
                                    <p><var>instance</var>の<a data-link-type="dfn" href="#animator-serialized-options"
                                            id="ref-for-animator-serialized-options①">アニメーターシリアライズオプション</a>（options）</p>
                                <li data-md>
                                    <p><var>serializedState</var>（state）</p>
                                <li data-md>
                                    <p><var>destinationWorkletGlobalScope</var>（workletGlobalScope）</p>
                            </ul>
                    </ol>
            </ol>
        </div>
        <p>アニメーターのstate getterが例外を投げた場合、ユーザーエージェントはそのアニメーターを削除し再生成しません。
            これによりそのアニメーターインスタンスは実質的に削除されます。</p>
        <h3 class="heading settled" data-level="4.5" id="requesting-animation-frames"><span class="secno">4.5.
            </span><span class="content">アニメーションフレームのリクエスト</span><a class="self-link"
                href="#requesting-animation-frames"></a></h3>
        <p>各<a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance⑦">アニメーターインスタンス</a>は、関連する<dfn
                class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="animation-requested-flag">アニメーションリクエストフラグ</dfn>を持ちます。これは<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-noexport id="frame-requested">frame-requested</dfn>または<dfn class="dfn-paneled" data-dfn-type="dfn"
                data-noexport id="frame-current">frame-current</dfn>のいずれかです。初期値は<a data-link-type="dfn"
                href="#frame-current" id="ref-for-frame-current②">frame-current</a>です。様々な状況により<a data-link-type="dfn"
                href="#animation-requested-flag" id="ref-for-animation-requested-flag④">アニメーションリクエストフラグ</a>が<a
                data-link-type="dfn" href="#frame-requested"
                id="ref-for-frame-requested①">frame-requested</a>に設定されることがあります。例：</p>
        <ul>
            <li data-md>
                <p>アニメーターの<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time"
                        id="ref-for-current-time">current time</a>（現在時刻）が<a data-link-type="dfn"
                        href="https://w3c.github.io/web-animations/#timeline" id="ref-for-timeline①">タイムライン</a>上で変化したとき
                </p>
            <li data-md>
                <p>アニメーターの対応する<a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①">Worklet
                        Animation</a>の<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time"
                        id="ref-for-current-time①">current time</a>が変化したとき</p>
        </ul>
        <p><a href="#running-animators">§4.2 アニメーターの実行</a>では、アニメーターの<a data-link-type="dfn"
                href="#animation-requested-flag" id="ref-for-animation-requested-flag⑤">アニメーションリクエストフラグ</a>を<a
                data-link-type="dfn" href="#frame-current" id="ref-for-frame-current③">frame-current</a>にリセットします。
        </p>
        <h2 class="heading settled" data-level="5" id="web-animation-integration"><span class="secno">5. </span><span
                class="content">Web Animations統合</span><a class="self-link" href="#web-animation-integration"></a></h2>
        <h3 class="heading settled" data-level="5.1" id="worklet-animation-desc"><span class="secno">5.1. </span><span
                class="content">Worklet Animation</span><a class="self-link" href="#worklet-animation-desc"></a></h3>
        <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="worklet-animation">Worklet Animation</dfn>は、<a
            data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation"
            id="ref-for-concept-animation">アニメーション</a>の一種であり、アニメーション再生を<a data-link-type="dfn" href="#animator-instance"
            id="ref-for-animator-instance⑧">アニメーターインスタンス</a>に委譲します。対応する<a data-link-type="dfn" href="#animator-instance"
            id="ref-for-animator-instance⑨">アニメーターインスタンス</a>のライフタイムや再生状態を制御します。
        <p><a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation"
                id="ref-for-concept-animation①">アニメーション</a>であるため、<a data-link-type="dfn" href="#worklet-animation"
                id="ref-for-worklet-animation②">Worklet Animation</a>は<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#animation-effect"
                id="ref-for-animation-effect②">アニメーション効果</a>と<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#timeline"
                id="ref-for-timeline②">タイムライン</a>を持ちます。ただし他のアニメーションとは異なり、Worklet Animationの<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#current-time"
                id="ref-for-current-time②">現在時刻</a>はアニメーション効果の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-time">local time</a>（<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#inherited-time"
                id="ref-for-inherited-time">inherited time</a>経由）を直接決定しません。
            代わりに、関連する<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance①⓪">アニメーターインスタンス</a>がアニメーション効果の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-time①">local
                time</a>を直接制御します。つまり、<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#timeline"
                id="ref-for-timeline③">タイムライン</a>の現在時刻だけではアニメーションの出力は完全に決定されません。
        </p>
        <p><a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation③">Worklet
                Animation</a>は、<code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#animation" id="ref-for-animation①">Animation</a></code>インターフェイスに加えて、以下のプロパティを持ちます：
        </p>
        <ul>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="animation-animator-name">animation
                        animator name</dfn>（自身の<a data-link-type="dfn" href="#animator-definition"
                        id="ref-for-animator-definition③">アニメーター定義</a>を識別する）</p>
            <li data-md>
                <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="serialized-options">serialized
                        options</dfn>（新しいアニメーターインスタンスの構築時に使われるシリアライズ可能なオブジェクト）</p>
        </ul>
        <figure>
            <img alt="WorkletAnimationタイミングモデルの概要。"
                src="https://www.w3.org/TR/css-animation-worklet-1/img/WorkletAnimation-timing-model.svg" width="600">
            <figcaption>
                WorkletAnimationタイミングモデルの概要。<br>
                <p>アニメーションの現在時刻はアニメーターインスタンスへの入力となり、アニメーション効果のローカル時刻値を生成します。アニメーターインスタンスが並列グローバルスコープで実行されている場合、実装はローカル時刻値を用いて最終的な効果値を生成し、ビジュアルの更新を並列で行うこともできます。
                </p>
            </figcaption>
        </figure>
        <h3 class="heading settled" data-level="5.2" id="creating-worklet-animation"><span class="secno">5.2.
            </span><span class="content">Worklet Animationの作成</span><a class="self-link"
                href="#creating-worklet-animation"></a></h3>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed④"><c- g>Exposed</c-></a>=<c- n>Window</c->,
 <a class="idl-code" data-link-type="constructor" href="#dom-workletanimation-workletanimation" id="ref-for-dom-workletanimation-workletanimation"><c- g>Constructor</c-></a> (<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname"><code><c- g>animatorName</c-></code><a class="self-link" href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname"></a></dfn>,
              <c- b>optional</c-> (<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect"><c- n>AnimationEffect</c-></a> <c- b>or</c-> <c- b>sequence</c->&lt;<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect①"><c- n>AnimationEffect</c-></a>>)? <dfn class="idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects"><code><c- g>effects</c-></code><a class="self-link" href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects"></a></dfn> = <c- b>null</c->,
              <c- b>optional</c-> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationtimeline" id="ref-for-animationtimeline"><c- n>AnimationTimeline</c-></a>? <dfn class="idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline"><code><c- g>timeline</c-></code><a class="self-link" href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline"></a></dfn>,
              <c- b>optional</c-> <c- b>any</c-> <dfn class="idl-code" data-dfn-for="WorkletAnimation/WorkletAnimation(animatorName, effects, timeline, options)" data-dfn-type="argument" data-export id="dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options"></a></dfn>)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="workletanimation"><code><c- g>WorkletAnimation</c-></code></dfn> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animation" id="ref-for-animation②"><c- n>Animation</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="WorkletAnimation" data-dfn-type="attribute" data-export data-readonly data-type="DOMString" id="dom-workletanimation-animatorname"><code><c- g>animatorName</c-></code><a class="self-link" href="#dom-workletanimation-animatorname"></a></dfn>;
};

</pre>
        <div class="algorithm" data-algorithm="create-worklet-animation">
            <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletAnimation" data-dfn-type="constructor" data-export
                id="dom-workletanimation-workletanimation"><code>WorkletAnimation(<var>animatorName</var>, <var>effects</var>, <var>timeline</var>, <var>options</var>)</code></dfn>
            <p>以下の手順で新しい<code
                    class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation②">WorkletAnimation</a></code>オブジェクトを作成します。
            </p>
            <ol>
                <li data-md>
                    <p><var>workletAnimation</var>を新しい<code
                            class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation③">WorkletAnimation</a></code>オブジェクトとする。
                    </p>
                <li data-md>
                    <p><var>workletAnimation</var>に対して<a data-link-type="dfn"
                            href="https://w3c.github.io/web-animations/#set-the-timeline-of-an-animation"
                            id="ref-for-set-the-timeline-of-an-animation">アニメーションのタイムラインを設定する</a>手順を実行する。<var>timeline</var>引数が指定されていればそれを新しいタイムラインとして渡し、指定されていなければ関連する<code
                            class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code>の<a
                            data-link-type="dfn"
                            href="https://w3c.github.io/web-animations/#the-documents-default-timeline"
                            id="ref-for-the-documents-default-timeline">デフォルトドキュメントタイムライン</a>を渡す。<code
                            class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code>は<a
                            data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object"
                            id="ref-for-current-global-object">現在のグローバルオブジェクト</a>である。</p>
                <li data-md>
                    <p>以下の最初に一致する条件に従って<var>effect</var>を決定する。</p>
                    <dl>
                        <dt data-md>もし<var>effects</var>が<code
                                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect②">AnimationEffect</a></code>オブジェクトの場合、
                        <dd data-md>
                            <p><var>effect</var>は<var>effects</var>とする。</p>
                        <dt data-md>もし<var>effects</var>が<code
                                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect③">AnimationEffect</a></code>オブジェクトの<a
                                data-link-type="dfn" href="https://infra.spec.whatwg.org/#list"
                                id="ref-for-list">リスト</a>の場合、
                        <dd data-md>
                            <p><var>effect</var>は子を<var>effects</var>とする新しい<code
                                    class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect">WorkletGroupEffect</a></code>とする。
                            </p>
                        <dt data-md>それ以外の場合、
                        <dd data-md>
                            <p><var>effect</var>は未定義とする。</p>
                    </dl>
                <li data-md>
                    <p><var>workletAnimation</var>に対して<a data-link-type="dfn"
                            href="https://w3c.github.io/web-animations/#set-the-target-effect-of-an-animation"
                            id="ref-for-set-the-target-effect-of-an-animation">アニメーションのターゲット効果を設定する</a>手順を実行し、<var>effect</var>を新しい効果として渡す。
                    </p>
                <li data-md>
                    <p><var>serializedOptions</var>を<a data-link-type="dfn"
                            href="http://w3c.github.io/html/infrastructure.html#structuredserialize"
                            id="ref-for-structuredserialize①">StructuredSerialize</a>(<var>options</var>)の結果とする。例外が発生した場合は再スローする。
                    </p>
                <li data-md>
                    <p><var>workletAnimation</var>の<a data-link-type="dfn" href="#serialized-options"
                            id="ref-for-serialized-options">シリアライズオプション</a>に<var>serializedOptions</var>を設定する。</p>
                <li data-md>
                    <p><var>workletAnimation</var>の<a data-link-type="dfn" href="#animation-animator-name"
                            id="ref-for-animation-animator-name">animation animator
                            name</a>に<var>animatorName</var>を設定する。</p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="5.3" id="timing-model"><span class="secno">5.3. </span><span
                class="content">Worklet Animationのタイミングモデル</span><a class="self-link" href="#timing-model"></a></h3>
        <p>このセクションでは、<a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation④">worklet
                animation</a>のタイミングモデルが他の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#concept-animation"
                id="ref-for-concept-animation②">アニメーション</a>とどのように異なるかを説明します。</p>
        <p>既存の<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#concept-animation"
                id="ref-for-concept-animation③">アニメーション</a>が<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#ready" id="ref-for-ready">ready</a>とみなされる条件に加え、<a
                data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑤">worklet
                animation</a>は以下の条件が満たされた場合にのみ<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#ready"
                id="ref-for-ready①">ready</a>とみなされます：</p>
        <ul>
            <li data-md>
                <p>ユーザーエージェントが<a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑥">worklet
                        animation</a>に対応する<a data-link-type="dfn" href="#animator-instance"
                        id="ref-for-animator-instance①①">animator instance</a>の作成に必要なセットアップを完了していること。</p>
        </ul>
        <p><a href="#worklet-animation-desc">§5.1 Worklet Animation</a>で説明されている通り、<a data-link-type="dfn"
                href="#worklet-animation" id="ref-for-worklet-animation⑦">worklet animation</a>の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#current-time" id="ref-for-current-time③">current
                time</a>は、その<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect"
                id="ref-for-animation-effect③">animation effect</a>の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-time②">local
                time</a>を決定しません。代わりに、関連付けられた<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance①②">animator instance</a>が<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#local-time" id="ref-for-local-time③">local
                time</a>を直接制御します。つまり、アニメーション効果のlocal timeは<code
                class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope④">WorkletGlobalScope</a></code>（並列実行コンテキストである可能性があります）から制御されます。
        </p>
        <p>上記の意味論から導かれる影響は以下の通りです：</p>
        <ul>
            <li data-md>
                <p><a data-link-type="dfn" href="https://w3c.github.io/web-animations/#current-time"
                        id="ref-for-current-time④">current time</a>や<a data-link-type="dfn"
                        href="https://www.w3.org/TR/css3-transitions/#transition-start-time"
                        id="ref-for-transition-start-time">start time</a>を<a data-link-type="dfn"
                        href="#worklet-animation" id="ref-for-worklet-animation⑧">worklet
                        animation</a>に設定しても必ずしも出力が変化するわけではなく、アニメーションの<a data-link-type="dfn"
                        href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-state">play
                        state</a>が変化する場合があります。</p>
            <li data-md>
                <p>同様に、<code
                        class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#dom-animation-finish" id="ref-for-dom-animation-finish">finish()</a></code>の呼び出しや<a
                        data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation⑨">worklet
                        animation</a>の<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#playback-rate"
                        id="ref-for-playback-rate">playback rate</a>の更新は、アニメーションの<a data-link-type="dfn"
                        href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-state①">play
                        state</a>のみを変更し、出力が変化しない場合があります。</p>
            <li data-md>
                <p><code
                        class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/web-animations-1/#dom-animationeffect-getcomputedtiming" id="ref-for-dom-animationeffect-getcomputedtiming">getComputedTiming()</a></code>でアニメーション効果のlocal
                    timeを取得すると、<a data-link-type="dfn" href="#animator-instance"
                        id="ref-for-animator-instance①③">animator instance</a>が並列実行コンテキストで動作している場合、古い情報が返されることがあります。</p>
        </ul>
        <p>Worklet
            Animationが並列worklet実行コンテキストで実行されている場合、そのアニメーション効果の最新状態は定期的にメインJavaScript実行コンテキストに同期されるべきです。並列worklet実行コンテキストからメインJavaScript実行コンテキストへの<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#effect-value"
                id="ref-for-effect-value">effect values</a>の同期は、ドキュメントライフサイクルの一部として<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/#run-the-animation-frame-callbacks"
                id="ref-for-run-the-animation-frame-callbacks">アニメーションフレームコールバック</a>が実行される前に<em>必ず</em>行われなければなりません。このアニメーションモデルの非同期性により、メインJavaScript実行コンテキストでWorklet
            Animationでアニメーションされている<a data-link-type="dfn" href="https://w3c.github.io/web-animations/#target-property"
                id="ref-for-target-property">target
                property</a>をスクリプトから読み取る場合、ユーザーに表示されているビジュアルフレームで使われている値と比べて古い値が表示される場合があります。これはメインJavaScript実行コンテキストでスクロールオフセットを読むときの非同期スクロールの効果に類似しています。
        </p>
        <p class="issue" id="issue-61e3a71a"><a class="self-link" href="#issue-61e3a71a"></a> <a data-link-type="dfn"
                href="#animator-instance" id="ref-for-animator-instance①④">animator instance</a>がanimation
            currentTimeの変更（例えばreverse()、finish()、playbackRateの変更）を通知される適切な仕組みを考案すべきです。これにより適切に反応できるようになります。<a
                href="https://github.com/w3c/css-houdini-drafts/issues/811">&lt;https://github.com/w3c/css-houdini-drafts/issues/811></a>
        </p>
        <h3 class="heading settled" data-level="5.4" id="worklet-animation-animator-instances"><span class="secno">5.4.
            </span><span class="content">アニメーターインスタンスとの連携</span><a class="self-link"
                href="#worklet-animation-animator-instances"></a></h3>
        <p><a data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①⓪">worklet
                animation</a>は任意の時点で最大1つの<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance①⑤">animator instance</a>に対応し、対応する<a data-link-type="dfn"
                href="#animator-instance" id="ref-for-animator-instance①⑥">animator instance</a>が存在しない場合もあります。<a
                data-link-type="dfn" href="#worklet-animation" id="ref-for-worklet-animation①①">worklet
                animation</a>に対する<a data-link-type="dfn" href="#animator-instance"
                id="ref-for-animator-instance①⑦">animator instance</a>の対応関係は、アニメーションの<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-state②">play state</a>に依存します。
        </p>
        <div class="algorithm" data-algorithm="associate-animator-instance">
            <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="associate-animator-instance-of-worklet-animation">worklet animationのanimator
                    instanceを関連付ける</dfn>には<var>workletAnimation</var>が与えられたとき、ユーザーエージェントは以下の手順を<em>必ず</em>実行します：</p>
            <ol>
                <li data-md>
                    <p><var>workletAnimation</var>に対応する<a data-link-type="dfn" href="#animator-instance"
                            id="ref-for-animator-instance①⑧">animator instance</a>が存在する場合、以降の手順を中止する。</p>
                <li data-md>
                    <p><var>workletGlobalScope</var>を<var>workletAnimation</var>に関連付けられた<code
                            class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①⓪">AnimationWorkletGlobalScope</a></code>とする。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                            id="ref-for-queue-a-task②">taskを<var>workletGlobalScope</var>でキューイング</a>し、以下の値を渡して<a
                            data-link-type="dfn" href="#create-a-new-animator-instance"
                            id="ref-for-create-a-new-animator-instance①">新しいanimator instanceを作成する</a>手順を実行する：</p>
                    <ul>
                        <li data-md>
                            <p><var>workletAnimation</var>の<a data-link-type="dfn" href="#animation-animator-name"
                                    id="ref-for-animation-animator-name①">animation animator name</a>（nameとして）</p>
                        <li data-md>
                            <p><var>workletAnimation</var>の<a data-link-type="dfn"
                                    href="https://w3c.github.io/web-animations/#timeline"
                                    id="ref-for-timeline④">timeline</a>（timelineとして）</p>
                        <li data-md>
                            <p><var>workletAnimation</var>の<a data-link-type="dfn"
                                    href="https://w3c.github.io/web-animations/#animation-effect"
                                    id="ref-for-animation-effect④">animation effect</a>（effectとして）</p>
                        <li data-md>
                            <p><var>workletAnimation</var>の<a data-link-type="dfn" href="#serialized-options"
                                    id="ref-for-serialized-options①">serialized options</a>（optionsとして）</p>
                        <li data-md>
                            <p><var>workletGlobalScope</var>（workletGlobalScopeとして）</p>
                    </ul>
                <li data-md>
                    <p>手順が成功した場合、結果の<a data-link-type="dfn" href="#animator-instance"
                            id="ref-for-animator-instance①⑨">animator instance</a>を<var>workletAnimation</var>に対応させる。
                    </p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="disassociate-animator-instance">
            <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="disassociate-animator-instance-of-worklet-animation">worklet animationのanimator
                    instanceの関連付け解除</dfn>には<var>workletAnimation</var>が与えられたとき、ユーザーエージェントは以下の手順を<em>必ず</em>実行します：</p>
            <ol>
                <li data-md>
                    <p><var>workletAnimation</var>に対応する<a data-link-type="dfn" href="#animator-instance"
                            id="ref-for-animator-instance②⓪">animator instance</a>が存在しない場合、以降の手順を中止する。</p>
                <li data-md>
                    <p><var>workletGlobalScope</var>を<var>workletAnimation</var>に関連付けられた<code
                            class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope①①">AnimationWorkletGlobalScope</a></code>とする。
                    </p>
                <li data-md>
                    <p><var>animatorInstance</var>を<var>workletAnimation</var>の対応する<a data-link-type="dfn"
                            href="#animator-instance" id="ref-for-animator-instance②①">animator instance</a>とする。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"
                            id="ref-for-queue-a-task③">taskを<var>workletGlobalScope</var>でキューイング</a>し、<var>animatorInstance</var>（instanceとして）、<var>workletGlobalScope</var>（workletGlobalScopeとして）を渡して<a
                            data-link-type="dfn" href="#remove-an-animator-instance"
                            id="ref-for-remove-an-animator-instance①">animator instanceを削除する</a>手順を実行する。</p>
                <li data-md>
                    <p><var>workletAnimation</var>は対応する<a data-link-type="dfn" href="#animator-instance"
                            id="ref-for-animator-instance②②">animator instance</a>を持たない状態にする。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="set-animator-instance">
            <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="set-animator-instance-of-worklet-animation">worklet animationのanimator
                    instanceをセットする</dfn>には<var>workletAnimation</var>が与えられたとき、ユーザーエージェントは以下の手順を<em>必ず</em>実行します：</p>
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="#disassociate-animator-instance-of-worklet-animation"
                            id="ref-for-disassociate-animator-instance-of-worklet-animation">worklet animationのanimator
                            instanceの関連付け解除</a>の手順を<var>workletAnimation</var>に対して実行する。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="#associate-animator-instance-of-worklet-animation"
                            id="ref-for-associate-animator-instance-of-worklet-animation">worklet animationのanimator
                            instanceを関連付ける</a>手順を<var>workletAnimation</var>に対して実行する。</p>
            </ol>
        </div>
        <p>与えられた<var>workletAnimation</var>の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-state③">play state</a>が<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#pending"
                id="ref-for-pending">pending</a>、<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#running" id="ref-for-running">running</a>、または<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#paused"
                id="ref-for-paused">paused</a>に変化した場合、<a data-link-type="dfn"
                href="#associate-animator-instance-of-worklet-animation"
                id="ref-for-associate-animator-instance-of-worklet-animation①">worklet animationのanimator
                instanceを関連付ける</a>手順を<var>workletAnimation</var>に対して実行する。</p>
        <p>与えられた<var>workletAnimation</var>の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#play-state" id="ref-for-play-state④">play state</a>が<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#idle" id="ref-for-idle">idle</a>または<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#finished"
                id="ref-for-finished">finished</a>に変化した場合、<a data-link-type="dfn"
                href="#disassociate-animator-instance-of-worklet-animation"
                id="ref-for-disassociate-animator-instance-of-worklet-animation①">worklet animationのanimator
                instanceの関連付け解除</a>手順を<var>workletAnimation</var>に対して実行する。</p>
        <p>与えられた<var>workletAnimation</var>に対して<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#set-the-target-effect-of-an-animation"
                id="ref-for-set-the-target-effect-of-an-animation①">set the target effect of an
                animation</a>手順が呼ばれた場合、<a data-link-type="dfn" href="#set-animator-instance-of-worklet-animation"
                id="ref-for-set-animator-instance-of-worklet-animation">worklet animationのanimator
                instanceをセットする</a>手順を<var>workletAnimation</var>に対して実行する。</p>
        <p>与えられた<var>workletAnimation</var>に対して<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#set-the-timeline-of-an-animation"
                id="ref-for-set-the-timeline-of-an-animation①">set the timeline of an animation</a>手順が呼ばれた場合、<a
                data-link-type="dfn" href="#set-animator-instance-of-worklet-animation"
                id="ref-for-set-animator-instance-of-worklet-animation①">worklet animationのanimator
                instanceをセットする</a>手順を<var>workletAnimation</var>に対して実行する。</p>
        <h3 class="heading settled" data-level="5.5" id="scroll-timeline"><span class="secno">5.5. </span><span
                class="content">ScrollTimeline</span><a class="self-link" href="#scroll-timeline"></a></h3>
        <em>このセクションは規範的ではありません。</em>
        <p><code
                class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#scrolltimeline" id="ref-for-scrolltimeline">ScrollTimeline</a></code>
            はウェブアニメーションAPIに追加提案されている新しい概念です。スクロールコンテナのスクロール位置に応じて時間値が変化するアニメーションタイムラインを定義します。<a data-link-type="dfn"
                href="#worklet-animation"
                id="ref-for-worklet-animation①②">Workletアニメーション</a>はスクロールタイムラインを持つことができ、スクロールオフセットに基づいてスクリプト効果を駆動できます。
        </p>
        <p class="note" role="note"><span>注:</span> <strong>入力へのアクセス</strong>:
            スクロール以外にも（タッチやポインター入力など）、追加のユーザー入力をこれらのアニメーションに公開することに関心があります。これにより、著者は現在は困難な入力駆動型のジャンクのないアニメーションを作成できるようになります。適切な抽象化やメカニズムを検討中です。
        </p>
        <h3 class="heading settled" data-level="5.6" id="worklet-group-effect"><span class="secno">5.6. </span><span
                class="content">WorkletGroupEffect</span><a class="self-link" href="#worklet-group-effect"></a></h3>
        <p><code
                class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect①">WorkletGroupEffect</a></code>
            は<a data-link-type="dfn" href="https://w3c.github.io/web-animations/level-2/#group-effect"
                id="ref-for-group-effect">グループエフェクト</a>の一種であり、<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/level-2/#child-effect"
                id="ref-for-child-effect">子エフェクト</a>の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#local-time"
                id="ref-for-local-time④">localTime</a>を個別に操作できます。</p>
        <p><code
                class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect②">WorkletGroupEffect</a></code>
            が<code
                class="idl"><a data-link-type="idl" href="#workletanimation" id="ref-for-workletanimation④">WorkletAnimation</a></code>の<a
                data-link-type="dfn" href="https://w3c.github.io/web-animations/#animation-effect"
                id="ref-for-animation-effect⑤">animation effect</a>に設定されている場合、対応する<a data-link-type="dfn"
                href="#animator-instance" id="ref-for-animator-instance②③">animator instance</a>は<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/level-2/#child-effect"
                id="ref-for-child-effect①">子エフェクト</a>の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#local-time"
                id="ref-for-local-time⑤">localTime</a>を直接制御できます。これにより、1つのworkletアニメーションで複数のエフェクトを連携させることができます。使用例は<a
                href="#example-2">§8.2 例2: パララックス背景</a>を参照してください。</p>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑤"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="workletgroupeffect"><code><c- g>WorkletGroupEffect</c-></code></dfn> {
  <c- b>sequence</c->&lt;<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect④"><c- n>AnimationEffect</c-></a>> <dfn class="idl-code" data-dfn-for="WorkletGroupEffect" data-dfn-type="method" data-export data-lt="getChildren()" id="dom-workletgroupeffect-getchildren"><code><c- g>getChildren</c-></code><a class="self-link" href="#dom-workletgroupeffect-getchildren"></a></dfn>();
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑥"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect⑤"><c- g>AnimationEffect</c-></a> {
    // Intended for use inside Animation Worklet scope to drive the effect.
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AnimationEffect" data-dfn-type="attribute" data-export data-type="double" id="dom-animationeffect-localtime"><code><c- g>localTime</c-></code></dfn>;
};
</pre>
        <div class="algorithm" data-algorithm="set-local-time">
            <p><var>effect</var>の<code
                    class="idl"><a data-link-type="idl" href="#dom-animationeffect-localtime" id="ref-for-dom-animationeffect-localtime">localTime</a></code>
                プロパティに値<var>t</var>を設定するには、ユーザーエージェントは次の最初に一致する条件のアクションを実行します：</p>
            <dl>
                <dt data-md>親グループを持たない場合
                <dd data-md>
                    <p><var>effect</var>のlocalTimeを<var>t</var>に設定する。</p>
                <dt data-md>親グループがあり、その型が<code
                        class="idl"><a data-link-type="idl" href="#workletgroupeffect" id="ref-for-workletgroupeffect③">WorkletGroupEffect</a></code>の場合
                <dd data-md>
                    <p>effectのstartTimeを（親の変換後の時間 - t）に設定する。これは実質的に<var>effect</var>のlocalTimeをtに設定することになります。</p>
                <dt data-md>それ以外の場合
                <dd data-md>
                    <p>子エフェクトの時間は親グループによってのみ制御可能であることを示す例外を投げる。</p>
            </dl>
        </div>
        <p class="issue" id="issue-9ff2b6cb"><a class="self-link" href="#issue-9ff2b6cb"></a>
            上記インターフェースはweb-animation-2で提案されているGroupEffectの保守的なサブセットのみを公開しています。代わりにweb-animationへの差分仕様に移行すべきです。<a
                href="https://github.com/w3c/csswg-drafts/issues/2071">&lt;https://github.com/w3c/csswg-drafts/issues/2071></a>
        </p>
        <h3 class="heading settled" data-level="5.7" id="effect-stack-composite-order"><span class="secno">5.7.
            </span><span class="content">エフェクトスタックと合成順序</span><a class="self-link"
                href="#effect-stack-composite-order"></a></h3>
        <p>他のアニメーションと同様に、<a data-link-type="dfn" href="#worklet-animation"
                id="ref-for-worklet-animation①③">workletアニメーション</a>は<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#effect-stack"
                id="ref-for-effect-stack">エフェクトスタック</a>に参加します。workletアニメーションは特定の<a data-link-type="dfn"
                href="https://w3c.github.io/web-animations/#animation-class" id="ref-for-animation-class">animation
                class</a>を持たないため、他のJavaScriptで作成されたWebアニメーションと同じ合成順序となります。</p>
        <h2 class="heading settled" data-level="6" id="security-considerations"><span class="secno">6. </span><span
                class="content">セキュリティの考慮事項</span><a class="self-link" href="#security-considerations"></a>
        </h2>
        <p>これらの機能による既知のセキュリティ問題はありません。</p>
        <h2 class="heading settled" data-level="7" id="privacy-considerations"><span class="secno">7. </span><span
                class="content">プライバシーの考慮事項</span><a class="self-link" href="#privacy-considerations"></a>
        </h2>
        <p>これらの機能による既知のプライバシー問題はありません。</p>
        <h2 class="heading settled" data-level="8" id="examples"><span class="secno">8. </span><span
                class="content">例</span><a class="self-link" href="#examples"></a></h2>
        <h3 class="heading settled" data-level="8.1" id="example-1"><span class="secno">8.1. </span><span
                class="content">例1: Twitterヘッダー</span><a class="self-link" href="#example-1"></a></h3>
        Twitterプロフィールヘッダー効果の例。2つの要素（アバターとヘッダー）がスクロールオフセットと同期して更新されます。
        <pre class="lang-markup highlight">// 文書スコープ内。
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'scrollingContainer'</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'header'</c-> <c- e>style</c-><c- o>=</c-><c- s>'height: 150px'</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'avatar'</c-><c- p>>&lt;</c-><c- f>img</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
await CSS<c- p>.</c->animationWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'twitter-header-animator.js'</c-><c- p>);</c->
<c- kr>const</c-> animation <c- o>=</c-> <c- k>new</c-> WorkletAnimation<c- p>(</c->
    <c- t>'twitter-header'</c-><c- p>,</c->
    <c- p>[</c-><c- k>new</c-> KeyframeEffect<c- p>(</c->$avatar<c- p>,</c->  <c- d>/* スクロールアップで縮小 */</c->
                    <c- p>[{</c->transform<c- o>:</c-> <c- t>'scale(1)'</c-><c- p>},</c-> <c- p>{</c->transform<c- o>:</c-> <c- t>'scale(0.5)'</c-><c- p>}],</c->
                    <c- p>{</c->duration<c- o>:</c-> <c- mi>1000</c-><c- p>,</c-> iterations<c- o>:</c-> <c- mi>1</c-><c- p>}),</c->
    <c- k>new</c-> KeyframeEffect<c- p>(</c->$header<c- p>,</c-> <c- d>/* スクロールアップで透明度が増加 */</c->
                    <c- p>[{</c->opacity<c- o>:</c-> <c- mi>0</c-><c- p>},</c-> <c- p>{</c->opacity<c- o>:</c-> <c- mf>0.8</c-><c- p>}],</c->
                    <c- p>{</c->duration<c- o>:</c-> <c- mi>1000</c-><c- p>,</c-> iterations<c- o>:</c-> <c- mi>1</c-><c- p>})],</c->
    <c- k>new</c-> ScrollTimeline<c- p>({</c->
      scrollSource<c- o>:</c-> $scrollingContainer<c- p>,</c->
      orientation<c- o>:</c-> <c- t>'block'</c-><c- p>,</c->
      timeRange<c- o>:</c-> <c- mi>1000</c-><c- p>,</c->
      startScrollOffset<c- o>:</c-> <c- mi>0</c-><c- p>,</c->
      endScrollOffset<c- o>:</c-> $header<c- p>.</c->clientHeight<c- p>}));</c->
animation<c- p>.</c->play<c- p>();</c->

<c- c1>// このアニメーションはグループエフェクトを使用しているため、同じアニメーションインスタンスは異なるハンドルからアクセスできます: $avatarEl.getAnimations()[0], $headerEl.getAnimations()[0]</c->

<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
        <pre class="lang-javascript highlight"><c- c1>// AnimationWorkletGlobalScope内。</c->
registerAnimator<c- p>(</c-><c- t>'twitter-header'</c-><c- p>,</c-> <c- kr>class</c-> HeaderAnimator <c- kr>extends</c-> StatelessAnimator <c- p>{</c->
  constructor<c- p>(</c->options<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->timing_ <c- o>=</c-> <c- k>new</c-> CubicBezier<c- p>(</c-><c- t>'ease-out'</c-><c- p>);</c->
  <c- p>}</c->

  animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
    <c- kr>const</c-> scroll <c- o>=</c-> currentTime<c- p>;</c->  <c- c1>// scrollは[0, 1000]範囲</c->

    <c- c1>// 子供のlocalTimeを個別に設定してグループエフェクトの出力を駆動</c->
    effect<c- p>.</c->children<c- p>[</c-><c- mi>0</c-><c- p>].</c->localTime <c- o>=</c-> scroll<c- p>;</c->
    effect<c- p>.</c->children<c- p>[</c-><c- mi>1</c-><c- p>].</c->localTime <c- o>=</c-> <c- k>this</c-><c- p>.</c->timing_<c- p>(</c->clamp<c- p>(</c->scroll<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>500</c-><c- p>));</c->
  <c- p>}</c->
<c- p>});</c->

<c- a>function</c-> clamp<c- p>(</c->value<c- p>,</c-> min<c- p>,</c-> max<c- p>)</c-> <c- p>{</c->
  <c- k>return</c-> Math<c- p>.</c->min<c- p>(</c->Math<c- p>.</c->max<c- p>(</c->value<c- p>,</c-> min<c- p>),</c-> max<c- p>);</c->
<c- p>}</c->
</pre>
        <h3 class="heading settled" data-level="8.2" id="example-2"><span class="secno">8.2. </span><span
                class="content">例2：パララックス背景</span><a class="self-link" href="#example-2"></a></h3>
        シンプルなパララックス背景の例です。
        <pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- p>.</c-><c- nc>parallax</c-> <c- p>{</c->
    <c- k>position</c-><c- p>:</c-> <c- kc>fixed</c-><c- p>;</c->
    <c- k>top</c-><c- p>:</c-> <c- mi>0</c-><c- p>;</c->
    <c- k>left</c-><c- p>:</c-> <c- mi>0</c-><c- p>;</c->
    <c- k>opacity</c-><c- p>:</c-> <c- mf>0.5</c-><c- p>;</c->
<c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>'scrollingContainer'</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"slow"</c-> <c- e>class</c-><c- o>=</c-><c- s>"parallax"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"fast"</c-> <c- e>class</c-><c- o>=</c-><c- s>"parallax"</c-><c- p>>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
await CSS<c- p>.</c->animationWorklet<c- p>.</c->addModule<c- p>(</c-><c- t>'parallax-animator.js'</c-><c- p>);</c->
<c- kr>const</c-> scrollTimeline <c- o>=</c-> <c- k>new</c-> ScrollTimeline<c- p>({</c->
  scrollSource<c- o>:</c-> $scrollingContainer<c- p>,</c->
  orientation<c- o>:</c-> <c- t>'block'</c-><c- p>,</c->
  timeRange<c- o>:</c-> <c- mi>1000</c->
<c- p>});</c->
<c- kr>const</c-> scrollRange <c- o>=</c-> $scrollingContainer<c- p>.</c->scrollHeight <c- o>-</c-> $scrollingContainer<c- p>.</c->clientHeight<c- p>;</c->

<c- kr>const</c-> slowParallax <c- o>=</c-> <c- k>new</c-> WorkletAnimation<c- p>(</c->
    <c- t>'parallax'</c-><c- p>,</c->
    <c- k>new</c-> KeyframeEffect<c- p>(</c->$parallax_slow<c- p>,</c-> <c- p>[{</c-><c- t>'transform'</c-><c- o>:</c-> <c- t>'translateY(0)'</c-><c- p>},</c-> <c- p>{</c-><c- t>'transform'</c-><c- o>:</c-> <c- t>'translateY('</c-> <c- o>+</c-> <c- o>-</c->scrollRange <c- o>+</c-> <c- t>'px)'</c-><c- p>}],</c-> <c- p>{</c->duration<c- o>:</c-> <c- mi>1000</c-><c- p>}),</c->
    scrollTimeline<c- p>,</c->
    <c- p>{</c->rate <c- o>:</c-> <c- mf>0.4</c-><c- p>}</c->
<c- p>);</c->
slowParallax<c- p>.</c->play<c- p>();</c->

<c- kr>const</c-> fastParallax <c- o>=</c-> <c- k>new</c-> WorkletAnimation<c- p>(</c->
    <c- t>'parallax'</c-><c- p>,</c->
    <c- k>new</c-> KeyframeEffect<c- p>(</c->$parallax_fast<c- p>,</c-> <c- p>[{</c-><c- t>'transform'</c-><c- o>:</c-> <c- t>'translateY(0)'</c-><c- p>},</c-> <c- p>{</c-><c- t>'transform'</c-><c- o>:</c-> <c- t>'translateY('</c-> <c- o>+</c-> <c- o>-</c->scrollRange <c- o>+</c-> <c- t>'px)'</c-><c- p>}],</c-> <c- p>{</c->duration<c- o>:</c-> <c- mi>1000</c-><c- p>}),</c->
    scrollTimeline<c- p>,</c->
    <c- p>{</c->rate <c- o>:</c-> <c- mf>0.8</c-><c- p>}</c->
<c- p>);</c->
fastParallax<c- p>.</c->play<c- p>();</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
        <pre class="lang-javascript highlight"><c- c1>// AnimationWorkletGlobalScope内。</c->
registerAnimator<c- p>(</c-><c- t>'parallax'</c-><c- p>,</c-> <c- kr>class</c-> ParallaxAnimator <c- kr>extends</c-> StatelessAnimator <c- p>{</c->
  constructor<c- p>(</c->options<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->rate_ <c- o>=</c-> options<c- p>.</c->rate<c- p>;</c->
  <c- p>}</c->

  animate<c- p>(</c->currentTime<c- p>,</c-> effect<c- p>)</c-> <c- p>{</c->
    effect<c- p>.</c->localTime <c- o>=</c-> currentTime <c- o>*</c-> <c- k>this</c-><c- p>.</c->rate_<c- p>;</c->
  <c- p>}</c->
<c- p>});</c->
</pre>
    </main>
    <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">適合性</span><a class="self-link"
            href="#conformance"></a></h2>
    <h3 class="no-ref heading settled" id="conventions"><span class="content">文書の規則</span><a class="self-link"
            href="#conventions"></a></h3>
    <p>適合性要件は、記述的な断言とRFC 2119の用語を組み合わせて表現されます。規範部分で使われる “MUST”、“MUST NOT”、“REQUIRED”、“SHALL”、“SHALL
        NOT”、“SHOULD”、“SHOULD NOT”、“RECOMMENDED”、“MAY”、“OPTIONAL” というキーワードは、RFC
        2119で定義されている通りに解釈されます。ただし、可読性のため、この仕様書ではこれらの単語はすべて大文字では書かれていません。</p>
    <p>この仕様の本文は、明示的に非規範的と示されたセクション、例、注記を除き、すべて規範的です。<a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
    <p>この仕様書の例は「例えば」で始まるか、<code>class="example"</code>のように、規範テキストとは区別して示されます。</p>
    <div class="example" id="example-ae2b6bc0">
        <a class="self-link" href="#example-ae2b6bc0"></a>
        <p>これは情報提供のための例です。</p>
    </div>
    <p>情報提供的な注記は “Note” で始まり、<code>class="note"</code> のように規範テキストから区別されます：</p>
    <p class="note" role="note">注：これは情報提供的な注記です。</p>
    <p>勧告は特別な注意を喚起するために規範的セクションとして表示され、<code>&lt;strong class="advisement"></code> のように他の規範テキストと区別されます：<strong
            class="advisement"> UAは必ずアクセシブルな代替手段を提供しなければなりません。 </strong></p>
    <h3 class="no-ref heading settled" id="conformance-classes"><span class="content">適合クラス</span><a class="self-link"
            href="#conformance-classes"></a></h3>
    <p>この仕様への適合は、3つの適合クラスについて定義されます：</p>
    <dl>
        <dt>スタイルシート
        <dd><a href="https://www.w3.org/TR/CSS21/conform.html#style-sheet">CSSスタイルシート</a>。
        <dt>レンダラー
        <dd><a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>であり、スタイルシートの意味を解釈し、それらを利用する文書をレンダリングします。
        <dt>オーサリングツール
        <dd><a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>であり、スタイルシートを作成します。
    </dl>
    <p>スタイルシートが、この仕様書で定義される構文を使うすべての記述が、汎用CSS文法およびこのモジュールで定義される各機能の個別文法に従い有効であれば、そのスタイルシートは本仕様に適合しています。</p>
    <p>レンダラーが本仕様に適合するには、適切な仕様で定義される通りにスタイルシートを解釈することに加え、本仕様で定義されたすべての機能を正しくパースし、文書を正しくレンダリングする必要があります。ただし、デバイスの制約によりUAが文書を正しくレンダリングできない場合でも、UAは非適合とはなりません（例：UAはモノクロモニターで色をレンダリングする必要はありません）。
    </p>
    <p>オーサリングツールが本仕様に適合するには、汎用CSS文法およびこのモジュールで定義される各機能の個別文法に従い、構文的に正しいスタイルシートを書き、本モジュールで記述されるスタイルシートのその他の適合要件をすべて満たす必要があります。
    </p>
    <h3 class="no-ref heading settled" id="partial"><span class="content">部分的な実装</span><a class="self-link"
            href="#partial"></a></h3>
    <p>著者が将来互換性のあるパース規則を利用してフォールバック値を指定できるように、CSSレンダラーは<strong>必ず</strong>、利用可能なレベルのサポートがない@ルール、プロパティ、プロパティ値、キーワード、その他の構文要素を無効として扱い、<a
            href="https://www.w3.org/TR/CSS21/conform.html#ignore">適切に無視</a>しなければなりません。特に、ユーザーエージェントは、単一の複数値プロパティ宣言でサポートされていないコンポーネント値だけを選択的に無視し、サポートされている値だけを適用しては<strong>なりません</strong>。いずれかの値が無効（未サポート値は必ず無効）と見なされた場合、CSSは宣言全体が無視されることを要求します。
    </p>
    <h4 class="heading settled" id="conform-future-proofing"><span class="content">不安定および独自機能の実装</span><a
            class="self-link" href="#conform-future-proofing"></a></h4>
    <p>将来の安定したCSS機能との衝突を避けるため、CSSWGは<a href="https://www.w3.org/TR/CSS/#future-proofing">ベストプラクティス</a>に従って<a
            href="https://www.w3.org/TR/CSS/#unstable">不安定</a>な機能や<a
            href="https://www.w3.org/TR/CSS/#proprietary-extension">独自拡張</a>の実装を行うことを推奨します。</p>
    <h3 class="no-ref heading settled" id="testing"><span class="content">非実験的な実装</span><a class="self-link"
            href="#testing"></a></h3>
    <p>仕様書がCandidate Recommendation段階に到達すると、非実験的な実装が可能となり、実装者は仕様に従って正しく実装できるCRレベルの機能について、プレフィックスなしの実装をリリースするべきです。</p>
    <p>CSSの実装間の相互運用性を確立・維持するため、CSSワーキンググループは非実験的なCSSレンダラーに対し、CSS機能のプレフィックスなし実装をリリースする前に、実装報告書（必要に応じてその実装報告書で使われたテストケースも）をW3Cに提出することを要請します。W3Cに提出されたテストケースはCSSワーキンググループによるレビュー・修正の対象となります。
    </p>
    <p>
        テストケースや実装報告書の提出方法など詳細は、CSSワーキンググループのウェブサイト<a
            href="https://www.w3.org/Style/CSS/Test/">https://www.w3.org/Style/CSS/Test/</a>をご覧ください。ご質問は<a
            href="https://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>メーリングリストへお寄せください。
        <script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
    </p>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">この仕様で定義されている用語</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#animate-function">animate function</a><span>, §3.3</span>
        <li><a href="#animation-animator-name">animation animator name</a><span>, §5.1</span>
        <li><a href="#animation-requested-flag">animation requested flag</a><span>, §4.5</span>
        <li><a href="#animation-worklet">Animation Worklet</a><span>, §2</span>
        <li><a href="#dom-css-animationworklet">animationWorklet</a><span>, §2</span>
        <li><a href="#animationworkletglobalscope">AnimationWorkletGlobalScope</a><span>, §3.4</span>
        <li><a href="#animator">Animator</a><span>, §3</span>
        <li><a href="#animator-current-time">animator current time</a><span>, §4</span>
        <li><a href="#animator-definition">animator definition</a><span>, §3.3</span>
        <li><a href="#animator-effect">animator effect</a><span>, §4</span>
        <li><a href="#animator-instance">animator instance</a><span>, §4</span>
        <li><a href="#callbackdef-animatorinstanceconstructor">AnimatorInstanceConstructor</a><span>, §3.4</span>
        <li><a href="#animator-instance-set">animator instance set</a><span>, §4.1</span>
        <li><a href="#animator-name">animator name</a><span>, §3.3</span>
        <li><a href="#dom-workletanimation-animatorname">animatorName</a><span>, §5.2</span>
        <li><a href="#animator-name-to-animator-definition-map">animator name to animator definition map</a><span>,
                §3.4</span>
        <li><a href="#animator-serialized-options">animator serialized options</a><span>, §4</span>
        <li><a href="#animator-timeline">animator timeline</a><span>, §4</span>
        <li><a href="#associate-animator-instance-of-worklet-animation">associate animator instance of worklet
                animation</a><span>, §5.4</span>
        <li><a href="#class-constructor">class constructor</a><span>, §3.3</span>
        <li><a href="#create-a-new-animator-instance">create a new animator instance</a><span>, §4.1</span>
        <li><a href="#disassociate-animator-instance-of-worklet-animation">disassociate animator instance of worklet
                animation</a><span>, §5.4</span>
        <li><a href="#frame-current">frame-current</a><span>, §4.5</span>
        <li><a href="#frame-requested">frame-requested</a><span>, §4.5</span>
        <li><a href="#dom-workletgroupeffect-getchildren">getChildren()</a><span>, §5.6</span>
        <li><a href="#dom-animationeffect-localtime">localTime</a><span>, §5.6</span>
        <li><a href="#migrate-an-animator-instance">migrate an animator instance</a><span>, §4.4</span>
        <li><a href="#dom-animationworkletglobalscope-registeranimator">registerAnimator(name, animatorCtor)</a><span>,
                §3.4</span>
        <li><a href="#remove-an-animator-instance">remove an animator instance</a><span>, §4.3</span>
        <li><a href="#run-animators">run animators</a><span>, §4.2</span>
        <li><a href="#serialized-options">serialized options</a><span>, §5.1</span>
        <li><a href="#set-animator-instance-of-worklet-animation">set animator instance of worklet animation</a><span>,
                §5.4</span>
        <li><a href="#dom-statefulanimator-state">state()</a><span>, §3.2</span>
        <li><a href="#statefulanimator">StatefulAnimator</a><span>, §3.2</span>
        <li><a href="#dom-statefulanimator-statefulanimator">StatefulAnimator()</a><span>, §3.2</span>
        <li><a href="#stateful-animator-instance">stateful animator instance</a><span>, §4</span>
        <li><a href="#dom-statefulanimator-statefulanimator">StatefulAnimator(options)</a><span>, §3.2</span>
        <li><a href="#dom-statefulanimator-statefulanimator">StatefulAnimator(options, state)</a><span>, §3.2</span>
        <li><a href="#stateful-flag">stateful flag</a><span>, §3.3</span>
        <li><a href="#dom-statelessanimator-statelessanimator">StatelessAnimator()</a><span>, §3.1</span>
        <li><a href="#statelessanimator">StatelessAnimator</a><span>, §3.1</span>
        <li><a href="#dom-statelessanimator-statelessanimator">StatelessAnimator(options)</a><span>, §3.1</span>
        <li><a href="#worklet-animation">Worklet animation</a><span>, §5.1</span>
        <li><a href="#workletanimation">WorkletAnimation</a><span>, §5.2</span>
        <li><a href="#dom-workletanimation-workletanimation">WorkletAnimation(animatorName, effects, timeline,
                options)</a><span>, §5.2</span>
        <li><a href="#workletgroupeffect">WorkletGroupEffect</a><span>, §5.6</span>
    </ul>
    <aside class="dfn-panel" data-for="term-for-transition-start-time">
        <a
            href="https://www.w3.org/TR/css3-transitions/#transition-start-time">https://www.w3.org/TR/css3-transitions/#transition-start-time</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-transition-start-time">5.3. Worklet Animation timing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-typedef-ident">
        <a
            href="https://www.w3.org/TR/css-values-4/#typedef-ident">https://www.w3.org/TR/css-values-4/#typedef-ident</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-typedef-ident">3.3. Animator Definition</a>
            <li><a href="#ref-for-typedef-ident①">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-namespacedef-css">
        <a
            href="https://drafts.csswg.org/cssom-1/#namespacedef-css">https://drafts.csswg.org/cssom-1/#namespacedef-css</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-namespacedef-css">2. Animation Worklet</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-document">
        <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-document">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-window">
        <a
            href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-window">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-current-global-object">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object">https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-current-global-object">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-queue-a-task">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-queue-a-task">4.4. Migrating an Animator Instance</a> <a
                    href="#ref-for-queue-a-task①">(2)</a>
            <li><a href="#ref-for-queue-a-task②">5.4. Interaction with Animator Instances</a> <a
                    href="#ref-for-queue-a-task③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list">
        <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-list">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-struct">
        <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-struct">3.3. Animator Definition</a>
            <li><a href="#ref-for-struct①">4. Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-animation">
        <a
            href="https://www.w3.org/TR/web-animations-1/#animation">https://www.w3.org/TR/web-animations-1/#animation</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-animation">1.1. Relationship to the Web Animations API</a>
            <li><a href="#ref-for-animation①">5.1. Worklet Animation</a>
            <li><a href="#ref-for-animation②">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-animationeffect">
        <a
            href="https://www.w3.org/TR/web-animations-1/#animationeffect">https://www.w3.org/TR/web-animations-1/#animationeffect</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-animationeffect">5.2. Creating a Worklet Animation</a> <a
                    href="#ref-for-animationeffect①">(2)</a> <a href="#ref-for-animationeffect②">(3)</a> <a
                    href="#ref-for-animationeffect③">(4)</a>
            <li><a href="#ref-for-animationeffect④">5.6. WorkletGroupEffect</a> <a
                    href="#ref-for-animationeffect⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-animationtimeline">
        <a
            href="https://www.w3.org/TR/web-animations-1/#animationtimeline">https://www.w3.org/TR/web-animations-1/#animationtimeline</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-animationtimeline">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dom-animation-finish">
        <a
            href="https://www.w3.org/TR/web-animations-1/#dom-animation-finish">https://www.w3.org/TR/web-animations-1/#dom-animation-finish</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-animation-finish">5.3. Worklet Animation timing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dom-animationeffect-getcomputedtiming">
        <a
            href="https://www.w3.org/TR/web-animations-1/#dom-animationeffect-getcomputedtiming">https://www.w3.org/TR/web-animations-1/#dom-animationeffect-getcomputedtiming</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-animationeffect-getcomputedtiming">5.3. Worklet Animation timing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-DOMString">
        <a href="https://heycam.github.io/webidl/#idl-DOMString">https://heycam.github.io/webidl/#idl-DOMString</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-DOMString">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-idl-DOMString①">5.2. Creating a Worklet Animation</a> <a
                    href="#ref-for-idl-DOMString②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-Exposed">
        <a href="https://heycam.github.io/webidl/#Exposed">https://heycam.github.io/webidl/#Exposed</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-Exposed">2. Animation Worklet</a>
            <li><a href="#ref-for-Exposed①">3.1. StatelessAnimator Interface</a>
            <li><a href="#ref-for-Exposed②">3.2. StatefulAnimator Interface</a>
            <li><a href="#ref-for-Exposed③">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-Exposed④">5.2. Creating a Worklet Animation</a>
            <li><a href="#ref-for-Exposed⑤">5.6. WorkletGroupEffect</a> <a href="#ref-for-Exposed⑥">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-Global">
        <a href="https://heycam.github.io/webidl/#Global">https://heycam.github.io/webidl/#Global</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-Global">3.1. StatelessAnimator Interface</a>
            <li><a href="#ref-for-Global①">3.2. StatefulAnimator Interface</a>
            <li><a href="#ref-for-Global②">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-SameObject">
        <a href="https://heycam.github.io/webidl/#SameObject">https://heycam.github.io/webidl/#SameObject</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-SameObject">2. Animation Worklet</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-callback-function">
        <a
            href="https://heycam.github.io/webidl/#dfn-callback-function">https://heycam.github.io/webidl/#dfn-callback-function</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-callback-function">3.3. Animator Definition</a> <a
                    href="#ref-for-dfn-callback-function①">(2)</a>
            <li><a href="#ref-for-dfn-callback-function②">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-double">
        <a href="https://heycam.github.io/webidl/#idl-double">https://heycam.github.io/webidl/#idl-double</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-double">5.6. WorkletGroupEffect</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-worklet">
        <a href="https://www.w3.org/TR/worklets-1/#worklet">https://www.w3.org/TR/worklets-1/#worklet</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-worklet">2. Animation Worklet</a> <a href="#ref-for-worklet①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-workletglobalscope">
        <a
            href="https://www.w3.org/TR/worklets-1/#workletglobalscope">https://www.w3.org/TR/worklets-1/#workletglobalscope</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-workletglobalscope">3.2. StatefulAnimator Interface</a>
            <li><a href="#ref-for-workletglobalscope①">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-workletglobalscope②">4.4. Migrating an Animator Instance</a> <a
                    href="#ref-for-workletglobalscope③">(2)</a>
            <li><a href="#ref-for-workletglobalscope④">5.3. Worklet Animation timing model</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-worklet-global-scope-type">
        <a
            href="https://www.w3.org/TR/worklets-1/#worklet-global-scope-type">https://www.w3.org/TR/worklets-1/#worklet-global-scope-type</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-worklet-global-scope-type">2. Animation Worklet</a>
        </ul>
    </aside>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">参照によって定義される用語</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[css-transitions-1]</a> は以下の用語を定義します:
            <ul>
                <li><span class="dfn-paneled" id="term-for-transition-start-time" style="color:initial">start
                        time</span>
            </ul>
        <li>
            <a data-link-type="biblio">[css-values-4]</a> は以下の用語を定義します:
            <ul>
                <li><span class="dfn-paneled" id="term-for-typedef-ident" style="color:initial">&lt;ident></span>
            </ul>
        <li>
            <a data-link-type="biblio">[cssom-1]</a> は以下の用語を定義します:
            <ul>
                <li><span class="dfn-paneled" id="term-for-namespacedef-css" style="color:initial">CSS</span>
            </ul>
        <li>
            <a data-link-type="biblio">[DOM]</a> は以下の用語を定義します:
            <ul>
                <li><span class="dfn-paneled" id="term-for-document" style="color:initial">Document</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> は以下の用語を定義します:
            <ul>
                <li><span class="dfn-paneled" id="term-for-window" style="color:initial">Window</span>
                <li><span class="dfn-paneled" id="term-for-current-global-object" style="color:initial">current global
                        object</span>
                <li><span class="dfn-paneled" id="term-for-queue-a-task" style="color:initial">queue a task</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> は以下の用語を定義します:
            <ul>
                <li><span class="dfn-paneled" id="term-for-list" style="color:initial">list</span>
                <li><span class="dfn-paneled" id="term-for-struct" style="color:initial">struct</span>
            </ul>
        <li>
            <a data-link-type="biblio">[web-animations-1]</a> は以下の用語を定義します:
            <ul>
                <li><span class="dfn-paneled" id="term-for-animation" style="color:initial">Animation</span>
                <li><span class="dfn-paneled" id="term-for-animationeffect" style="color:initial">AnimationEffect</span>
                <li><span class="dfn-paneled" id="term-for-animationtimeline"
                        style="color:initial">AnimationTimeline</span>
                <li><span class="dfn-paneled" id="term-for-dom-animation-finish" style="color:initial">finish()</span>
                <li><span class="dfn-paneled" id="term-for-dom-animationeffect-getcomputedtiming"
                        style="color:initial">getComputedTiming()</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WebIDL]</a> は以下の用語を定義します:
            <ul>
                <li><span class="dfn-paneled" id="term-for-idl-DOMString" style="color:initial">DOMString</span>
                <li><span class="dfn-paneled" id="term-for-Exposed" style="color:initial">Exposed</span>
                <li><span class="dfn-paneled" id="term-for-Global" style="color:initial">Global</span>
                <li><span class="dfn-paneled" id="term-for-SameObject" style="color:initial">SameObject</span>
                <li><span class="dfn-paneled" id="term-for-dfn-callback-function" style="color:initial">callback
                        function</span>
                <li><span class="dfn-paneled" id="term-for-idl-double" style="color:initial">double</span>
            </ul>
        <li>
            <a data-link-type="biblio">[worklets-1]</a> は以下の用語を定義します:
            <ul>
                <li><span class="dfn-paneled" id="term-for-worklet" style="color:initial">Worklet</span>
                <li><span class="dfn-paneled" id="term-for-workletglobalscope"
                        style="color:initial">WorkletGlobalScope</span>
                <li><span class="dfn-paneled" id="term-for-worklet-global-scope-type" style="color:initial">worklet
                        global scope type</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">規範参考文献</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css-transitions-1">[CSS-TRANSITIONS-1]
        <dd>David Baron; 他. <a href="https://www.w3.org/TR/css-transitions-1/">CSS Transitions</a>. 2018年10月11日. WD.
            URL: <a href="https://www.w3.org/TR/css-transitions-1/">https://www.w3.org/TR/css-transitions-1/</a>
        <dt id="biblio-css-values-4">[CSS-VALUES-4]
        <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://www.w3.org/TR/css-values-4/">CSS Values and Units Module
                Level 4</a>. 2019年1月31日. WD. URL: <a
                href="https://www.w3.org/TR/css-values-4/">https://www.w3.org/TR/css-values-4/</a>
        <dt id="biblio-cssom-1">[CSSOM-1]
        <dd>Simon Pieters; Glenn Adams. <a href="https://www.w3.org/TR/cssom-1/">CSS Object Model (CSSOM)</a>.
            2016年3月17日. WD. URL: <a href="https://www.w3.org/TR/cssom-1/">https://www.w3.org/TR/cssom-1/</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. ライビングスタンダード. URL: <a
                href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; 他. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. ライビングスタンダード. URL:
            <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>.
            ライビングスタンダード. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement
                Levels</a>. 1997年3月. Best Current Practice. URL: <a
                href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
        <dt id="biblio-web-animations-1">[WEB-ANIMATIONS-1]
        <dd>Brian Birtles; 他. <a href="https://www.w3.org/TR/web-animations-1/">Web Animations</a>. 2018年10月11日. WD.
            URL: <a href="https://www.w3.org/TR/web-animations-1/">https://www.w3.org/TR/web-animations-1/</a>
        <dt id="biblio-webidl">[WebIDL]
        <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 2016年12月15日. ED. URL: <a
                href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
        <dt id="biblio-worklets-1">[WORKLETS-1]
        <dd>Ian Kilpatrick. <a href="https://www.w3.org/TR/worklets-1/">Worklets Level 1</a>. 2016年6月7日. WD. URL: <a
                href="https://www.w3.org/TR/worklets-1/">https://www.w3.org/TR/worklets-1/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">参考情報</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-explainer">[EXPLAINER]
        <dd><a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/README.md">Animation
                Worklet Explainer</a>. URL: <a
                href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/README.md">https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/README.md</a>
        <dt id="biblio-principles">[PRINCIPLES]
        <dd><a href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/principles.md">Animation
                Worklet Design Principles and Goals</a>. URL: <a
                href="https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/principles.md">https://github.com/w3c/css-houdini-drafts/blob/master/css-animationworklet/principles.md</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑦"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>namespace</c-> <a class="idl-code" data-link-type="namespace" href="https://drafts.csswg.org/cssom-1/#namespacedef-css" id="ref-for-namespacedef-css①"><c- g>CSS</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject" id="ref-for-SameObject①"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/worklets-1/#worklet" id="ref-for-worklet①①"><c- n>Worklet</c-></a> <a data-readonly data-type="Worklet" href="#dom-css-animationworklet"><code><c- g>animationWorklet</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global③"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>, <a href="#dom-statelessanimator-statelessanimator"><code><c- g>Constructor</c-></code></a> (<c- b>optional</c-> <c- b>any</c-> <a href="#dom-statelessanimator-statelessanimator-options-options"><code><c- g>options</c-></code></a>)]
<c- b>interface</c-> <a href="#statelessanimator"><code><c- g>StatelessAnimator</c-></code></a> {
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global①①"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a>,
<a href="#dom-statefulanimator-statefulanimator"><code><c- g>Constructor</c-></code></a> (<c- b>optional</c-> <c- b>any</c-> <a href="#dom-statefulanimator-statefulanimator-options-state-options"><code><c- g>options</c-></code></a>, <c- b>optional</c-> <c- b>any</c-> <a href="#dom-statefulanimator-statefulanimator-options-state-state"><code><c- g>state</c-></code></a>)]
<c- b>interface</c-> <a href="#statefulanimator"><code><c- g>StatefulAnimator</c-></code></a> {
  <c- b>any</c-> <a href="#dom-statefulanimator-state"><code><c- g>state</c-></code></a>();
};

[ <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed③①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Global" id="ref-for-Global②①"><c- g>Global</c-></a>=<a class="n" data-link-type="idl-name"><c- n>AnimationWorklet</c-></a> ]
<c- b>interface</c-> <a href="#animationworkletglobalscope"><code><c- g>AnimationWorkletGlobalScope</c-></code></a> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/worklets-1/#workletglobalscope" id="ref-for-workletglobalscope①①"><c- n>WorkletGlobalScope</c-></a> {
    <c- b>void</c-> <a class="idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator①①"><c- g>registerAnimator</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <a href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"><code><c- g>name</c-></code></a>, <a class="n" data-link-type="idl-name" href="#callbackdef-animatorinstanceconstructor" id="ref-for-callbackdef-animatorinstanceconstructor①①"><c- n>AnimatorInstanceConstructor</c-></a> <a href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"><code><c- g>animatorCtor</c-></code></a>);
};

<c- b>callback</c-> <a href="#callbackdef-animatorinstanceconstructor"><code><c- g>AnimatorInstanceConstructor</c-></code></a> = <c- b>any</c-> (<c- b>any</c-> <a href="#dom-animatorinstanceconstructor-options"><code><c- g>options</c-></code></a>, <c- b>optional</c-> <c- b>any</c-> <a href="#dom-animatorinstanceconstructor-state"><code><c- g>state</c-></code></a>);


[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed④①"><c- g>Exposed</c-></a>=<c- n>Window</c->,
 <a class="idl-code" data-link-type="constructor" href="#dom-workletanimation-workletanimation" id="ref-for-dom-workletanimation-workletanimation①"><c- g>Constructor</c-></a> (<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①①"><c- b>DOMString</c-></a> <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-animatorname"><code><c- g>animatorName</c-></code></a>,
              <c- b>optional</c-> (<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect⑥"><c- n>AnimationEffect</c-></a> <c- b>or</c-> <c- b>sequence</c->&lt;<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect①①"><c- n>AnimationEffect</c-></a>>)? <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-effects"><code><c- g>effects</c-></code></a> = <c- b>null</c->,
              <c- b>optional</c-> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationtimeline" id="ref-for-animationtimeline①"><c- n>AnimationTimeline</c-></a>? <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-timeline"><code><c- g>timeline</c-></code></a>,
              <c- b>optional</c-> <c- b>any</c-> <a href="#dom-workletanimation-workletanimation-animatorname-effects-timeline-options-options"><code><c- g>options</c-></code></a>)]
<c- b>interface</c-> <a href="#workletanimation"><code><c- g>WorkletAnimation</c-></code></a> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animation" id="ref-for-animation②①"><c- n>Animation</c-></a> {
        <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString②①"><c- b>DOMString</c-></a> <a data-readonly data-type="DOMString" href="#dom-workletanimation-animatorname"><code><c- g>animatorName</c-></code></a>;
};


[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑤①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>interface</c-> <a href="#workletgroupeffect"><code><c- g>WorkletGroupEffect</c-></code></a> {
  <c- b>sequence</c->&lt;<a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect④①"><c- n>AnimationEffect</c-></a>> <a href="#dom-workletgroupeffect-getchildren"><code><c- g>getChildren</c-></code></a>();
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed⑥①"><c- g>Exposed</c-></a>=<c- n>AnimationWorklet</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/web-animations-1/#animationeffect" id="ref-for-animationeffect⑤①"><c- g>AnimationEffect</c-></a> {
    // Intended for use inside Animation Worklet scope to drive the effect.
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double①"><c- b>double</c-></a> <a data-type="double" href="#dom-animationeffect-localtime"><code><c- g>localTime</c-></code></a>;
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">課題索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> ユーザーエージェントが遅いアニメーターの処理をスキップしてスロットルする権限を与えることを検討してください。<a href="#issue-6d334361"> ↵ </a>
        </div>
        <div class="issue"> animateFunctionが例外を投げた場合の挙動を明示するべきです。少なくとも、キー
            フレームのlocalTime値は無視されるため、誤った部分更新が発生しない旨の文言が必要です。<a href="#issue-84eae255"> ↵ </a></div>
        <div class="issue"> <a data-link-type="dfn" href="#animator-instance">animator instance</a>がanimation
            currentTimeの変更（例えばreverse()、finish()、playbackRateの変更）を通知される適切な仕組みを考案すべきです。これにより適切に反応できるようになります。 <a
                href="https://github.com/w3c/css-houdini-drafts/issues/811">&lt;https://github.com/w3c/css-houdini-drafts/issues/811></a><a
                href="#issue-61e3a71a"> ↵ </a></div>
        <div class="issue">
            上記のインターフェイスはweb-animation-2のGroupEffectで提案されている保守的なサブセットのみを公開しています。代わりにこれをweb-animationに対する差分仕様として移行するべきです。
            <a
                href="https://github.com/w3c/csswg-drafts/issues/2071">&lt;https://github.com/w3c/csswg-drafts/issues/2071></a><a
                href="#issue-9ff2b6cb"> ↵ </a>
        </div>
    </div>
    <aside class="dfn-panel" data-for="animation-worklet">
        <b><a href="#animation-worklet">#animation-worklet</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animation-worklet">1. Introduction</a>
            <li><a href="#ref-for-animation-worklet①">1.1. Relationship to the Web Animations API</a>
            <li><a href="#ref-for-animation-worklet②">3.2. StatefulAnimator Interface</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-css-animationworklet">
        <b><a href="#dom-css-animationworklet">#dom-css-animationworklet</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-css-animationworklet">2. Animation Worklet</a> <a
                    href="#ref-for-dom-css-animationworklet①">(2)</a> <a
                    href="#ref-for-dom-css-animationworklet②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator">
        <b><a href="#animator">#animator</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator">3. Animator</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="statelessanimator">
        <b><a href="#statelessanimator">#statelessanimator</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-statelessanimator">3. Animator</a>
            <li><a href="#ref-for-statelessanimator①">3.1. StatelessAnimator Interface</a>
            <li><a href="#ref-for-statelessanimator②">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="statefulanimator">
        <b><a href="#statefulanimator">#statefulanimator</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-statefulanimator">3. Animator</a>
            <li><a href="#ref-for-statefulanimator①">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-statefulanimator-state">
        <b><a href="#dom-statefulanimator-state">#dom-statefulanimator-state</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-statefulanimator-state">3.2. StatefulAnimator Interface</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-definition">
        <b><a href="#animator-definition">#animator-definition</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-definition">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-animator-definition①">4. Animator Instance</a> <a
                    href="#ref-for-animator-definition②">(2)</a>
            <li><a href="#ref-for-animator-definition③">5.1. Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-name">
        <b><a href="#animator-name">#animator-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-name">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-animator-name①">4. Animator Instance</a>
            <li><a href="#ref-for-animator-name②">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-name③">4.2. Running Animators</a>
            <li><a href="#ref-for-animator-name④">4.4. Migrating an Animator Instance</a> <a
                    href="#ref-for-animator-name⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="class-constructor">
        <b><a href="#class-constructor">#class-constructor</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-class-constructor">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-class-constructor①">4.1. Creating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animate-function">
        <b><a href="#animate-function">#animate-function</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animate-function">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-animate-function①">4.2. Running Animators</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="stateful-flag">
        <b><a href="#stateful-flag">#stateful-flag</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-stateful-flag">3.4. Registering an Animator Definition</a>
            <li><a href="#ref-for-stateful-flag①">4. Animator Instance</a>
            <li><a href="#ref-for-stateful-flag②">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-name-to-animator-definition-map">
        <b><a
                href="#animator-name-to-animator-definition-map">#animator-name-to-animator-definition-map</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-animator-name-to-animator-definition-map">3.4. Registering an Animator Definition</a>
                <a href="#ref-for-animator-name-to-animator-definition-map①">(2)</a>
            <li><a href="#ref-for-animator-name-to-animator-definition-map②">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-name-to-animator-definition-map③">4.2. Running Animators</a>
            <li><a href="#ref-for-animator-name-to-animator-definition-map④">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animationworkletglobalscope">
        <b><a href="#animationworkletglobalscope">#animationworkletglobalscope</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animationworkletglobalscope">2. Animation Worklet</a> <a
                    href="#ref-for-animationworkletglobalscope①">(2)</a>
            <li><a href="#ref-for-animationworkletglobalscope②">3. Animator</a>
            <li><a href="#ref-for-animationworkletglobalscope③">3.3. Animator Definition</a>
            <li><a href="#ref-for-animationworkletglobalscope④">3.4. Registering an Animator Definition</a> <a
                    href="#ref-for-animationworkletglobalscope⑤">(2)</a>
            <li><a href="#ref-for-animationworkletglobalscope⑥">4. Animator Instance</a>
            <li><a href="#ref-for-animationworkletglobalscope⑦">4.1. Creating an Animator Instance</a> <a
                    href="#ref-for-animationworkletglobalscope⑧">(2)</a> <a
                    href="#ref-for-animationworkletglobalscope⑨">(3)</a>
            <li><a href="#ref-for-animationworkletglobalscope①⓪">5.4. Interaction with Animator Instances</a> <a
                    href="#ref-for-animationworkletglobalscope①①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="callbackdef-animatorinstanceconstructor">
        <b><a
                href="#callbackdef-animatorinstanceconstructor">#callbackdef-animatorinstanceconstructor</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-callbackdef-animatorinstanceconstructor">3.3. Animator Definition</a>
            <li><a href="#ref-for-callbackdef-animatorinstanceconstructor①">3.4. Registering an Animator Definition</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-animationworkletglobalscope-registeranimator">
        <b><a
                href="#dom-animationworkletglobalscope-registeranimator">#dom-animationworkletglobalscope-registeranimator</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-animationworkletglobalscope-registeranimator">3.4. Registering an Animator
                    Definition</a> <a href="#ref-for-dom-animationworkletglobalscope-registeranimator①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-instance">
        <b><a href="#animator-instance">#animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-instance">3.2. StatefulAnimator Interface</a>
            <li><a href="#ref-for-animator-instance①">4. Animator Instance</a>
            <li><a href="#ref-for-animator-instance②">4.1. Creating an Animator Instance</a> <a
                    href="#ref-for-animator-instance③">(2)</a> <a href="#ref-for-animator-instance④">(3)</a>
            <li><a href="#ref-for-animator-instance⑤">4.2. Running Animators</a> <a
                    href="#ref-for-animator-instance⑥">(2)</a>
            <li><a href="#ref-for-animator-instance⑦">4.5. Requesting Animation Frames</a>
            <li><a href="#ref-for-animator-instance⑧">5.1. Worklet Animation</a> <a
                    href="#ref-for-animator-instance⑨">(2)</a> <a href="#ref-for-animator-instance①⓪">(3)</a>
            <li><a href="#ref-for-animator-instance①①">5.3. Worklet Animation timing model</a> <a
                    href="#ref-for-animator-instance①②">(2)</a> <a href="#ref-for-animator-instance①③">(3)</a> <a
                    href="#ref-for-animator-instance①④">(4)</a>
            <li><a href="#ref-for-animator-instance①⑤">5.4. Interaction with Animator Instances</a> <a
                    href="#ref-for-animator-instance①⑥">(2)</a> <a href="#ref-for-animator-instance①⑦">(3)</a> <a
                    href="#ref-for-animator-instance①⑧">(4)</a> <a href="#ref-for-animator-instance①⑨">(5)</a> <a
                    href="#ref-for-animator-instance②⓪">(6)</a> <a href="#ref-for-animator-instance②①">(7)</a> <a
                    href="#ref-for-animator-instance②②">(8)</a>
            <li><a href="#ref-for-animator-instance②③">5.6. WorkletGroupEffect</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-effect">
        <b><a href="#animator-effect">#animator-effect</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-effect">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-effect①">4.2. Running Animators</a>
            <li><a href="#ref-for-animator-effect②">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-current-time">
        <b><a href="#animator-current-time">#animator-current-time</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-current-time">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-current-time①">4.2. Running Animators</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-timeline">
        <b><a href="#animator-timeline">#animator-timeline</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-timeline">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-timeline①">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-serialized-options">
        <b><a href="#animator-serialized-options">#animator-serialized-options</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-serialized-options">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-serialized-options①">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="stateful-animator-instance">
        <b><a href="#stateful-animator-instance">#stateful-animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-stateful-animator-instance">4.4. Migrating an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animator-instance-set">
        <b><a href="#animator-instance-set">#animator-instance-set</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animator-instance-set">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animator-instance-set①">4.2. Running Animators</a>
            <li><a href="#ref-for-animator-instance-set②">4.3. Removing an Animator Instance</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="create-a-new-animator-instance">
        <b><a href="#create-a-new-animator-instance">#create-a-new-animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-create-a-new-animator-instance">4.4. Migrating an Animator Instance</a>
            <li><a href="#ref-for-create-a-new-animator-instance①">5.4. Interaction with Animator Instances</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="run-animators">
        <b><a href="#run-animators">#run-animators</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-run-animators">4.2. Running Animators</a> <a href="#ref-for-run-animators①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="remove-an-animator-instance">
        <b><a href="#remove-an-animator-instance">#remove-an-animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-remove-an-animator-instance">4.4. Migrating an Animator Instance</a>
            <li><a href="#ref-for-remove-an-animator-instance①">5.4. Interaction with Animator Instances</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="migrate-an-animator-instance">
        <b><a href="#migrate-an-animator-instance">#migrate-an-animator-instance</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-migrate-an-animator-instance">3.2. StatefulAnimator Interface</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animation-requested-flag">
        <b><a href="#animation-requested-flag">#animation-requested-flag</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animation-requested-flag">4. Animator Instance</a>
            <li><a href="#ref-for-animation-requested-flag①">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-animation-requested-flag②">4.2. Running Animators</a> <a
                    href="#ref-for-animation-requested-flag③">(2)</a>
            <li><a href="#ref-for-animation-requested-flag④">4.5. Requesting Animation Frames</a> <a
                    href="#ref-for-animation-requested-flag⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="frame-requested">
        <b><a href="#frame-requested">#frame-requested</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-frame-requested">4.2. Running Animators</a>
            <li><a href="#ref-for-frame-requested①">4.5. Requesting Animation Frames</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="frame-current">
        <b><a href="#frame-current">#frame-current</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-frame-current">4.1. Creating an Animator Instance</a>
            <li><a href="#ref-for-frame-current①">4.2. Running Animators</a>
            <li><a href="#ref-for-frame-current②">4.5. Requesting Animation Frames</a> <a
                    href="#ref-for-frame-current③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="worklet-animation">
        <b><a href="#worklet-animation">#worklet-animation</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-worklet-animation">4. Animator Instance</a>
            <li><a href="#ref-for-worklet-animation①">4.5. Requesting Animation Frames</a>
            <li><a href="#ref-for-worklet-animation②">5.1. Worklet Animation</a> <a
                    href="#ref-for-worklet-animation③">(2)</a>
            <li><a href="#ref-for-worklet-animation④">5.3. Worklet Animation timing model</a> <a
                    href="#ref-for-worklet-animation⑤">(2)</a> <a href="#ref-for-worklet-animation⑥">(3)</a> <a
                    href="#ref-for-worklet-animation⑦">(4)</a> <a href="#ref-for-worklet-animation⑧">(5)</a> <a
                    href="#ref-for-worklet-animation⑨">(6)</a>
            <li><a href="#ref-for-worklet-animation①⓪">5.4. Interaction with Animator Instances</a> <a
                    href="#ref-for-worklet-animation①①">(2)</a>
            <li><a href="#ref-for-worklet-animation①②">5.5. ScrollTimeline</a>
            <li><a href="#ref-for-worklet-animation①③">5.7. Effect Stack and Composite Order</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="animation-animator-name">
        <b><a href="#animation-animator-name">#animation-animator-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-animation-animator-name">5.2. Creating a Worklet Animation</a>
            <li><a href="#ref-for-animation-animator-name①">5.4. Interaction with Animator Instances</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="serialized-options">
        <b><a href="#serialized-options">#serialized-options</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-serialized-options">5.2. Creating a Worklet Animation</a>
            <li><a href="#ref-for-serialized-options①">5.4. Interaction with Animator Instances</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="workletanimation">
        <b><a href="#workletanimation">#workletanimation</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-workletanimation">3. Animator</a> <a href="#ref-for-workletanimation①">(2)</a>
            <li><a href="#ref-for-workletanimation②">5.2. Creating a Worklet Animation</a> <a
                    href="#ref-for-workletanimation③">(2)</a>
            <li><a href="#ref-for-workletanimation④">5.6. WorkletGroupEffect</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-workletanimation-workletanimation">
        <b><a href="#dom-workletanimation-workletanimation">#dom-workletanimation-workletanimation</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-workletanimation-workletanimation">5.2. Creating a Worklet Animation</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="associate-animator-instance-of-worklet-animation">
        <b><a
                href="#associate-animator-instance-of-worklet-animation">#associate-animator-instance-of-worklet-animation</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-associate-animator-instance-of-worklet-animation">5.4. Interaction with Animator
                    Instances</a> <a href="#ref-for-associate-animator-instance-of-worklet-animation①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="disassociate-animator-instance-of-worklet-animation">
        <b><a
                href="#disassociate-animator-instance-of-worklet-animation">#disassociate-animator-instance-of-worklet-animation</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-disassociate-animator-instance-of-worklet-animation">5.4. Interaction with Animator
                    Instances</a> <a href="#ref-for-disassociate-animator-instance-of-worklet-animation①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="set-animator-instance-of-worklet-animation">
        <b><a
                href="#set-animator-instance-of-worklet-animation">#set-animator-instance-of-worklet-animation</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-set-animator-instance-of-worklet-animation">5.4. Interaction with Animator
                    Instances</a> <a href="#ref-for-set-animator-instance-of-worklet-animation①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="workletgroupeffect">
        <b><a href="#workletgroupeffect">#workletgroupeffect</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-workletgroupeffect">5.2. Creating a Worklet Animation</a>
            <li><a href="#ref-for-workletgroupeffect①">5.6. WorkletGroupEffect</a> <a
                    href="#ref-for-workletgroupeffect②">(2)</a> <a href="#ref-for-workletgroupeffect③">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-animationeffect-localtime">
        <b><a href="#dom-animationeffect-localtime">#dom-animationeffect-localtime</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-animationeffect-localtime">5.6. WorkletGroupEffect</a>
        </ul>
    </aside>

    <p role="navigation" id="back-to-top"><a href="#toc"><abbr title="Back to top">↑</abbr></a></p>

    <script>/* script-var-click-highlighting */

        document.addEventListener("click", e => {
            if (e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        {
            const indexCounts = new Map();
            const indexNames = new Map();
            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = null;
                let searchEl = v;
                while (algoContainer == null && searchEl != document.body) {
                    searchEl = searchEl.parentNode;
                    if (searchEl.hasAttribute("data-algorithm")) {
                        algoContainer = searchEl;
                    }
                }

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const algoName = algoContainer.getAttribute("data-algorithm");
                const varName = getVarName(v);
                const addClass = !v.classList.contains("selected");
                let highlightClass = null;
                if (addClass) {
                    const index = chooseHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] += 1;
                    indexNames.set(algoName + "///" + varName, index);
                    highlightClass = nameFromIndex(index);
                } else {
                    const index = previousHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] -= 1;
                    highlightClass = nameFromIndex(index);
                }

                // Find all same-name vars, and toggle their class appropriately.
                for (const el of algoContainer.querySelectorAll("var")) {
                    if (getVarName(el) == varName) {
                        el.classList.toggle("selected", addClass);
                        el.classList.toggle(highlightClass, addClass);
                    }
                }
            }
            function getVarName(el) {
                return el.textContent.replace(/(\s| )+/, " ").trim();
            }
            function chooseHighlightIndex(algoName, varName) {
                let indexes = null;
                if (indexCounts.has(algoName)) {
                    indexes = indexCounts.get(algoName);
                } else {
                    // 7 classes right now
                    indexes = [0, 0, 0, 0, 0, 0, 0];
                    indexCounts.set(algoName, indexes);
                }

                // If the element was recently unclicked,
                // *and* that color is still unclaimed,
                // give it back the same color.
                const lastIndex = previousHighlightIndex(algoName, varName);
                if (indexes[lastIndex] === 0) return lastIndex;

                // Find the earliest index with the lowest count.
                const minCount = Math.min.apply(null, indexes);
                let index = null;
                for (var i = 0; i < indexes.length; i++) {
                    if (indexes[i] == minCount) {
                        return i;
                    }
                }
            }
            function previousHighlightIndex(algoName, varName) {
                return indexNames.get(algoName + "///" + varName);
            }
            function nameFromIndex(index) {
                return "selected" + index;
            }
        }
    </script>
    <script>/* script-dfn-panel */

        document.body.addEventListener("click", function (e) {
            var queryAll = function (sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while (el.parentElement) {
                if (el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if (el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if (el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if (target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function (el) {
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if (target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if (dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if (panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if (target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
    </script>
    <script src="https://htmlspecs.com/dropdown.js"></script>