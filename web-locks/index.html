<!doctype html>
<html lang="ja-JP">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <title>Web ロックス API</title>
    <meta content="WD" name="w3c-status">
    <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
    <meta content="Bikeshed version 26e85e599, updated Thu Dec 8 15:29:31 2022 -0800" name="generator">
    <link href="https://www.w3.org/TR/web-locks/" rel="canonical">
    <link href="https://www.w3.org/TR/web-locks/logo-lock.svg" rel="icon">
    <style>
        .domintro::before {
            content: 'For web developers (non-normative)';
            text-transform: initial;
        }

        .domintro dt {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;

            padding-top: 0.5em;
            padding-bottom: 1em;
        }

        .domintro dt a {
            color: inherit;
            border-bottom-style: none;
        }

        .domintro dt code {
            font-size: inherit;
        }
    </style>
    <style>
        #speclogo {
            height: 100px;
            width: 100px;
            background-color: transparent;
        }

        main #speclogo {
            position: absolute;
            right: 20px;
            top: 30px;
        }

        .logo #speclogo {
            margin-top: 20px;
        }
    </style>
    <style>
        /* style-autolinks */

        .css.css,
        .property.property,
        .descriptor.descriptor {
            color: var(--a-normal-text);
            font-size: inherit;
            font-family: inherit;
        }

        .css::before,
        .property::before,
        .descriptor::before {
            content: "‘";
        }

        .css::after,
        .property::after,
        .descriptor::after {
            content: "’";
        }

        .property,
        .descriptor {
            /* Don't wrap property and descriptor names */
            white-space: nowrap;
        }

        .type {
            /* CSS value <type> */
            font-style: italic;
        }

        pre .property::before,
        pre .property::after {
            content: "";
        }

        [data-link-type="property"]::before,
        [data-link-type="propdesc"]::before,
        [data-link-type="descriptor"]::before,
        [data-link-type="value"]::before,
        [data-link-type="function"]::before,
        [data-link-type="at-rule"]::before,
        [data-link-type="selector"]::before,
        [data-link-type="maybe"]::before {
            content: "‘";
        }

        [data-link-type="property"]::after,
        [data-link-type="propdesc"]::after,
        [data-link-type="descriptor"]::after,
        [data-link-type="value"]::after,
        [data-link-type="function"]::after,
        [data-link-type="at-rule"]::after,
        [data-link-type="selector"]::after,
        [data-link-type="maybe"]::after {
            content: "’";
        }

        [data-link-type].production::before,
        [data-link-type].production::after,
        .prod [data-link-type]::before,
        .prod [data-link-type]::after {
            content: "";
        }

        [data-link-type=element],
        [data-link-type=element-attr] {
            font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: .9em;
        }

        [data-link-type=element]::before {
            content: "<"
        }

        [data-link-type=element]::after {
            content: ">"
        }

        [data-link-type=biblio] {
            white-space: pre;
        }
    </style>
    <style>
        /* style-counters */

        body {
            counter-reset: example figure issue;
        }

        .issue {
            counter-increment: issue;
        }

        .issue:not(.no-marker)::before {
            content: "Issue " counter(issue);
        }

        .example {
            counter-increment: example;
        }

        .example:not(.no-marker)::before {
            content: "Example " counter(example);
        }

        .invalid.example:not(.no-marker)::before,
        .illegal.example:not(.no-marker)::before {
            content: "Invalid Example" counter(example);
        }

        figcaption {
            counter-increment: figure;
        }

        figcaption:not(.no-marker)::before {
            content: "Figure " counter(figure) " ";
        }
    </style>
    <style>
        /* style-dfn-panel */

        :root {
            --dfnpanel-bg: #ddd;
            --dfnpanel-text: var(--text);
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: var(--dfnpanel-bg);
            color: var(--dfnpanel-text);
            border: outset 0.2em;
        }

        .dfn-panel:not(.on) {
            display: none;
        }

        .dfn-panel * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        .dfn-panel>b {
            display: block;
        }

        .dfn-panel a {
            color: var(--dfnpanel-text);
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .dfn-panel>b+b {
            margin-top: 0.25em;
        }

        .dfn-panel ul {
            padding: 0;
        }

        .dfn-panel li {
            list-style: inside;
        }

        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled {
            cursor: pointer;
        }
    </style>
    <style>
        /* style-issues */

        a[href].issue-return {
            float: right;
            float: inline-end;
            color: var(--issueheading-text);
            font-weight: bold;
            text-decoration: none;
        }
    </style>
    <style>
        /* style-md-lists */

        /* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
        [data-md]> :first-child {
            margin-top: 0;
        }

        [data-md]> :last-child {
            margin-bottom: 0;
        }
    </style>
    <style>
        /* style-mdn-anno */
        @media (max-width: 767px) {
            .mdn-anno {
                opacity: .1;
            }
        }

        :root {
            --mdn-bg: #EEE;
            --mdn-shadow: #999;
            --mdn-nosupport-text: #ccc;
        }

        .mdn-anno {
            font: 1em sans-serif;
            padding: 0.3em;
            position: absolute;
            z-index: 8;
            right: 0.3em;
            background: var(--mdn-bg, #EEE);
            color: var(--text, black);
            box-shadow: 0 0 3px var(--mdn-shadow, #999);
            overflow: hidden;
            border-collapse: initial;
            border-spacing: initial;
            min-width: 9em;
            max-width: min-content;
            white-space: nowrap;
            word-wrap: normal;
            hyphens: none;
            border-radius: .25em;
        }

        .mdn-anno:not(.wrapped) {
            opacity: 1;
            z-index: 9;
        }

        .mdn-anno.wrapped {
            min-width: 0;
        }

        .mdn-anno.wrapped> :not(button) {
            display: none;
        }

        .mdn-anno:hover {
            outline: var(--text, black) 1px solid;
        }

        .mdn-anno>.mdn-anno-btn {
            cursor: pointer;
            border: none;
            color: #000;
            background: transparent;
            margin: -8px;
            float: right;
            padding: 10px 8px 8px 8px;
            outline: none;
        }

        .mdn-anno>.mdn-anno-btn>.less-than-two-engines-flag {
            color: red;
            padding-right: 2px;
        }

        .mdn-anno>.mdn-anno-btn>.all-engines-flag {
            color: green;
            padding-right: 2px;
        }

        .mdn-anno>.mdn-anno-btn>span {
            color: #fff;
            background-color: #000;
            font-weight: normal;
            font-family: zillaslab, Palatino, "Palatino Linotype", serif;
            padding: 2px 3px 0px 3px;
            line-height: 1.3em;
            vertical-align: top;
        }

        .mdn-anno>.feature {
            margin-top: 20px;
        }

        .mdn-anno>.feature:not(:first-of-type) {
            border-top: 1px solid #999;
            margin-top: 6px;
            padding-top: 2px;
        }

        .mdn-anno>.feature>.less-than-two-engines-text {
            color: red;
        }

        .mdn-anno>.feature>.all-engines-text {
            color: green;
        }

        .mdn-anno>.feature>p {
            font-size: .75em;
            margin-top: 6px;
            margin-bottom: 0;
        }

        .mdn-anno>.feature>p+p {
            margin-top: 3px;
        }

        .mdn-anno>.feature>.support {
            display: block;
            font-size: 0.6em;
            margin: 0;
            padding: 0;
            margin-top: 2px;
        }

        .mdn-anno>.feature>.support+div {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>hr {
            display: block;
            border: none;
            border-top: 1px dotted #999;
            padding: 3px 0px 0px 0px;
            margin: 2px 3px 0px 3px;
        }

        .mdn-anno>.feature>.support>hr::before {
            content: "";
        }

        .mdn-anno>.feature>.support>span {
            padding: 0.2em 0;
            display: block;
            display: table;
        }

        .mdn-anno>.feature>.support>span.no {
            color: var(--mdn-nosupport-text);
            filter: grayscale(100%);
        }

        .mdn-anno>.feature>.support>span.no::before {
            opacity: 0.5;
        }

        .mdn-anno>.feature>.support>span:first-of-type {
            padding-top: 0.5em;
        }

        .mdn-anno>.feature>.support>span>span {
            padding: 0 0.5em;
            display: table-cell;
        }

        .mdn-anno>.feature>.support>span>span:first-child {
            width: 100%;
        }

        .mdn-anno>.feature>.support>span>span:last-child {
            width: 100%;
            white-space: pre;
            padding: 0;
        }

        .mdn-anno>.feature>.support>span::before {
            content: ' ';
            display: table-cell;
            min-width: 1.5em;
            height: 1.5em;
            background: no-repeat center center;
            background-size: contain;
            text-align: right;
            font-size: 0.75em;
            font-weight: bold;
        }

        .mdn-anno>.feature>.support>.chrome_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.firefox_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.chrome::before {
            background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg);
        }

        .mdn-anno>.feature>.support>.edge_blink::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge.svg);
        }

        .mdn-anno>.feature>.support>.edge::before {
            background-image: url(https://resources.whatwg.org/browser-logos/edge_legacy.svg);
        }

        .mdn-anno>.feature>.support>.firefox::before {
            background-image: url(https://resources.whatwg.org/browser-logos/firefox.png);
        }

        .mdn-anno>.feature>.support>.ie::before {
            background-image: url(https://resources.whatwg.org/browser-logos/ie.png);
        }

        .mdn-anno>.feature>.support>.safari_ios::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg);
        }

        .mdn-anno>.feature>.support>.nodejs::before {
            background-image: url(https://nodejs.org/static/images/favicons/favicon.ico);
        }

        .mdn-anno>.feature>.support>.opera_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.opera::before {
            background-image: url(https://resources.whatwg.org/browser-logos/opera.svg);
        }

        .mdn-anno>.feature>.support>.safari::before {
            background-image: url(https://resources.whatwg.org/browser-logos/safari.png);
        }

        .mdn-anno>.feature>.support>.samsunginternet_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/samsung.svg);
        }

        .mdn-anno>.feature>.support>.webview_android::before {
            background-image: url(https://resources.whatwg.org/browser-logos/android-webview.png);
        }

        .name-slug-mismatch {
            color: red;
        }

        .caniuse-status:hover {
            z-index: 9;
        }

        /* dt, li, .issue, .note, and .example are "position: relative", so to put annotation at right margin, must move to right of containing block */
        ;

        .h-entry:not(.status-LS) dt>.mdn-anno,
        .h-entry:not(.status-LS) li>.mdn-anno,
        .h-entry:not(.status-LS) .issue>.mdn-anno,
        .h-entry:not(.status-LS) .note>.mdn-anno,
        .h-entry:not(.status-LS) .example>.mdn-anno {
            right: -6.7em;
        }

        .h-entry p+.mdn-anno {
            margin-top: 0;
        }

        h2+.mdn-anno.after {
            margin: -48px 0 0 0;
        }

        h3+.mdn-anno.after {
            margin: -46px 0 0 0;
        }

        h4+.mdn-anno.after {
            margin: -42px 0 0 0;
        }

        h5+.mdn-anno.after {
            margin: -40px 0 0 0;
        }

        h6+.mdn-anno.after {
            margin: -40px 0 0 0;
        }
    </style>
    <style>
        /* style-selflinks */

        :root {
            --selflink-text: white;
            --selflink-bg: gray;
            --selflink-hover-text: black;
        }

        .heading,
        .issue,
        .note,
        .example,
        li,
        dt {
            position: relative;
        }

        a.self-link {
            position: absolute;
            top: 0;
            left: calc(-1 * (3.5rem - 26px));
            width: calc(3.5rem - 26px);
            height: 2em;
            text-align: center;
            border: none;
            transition: opacity .2s;
            opacity: .5;
        }

        a.self-link:hover {
            opacity: 1;
        }

        .heading>a.self-link {
            font-size: 83%;
        }

        .example>a.self-link,
        .note>a.self-link,
        .issue>a.self-link {
            /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
            left: auto;
            right: 0;
        }

        li>a.self-link {
            left: calc(-1 * (3.5rem - 26px) - 2em);
        }

        dfn>a.self-link {
            top: auto;
            left: auto;
            opacity: 0;
            width: 1.5em;
            height: 1.5em;
            background: var(--selflink-bg);
            color: var(--selflink-text);
            font-style: normal;
            transition: opacity .2s, background-color .2s, color .2s;
        }

        dfn:hover>a.self-link {
            opacity: 1;
        }

        dfn>a.self-link:hover {
            color: var(--selflink-hover-text);
        }

        a.self-link::before {
            content: "¶";
        }

        .heading>a.self-link::before {
            content: "§";
        }

        dfn>a.self-link::before {
            content: "#";
        }
    </style>
    <style>
        /* style-syntax-highlighting */

        pre.idl.highlight {
            background: var(--borderedblock-bg, var(--def-bg));
        }

        code.highlight {
            padding: .1em;
            border-radius: .3em;
        }

        pre.highlight,
        pre>code.highlight {
            display: block;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
            border-radius: 0;
        }

        .highlight:not(.idl) {
            background: rgba(0, 0, 0, .03);
        }

        c-[a] {
            color: #990055
        }

        /* Keyword.Declaration */
        c-[b] {
            color: #990055
        }

        /* Keyword.Type */
        c-[c] {
            color: #708090
        }

        /* Comment */
        c-[d] {
            color: #708090
        }

        /* Comment.Multiline */
        c-[e] {
            color: #0077aa
        }

        /* Name.Attribute */
        c-[f] {
            color: #669900
        }

        /* Name.Tag */
        c-[g] {
            color: #222222
        }

        /* Name.Variable */
        c-[k] {
            color: #990055
        }

        /* Keyword */
        c-[l] {
            color: #000000
        }

        /* Literal */
        c-[m] {
            color: #000000
        }

        /* Literal.Number */
        c-[n] {
            color: #0077aa
        }

        /* Name */
        c-[o] {
            color: #999999
        }

        /* Operator */
        c-[p] {
            color: #999999
        }

        /* Punctuation */
        c-[s] {
            color: #a67f59
        }

        /* Literal.String */
        c-[t] {
            color: #a67f59
        }

        /* Literal.String.Single */
        c-[u] {
            color: #a67f59
        }

        /* Literal.String.Double */
        c-[cp] {
            color: #708090
        }

        /* Comment.Preproc */
        c-[c1] {
            color: #708090
        }

        /* Comment.Single */
        c-[cs] {
            color: #708090
        }

        /* Comment.Special */
        c-[kc] {
            color: #990055
        }

        /* Keyword.Constant */
        c-[kn] {
            color: #990055
        }

        /* Keyword.Namespace */
        c-[kp] {
            color: #990055
        }

        /* Keyword.Pseudo */
        c-[kr] {
            color: #990055
        }

        /* Keyword.Reserved */
        c-[ld] {
            color: #000000
        }

        /* Literal.Date */
        c-[nc] {
            color: #0077aa
        }

        /* Name.Class */
        c-[no] {
            color: #0077aa
        }

        /* Name.Constant */
        c-[nd] {
            color: #0077aa
        }

        /* Name.Decorator */
        c-[ni] {
            color: #0077aa
        }

        /* Name.Entity */
        c-[ne] {
            color: #0077aa
        }

        /* Name.Exception */
        c-[nf] {
            color: #0077aa
        }

        /* Name.Function */
        c-[nl] {
            color: #0077aa
        }

        /* Name.Label */
        c-[nn] {
            color: #0077aa
        }

        /* Name.Namespace */
        c-[py] {
            color: #0077aa
        }

        /* Name.Property */
        c-[ow] {
            color: #999999
        }

        /* Operator.Word */
        c-[mb] {
            color: #000000
        }

        /* Literal.Number.Bin */
        c-[mf] {
            color: #000000
        }

        /* Literal.Number.Float */
        c-[mh] {
            color: #000000
        }

        /* Literal.Number.Hex */
        c-[mi] {
            color: #000000
        }

        /* Literal.Number.Integer */
        c-[mo] {
            color: #000000
        }

        /* Literal.Number.Oct */
        c-[sb] {
            color: #a67f59
        }

        /* Literal.String.Backtick */
        c-[sc] {
            color: #a67f59
        }

        /* Literal.String.Char */
        c-[sd] {
            color: #a67f59
        }

        /* Literal.String.Doc */
        c-[se] {
            color: #a67f59
        }

        /* Literal.String.Escape */
        c-[sh] {
            color: #a67f59
        }

        /* Literal.String.Heredoc */
        c-[si] {
            color: #a67f59
        }

        /* Literal.String.Interpol */
        c-[sx] {
            color: #a67f59
        }

        /* Literal.String.Other */
        c-[sr] {
            color: #a67f59
        }

        /* Literal.String.Regex */
        c-[ss] {
            color: #a67f59
        }

        /* Literal.String.Symbol */
        c-[vc] {
            color: #0077aa
        }

        /* Name.Variable.Class */
        c-[vg] {
            color: #0077aa
        }

        /* Name.Variable.Global */
        c-[vi] {
            color: #0077aa
        }

        /* Name.Variable.Instance */
        c-[il] {
            color: #000000
        }

        /* Literal.Number.Integer.Long */
    </style>
    <style>
        /* style-var-click-highlighting */

        var {
            cursor: pointer;
        }

        var.selected0 {
            background-color: #F4D200;
            box-shadow: 0 0 0 2px #F4D200;
        }

        var.selected1 {
            background-color: #FF87A2;
            box-shadow: 0 0 0 2px #FF87A2;
        }

        var.selected2 {
            background-color: #96E885;
            box-shadow: 0 0 0 2px #96E885;
        }

        var.selected3 {
            background-color: #3EEED2;
            box-shadow: 0 0 0 2px #3EEED2;
        }

        var.selected4 {
            background-color: #EACFB6;
            box-shadow: 0 0 0 2px #EACFB6;
        }

        var.selected5 {
            background-color: #82DDFF;
            box-shadow: 0 0 0 2px #82DDFF;
        }

        var.selected6 {
            background-color: #FFBCF2;
            box-shadow: 0 0 0 2px #FFBCF2;
        }
    </style>

    <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD" rel="stylesheet">

<body class="h-entry">
    <div class="head">
        <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
        <h1 class="p-name no-ref" id="title">Web ロックス API</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#FPWD">W3C 初回公開作業草案</a>、<time class="dt-updated"
                datetime="2023-01-05">2023年1月5日</time></p>
        <details open>
            <summary>この文書の詳細情報</summary>
            <div data-fill-with="spec-metadata">
                <dl>
                    <dt>このバージョン:
                    <dd><a class="u-url"
                            href="https://www.w3.org/TR/2023/WD-web-locks-20230105/">https://www.w3.org/TR/2023/WD-web-locks-20230105/</a>
                    <dt>最新公表バージョン:
                    <dd><a href="https://www.w3.org/TR/web-locks/">https://www.w3.org/TR/web-locks/</a>
                    <dt>編集者草案:
                    <dd><a href="https://w3c.github.io/web-locks/">https://w3c.github.io/web-locks/</a>
                    <dt>履歴:
                    <dd><a class="u-url"
                            href="https://www.w3.org/standards/history/web-locks">https://www.w3.org/standards/history/web-locks</a>
                    <dt>テストスイート:
                    <dd><a
                            href="https://github.com/web-platform-tests/wpt/tree/master/web-locks">https://github.com/web-platform-tests/wpt/tree/master/web-locks</a>
                    <dt>フィードバック:
                    <dd><a href="https://github.com/w3c/web-locks/issues/">GitHub</a>
                    <dd><a href="#issues-index">仕様内インライン</a>
                    <dt class="editor">編集者:
                    <dd class="editor p-author h-card vcard" data-editor-id="61302"><a class="p-name fn u-email email"
                            href="mailto:jsbell@google.com">Joshua Bell</a> (<a class="p-org org"
                            href="https://google.com">Google Inc.</a>)
                    <dd class="editor p-author h-card vcard" data-editor-id="107856"><a class="p-name fn u-email email"
                            href="mailto:krosylight@mozilla.com">Kagami Rosylight</a> (<a class="p-org org"
                            href="https://www.mozilla.org/">Mozilla</a>)
                </dl>
            </div>
        </details>
        <div data-fill-with="warning"></div>
        <p class="copyright" data-fill-with="copyright"><a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2023 <a
                href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
                href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a
                href="https://www.ercim.eu/"><abbr
                    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a
                href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a
                href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a
                href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive
                document license</a> rules apply. </p>
        <hr title="Separator for header">
    </div>
    <div class="p-summary" data-fill-with="abstract">
        <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">概要</span></h2>
        <p>本書は、スクリプトがリソースに対して非同期的にロックを取得し、作業を行っている間ロックを保持し、その後解放することを可能にするウェブプラットフォームAPIを定義しています。ロックが保持されている間、同一オリジン内の他のスクリプトは同じリソースに対してロックを取得できません。これにより、ウェブアプリケーション内のコンテキスト（ウィンドウやワーカー）がリソースの利用を協調することができます。
        </p>
    </div>
    <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">この文書のステータス</span></h2>
    <div data-fill-with="status">
        <p> <em>このセクションは、本書の公開時点における文書のステータスについて説明しています。現在の<abbr title="World Wide Web Consortium">W3C</abbr>
                公開物の一覧と、最新の技術レポート改訂版は <a href="https://www.w3.org/TR/"><abbr
                        title="World Wide Web Consortium">W3C</abbr> 技術レポート索引</a>（https://www.w3.org/TR/）でご覧いただけます。</em>
        </p>
        <p> 本書は <a href="https://www.w3.org/groups/wg/webapps">Web Applications Working Group</a> により作業草案として公開されました。本書は
            <abbr title="World Wide Web Consortium">W3C</abbr> 勧告となることを意図しています。
        </p>
        <p></p>
        <p> 本書は <a href="https://www.w3.org/groups/wg/webapps">Web Applications Working Group</a> により、<a
                href="https://www.w3.org/2021/Process-20211102/#recs-and-notes">勧告トラック</a> を利用して初回公開作業草案として公開されました。

            この仕様へのフィードバックやコメントは歓迎します。<a href="https://github.com/w3c/web-locks/issues">GitHub issues</a> をご利用ください。過去の議論は
            <a href="https://lists.w3.org/Archives/Public/public-webapps/">public-webapps@w3.org アーカイブ</a> にてご参照いただけます。
        </p>
        <p> 初回公開作業草案としての公開は、<abbr title="World Wide Web Consortium">W3C</abbr>
            およびそのメンバーによる承認を意味するものではありません。本書は草案であり、随時更新・置換・廃止される場合があります。本書を進行中の作業以外として引用することは不適切です。</p>
        <p> 本書は、<a href="https://www.w3.org/Consortium/Patent-Policy-20200915/"><abbr
                    title="World Wide Web Consortium">W3C</abbr> 特許ポリシー</a>の下で活動するグループによって作成されました。<abbr
                title="World Wide Web Consortium">W3C</abbr> は、グループの成果物に関連して提出された <a
                href="https://www.w3.org/2004/01/pp-impl/114929/status" rel="disclosure">特許開示の公開リスト</a>
            を管理しています。そのページには特許開示方法の説明も記載されています。特許に関する実際の知識を持つ個人は、<a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#def-essential">必須クレーム</a>が含まれていると考える場合、<a
                href="https://www.w3.org/Consortium/Patent-Policy-20200915/#sec-Disclosure">W3C特許ポリシー第6節</a>に従って情報を開示しなければなりません。
        </p>
        <p>本書は <a href="https://www.w3.org/2021/Process-20211102/" id="w3c_process_revision">2021年11月2日 W3Cプロセス文書</a>
            に基づいて管理されています。</p>
    </div>
    <div data-fill-with="at-risk"></div>
    <nav data-fill-with="table-of-contents" id="toc">
        <h2 class="no-num no-toc no-ref" id="contents">目次</h2>
        <ol class="toc" role="directory">
            <li>
                <a href="#introduction"><span class="secno">1</span> <span class="content">導入</span></a>
                <ol class="toc">
                    <li><a href="#usage-overview"><span class="secno">1.1</span> <span class="content">利用概要</span></a>
                    <li><a href="#motivations"><span class="secno">1.2</span> <span
                                class="content">動機づけとなるユースケース</span></a>
                </ol>
            <li>
                <a href="#concepts"><span class="secno">2</span> <span class="content">概念</span></a>
                <ol class="toc">
                    <li><a href="#resource-names"><span class="secno">2.1</span> <span class="content">リソース名</span></a>
                    <li><a href="#lock-managers"><span class="secno">2.2</span> <span
                                class="content">ロックマネージャ</span></a>
                    <li><a href="#modes-scheduling"><span class="secno">2.3</span> <span
                                class="content">モードとスケジューリング</span></a>
                    <li><a href="#concept-lock"><span class="secno">2.4</span> <span class="content">ロック</span></a>
                    <li><a href="#concept-lock-request"><span class="secno">2.5</span> <span
                                class="content">ロック要求</span></a>
                    <li><a href="#termination-of-locks"><span class="secno">2.6</span> <span
                                class="content">ロックの終了</span></a>
                </ol>
            <li>
                <a href="#api"><span class="secno">3</span> <span class="content">API</span></a>
                <ol class="toc">
                    <li><a href="#navigator-mixins"><span class="secno">3.1</span> <span
                                class="content">Navigatorミックスイン</span></a>
                    <li>
                        <a href="#api-lock-manager"><span class="secno">3.2</span> <span class="content"><code
                                    class="idl"><span>LockManager</span></code> クラス</span></a>
                        <ol class="toc">
                            <li><a href="#api-lock-manager-request"><span class="secno">3.2.1</span> <span
                                        class="content"><code class="idl"><span>request()</span></code>
                                        メソッド</span></a>
                            <li><a href="#api-lock-manager-query"><span class="secno">3.2.2</span> <span
                                        class="content"><code class="idl"><span>query()</span></code>
                                        メソッド</span></a>
                        </ol>
                    <li><a href="#api-lock"><span class="secno">3.3</span> <span class="content"><code
                                    class="idl"><span>Lock</span></code> クラス</span></a>
                </ol>
            <li>
                <a href="#algorithms"><span class="secno">4</span> <span class="content">アルゴリズム</span></a>
                <ol class="toc">
                    <li><a href="#algorithm-request-lock"><span class="secno">4.1</span> <span
                                class="content">ロックの要求</span></a>
                    <li><a href="#algorithm-release-lock"><span class="secno">4.2</span> <span
                                class="content">ロックの解放</span></a>
                    <li><a href="#algorithm-abort-request"><span class="secno">4.3</span> <span
                                class="content">要求の中止</span></a>
                    <li><a href="#algorithm-process-request"><span class="secno">4.4</span> <span
                                class="content">指定されたリソース名のロック要求キューの処理</span></a>
                    <li><a href="#algorithm-snapshot-state"><span class="secno">4.5</span> <span
                                class="content">ロック状態のスナップショット</span></a>
                </ol>
            <li>
                <a href="#usage-considerations"><span class="secno">5</span> <span class="content">利用上の注意事項</span></a>
                <ol class="toc">
                    <li><a href="#deadlocks"><span class="secno">5.1</span> <span class="content">デッドロック</span></a>
                </ol>
            <li>
                <a href="#security-privacy"><span class="secno">6</span> <span
                        class="content">セキュリティとプライバシーに関する考慮事項</span></a>
                <ol class="toc">
                    <li><a href="#security-scope"><span class="secno">6.1</span> <span
                                class="content">ロックのスコープ</span></a>
                    <li><a href="#private-browsing"><span class="secno">6.2</span> <span
                                class="content">プライベートブラウジング</span></a>
                    <li><a href="#implementation-risks"><span class="secno">6.3</span> <span
                                class="content">実装リスク</span></a>
                    <li><a href="#security-privacy-checklist"><span class="secno">6.4</span> <span
                                class="content">チェックリスト</span></a>
                </ol>
            <li><a href="#acknowledgements"><span class="secno">7</span> <span class="content">謝辞</span></a>
            <li>
                <a href="#w3c-conformance"><span class="secno"></span> <span class="content">適合性</span></a>
                <ol class="toc">
                    <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">文書の規約</span></a>
                    <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span
                                class="content">適合アルゴリズム</span></a>
                </ol>
            <li>
                <a href="#index"><span class="secno"></span> <span class="content">索引</span></a>
                <ol class="toc">
                    <li><a href="#index-defined-here"><span class="secno"></span> <span
                                class="content">本仕様書で定義されている用語</span></a>
                    <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span
                                class="content">参照によって定義された用語</span></a>
                </ol>
            <li>
                <a href="#references"><span class="secno"></span> <span class="content">参考文献</span></a>
                <ol class="toc">
                    <li><a href="#normative"><span class="secno"></span> <span class="content">規範参考文献</span></a>
                    <li><a href="#informative"><span class="secno"></span> <span class="content">参考情報</span></a>
                </ol>
            <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL索引</span></a>
            <li><a href="#issues-index"><span class="secno"></span> <span class="content">課題索引</span></a>
        </ol>
    </nav>
    <main>
        <p><img alt="logo" height="100" id="speclogo" src="https://www.w3.org/TR/web-locks/logo-lock.svg" width="100">
        </p>
        <script>
            (function () {
                const logo = document.querySelector('.logo');
                if (logo) logo.appendChild(document.querySelector('#speclogo'));
            })();
        </script>
        <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span
                class="content">導入</span><a class="self-link" href="#introduction"></a></h2>
        <p><em>このセクションは規範的ではありません。</em></p>
        <p><a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request">ロック要求</a>は、スクリプトによって特定の<a
                data-link-type="dfn" href="#resource-name" id="ref-for-resource-name">リソース名</a>と<a data-link-type="dfn"
                href="#mode" id="ref-for-mode">モード</a>に対して行われます。スケジューリングアルゴリズムは、現在および過去の要求の状態を見て、最終的にロック要求を付与します。<a
                data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept">ロック</a>は付与された要求であり、<a
                data-link-type="dfn" href="#resource-name" id="ref-for-resource-name①">リソース名</a>と<a data-link-type="dfn"
                href="#mode"
                id="ref-for-mode①">モード</a>を持ちます。これはスクリプトに返されるオブジェクトとして表現されます。ロックが保持されている限り（名前やモードによっては）他のロック要求が付与されない可能性があります。ロックはスクリプトによって解放することができ、解放されると他のロック要求が付与される場合があります。
        </p>
        <p>このAPIは必要に応じて利用できるオプション機能を提供します：</p>
        <ul>
            <li data-md>
                <p>非同期タスクから値を返すこと、</p>
            <li data-md>
                <p>共有および排他的ロックモード、</p>
            <li data-md>
                <p>条件付き取得、</p>
            <li data-md>
                <p>ロックの状態の診断用クエリ、</p>
            <li data-md>
                <p>デッドロックを防ぐためのエスケープ手段。</p>
        </ul>
        <p>協調的な調整は、<a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent">エージェント</a>が<a
                data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket"
                id="ref-for-storage-bucket">ストレージバケット</a>を共有する範囲内で行われます。これは複数の<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism"
                id="ref-for-integration-with-the-javascript-agent-cluster-formalism">エージェントクラスタ</a>にまたがる場合があります。</p>
        <aside class="note"> <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent"
                id="ref-for-agent①">エージェント</a>は概ねウィンドウ（タブ）、iframe、ワーカーに対応します。<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism"
                id="ref-for-integration-with-the-javascript-agent-cluster-formalism①">エージェントクラスタ</a>は、一部のユーザーエージェント実装では独立したプロセスに対応します。
        </aside>
        <h3 class="heading settled" data-level="1.1" id="usage-overview"><span class="secno">1.1. </span><span
                class="content">利用概要</span><a class="self-link" href="#usage-overview"></a></h3>
        <p>APIの利用方法は以下の通りです：</p>
        <ol>
            <li data-md>
                <p>ロックを要求します。</p>
            <li data-md>
                <p>非同期タスクでロックを保持したまま作業を行います。</p>
            <li data-md>
                <p>タスクが完了するとロックは自動的に解放されます。</p>
        </ol>
        <aside class="example" id="example-basic-usage">
            <a class="self-link" href="#example-basic-usage"></a>
            <p>APIの基本的な利用例は次の通りです：</p>
            <pre class="language-js highlight">navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'my_resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
   <c- c1>// ロックが取得されました。</c->
   <c- k>await</c-> do_something<c- p>();</c->
   <c- k>await</c-> do_something_else<c- p>();</c->
   <c- c1>// ここでロックが解放されます。</c->
<c- p>});</c->
</pre>
            <p>非同期関数内では、ロック要求自体をawaitできます：</p>
            <pre class="language-js highlight"><c- c1>// ロック要求前。</c->
<c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'my_resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
   <c- c1>// ロックが取得されました。</c->
   <c- k>await</c-> do_something<c- p>();</c->
   <c- c1>// ここでロックが解放されます。</c->
<c- p>});</c->
<c- c1>// ロック解放後</c->
</pre>
        </aside>
        <h3 class="heading settled" data-level="1.2" id="motivations"><span class="secno">1.2. </span><span
                class="content">動機づけとなるユースケース</span><a class="self-link" href="#motivations"></a></h3>
        <p>ウェブベースのドキュメントエディタは、高速アクセスのために状態をメモリに保持し、変更を（レコードの一連として）<a data-link-type="biblio" href="#biblio-indexeddb-2"
                title="Indexed Database API 2.0">Indexed Database
                API</a>などのストレージAPIに永続化して耐障害性やオフライン利用を実現し、サーバーにも保存して複数デバイス間で利用できるようにします。同じドキュメントが2つのタブで編集のために開かれている場合、どちらか一方だけがドキュメントの変更や同期を行えるように、タブ間で作業を協調する必要があります。これには、どちらがアクティブに変更（およびストレージAPIとの状態同期）を行うかを調整し、アクティブなタブが離脱（ナビゲート、閉じる、クラッシュ）した際に他のタブがアクティブになれるよう把握する必要があります。
        </p>
        <p>データ同期サービスでは、「プライマリタブ」が指定されます。このタブだけが特定の操作（ネットワーク同期、キュー済みデータのクリーンアップなど）を実行します。プライマリタブはロックを保持し続け、決して解放しません。他のタブはロックの取得を試み、その試みはキューされます。「プライマリタブ」がクラッシュしたり閉じられたりすると、他のタブのいずれかがロックを取得して新しいプライマリとなります。
        </p>
        <p><a data-link-type="biblio" href="#biblio-indexeddb-2" title="Indexed Database API 2.0">Indexed Database
                API</a>は、オリジン内の複数の名前付きストレージパーティション間で共有読み取りと排他的書き込みアクセスを可能にするトランザクションモデルを定義しています。この概念をプリミティブとして公開すれば、リソースの利用可能性に基づいて任意のWebプラットフォームの活動をスケジューリングでき、例えば他のストレージ型（Cache
            <a data-link-type="biblio" href="#biblio-service-workers"
                title="Service Workers">[Service-Workers]</a>など）やストレージ型をまたいだトランザクションの合成、さらには非ストレージAPI（例えばネットワークフェッチ）にも応用できます。
        </p>
        <h2 class="heading settled" data-level="2" id="concepts"><span class="secno">2. </span><span
                class="content">概念</span><a class="self-link" href="#concepts"></a></h2>
        <p>本仕様においては、以下の通りとします：</p>
        <ul>
            <li data-md>
                <p>ブラウザ内の個別ユーザープロファイルは、それぞれ別のユーザーエージェントとみなされます。</p>
            <li data-md>
                <p>各 <a href="https://github.com/w3ctag/private-mode">プライベートモード</a>の閲覧セッションは、別個のユーザーエージェントとみなされます。</p>
        </ul>
        <p><a data-link-type="dfn" href="https://www.w3.org/TR/CSS2/conform.html#user-agent"
                id="ref-for-user-agent">ユーザーエージェント</a>は、<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="lock-task-queue">ロックタスクキュー</dfn>を持ち、これは<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue"
                id="ref-for-starting-a-new-parallel-queue">新しい並列キューの開始</a>の結果です。</p>
        <p>以下にエンキューされる<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source"
                id="ref-for-task-source">タスクソース</a>は、<dfn data-dfn-type="dfn" data-export
                id="web-locks-tasks-source">Web Locksタスクソース<a class="self-link"
                    href="#web-locks-tasks-source"></a></dfn>です。</p>
        <h3 class="heading settled" data-level="2.1" id="resource-names"><span class="secno">2.1. </span><span
                class="content">リソース名</span><a class="self-link" href="#resource-names"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="resource-name">リソース名</dfn>は、Webアプリケーションが抽象的なリソースを表すために選択する<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#string" id="ref-for-string">JavaScript文字列</a>です。</p>
        <p>リソース名はスケジューリングアルゴリズム以外には外部的な意味を持たず、<a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent"
                id="ref-for-agent②">agent</a> が同じ <a data-link-type="dfn"
                href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket①">storage bucket</a>
            を共有する場合にグローバルです。Webアプリケーションは、任意のリソース命名規則を自由に使用できます。</p>
        <aside class="example" id="example-indexeddb-transactions">
            <a class="self-link" href="#example-indexeddb-transactions"></a> <a data-link-type="biblio"
                href="#biblio-indexeddb-2"
                title="Indexed Database API 2.0">[IndexedDB-2]</a>の名前付きデータベース内の名前付きストアに対するトランザクションロックを模倣するために、スクリプトは以下のようにリソース名を構成することがあります：
            <pre class="language-js highlight">encodeURIComponent<c- p>(</c->db_name<c- p>)</c-> <c- o>+</c-> <c- t>'/'</c-> <c- o>+</c-> encodeURIComponent<c- p>(</c->store_name<c- p>)</c->
</pre>
        </aside>
        <p>U+002D HYPHEN-MINUS (-)で始まるリソース名は予約されており、これらを要求すると例外が発生します。</p>
        <h3 class="heading settled" data-level="2.2" id="lock-managers"><span class="secno">2.2. </span><span
                class="content">ロックマネージャ</span><a class="self-link" href="#lock-managers"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-manager">ロックマネージャ</dfn>は、<a
                data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①">ロック</a>と<a data-link-type="dfn"
                href="#lock-request" id="ref-for-lock-request①">ロック要求</a>の状態をカプセル化します。各<a data-link-type="dfn"
                href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket②">ストレージバケット</a>は、Web
            Locks API用に関連付けられた<a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bottle"
                id="ref-for-storage-bottle">ストレージボトル</a>を通じて1つの<a data-link-type="dfn" href="#lock-manager"
                id="ref-for-lock-manager">ロックマネージャ</a>を含みます。</p>
        <p class="note" role="note"><span>注:</span> 同じユーザーエージェント内で開かれた<a data-link-type="dfn"
                href="https://storage.spec.whatwg.org/#storage-bucket"
                id="ref-for-storage-bucket③">ストレージバケット</a>を共有するページやワーカー（<a data-link-type="dfn"
                href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent③">エージェント</a>）は、<a data-link-type="dfn"
                href="#lock-manager" id="ref-for-lock-manager①">ロックマネージャ</a>を共有します。たとえそれらが無関係な<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context"
                id="ref-for-browsing-context">ブラウジングコンテキスト</a>であってもです。</p>
        <div class="algorithm" data-algorithm="obtain a lock manager">
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="obtain-a-lock-manager">ロックマネージャを取得する</dfn>には、<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object">環境設定オブジェクト</a> <var>environment</var>を与えて、次の手順を実行します：
            <ol>
                <li data-md>
                    <p><var>map</var>を、<var>environment</var>と"<code>web-locks</code>"を与えて<a data-link-type="dfn"
                            href="https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map"
                            id="ref-for-obtain-a-local-storage-bottle-map">ローカルストレージボトルマップの取得</a>を実行した結果とします。</p>
                <li data-md>
                    <p><var>map</var>が失敗なら、失敗を返します。</p>
                <li data-md>
                    <p><var>bottle</var>を<var>map</var>の関連付けられた<a data-link-type="dfn"
                            href="https://storage.spec.whatwg.org/#storage-bottle"
                            id="ref-for-storage-bottle①">ストレージボトル</a>とします。</p>
                <li data-md>
                    <p><var>bottle</var>の関連付けられた<a data-link-type="dfn" href="#lock-manager"
                            id="ref-for-lock-manager②">ロックマネージャ</a>を返します。</p>
            </ol>
        </div>
        <p class="issue" id="issue-73644ca1"><a class="self-link" href="#issue-73644ca1"></a> ここで<a
                data-link-type="biblio" href="#biblio-storage"
                title="Storage Standard">[Storage]</a>との統合方法を調整してください。与えられた環境からロックマネージャを正しく取得する方法も含みます。</p>
        <h3 class="heading settled" data-level="2.3" id="modes-scheduling"><span class="secno">2.3. </span><span
                class="content">モードとスケジューリング</span><a class="self-link" href="#modes-scheduling"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="mode">モード</dfn>は、"<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive">exclusive</a></code>"
            または"<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared">shared</a></code>"のいずれかです。モードは一般的な<a
                href="https://ja.wikipedia.org/wiki/%E8%AA%AD%E3%81%BF%E6%89%8B%E3%83%BB%E6%9B%B8%E3%81%8D%E6%89%8B%E3%83%AD%E3%83%83%E3%82%AF">読取・書込ロック</a>パターンをモデル化できます。"<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive①">exclusive</a></code>"ロックが保持されている場合、その名前の他のロックは付与されません。"<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared①">shared</a></code>"ロックが保持されている場合、その名前の他の"<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared②">shared</a></code>"ロックは付与できますが、"<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive②">exclusive</a></code>"ロックは付与できません。APIのデフォルトモードは"<code
                class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive③">exclusive</a></code>"です。
        </p>
        <p>追加のプロパティ（タイムアウト、公平性など）がスケジューリングに影響する場合があります。</p>
        <h3 class="heading settled" data-level="2.4" id="concept-lock"><span class="secno">2.4. </span><span
                class="content">ロック</span><a class="self-link" href="#concept-lock"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="lock-concept" data-noexport
                id="lock-concept">ロック</dfn>は、共有リソースへの排他的アクセスを表します。</p>
        <div>
            <p><a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept②">ロック</a>は、<dfn class="dfn-paneled"
                    data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-agent">agent</dfn>（<a
                    data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent"
                    id="ref-for-agent④">エージェント</a>）を持ちます。</p>
            <p><a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept③">ロック</a>は、<dfn class="dfn-paneled"
                    data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-clientid">clientId</dfn>（不透明な文字列）を持ちます。</p>
            <p><a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept④">ロック</a>は、<dfn class="dfn-paneled"
                    data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-manager">manager</dfn>（<a data-link-type="dfn" href="#lock-manager"
                    id="ref-for-lock-manager③">ロックマネージャ</a>）を持ちます。</p>
            <p><a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑤">ロック</a>は、<dfn class="dfn-paneled"
                    data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport id="lock-concept-name">name</dfn>（<a
                    data-link-type="dfn" href="#resource-name" id="ref-for-resource-name②">リソース名</a>）を持ちます。</p>
            <p><a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑥">ロック</a>は、<dfn class="dfn-paneled"
                    data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-mode">mode</dfn>（"<code
                    class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive④">exclusive</a></code>"または"<code
                    class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared③">shared</a></code>"）を持ちます。
            </p>
            <p><a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑦">ロック</a>は、<dfn class="dfn-paneled"
                    data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-waiting-promise">waiting promise</dfn>（Promise）を持ちます。</p>
            <p><a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑧">ロック</a>は、<dfn class="dfn-paneled"
                    data-dfn-for="lock-concept" data-dfn-type="dfn" data-noexport
                    id="lock-concept-released-promise">released promise</dfn>（Promise）を持ちます。</p>
            <aside class="note">
                ロックのライフサイクルには2つのPromiseが関連しています：
                <ul>
                    <li data-md>
                        <p>ロックが付与された際、コールバック経由で暗黙的または明示的に提供されるPromiseで、ロックが保持される期間を決定します。このPromiseが解決されるとロックが解放されます。これがロックの<a
                                data-link-type="dfn" href="#lock-concept-waiting-promise"
                                id="ref-for-lock-concept-waiting-promise">waiting promise</a>です。</p>
                    <li data-md>
                        <p><code
                                class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager">LockManager</a></code>の
                            <code
                                class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request">request()</a></code>
                            メソッドによって返され、ロックが解放されるか要求が中止された時に解決されるPromiseです。これがロックの<a data-link-type="dfn"
                                href="#lock-concept-released-promise"
                                id="ref-for-lock-concept-released-promise">released promise</a>です。
                        </p>
                </ul>
                <pre class="language-js highlight"><c- a>const</c-> p1 <c- o>=</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- a>const</c-> p2 <c- o>=</c-> <c- ow>new</c-> Promise<c- p>(</c->r <c- p>=></c-> <c- p>{</c->
    <c- c1>// ロックを利用し、Promiseを解決するロジック...</c->
  <c- p>});</c->
  <c- k>return</c-> p2<c- p>;</c->
<c- p>});</c->
</pre>
                <p>上記例では、<code>p1</code>が<a data-link-type="dfn" href="#lock-concept-released-promise"
                        id="ref-for-lock-concept-released-promise①">released promise</a>、<code>p2</code>が<a
                        data-link-type="dfn" href="#lock-concept-waiting-promise"
                        id="ref-for-lock-concept-waiting-promise①">waiting promise</a>です。
                    多くのコードではコールバックが<code>async</code>関数となり、返されるPromiseは暗黙的となります。以下の例のように：</p>
                <pre class="language-js highlight"><c- a>const</c-> p1 <c- o>=</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- c1>// ロックを利用するロジック...</c->
<c- p>});</c->
</pre>
                <p>この場合、<a data-link-type="dfn" href="#lock-concept-waiting-promise"
                        id="ref-for-lock-concept-waiting-promise②">waiting
                        promise</a>はコード上で名前付けされませんが、匿名<code>async</code>コールバックの返り値として存在します。
                    また、コールバックが<code>async</code>でなくPromise以外を返す場合は、返り値は即座に解決されるPromiseとしてラップされます。ロックは次のマイクロタスクで解放され、<a
                        data-link-type="dfn" href="#lock-concept-released-promise"
                        id="ref-for-lock-concept-released-promise②">released promise</a>も次のマイクロタスクで解決されます。</p>
            </aside>
            <p>各<a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager④">ロックマネージャ</a>は、<dfn
                    class="dfn-paneled" data-dfn-for="lock manager" data-dfn-type="dfn" data-noexport
                    id="lock-manager-held-lock-set">保持ロック集合</dfn>（<a data-link-type="dfn"
                    href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">順序付きセット</a>）を持ち、それは<a
                    data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept⑨">ロック</a>の集合です。</p>
            <div class="algorithm" data-algorithm="waiting promise settles">
                <p><a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⓪">ロック</a>
                    <var>lock</var>の<a data-link-type="dfn" href="#lock-concept-waiting-promise"
                        id="ref-for-lock-concept-waiting-promise③">waiting promise</a>が解決（fulfillまたはreject）されたとき、<a
                        data-link-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                        id="ref-for-enqueue-the-following-steps①">以下の手順をロックタスクキューにエンキューする</a>：
                </p>
                <ol>
                    <li data-md>
                        <p><a data-link-type="dfn" href="#release-the-lock" id="ref-for-release-the-lock">ロックを解放する</a>
                            <var>lock</var>。
                        </p>
                    <li data-md>
                        <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                id="ref-for-resolve">解決する</a> <var>lock</var>の<a data-link-type="dfn"
                                href="#lock-concept-released-promise"
                                id="ref-for-lock-concept-released-promise③">released promise</a>に、<var>lock</var>の<a
                                data-link-type="dfn" href="#lock-concept-waiting-promise"
                                id="ref-for-lock-concept-waiting-promise④">waiting promise</a>を与える。
                        </p>
                </ol>
            </div>
        </div>
        <h3 class="heading settled" data-level="2.5" id="concept-lock-request"><span class="secno">2.5. </span><span
                class="content">ロック要求</span><a class="self-link" href="#concept-lock-request"></a></h3>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-request">ロック要求</dfn>は、
            保留中の<a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①①">ロック</a>の要求を表します。
        </p>
        <div>
            <p><a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request②">ロック要求</a>は、
                <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">構造体</a>であり、
                <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item"
                    id="ref-for-struct-item">項目</a>
                <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-agent">agent</dfn>、
                <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-clientid">clientId</dfn>、
                <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-manager">manager</dfn>、
                <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-name">name</dfn>、
                <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-mode">mode</dfn>、
                <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-callback">callback</dfn>、
                <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-promise">promise</dfn>、
                <dfn class="dfn-paneled" data-dfn-for="lock request" data-dfn-type="dfn" data-noexport
                    id="lock-request-signal">signal</dfn>
                を持ちます。
            </p>
        </div>
        <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="lock-request-queue">ロック要求キュー</dfn>は、
            <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue" id="ref-for-queue">キュー</a>であり、
            <a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request③">ロック要求</a>のキューです。
        </p>
        <p>各<a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager⑤">ロックマネージャ</a>は、
            <dfn class="dfn-paneled" data-dfn-for="lock manager" data-dfn-type="dfn" data-noexport
                id="lock-manager-lock-request-queue-map">ロック要求キュー・マップ</dfn>を持ちます。
            これは<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map"
                id="ref-for-ordered-map">マップ</a>であり、
            <a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name③">リソース名</a>から
            <a data-link-type="dfn" href="#lock-request-queue" id="ref-for-lock-request-queue">ロック要求キュー</a>への対応を持ちます。
        </p>
        <div class="algorithm" data-algorithm="get the lock request queue">
            <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="get-the-lock-request-queue">ロック要求キューを取得する</dfn>には、
                <a data-link-type="dfn" href="#lock-manager-lock-request-queue-map"
                    id="ref-for-lock-manager-lock-request-queue-map">ロック要求キュー・マップ</a> <var>queueMap</var>から
                <a data-link-type="dfn" href="#resource-name" id="ref-for-resource-name④">リソース名</a>
                <var>name</var>に対して、以下の手順を実行します：
            </p>
            <ol>
                <li data-md>
                    <p>もし<var>queueMap</var>[<var>name</var>]が<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">存在しない</a>場合、
                        <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set"
                            id="ref-for-map-set">設定</a>し、<var>queueMap</var>[<var>name</var>]に新しい空の
                        <a data-link-type="dfn" href="#lock-request-queue"
                            id="ref-for-lock-request-queue①">ロック要求キュー</a>を割り当てます。
                    </p>
                <li data-md>
                    <p><var>queueMap</var>[<var>name</var>]を返します。</p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="grantable">
            <p><a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request④">ロック要求</a> <var>request</var>が
                <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="grantable">付与可能</dfn>かどうかは、以下の手順がtrueを返す場合です：
            </p>
            <ol>
                <li data-md>
                    <p><var>manager</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-request-manager"
                            id="ref-for-lock-request-manager">manager</a>とします。</p>
                <li data-md>
                    <p><var>queueMap</var>を<var>manager</var>の<a data-link-type="dfn"
                            href="#lock-manager-lock-request-queue-map"
                            id="ref-for-lock-manager-lock-request-queue-map①">ロック要求キュー・マップ</a>とします。</p>
                <li data-md>
                    <p><var>name</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-request-name"
                            id="ref-for-lock-request-name">name</a>とします。</p>
                <li data-md>
                    <p><var>queue</var>を、<a data-link-type="dfn" href="#get-the-lock-request-queue"
                            id="ref-for-get-the-lock-request-queue">ロック要求キューの取得</a>を
                        <var>queueMap</var>と<var>name</var>に対して実行した結果とします。
                    </p>
                <li data-md>
                    <p><var>held</var>を<var>manager</var>の<a data-link-type="dfn" href="#lock-manager-held-lock-set"
                            id="ref-for-lock-manager-held-lock-set">保持ロック集合</a>とします。</p>
                <li data-md>
                    <p><var>mode</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-request-mode"
                            id="ref-for-lock-request-mode">mode</a>とします。</p>
                <li data-md>
                    <p>もし<var>queue</var>が<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty"
                            id="ref-for-list-is-empty">空でない</a>かつ
                        <var>request</var>が<var>queue</var>の最初の<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#list-item"
                            id="ref-for-list-item">項目</a>でない場合、falseを返します。
                    </p>
                <li data-md>
                    <p>もし<var>mode</var>が"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑤">exclusive</a></code>"の場合、
                        <var>held</var>内のいずれの<a data-link-type="dfn" href="#lock-concept"
                            id="ref-for-lock-concept①②">ロック</a>も
                        <a data-link-type="dfn" href="#lock-concept-name"
                            id="ref-for-lock-concept-name">name</a>が<var>name</var>と等しくなければtrue、そうでなければfalseを返します。
                    </p>
                <li data-md>
                    <p>それ以外の場合、<var>mode</var>は"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared④">shared</a></code>"です。
                        <var>held</var>内のいずれの<a data-link-type="dfn" href="#lock-concept"
                            id="ref-for-lock-concept①③">ロック</a>も
                        <a data-link-type="dfn" href="#lock-concept-mode" id="ref-for-lock-concept-mode">mode</a>が"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑥">exclusive</a></code>"であり、
                        かつ<a data-link-type="dfn" href="#lock-concept-name"
                            id="ref-for-lock-concept-name①">name</a>が<var>name</var>と等しくなければtrue、そうでなければfalseを返します。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="2.6" id="termination-of-locks"><span class="secno">2.6. </span><span
                class="content">ロックの終了</span><a class="self-link" href="#termination-of-locks"></a></h3>
        <p><a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps"
                id="ref-for-unloading-document-cleanup-steps">ドキュメントアンロード時クリーンアップ手順</a>が
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document"
                id="ref-for-concept-document">document</a>に対して実行された場合、
            その<a data-link-type="dfn" href="#terminate-remaining-locks-and-requests"
                id="ref-for-terminate-remaining-locks-and-requests">残りのロックと要求の終了</a>を
            その<a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent⑤">agent</a>で実行します。
        </p>
        <p><a data-link-type="dfn" href="https://tc39.github.io/ecma262/#agent" id="ref-for-agent⑥">agent</a>が終了した場合、
            <a data-link-type="dfn" href="#terminate-remaining-locks-and-requests"
                id="ref-for-terminate-remaining-locks-and-requests①">残りのロックと要求の終了</a>を
            そのagentで実行します。
        </p>
        <p class="issue" id="issue-9062c3e0"><a class="self-link" href="#issue-9062c3e0"></a>
            これは現在ワーカーのみを対象としており、ワーカー終了時に手順を実行する規範的な方法がないため定義が曖昧です。</p>
        <div class="algorithm" data-algorithm="terminate remaining locks and requests">
            <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                    id="terminate-remaining-locks-and-requests">残りのロックと要求の終了</dfn>を
                <var>agent</var>で実行するには、<a data-link-type="dfn"
                    href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                    id="ref-for-enqueue-the-following-steps②">以下の手順をロックタスクキューにエンキューします：</a>
            </p>
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="#lock-request" id="ref-for-lock-request⑤">ロック要求</a>
                        <var>request</var>のうち、<a data-link-type="dfn" href="#lock-request-agent"
                            id="ref-for-lock-request-agent">agent</a>が<var>agent</var>に等しいものについて：
                    </p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#abort-the-request"
                                    id="ref-for-abort-the-request">要求の中止</a>を<var>request</var>に対して実行します。</p>
                    </ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①④">ロック</a>
                        <var>lock</var>のうち、<a data-link-type="dfn" href="#lock-concept-agent"
                            id="ref-for-lock-concept-agent">agent</a>が<var>agent</var>に等しいものについて：
                    </p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#release-the-lock"
                                    id="ref-for-release-the-lock①">ロックの解放</a>を<var>lock</var>に対して実行します。</p>
                    </ol>
            </ol>
        </div>
        <h2 class="heading settled" data-level="3" id="api"><span class="secno">3. </span><span
                class="content">API</span><a class="self-link" href="#api"></a></h2>
        <h3 class="heading settled" data-level="3.1" id="navigator-mixins"><span class="secno">3.1. </span><span
                class="content">Navigatorミックスイン</span><a class="self-link" href="#navigator-mixins"></a></h3>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="navigatorlocks"><code><c- g>NavigatorLocks</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#lockmanager" id="ref-for-lockmanager①"><c- n>LockManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockManager" href="#dom-navigatorlocks-locks" id="ref-for-dom-navigatorlocks-locks"><c- g>locks</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks" id="ref-for-navigatorlocks"><c- n>NavigatorLocks</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator" id="ref-for-workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks" id="ref-for-navigatorlocks①"><c- n>NavigatorLocks</c-></a>;
</pre>
        <p>各<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"
                id="ref-for-environment-settings-object①">environment settings object</a>は
            <code
                class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager②">LockManager</a></code>オブジェクトを持ちます。
        </p>
        <div class="mdn-anno wrapped">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="この機能はすべての現行エンジンに搭載されています。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/ja/docs/Web/API/Navigator/locks"
                        title="Navigatorインターフェースのlocks読み取り専用プロパティは、LockManagerオブジェクトを返します。このLockManagerは新しいLockオブジェクトの要求や既存のLockオブジェクトのクエリメソッドを提供します。">Navigator/locks</a>
                </p>
                <p class="all-engines-text">すべての現行エンジンで利用可能です。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96以上</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4以上</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69以上</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79以上</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (レガシー)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>利用不可</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="NavigatorLocks" data-dfn-type="attribute" data-export
                id="dom-navigatorlocks-locks"><code>locks</code></dfn>ゲッターの手順は
            <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>の
            <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                id="ref-for-relevant-settings-object">relevant settings object</a>が持つ
            <code
                class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager③">LockManager</a></code>オブジェクトを返します。
        </p>
        <h3 class="heading settled" data-level="3.2" id="api-lock-manager"><span class="secno">3.2. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager④">LockManager</a></code>
                クラス</span><a class="self-link" href="#api-lock-manager"></a></h3>
        <div class="mdn-anno wrapped after">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="この機能はすべての現行エンジンに搭載されています。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/ja/docs/Web/API/LockManager"
                        title="Web Locks APIのLockManagerインターフェースは、新しいLockオブジェクトの要求や既存Lockオブジェクトのクエリメソッドを提供します。LockManagerのインスタンスはnavigator.locksで取得できます。">LockManager</a>
                </p>
                <p class="all-engines-text">すべての現行エンジンで利用可能です。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96以上</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4以上</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69以上</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79以上</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (レガシー)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>利用不可</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="lockmanager"><code><c- g>LockManager</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request①"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-callback-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-lockmanager-request-name-callback-name"></a></dfn>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback" id="ref-for-callbackdef-lockgrantedcallback"><c- n>LockGrantedCallback</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-callback-callback"><code><c- g>callback</c-></code><a class="self-link" href="#dom-lockmanager-request-name-callback-callback"></a></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request-name-options-callback" id="ref-for-dom-lockmanager-request-name-options-callback"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, options, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-options-callback-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-lockmanager-request-name-options-callback-name"></a></dfn>,
                       <a data-link-type="idl-name" href="#dictdef-lockoptions" id="ref-for-dictdef-lockoptions"><c- n>LockOptions</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, options, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-options-callback-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-lockmanager-request-name-options-callback-options"></a></dfn>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback" id="ref-for-callbackdef-lockgrantedcallback①"><c- n>LockGrantedCallback</c-></a> <dfn class="idl-code" data-dfn-for="LockManager/request(name, options, callback)" data-dfn-type="argument" data-export id="dom-lockmanager-request-name-options-callback-callback"><code><c- g>callback</c-></code><a class="self-link" href="#dom-lockmanager-request-name-options-callback-callback"></a></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockmanagersnapshot" id="ref-for-dictdef-lockmanagersnapshot"><c- n>LockManagerSnapshot</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query"><c- g>query</c-></a>();
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-lockgrantedcallback"><code><c- g>LockGrantedCallback</c-></code></dfn> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise③"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a>> (<a data-link-type="idl-name" href="#lock" id="ref-for-lock"><c- n>Lock</c-></a>? <dfn class="idl-code" data-dfn-for="LockGrantedCallback" data-dfn-type="argument" data-export id="dom-lockgrantedcallback-lock"><code><c- g>lock</c-></code><a class="self-link" href="#dom-lockgrantedcallback-lock"></a></dfn>);

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-lockmode"><code><c- g>LockMode</c-></code></dfn> { <dfn class="dfn-paneled idl-code" data-dfn-for="LockMode" data-dfn-type="enum-value" data-export id="dom-lockmode-shared"><code><c- s>"shared"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="LockMode" data-dfn-type="enum-value" data-export id="dom-lockmode-exclusive"><code><c- s>"exclusive"</c-></code></dfn> };

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-lockoptions"><code><c- g>LockOptions</c-></code></dfn> {
  <a data-link-type="idl-name" href="#enumdef-lockmode" id="ref-for-enumdef-lockmode"><c- n>LockMode</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;exclusive&quot;" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="LockMode " id="dom-lockoptions-mode"><code><c- g>mode</c-></code></dfn> = "exclusive";
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-lockoptions-ifavailable"><code><c- g>ifAvailable</c-></code></dfn> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-lockoptions-steal"><code><c- g>steal</c-></code></dfn> = <c- b>false</c->;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal"><c- n>AbortSignal</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="LockOptions" data-dfn-type="dict-member" data-export data-type="AbortSignal " id="dom-lockoptions-signal"><code><c- g>signal</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-lockmanagersnapshot"><code><c- g>LockManagerSnapshot</c-></code></dfn> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo" id="ref-for-dictdef-lockinfo"><c- n>LockInfo</c-></a>> <dfn class="idl-code" data-dfn-for="LockManagerSnapshot" data-dfn-type="dict-member" data-export data-type="sequence<LockInfo> " id="dom-lockmanagersnapshot-held"><code><c- g>held</c-></code><a class="self-link" href="#dom-lockmanagersnapshot-held"></a></dfn>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo" id="ref-for-dictdef-lockinfo①"><c- n>LockInfo</c-></a>> <dfn class="idl-code" data-dfn-for="LockManagerSnapshot" data-dfn-type="dict-member" data-export data-type="sequence<LockInfo> " id="dom-lockmanagersnapshot-pending"><code><c- g>pending</c-></code><a class="self-link" href="#dom-lockmanagersnapshot-pending"></a></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-lockinfo"><code><c- g>LockInfo</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockInfo" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-lockinfo-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-lockinfo-name"></a></dfn>;
  <a data-link-type="idl-name" href="#enumdef-lockmode" id="ref-for-enumdef-lockmode①"><c- n>LockMode</c-></a> <dfn class="idl-code" data-dfn-for="LockInfo" data-dfn-type="dict-member" data-export data-type="LockMode " id="dom-lockinfo-mode"><code><c- g>mode</c-></code><a class="self-link" href="#dom-lockinfo-mode"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="LockInfo" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-lockinfo-clientid"><code><c- g>clientId</c-></code><a class="self-link" href="#dom-lockinfo-clientid"></a></dfn>;
};
</pre>
        <p><code
                class="idl"><a data-link-type="idl" href="#lockmanager" id="ref-for-lockmanager⑤">LockManager</a></code>のインスタンスは、スクリプトから<a
                data-link-type="dfn" href="#lock-request" id="ref-for-lock-request⑥">ロック要求</a>を行ったり
            <a data-link-type="dfn" href="#lock-manager" id="ref-for-lock-manager⑥">ロックマネージャ</a>の状態をクエリすることができます。
        </p>
        <h4 class="heading settled" data-level="3.2.1" id="api-lock-manager-request"><span class="secno">3.2.1.
            </span><span class="content"><code
                    class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request②">request()</a></code>
                メソッド</span><a class="self-link" href="#api-lock-manager-request"></a></h4>
        <div class="mdn-anno wrapped after">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="この機能はすべての現行エンジンで利用可能です。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/ja/docs/Web/API/LockManager/request"
                        title="LockManagerインターフェースのrequest()メソッドは、名前や特性を指定してLockオブジェクトを要求します。要求されたLockはコールバックに渡され、関数自体はundefinedで解決されるPromiseを返します。">LockManager/request</a>
                </p>
                <p class="all-engines-text">すべての現行エンジンで利用可能です。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96以上</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4以上</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69以上</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79以上</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (レガシー)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>利用不可</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <div class="domintro note" role="note">
            <dl>
                <dt data-md><var>promise</var> = navigator . locks . <code
                        class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request③">request</a></code>(<var>name</var>,
                    <var>callback</var>)
                <dt data-md><var>promise</var> = navigator . locks . <code
                        class="idl"><a data-link-type="idl" href="#dom-lockmanager-request-name-options-callback" id="ref-for-dom-lockmanager-request-name-options-callback①">request</a></code>(<var>name</var>,
                    <var>options</var>, <var>callback</var>)
                <dd data-md>
                    <p><code
                            class="idl"><a data-link-type="idl" href="#dom-lockmanager-request" id="ref-for-dom-lockmanager-request④">request()</a></code>
                        メソッドはロックを要求するために呼び出されます。</p>
                    <p><var>name</var>（最初の引数）は<a data-link-type="dfn" href="#resource-name"
                            id="ref-for-resource-name⑤">リソース名</a>文字列です。</p>
                    <p><var>callback</var>（最後の引数）は、ロックが付与されたときに呼び出される<a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#dfn-callback-function"
                            id="ref-for-dfn-callback-function">コールバック関数</a>です。これはスクリプトで指定され、通常は<code>async</code>関数です。ロックはコールバック関数が完了するまで保持されます。非asyncコールバック関数が渡された場合、即座にresolveされるPromiseでラップされるため、ロックは同期コールバックの間だけ保持されます。
                    </p>
            </dl>
            <p>返される<var>promise</var>は、ロックが解放された後にコールバックの結果でresolve（またはreject）されるか、要求が中止された場合はrejectされます。</p>
            <p>例：</p>
            <pre class="language-js highlight"><c- k>try</c-> <c- p>{</c->
  <c- a>const</c-> result <c- o>=</c-> <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
    <c- c1>// この時点でロックが保持されています。</c->
    <c- k>await</c-> do_something<c- p>();</c->
    <c- k>await</c-> do_something_else<c- p>();</c->
    <c- k>return</c-> <c- u>"ok"</c-><c- p>;</c->
    <c- c1>// ここでロックが解放されます。</c->
  <c- p>});</c->
  <c- c1>// |result|にはコールバックの戻り値が入ります。</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->ex<c- p>)</c-> <c- p>{</c->
  <c- c1>// コールバックがthrowされた場合、ここで捕捉されます。</c->
<c- p>}</c->
</pre>
            <p>コールバックがいかなる理由で終了してもロックは解放されます ― returnした場合もthrowした場合も同様です。</p>
            <p><var>options</var>辞書を第2引数として指定できます。<var>callback</var>引数は常に最後です。</p>
            <dl>
                <dt data-md><var>options</var> . mode
                <dd data-md>
                    <p><code
                            class="idl"><a data-link-type="idl" href="#dom-lockoptions-mode" id="ref-for-dom-lockoptions-mode">mode</a></code>
                        オプションは"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑦">exclusive</a></code>"
                        （指定しない場合のデフォルト）または"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared⑤">shared</a></code>"のいずれかです。
                        複数のタブやワーカーが同じリソースに対し"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-shared" id="ref-for-dom-lockmode-shared⑥">shared</a></code>"モードのロックを保持できますが、
                        "<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑧">exclusive</a></code>"モードでは1つのタブ／ワーカーだけがそのリソースのロックを保持できます。
                    </p>
                    <p>この主な用途は、複数のリーダーが同時にリソースへアクセスできるようにする一方、変更を防ぐことです。
                        リーダーロックが解放された後、排他的ライターがロックを取得して変更し、その後また排他的ライターや共有リーダーが続くことができます。</p>
            </dl>
            <pre class="language-js highlight"><c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- p>{</c->mode<c- o>:</c-> <c- t>'shared'</c-><c- p>},</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- c1>// ここでロックが保持されています。他のコンテキストも共有モードでロックを保持できるが、排他モードでは保持できません。</c->
<c- p>});</c->
</pre>
            <dl>
                <dt data-md><var>options</var> . ifAvailable
                <dd data-md>
                    <p><code
                            class="idl"><a data-link-type="idl" href="#dom-lockoptions-ifavailable" id="ref-for-dom-lockoptions-ifavailable">ifAvailable</a></code>
                        オプションが<code>true</code>の場合、追加の待機なしでロックが付与可能な場合のみ取得します。これは依然として<em>同期</em>ではないことに注意してください。多くのユーザーエージェントではロックの可否確認にプロセス間通信が必要です。ロックが付与されない場合、コールバックには<code>null</code>が渡されます（これは想定内なので、要求はrejectされません）。
                    </p>
            </dl>
            <pre class="language-js highlight"><c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'resource'</c-><c- p>,</c-> <c- p>{</c->ifAvailable<c- o>:</c-> <c- kc>true</c-><c- p>},</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c-><c- o>!</c->lock<c- p>)</c-> <c- p>{</c->
    <c- c1>// 取得できなかった。必要に応じて対応する。</c->
    <c- k>return</c-><c- p>;</c->
  <c- p>}</c->
  <c- c1>// この時点でロックが保持されています。</c->
<c- p>});</c->
</pre>
            <dl>
                <dt data-md><var>options</var> . signal
                <dd data-md>
                    <p><code
                            class="idl"><a data-link-type="idl" href="#dom-lockoptions-signal" id="ref-for-dom-lockoptions-signal">signal</a></code>
                        オプションには<code
                            class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①">AbortSignal</a></code>を設定できます。
                        これにより、例えば要求がタイムリーに付与されない場合など、ロック要求を中止できます：</p>
            </dl>
            <pre class="language-js highlight"><c- a>const</c-> controller <c- o>=</c-> <c- ow>new</c-> AbortController<c- p>();</c->
setTimeout<c- p>(()</c-> <c- p>=></c-> controller<c- p>.</c->abort<c- p>(),</c-> <c- mf>200</c-><c- p>);</c-> <c- c1>// 最大200ms待つ</c->

<c- k>try</c-> <c- p>{</c->
  <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c->
    <c- t>'resource'</c-><c- p>,</c-> <c- p>{</c->signal<c- o>:</c-> controller<c- p>.</c->signal<c- p>},</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
      <c- c1>// この時点でロックが保持されています。</c->
  <c- p>});</c->
  <c- c1>// ロック解放後。</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->ex<c- p>)</c-> <c- p>{</c->
  <c- c1>// |ex|が"AbortError"というエラー名のDOMExceptionであれば、タイマーが発火した場合です。</c->
<c- p>}</c->
</pre>
            <p>ロックが付与される前にabortが発生した場合、要求のPromiseは<code
                    class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror">AbortError</a></code>でrejectされます。ロックが付与された後はsignalは無視されます。
            </p>
            <dl>
                <dt data-md><var>options</var> . steal
                <dd data-md>
                    <p><code
                            class="idl"><a data-link-type="idl" href="#dom-lockoptions-steal" id="ref-for-dom-lockoptions-steal">steal</a></code>
                        オプションが<code>true</code>の場合、そのリソースの保持中のロックはすべて解放され（そのロックの<a data-link-type="dfn"
                            href="#lock-concept-released-promise" id="ref-for-lock-concept-released-promise④">released
                            promise</a>は<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror①">AbortError</a></code>で解決されます）、
                        この要求が付与され、キュー済み要求も先取りされます。</p>
                    <p>Webアプリケーションが回復不能な状態、例えばService Workerなどがロックを保持するタブに応答がないことを検出した場合、このオプションでロックを「奪う」ことが可能です。</p>
            </dl>
        </div>
        <aside class="advisement"> <code
                class="idl"><a data-link-type="idl" href="#dom-lockoptions-steal" id="ref-for-dom-lockoptions-steal①">steal</a></code>
            オプションの使用は慎重に行ってください。
            これを使うと、先にロックを保持していたコードは、もはやリソースへの唯一アクセス保証がないまま実行されることになります。
            同様に、このオプションを使用したコードも、他のコンテキストが抽象リソースへアクセスできるかの保証はありません。
            これは、アプリケーションやユーザーエージェントの不具合など、すでに予測不能な状況で回復を試みるWebアプリケーション向けの機能です。 </aside>
        <div class="algorithm" data-algorithm="LockManager request method">
            <p><dfn class="dfn-paneled idl-code" data-dfn-for="LockManager" data-dfn-type="method" data-export
                    id="dom-lockmanager-request"><code>request(<var>name</var>, <var>callback</var>)</code></dfn>および
                <dfn class="dfn-paneled idl-code" data-dfn-for="LockManager" data-dfn-type="method" data-export
                    id="dom-lockmanager-request-name-options-callback"><code>request(<var>name</var>, <var>options</var>, <var>callback</var>)</code></dfn>
                メソッドの手順は次の通りです：
            </p>
            <ol>
                <li data-md>
                    <p><var>options</var>が渡されなかった場合、<var>options</var>にデフォルトメンバーを持つ新しい<code
                            class="idl"><a data-link-type="idl" href="#dictdef-lockoptions" id="ref-for-dictdef-lockoptions①">LockOptions</a></code>辞書を設定します。
                    </p>
                <li data-md>
                    <p><var>environment</var>を<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this①">this</a>の<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                            id="ref-for-relevant-settings-object①">relevant settings object</a>とします。</p>
                <li data-md>
                    <p><var>environment</var>の<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global">関連グローバルオブジェクト</a>の<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"
                            id="ref-for-concept-document-window">関連付けられたDocument</a>が<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active"
                            id="ref-for-fully-active">完全にアクティブ</a>でない場合、"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>で<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with">rejectされたpromise</a>を返します。
                    </p>
                <li data-md>
                    <p><var>manager</var>を<var>environment</var>で<a data-link-type="dfn" href="#obtain-a-lock-manager"
                            id="ref-for-obtain-a-lock-manager">ロックマネージャの取得</a>の結果とします。それが失敗を返した場合、"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#securityerror" id="ref-for-securityerror">SecurityError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>で<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with①">rejectされたpromise</a>を返します。
                    </p>
                <li data-md>
                    <p><var>name</var>がU+002Dハイフン（-）で始まる場合、"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror">NotSupportedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>で<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with②">rejectされたpromise</a>を返します。
                    </p>
                <li data-md>
                    <p><var>options</var>["<code>steal</code>"]と<var>options</var>["<code>ifAvailable</code>"]が両方trueの場合、"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror①">NotSupportedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>で<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with③">rejectされたpromise</a>を返します。
                    </p>
                <li data-md>
                    <p><var>options</var>["<code>steal</code>"]がtrueで、<var>options</var>["<code>mode</code>"]が"<code
                            class="idl"><a data-link-type="idl" href="#dom-lockmode-exclusive" id="ref-for-dom-lockmode-exclusive⑨">exclusive</a></code>"でない場合、"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror②">NotSupportedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>で<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with④">rejectされたpromise</a>を返します。
                    </p>
                <li data-md>
                    <p><var>options</var>["<code>signal</code>"]<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">が存在する</a>場合、
                        <var>options</var>["<code>steal</code>"]または<var>options</var>["<code>ifAvailable</code>"]のいずれかがtrueなら、"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror③">NotSupportedError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>で<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with⑤">rejectされたpromise</a>を返します。
                    </p>
                <li data-md>
                    <p><var>options</var>["<code>signal</code>"]<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">が存在し</a>、かつ<a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-aborted"
                            id="ref-for-abortsignal-aborted">aborted</a>なら、<var>options</var>["<code>signal</code>"]の<a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                            id="ref-for-abortsignal-abort-reason">abort reason</a>で<a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with⑥">rejectされたpromise</a>を返します。</p>
                <li data-md>
                    <p><var>promise</var>を<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise"
                            id="ref-for-a-new-promise">新しいpromise</a>とします。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="#request-a-lock"
                            id="ref-for-request-a-lock">ロックを要求する</a>を<var>promise</var>、現在の<a data-link-type="dfn"
                            href="https://tc39.github.io/ecma262/#agent"
                            id="ref-for-agent⑦">agent</a>、<var>environment</var>の<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id"
                            id="ref-for-concept-environment-id">id</a>、<var>manager</var>、<var>callback</var>、<var>name</var>、<var>options</var>["<code>mode</code>"]、<var>options</var>["<code>ifAvailable</code>"]、<var>options</var>["<code>steal</code>"]、<var>options</var>["<code>signal</code>"]で実行します。
                    </p>
                <li data-md>
                    <p><var>promise</var>を返します。</p>
            </ol>
        </div>
        <h4 class="heading settled" data-level="3.2.2" id="api-lock-manager-query"><span class="secno">3.2.2.
            </span><span class="content"><code
                    class="idl"><a data-link-type="idl" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query①">query()</a></code>
                メソッド</span><a class="self-link" href="#api-lock-manager-query"></a></h4>
        <div class="mdn-anno wrapped after">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="この機能はすべての現行エンジンに搭載されています。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/ja/docs/Web/API/LockManager/query"
                        title="LockManagerインターフェースのquery()メソッドは、保持中および保留中のロックに関する情報を含むオブジェクトで解決されるPromiseを返します。">LockManager/query</a>
                </p>
                <p class="all-engines-text">すべての現行エンジンで利用可能です。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96以上</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4以上</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69以上</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79以上</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (レガシー)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>利用不可</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <div class="domintro note" role="note">
            <dl>
                <dt data-md><var>state</var> = await navigator . locks . <code
                        class="idl"><a data-link-type="idl" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query②">query</a></code>()
                <dd data-md>
                    <p><code
                            class="idl"><a data-link-type="idl" href="#dom-lockmanager-query" id="ref-for-dom-lockmanager-query③">query()</a></code>
                        メソッドは、オリジンの<a data-link-type="dfn" href="#lock-manager"
                            id="ref-for-lock-manager⑦">ロックマネージャ</a>の状態スナップショットを生成するために利用できます。これにより、Webアプリケーションはロック利用状況をログやデバッグ目的で検査できます。
                    </p>
                    <p>返されるPromiseは<var>state</var>（JSONライクなデータ構造）で解決され、以下の形式です：</p>
            </dl>
            <pre class="language-js highlight"><c- p>{</c->
  held<c- o>:</c-> <c- p>[</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource1"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"exclusive"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"8b1e730c-7405-47db-9265-6ee7c73ac153"</c-> <c- p>},</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource2"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"shared"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"8b1e730c-7405-47db-9265-6ee7c73ac153"</c-> <c- p>},</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource2"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"shared"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"fad203a5-1f31-472b-a7f7-a3236a1f6d3b"</c-> <c- p>},</c->
  <c- p>],</c->
  pending<c- o>:</c-> <c- p>[</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource1"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"exclusive"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"fad203a5-1f31-472b-a7f7-a3236a1f6d3b"</c-> <c- p>},</c->
    <c- p>{</c-> name<c- o>:</c-> <c- u>"resource1"</c-><c- p>,</c-> mode<c- o>:</c-> <c- u>"exclusive"</c-><c- p>,</c->
      clientId<c- o>:</c-> <c- u>"d341a5d0-1d8d-4224-be10-704d1ef92a15"</c-> <c- p>},</c->
  <c- p>]</c->
<c- p>}</c->
</pre>
            <p><code>clientId</code>フィールドは個別のコンテキスト（フレームやワーカー）に対応し、<code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/service-workers-1/#client" id="ref-for-client">Client</a></code>の
                <code
                    class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/service-workers-1/#dom-client-id" id="ref-for-dom-client-id">id</a></code>
                属性で返される値と同じです。
            </p>
        </div>
        <aside class="advisement"> このデータは、<a data-link-type="dfn" href="#lock-manager"
                id="ref-for-lock-manager⑧">ロックマネージャ</a>のある時点の<em>スナップショット</em>に過ぎません。スクリプトにデータが返される時点で、実際のロック状態が変更されている可能性があります。
        </aside>
        <div class="algorithm" data-algorithm="query()" data-algorithm-for="LockManager">
            <p><dfn class="dfn-paneled idl-code" data-dfn-for="LockManager" data-dfn-type="method" data-export
                    id="dom-lockmanager-query"><code>query()</code></dfn>メソッドの手順は次の通りです：</p>
            <ol>
                <li data-md>
                    <p><var>environment</var>を<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this"
                            id="ref-for-this②">this</a>の<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                            id="ref-for-relevant-settings-object②">relevant settings object</a>とします。</p>
                <li data-md>
                    <p><var>environment</var>の<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"
                            id="ref-for-concept-relevant-global①">関連グローバルオブジェクト</a>の<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"
                            id="ref-for-concept-document-window①">関連付けられたDocument</a>が<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active"
                            id="ref-for-fully-active①">完全にアクティブ</a>でない場合、"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>で<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with⑦">rejectされたpromise</a>を返します。
                    </p>
                <li data-md>
                    <p><var>manager</var>を<var>environment</var>で<a data-link-type="dfn" href="#obtain-a-lock-manager"
                            id="ref-for-obtain-a-lock-manager①">ロックマネージャの取得</a>の結果とします。それが失敗を返した場合、"<code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#securityerror" id="ref-for-securityerror①">SecurityError</a></code>"
                        <code
                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>で<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with"
                            id="ref-for-a-promise-rejected-with⑧">rejectされたpromise</a>を返します。
                    </p>
                <li data-md>
                    <p><var>promise</var>を<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise"
                            id="ref-for-a-new-promise①">新しいpromise</a>とします。</p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                            id="ref-for-enqueue-the-following-steps③">ロック状態のスナップショット手順</a>を<var>manager</var>と<var>promise</var>で<a
                            data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue②">ロックタスクキュー</a>にエンキューします。</p>
                <li data-md>
                    <p><var>promise</var>を返します。</p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="3.3" id="api-lock"><span class="secno">3.3. </span><span
                class="content"><code
                    class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock②">Lock</a></code> クラス</span><a
                class="self-link" href="#api-lock"></a></h3>
        <div class="mdn-anno wrapped after">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="この機能はすべての現行エンジンで利用可能です。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/ja/docs/Web/API/Lock"
                        title="Web Locks APIのLockインターフェースはロックの名前とモードを提供します。これはLockManager.request()のコールバックで受け取る新しいロックや、LockManager.query()で返されるアクティブまたはキュー済みロックの記録です。">Lock</a>
                </p>
                <p class="all-engines-text">すべての現行エンジンで利用可能です。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96以上</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4以上</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69以上</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79以上</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (レガシー)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>利用不可</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext②"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="lock"><code><c- g>Lock</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-lock-name" id="ref-for-dom-lock-name"><c- g>name</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-lockmode" id="ref-for-enumdef-lockmode②"><c- n>LockMode</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockMode" href="#dom-lock-mode" id="ref-for-dom-lock-mode"><c- g>mode</c-></a>;
};
</pre>
        <p><code class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock③">Lock</a></code>オブジェクトは関連する<a
                data-link-type="dfn" href="#lock-concept" id="ref-for-lock-concept①⑤">ロック</a>を持ちます。</p>
        <div class="mdn-anno wrapped">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="この機能はすべての現行エンジンで利用可能です。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/ja/docs/Web/API/Lock/name"
                        title="Lockインターフェースのname読み取り専用プロパティは、ロック要求時にLockManager.requestに渡されたnameを返します。">Lock/name</a>
                </p>
                <p class="all-engines-text">すべての現行エンジンで利用可能です。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96以上</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4以上</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69以上</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79以上</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (レガシー)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>利用不可</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="Lock" data-dfn-type="attribute" data-export
                id="dom-lock-name"><code>name</code></dfn>ゲッターの手順は、関連する<a data-link-type="dfn" href="#lock-concept"
                id="ref-for-lock-concept①⑥">ロック</a>の<a data-link-type="dfn" href="#lock-concept-name"
                id="ref-for-lock-concept-name②">name</a>を返します。</p>
        <div class="mdn-anno wrapped">
            <button class="mdn-anno-btn"><b class="all-engines-flag"
                    title="この機能はすべての現行エンジンで利用可能です。">✔</b><span>MDN</span></button>
            <div class="feature">
                <p><a href="https://developer.mozilla.org/ja/docs/Web/API/Lock/mode"
                        title="Lockインターフェースのmode読み取り専用プロパティは、ロック要求時にLockManager.requestで渡されたアクセスモード（デフォルトは&quot;exclusive&quot;または&quot;shared&quot;）を返します。">Lock/mode</a>
                </p>
                <p class="all-engines-text">すべての現行エンジンで利用可能です。</p>
                <div class="support">
                    <span class="firefox yes"><span>Firefox</span><span>96以上</span></span><span
                        class="safari yes"><span>Safari</span><span>15.4以上</span></span><span
                        class="chrome yes"><span>Chrome</span><span>69以上</span></span>
                    <hr>
                    <span class="opera no"><span>Opera</span><span>?</span></span><span
                        class="edge_blink yes"><span>Edge</span><span>79以上</span></span>
                    <hr>
                    <span class="edge no"><span>Edge (レガシー)</span><span>?</span></span><span
                        class="ie no"><span>IE</span><span>利用不可</span></span>
                    <hr>
                    <span class="firefox_android no"><span>Firefox for Android</span><span>?</span></span><span
                        class="safari_ios no"><span>iOS Safari</span><span>?</span></span><span
                        class="chrome_android no"><span>Chrome for Android</span><span>?</span></span><span
                        class="webview_android no"><span>Android WebView</span><span>?</span></span><span
                        class="samsunginternet_android no"><span>Samsung Internet</span><span>?</span></span><span
                        class="opera_android no"><span>Opera Mobile</span><span>?</span></span>
                </div>
            </div>
        </div>
        <p><dfn class="dfn-paneled idl-code" data-dfn-for="Lock" data-dfn-type="attribute" data-export
                id="dom-lock-mode"><code>mode</code></dfn>ゲッターの手順は、関連する<a data-link-type="dfn" href="#lock-concept"
                id="ref-for-lock-concept①⑦">ロック</a>の<a data-link-type="dfn" href="#lock-concept-mode"
                id="ref-for-lock-concept-mode①">mode</a>を返します。</p>
        <h2 class="heading settled" data-level="4" id="algorithms"><span class="secno">4. </span><span
                class="content">アルゴリズム</span><a class="self-link" href="#algorithms"></a></h2>
        <h3 class="heading settled" data-level="4.1" id="algorithm-request-lock"><span class="secno">4.1. </span><span
                class="content">ロックの要求</span><a class="self-link" href="#algorithm-request-lock"></a></h3>
        <div class="algorithm" data-algorithm="request a lock">
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="request-a-lock">ロックを要求する</dfn>には
            <var>promise</var>, <var>agent</var>, <var>clientId</var>, <var>manager</var>, <var>callback</var>,
            <var>name</var>, <var>mode</var>, <var>ifAvailable</var>, <var>steal</var>, <var>signal</var>を与えて次を行う：
            <ol>
                <li data-md>
                    <p><var>request</var>を新しい<a data-link-type="dfn" href="#lock-request"
                            id="ref-for-lock-request⑦">ロック要求</a>（<var>agent</var>, <var>clientId</var>,
                        <var>manager</var>, <var>name</var>, <var>mode</var>, <var>callback</var>, <var>promise</var>,
                        <var>signal</var>）とする。
                    </p>
                <li data-md>
                    <p><var>signal</var>が存在する場合、<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#abortsignal-add"
                            id="ref-for-abortsignal-add">次のアルゴリズム</a>を
                        <a data-link-type="dfn" href="#signal-to-abort-the-request"
                            id="ref-for-signal-to-abort-the-request">要求中止のsignal通知</a>として
                        <var>request</var>と<var>signal</var>で<var>signal</var>に追加する。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                            id="ref-for-enqueue-the-following-steps④">以下の手順を</a> <a data-link-type="dfn"
                            href="#lock-task-queue" id="ref-for-lock-task-queue③">ロックタスクキュー</a>にエンキュー：</p>
                    <ol>
                        <li data-md>
                            <p><var>queueMap</var>を<var>manager</var>の<a data-link-type="dfn"
                                    href="#lock-manager-lock-request-queue-map"
                                    id="ref-for-lock-manager-lock-request-queue-map②">ロック要求キュー・マップ</a>とする。</p>
                        <li data-md>
                            <p><var>queue</var>を<var>queueMap</var>から<var>name</var>で<a data-link-type="dfn"
                                    href="#get-the-lock-request-queue"
                                    id="ref-for-get-the-lock-request-queue①">ロック要求キューを取得</a>した結果とする。</p>
                        <li data-md>
                            <p><var>held</var>を<var>manager</var>の<a data-link-type="dfn"
                                    href="#lock-manager-held-lock-set"
                                    id="ref-for-lock-manager-held-lock-set①">保持ロック集合</a>とする。</p>
                        <li data-md>
                            <p><var>steal</var>がtrueなら、次の手順を実行：</p>
                            <ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                                            id="ref-for-list-iterate">held</a>内の<var>lock</var>に対し：</p>
                                    <ol>
                                        <li data-md>
                                            <p><var>lock</var>の<a data-link-type="dfn" href="#lock-concept-name"
                                                    id="ref-for-lock-concept-name③">name</a>が<var>name</var>なら、次を行う：</p>
                                            <ol>
                                                <li data-md>
                                                    <p><a data-link-type="dfn"
                                                            href="https://infra.spec.whatwg.org/#list-remove"
                                                            id="ref-for-list-remove">lock</a>を<var>held</var>から削除。</p>
                                                <li data-md>
                                                    <p><a data-link-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#reject"
                                                            id="ref-for-reject">lock</a>の<a data-link-type="dfn"
                                                            href="#lock-concept-released-promise"
                                                            id="ref-for-lock-concept-released-promise⑤">released
                                                            promise</a>を
                                                        "<code
                                                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#aborterror" id="ref-for-aborterror②">AbortError</a></code>"
                                                        <code
                                                            class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑧">DOMException</a></code>でreject。
                                                    </p>
                                            </ol>
                                    </ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-prepend"
                                            id="ref-for-list-prepend">request</a>を<var>queue</var>に先頭に追加。</p>
                            </ol>
                        <li data-md>
                            <p>それ以外の場合、次の手順を実行：</p>
                            <ol>
                                <li data-md>
                                    <p><var>ifAvailable</var>がtrueかつ<var>request</var>が<a data-link-type="dfn"
                                            href="#grantable" id="ref-for-grantable">grantable</a>でない場合、
                                        <a data-link-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                                            id="ref-for-enqueue-the-following-steps⑤">以下の手順を</a> <var>callback</var>の<a
                                            data-link-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                                            id="ref-for-relevant-settings-object③">relevant settings object</a>の<a
                                            data-link-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop"
                                            id="ref-for-responsible-event-loop">responsible event loop</a>にエンキュー：
                                    </p>
                                    <ol>
                                        <li data-md>
                                            <p><var>r</var>を<a data-link-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#invoke-a-callback-function"
                                                    id="ref-for-invoke-a-callback-function">callback</a>を
                                                引数に<code>null</code>で呼び出した結果とする。</p>
                                        <li data-md>
                                            <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                                    id="ref-for-resolve①">promise</a>を<var>r</var>でresolveし、この手順を中止。</p>
                                    </ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#queue-enqueue"
                                            id="ref-for-queue-enqueue">request</a>を<var>queue</var>にエンキュー。</p>
                            </ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="#process-the-lock-request-queue"
                                    id="ref-for-process-the-lock-request-queue">ロック要求キューを処理する</a>
                                <var>queue</var>。
                            </p>
                    </ol>
                <li data-md>
                    <p><var>request</var>を返す。</p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.2" id="algorithm-release-lock"><span class="secno">4.2. </span><span
                class="content">ロックの解放</span><a class="self-link" href="#algorithm-release-lock"></a></h3>
        <div class="algorithm" data-algorithm="release the lock">
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="release-the-lock">ロックの解放</dfn>
            <var>lock</var>には次を行う：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert">アサート</a>：これらの手順は<a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue④">ロックタスクキュー</a>上で実行されている。</p>
                <li data-md>
                    <p><var>manager</var>を<var>lock</var>の<a data-link-type="dfn" href="#lock-concept-manager"
                            id="ref-for-lock-concept-manager">manager</a>とする。</p>
                <li data-md>
                    <p><var>queueMap</var>を<var>manager</var>の<a data-link-type="dfn"
                            href="#lock-manager-lock-request-queue-map"
                            id="ref-for-lock-manager-lock-request-queue-map③">ロック要求キュー・マップ</a>とする。</p>
                <li data-md>
                    <p><var>name</var>を<var>lock</var>の<a data-link-type="dfn" href="#resource-name"
                            id="ref-for-resource-name⑥">リソース名</a>とする。</p>
                <li data-md>
                    <p><var>queue</var>を<var>queueMap</var>から<var>name</var>で<a data-link-type="dfn"
                            href="#get-the-lock-request-queue"
                            id="ref-for-get-the-lock-request-queue②">ロック要求キューを取得</a>した結果とする。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove"
                            id="ref-for-list-remove①">lock</a>を<var>manager</var>の<a data-link-type="dfn"
                            href="#lock-manager-held-lock-set" id="ref-for-lock-manager-held-lock-set②">保持ロック集合</a>から削除。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="#process-the-lock-request-queue"
                            id="ref-for-process-the-lock-request-queue①">ロック要求キューを処理する</a>
                        <var>queue</var>。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.3" id="algorithm-abort-request"><span class="secno">4.3. </span><span
                class="content">要求の中止</span><a class="self-link" href="#algorithm-abort-request"></a></h3>
        <div class="algorithm" data-algorithm="abort the request">
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="abort-the-request">要求の中止</dfn>
            <var>request</var>には次を行う：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert①">アサート</a>：これらの手順は<a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue⑤">ロックタスクキュー</a>上で実行されている。</p>
                <li data-md>
                    <p><var>manager</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-request-manager"
                            id="ref-for-lock-request-manager①">manager</a>とする。</p>
                <li data-md>
                    <p><var>name</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-request-name"
                            id="ref-for-lock-request-name①">name</a>とする。</p>
                <li data-md>
                    <p><var>queueMap</var>を<var>manager</var>の<a data-link-type="dfn"
                            href="#lock-manager-lock-request-queue-map"
                            id="ref-for-lock-manager-lock-request-queue-map④">ロック要求キュー・マップ</a>とする。</p>
                <li data-md>
                    <p><var>queue</var>を<var>queueMap</var>から<var>name</var>で<a data-link-type="dfn"
                            href="#get-the-lock-request-queue"
                            id="ref-for-get-the-lock-request-queue③">ロック要求キューを取得</a>した結果とする。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove"
                            id="ref-for-list-remove②">request</a>を<var>queue</var>から削除。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="#process-the-lock-request-queue"
                            id="ref-for-process-the-lock-request-queue②">ロック要求キューを処理する</a>
                        <var>queue</var>。
                    </p>
            </ol>
        </div>
        <div class="algorithm" data-algorithm="signal to abort the request">
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="signal-to-abort-the-request">要求中止のsignal通知</dfn>
            <var>request</var>と<var>signal</var>には次を行う：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                            id="ref-for-enqueue-the-following-steps⑥">以下の手順を</a> <a data-link-type="dfn"
                            href="#abort-the-request" id="ref-for-abort-the-request①">要求の中止</a>
                        <var>request</var>に対し<a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue⑥">ロックタスクキュー</a>にエンキュー。
                    </p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject"
                            id="ref-for-reject①">request</a>の<a data-link-type="dfn" href="#lock-request-promise"
                            id="ref-for-lock-request-promise">promise</a>を
                        <var>signal</var>の<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#abortsignal-abort-reason"
                            id="ref-for-abortsignal-abort-reason①">abort reason</a>でreject。
                    </p>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.4" id="algorithm-process-request"><span class="secno">4.4.
            </span><span class="content">指定されたリソース名のロック要求キューの処理</span><a class="self-link"
                href="#algorithm-process-request"></a></h3>
        <div class="algorithm" data-algorithm="process the lock request queue">
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="process-the-lock-request-queue">ロック要求キューを処理する</dfn> <var>queue</var>には次を行う：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert②">アサート</a>：これらの手順は<a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue⑦">ロックタスクキュー</a>上で実行されている。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                            id="ref-for-list-iterate①">queue</a>内の各<var>request</var>について：</p>
                    <ol>
                        <li data-md>
                            <p><var>request</var>が<a data-link-type="dfn" href="#grantable"
                                    id="ref-for-grantable①">grantable</a>でなければreturn。</p>
                            <p class="note" role="note"><span>注:</span>
                                キューの最初の項目だけがgrantableです。したがって、grantableでない場合、以降の項目も自動的にgrantableではありません。</p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove"
                                    id="ref-for-list-remove③">request</a>を<var>queue</var>から削除。</p>
                        <li data-md>
                            <p><var>agent</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-concept-agent"
                                    id="ref-for-lock-concept-agent①">agent</a>とする。</p>
                        <li data-md>
                            <p><var>manager</var>を<var>request</var>の<a data-link-type="dfn"
                                    href="#lock-request-manager" id="ref-for-lock-request-manager②">manager</a>とする。</p>
                        <li data-md>
                            <p><var>clientId</var>を<var>request</var>の<a data-link-type="dfn"
                                    href="#lock-request-clientid" id="ref-for-lock-request-clientid">clientId</a>とする。
                            </p>
                        <li data-md>
                            <p><var>name</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-request-name"
                                    id="ref-for-lock-request-name②">name</a>とする。</p>
                        <li data-md>
                            <p><var>mode</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-request-mode"
                                    id="ref-for-lock-request-mode①">mode</a>とする。</p>
                        <li data-md>
                            <p><var>callback</var>を<var>request</var>の<a data-link-type="dfn"
                                    href="#lock-request-callback" id="ref-for-lock-request-callback">callback</a>とする。
                            </p>
                        <li data-md>
                            <p><var>p</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-request-promise"
                                    id="ref-for-lock-request-promise①">promise</a>とする。</p>
                        <li data-md>
                            <p><var>signal</var>を<var>request</var>の<a data-link-type="dfn" href="#lock-request-signal"
                                    id="ref-for-lock-request-signal">signal</a>とする。</p>
                        <li data-md>
                            <p><var>waiting</var>を<a data-link-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#a-new-promise"
                                    id="ref-for-a-new-promise②">新しいPromise</a>とする。</p>
                        <li data-md>
                            <p><var>lock</var>を新しい<a data-link-type="dfn" href="#lock-concept"
                                    id="ref-for-lock-concept②⓪">ロック</a>（<a data-link-type="dfn"
                                    href="#lock-concept-agent" id="ref-for-lock-concept-agent②">agent</a>
                                <var>agent</var>、
                                <a data-link-type="dfn" href="#lock-concept-clientid"
                                    id="ref-for-lock-concept-clientid">clientId</a> <var>clientId</var>、
                                <a data-link-type="dfn" href="#lock-concept-manager"
                                    id="ref-for-lock-concept-manager①">manager</a> <var>manager</var>、
                                <a data-link-type="dfn" href="#lock-concept-mode"
                                    id="ref-for-lock-concept-mode②">mode</a> <var>mode</var>、
                                <a data-link-type="dfn" href="#lock-concept-name"
                                    id="ref-for-lock-concept-name④">name</a> <var>name</var>、
                                <a data-link-type="dfn" href="#lock-concept-released-promise"
                                    id="ref-for-lock-concept-released-promise⑥">released promise</a> <var>p</var>、
                                <a data-link-type="dfn" href="#lock-concept-waiting-promise"
                                    id="ref-for-lock-concept-waiting-promise⑤">waiting promise</a> <var>waiting</var>
                                ）とする。
                            </p>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append"
                                    id="ref-for-set-append">lock</a>を<var>manager</var>の<a data-link-type="dfn"
                                    href="#lock-manager-held-lock-set"
                                    id="ref-for-lock-manager-held-lock-set③">保持ロック集合</a>に追加。</p>
                        <li data-md>
                            <p><a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                                    id="ref-for-enqueue-the-following-steps⑦">以下の手順を</a>
                                <var>callback</var>の<a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"
                                    id="ref-for-relevant-settings-object④">relevant settings object</a>の
                                <a data-link-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop"
                                    id="ref-for-responsible-event-loop①">responsible event loop</a>にエンキュー：
                            </p>
                            <ol>
                                <li data-md>
                                    <p><var>signal</var>が存在する場合、次の手順を実行：</p>
                                    <ol>
                                        <li data-md>
                                            <p><var>signal</var>が<a data-link-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#abortsignal-aborted"
                                                    id="ref-for-abortsignal-aborted①">aborted</a>なら、次を行う：</p>
                                            <ol>
                                                <li data-md>
                                                    <p><a data-link-type="dfn"
                                                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps"
                                                            id="ref-for-enqueue-the-following-steps⑧">以下の手順を</a>
                                                        <a data-link-type="dfn" href="#lock-task-queue"
                                                            id="ref-for-lock-task-queue⑧">ロックタスクキュー</a>にエンキュー：
                                                    </p>
                                                    <ol>
                                                        <li data-md>
                                                            <p><a data-link-type="dfn" href="#release-the-lock"
                                                                    id="ref-for-release-the-lock②">ロックの解放</a>
                                                                <var>lock</var>。
                                                            </p>
                                                    </ol>
                                                <li data-md>
                                                    <p>return。</p>
                                            </ol>
                                        <li data-md>
                                            <p><a data-link-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#abortsignal-remove"
                                                    id="ref-for-abortsignal-remove">signal to abort the request</a>
                                                アルゴリズムを<var>signal</var>から削除。</p>
                                    </ol>
                                <li data-md>
                                    <p><var>r</var>を<a data-link-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#invoke-a-callback-function"
                                            id="ref-for-invoke-a-callback-function①">callback</a>を
                                        新しい<code
                                            class="idl"><a data-link-type="idl" href="#lock" id="ref-for-lock④">Lock</a></code>オブジェクト
                                        （<var>lock</var>を関連付け）を唯一の引数として呼び出した結果とする。</p>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                                            id="ref-for-resolve②">waiting</a>を<var>r</var>でresolve。</p>
                            </ol>
                    </ol>
            </ol>
        </div>
        <h3 class="heading settled" data-level="4.5" id="algorithm-snapshot-state"><span class="secno">4.5. </span><span
                class="content">ロック状態のスナップショット</span><a class="self-link" href="#algorithm-snapshot-state"></a>
        </h3>
        <div class="algorithm" data-algorithm="snapshot the lock state">
            <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport
                id="snapshot-the-lock-state">ロック状態のスナップショット</dfn>を<var>manager</var>と<var>promise</var>で行うには：
            <ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert"
                            id="ref-for-assert③">アサート</a>：これらの手順は<a data-link-type="dfn" href="#lock-task-queue"
                            id="ref-for-lock-task-queue⑨">ロックタスクキュー</a>上で実行されている。</p>
                <li data-md>
                    <p><var>pending</var>を新しい<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list"
                            id="ref-for-list">リスト</a>とする。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate"
                            id="ref-for-map-iterate">manager</a>の<a data-link-type="dfn"
                            href="#lock-manager-lock-request-queue-map"
                            id="ref-for-lock-manager-lock-request-queue-map⑤">ロック要求キュー・マップ</a>の<a data-link-type="dfn"
                            href="https://infra.spec.whatwg.org/#map-getting-the-values"
                            id="ref-for-map-getting-the-values">values</a>ごとに<var>queue</var>について：</p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                                    id="ref-for-list-iterate②">queue</a>内の各<var>request</var>について：</p>
                            <ol>
                                <li data-md>
                                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append"
                                            id="ref-for-list-append">追加</a> «[ "name" → <var>request</var>の<a
                                            data-link-type="dfn" href="#lock-request-name"
                                            id="ref-for-lock-request-name③">name</a>, "mode" → <var>request</var>の<a
                                            data-link-type="dfn" href="#lock-request-mode"
                                            id="ref-for-lock-request-mode②">mode</a>, "clientId" → <var>request</var>の<a
                                            data-link-type="dfn" href="#lock-request-clientid"
                                            id="ref-for-lock-request-clientid①">clientId</a> ]»
                                        を<var>pending</var>に追加する。</p>
                            </ol>
                    </ol>
                <li data-md>
                    <p><var>held</var>を新しい<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list"
                            id="ref-for-list①">リスト</a>とする。</p>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate"
                            id="ref-for-list-iterate③">manager</a>の<a data-link-type="dfn"
                            href="#lock-manager-held-lock-set"
                            id="ref-for-lock-manager-held-lock-set④">保持ロック集合</a>の各<var>lock</var>について：</p>
                    <ol>
                        <li data-md>
                            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append"
                                    id="ref-for-list-append①">追加</a> «[ "name" → <var>lock</var>の<a data-link-type="dfn"
                                    href="#lock-concept-name" id="ref-for-lock-concept-name⑤">name</a>, "mode" →
                                <var>lock</var>の<a data-link-type="dfn" href="#lock-concept-mode"
                                    id="ref-for-lock-concept-mode③">mode</a>, "clientId" → <var>lock</var>の<a
                                    data-link-type="dfn" href="#lock-concept-clientid"
                                    id="ref-for-lock-concept-clientid①">clientId</a> ]» を<var>held</var>に追加する。
                            </p>
                    </ol>
                <li data-md>
                    <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve"
                            id="ref-for-resolve③">promise</a>を«[ "held" → <var>held</var>,
                        "pending" → <var>pending</var> ]»でresolve。</p>
            </ol>
        </div>
        <aside class="note">
            <p> 任意のリソースについて、pendingロック要求のスナップショットは要求が行われた順序で返されます。
                ただし、異なるリソース間の要求の相対的な順序については保証されません。例えば、pendingロック要求A1とA2がリソースAに対してその順序で行われ、pendingロック要求B1とB2がリソースBに対してその順序で行われた場合、
                スナップショットのpendingリストの順序として«A1, A2, B1, B2»も«A1, B1, A2, B2»もあり得ます。 </p>
            <p> 保持ロック状態のスナップショットについては順序保証はありません。 </p>
        </aside>
        <h2 class="heading settled" data-level="5" id="usage-considerations"><span class="secno">5. </span><span
                class="content">利用上の注意事項</span><a class="self-link" href="#usage-considerations"></a></h2>
        <p><em>このセクションは規範的ではありません。</em></p>
        <h3 class="heading settled" data-level="5.1" id="deadlocks"><span class="secno">5.1. </span><span
                class="content">デッドロック</span><a class="self-link" href="#deadlocks"></a></h3>
        <p><a href="https://en.wikipedia.org/wiki/Deadlock">デッドロック</a>は並行計算の概念であり、特定の<a data-link-type="dfn"
                href="#lock-manager" id="ref-for-lock-manager⑨">ロックマネージャ</a>に限定されたデッドロックがこのAPIによって生じることがあります。</p>
        <aside class="example" id="example-deadlocks">
            <a class="self-link" href="#example-deadlocks"></a> このAPIの利用によってデッドロックが発生する例は以下の通りです。
            <p>スクリプト1：</p>
            <pre class="language-js highlight">navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'A'</c-><c- p>,</c-> <c- k>async</c-> a <c- p>=></c-> <c- p>{</c->
  <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'B'</c-><c- p>,</c-> <c- k>async</c-> b <c- p>=></c-> <c- p>{</c->
    <c- c1>// do stuff with A and B</c->
  <c- p>});</c->
<c- p>});</c->
</pre>
            <p>スクリプト2：</p>
            <pre class="language-js highlight">navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'B'</c-><c- p>,</c-> <c- k>async</c-> b <c- p>=></c-> <c- p>{</c->
  <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c-><c- t>'A'</c-><c- p>,</c-> <c- k>async</c-> a <c- p>=></c-> <c- p>{</c->
    <c- c1>// do stuff with A and B</c->
  <c- p>});</c->
<c- p>});</c->
</pre>
            <p>スクリプト1とスクリプト2がほぼ同時に実行されると、スクリプト1がロックAを保持し、スクリプト2がロックBを保持して、いずれもそれ以上進行できない（デッドロック）可能性があります。これはユーザーエージェント全体には影響せず、タブが停止したり、同一オリジン内の他のスクリプトに影響したりすることはありませんが、この機能のみがブロックされます。
            </p>
        </aside>
        <p>デッドロックを防ぐには注意が必要です。一つの方法は、常に複数のロックを厳密な順序で取得することです。</p>
        <aside class="example" id="example-request-multiple-locks">
            <a class="self-link" href="#example-request-multiple-locks"></a>
            <p>次のようなヘルパー関数を使って、複数ロックを一貫した順序で要求できます。</p>
            <pre class="language-js highlight"><c- k>async</c-> <c- a>function</c-> requestMultiple<c- p>(</c->resources<c- p>,</c-> callback<c- p>)</c-> <c- p>{</c->
  <c- a>const</c-> sortedResources <c- o>=</c-> <c- p>[...</c->resources<c- p>];</c->
  sortedResources<c- p>.</c->sort<c- p>();</c-> <c- c1>// Always request in the same order.</c->

  <c- k>async</c-> <c- a>function</c-> requestNext<c- p>(</c->locks<c- p>)</c-> <c- p>{</c->
    <c- k>return</c-> <c- k>await</c-> navigator<c- p>.</c->locks<c- p>.</c->request<c- p>(</c->sortedResources<c- p>.</c->shift<c- p>(),</c-> <c- k>async</c-> lock <c- p>=></c-> <c- p>{</c->
      <c- c1>// Now holding this lock, plus all previously requested locks.</c->
      locks<c- p>.</c->push<c- p>(</c->lock<c- p>);</c->

      <c- c1>// Recursively request the next lock in order if needed.</c->
      <c- k>if</c-> <c- p>(</c->sortedResources<c- p>.</c->length <c- o>></c-> <c- mf>0</c-><c- p>)</c->
        <c- k>return</c-> <c- k>await</c-> requestNext<c- p>(</c->locks<c- p>);</c->

      <c- c1>// Otherwise, run the callback.</c->
      <c- k>return</c-> <c- k>await</c-> callback<c- p>(</c->locks<c- p>);</c->

      <c- c1>// All locks will be released when the callback returns (or throws).</c->
    <c- p>});</c->
  <c- p>}</c->
  <c- k>return</c-> <c- k>await</c-> requestNext<c- p>([]);</c->
<c- p>}</c->
</pre>
            <p>実際には、複数ロックの利用はこのように単純とは限りません。ライブラリや他のユーティリティが、その利用を意図せずわかりにくくすることがあります。</p>
        </aside>
        <h2 class="heading settled" data-level="6" id="security-privacy"><span class="secno">6. </span><span
                class="content">セキュリティとプライバシーに関する考慮事項</span><a class="self-link" href="#security-privacy"></a></h2>
        <h3 class="heading settled" data-level="6.1" id="security-scope"><span class="secno">6.1. </span><span
                class="content">ロックのスコープ</span><a class="self-link" href="#security-scope"></a></h3>
        <p><a data-link-type="dfn" href="#lock-manager"
                id="ref-for-lock-manager①⓪">ロックマネージャ</a>のスコープ定義は、プライバシー境界を定めるため重要です。ロックは一時的な状態保持機構として使われ、ストレージAPI同様通信手段にもなり得るため、ストレージ機能以上の権限を持ってはなりません。ユーザーエージェントがこれらサービスのいずれかに細かい粒度を課す場合、他のサービスにも同じ粒度を課す必要があります。例えば、プライバシー理由でトップレベルページ（ファーストパーティ）とクロスオリジンiframe（サードパーティ）で異なるストレージ区画を同一オリジンに対し公開する場合、ロックも同様に分割しなければなりません。
        </p>
        <p>これにより、Webアプリ開発者にも合理的な期待が与えられます。ストレージリソース上でロックを取得した場合、同一オリジンのすべてのブラウジングコンテキストが同じ状態を観測できなければなりません。</p>
        <h3 class="heading settled" data-level="6.2" id="private-browsing"><span class="secno">6.2. </span><span
                class="content">プライベートブラウジング</span><a class="self-link" href="#private-browsing"></a></h3>
        <p>各<a
                href="https://github.com/w3ctag/private-mode">プライベートモード</a>のブラウジングセッションは、このAPIの観点では別のユーザーエージェントとみなされます。つまり、こうしたセッション外で要求・保持されたロックは、セッション内の要求・保持に影響しませんし、その逆も同様です。これにより、ウェブサイトがセッションが「シークレットモード」であることを判定したり、こうしたセッション間で通信手段を提供したりすることが防止されます。
        </p>
        <h3 class="heading settled" data-level="6.3" id="implementation-risks"><span class="secno">6.3. </span><span
                class="content">実装リスク</span><a class="self-link" href="#implementation-risks"></a></h3>
        <p>実装では、ロックがオリジンをまたがってはいけないことを保証しなければなりません。これを怠ると、2つのオリジンで動作するスクリプト間の通信のためのサイドチャネルが生じたり、一方のオリジンのスクリプトがもう一方の挙動を妨害する（例えばサービス拒否）ことが可能となります。
        </p>
        <h3 class="heading settled" data-level="6.4" id="security-privacy-checklist"><span class="secno">6.4.
            </span><span class="content">チェックリスト</span><a class="self-link" href="#security-privacy-checklist"></a>
        </h3>
        <p>W3C TAGは<a
                href="https://www.w3.org/TR/security-privacy-questionnaire/">セキュリティ・プライバシー自己レビュー質問票</a>を仕様編集者向けに作成しています。以下、その質問内容を再確認します：
        </p>
        <ul>
            <li data-md>
                <p>本仕様は個人識別情報や高価値データを扱いません。</p>
            <li data-md>
                <p>オリジンに対して、ブラウジングセッションをまたいで永続する新しい状態は導入されません。</p>
            <li data-md>
                <p>ウェブに新たな永続的なクロスオリジン状態は公開されません。</p>
            <li data-md>
                <p>オリジンに現在アクセス可能な情報以外（例：<a data-link-type="biblio" href="#biblio-indexeddb-2"
                        title="Indexed Database API 2.0">[IndexedDB-2]</a>によるポーリング等）を新たに公開しません。</p>
            <li data-md>
                <p>新たなスクリプト実行/読み込みメカニズムは有効化されません。</p>
            <li data-md>
                <p>本仕様は以下のいずれにもオリジンへのアクセスを許可しません：</p>
                <ul>
                    <li data-md>
                        <p>ユーザーの位置情報</p>
                    <li data-md>
                        <p>ユーザー端末のセンサー</p>
                    <li data-md>
                        <p>ユーザーのローカルコンピュータ環境の側面</p>
                    <li data-md>
                        <p>他のデバイスへのアクセス</p>
                    <li data-md>
                        <p>ユーザーエージェントのネイティブUIに対する制御権限</p>
                </ul>
            <li data-md>
                <p>ウェブに一時的な識別子は公開されません。すべての<a data-link-type="dfn" href="#resource-name"
                        id="ref-for-resource-name⑦">リソース名</a>はWebアプリ自身が指定します。</p>
            <li data-md>
                <p>ファーストパーティとサードパーティ文脈での挙動は、ユーザーエージェントがストレージを区別する場合区別されます。<a href="#security-scope">§6.1 ロックのスコープ</a>参照。
                </p>
            <li data-md>
                <p>ユーザーエージェントの「シークレットモード」文脈での挙動は<a href="#private-browsing">§6.2 プライベートブラウジング</a>で説明されています。</p>
            <li data-md>
                <p>本APIによってユーザー端末へのデータ保存は行われません。</p>
            <li data-md>
                <p>本APIはデフォルトのセキュリティ特性を下げることはありません。</p>
        </ul>
        <h2 class="heading settled" data-level="7" id="acknowledgements"><span class="secno">7. </span><span
                class="content">謝辞</span><a class="self-link" href="#acknowledgements"></a></h2>
        <p>この提案の作成にあたり、下記の方々に深く感謝します。
            Alex Russell,
            Andreas Butler,
            Anne van Kesteren,
            Boris Zbarsky,
            Chris Messina,
            Darin Fisher,
            Domenic Denicola,
            Gus Caplan,
            Harald Alvestrand,
            Jake Archibald,
            Kagami Sascha Rosylight,
            L. David Baron,
            Luciano Pacheco,
            Marcos Caceres,
            Ralph Chelala,
            Raymond Toy,
            Ryan Fioravanti,
            そして
            Victor Costan
            。
        </p>
        <p><a href="https://github.com/tabatkins/bikeshed">Bikeshed</a>（この仕様書作成に用いたツール）および著者全般への助言をしてくださったTab Atkins,
            Jr.にも特別感謝いたします。</p>
    </main>
    <div data-fill-with="conformance">
        <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">適合性</span><a
                class="self-link" href="#w3c-conformance"></a></h2>
        <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">文書の規約</span><a
                class="self-link" href="#w3c-conventions"></a></h3>
        <p>適合性要件は、記述的な断定とRFC 2119の用語の組み合わせで表現されます。
            規範部分で使われる “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”,
            “MAY”, “OPTIONAL” というキーワードは、
            RFC 2119で説明されているとおりに解釈されます。
            ただし、可読性のため、これらの語はすべて大文字では記載されません。
        </p>
        <p>本仕様書のすべてのテキストは規範的です（明確に非規範と示されたセクション、例、注意書きを除く）。<a data-link-type="biblio" href="#biblio-rfc2119"
                title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>
        </p>
        <p>この仕様書の例は「例えば」などの語で始まるか、規範テキストから <code>class="example"</code> を使って区別されています。例：</p>
        <div class="example" id="w3c-example">
            <a class="self-link" href="#w3c-example"></a>
            <p>これは非規範的な例です。</p>
        </div>
        <p>非規範的な注意書きは「注」で始まり、<code>class="note"</code>で規範テキストから区別されています。例：</p>
        <p class="note" role="note">注：これは非規範的な注意書きです。</p>
        <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">適合アルゴリズム</span><a
                class="self-link" href="#w3c-conformant-algorithms"></a></h3>
        <p>アルゴリズムの一部として命令形で記載された要件（たとえば「先頭の空白文字を取り除く」や「falseを返してこれらの手順を中止する」など）は、
            そのアルゴリズムの導入で使われたキーワード（"must", "should", "may"など）が持つ意味で解釈されます。
        </p>
        <p>アルゴリズムや具体的な手順として表現された適合性要件は、最終結果が同等である限り、いかなる方法でも実装可能です。
            特に、本仕様書で定義されるアルゴリズムは理解しやすいことを意図しており、性能を意図したものではありません。
            実装者は最適化を推奨します。
        </p>
    </div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <h2 class="no-num no-ref heading settled" id="index"><span class="content">索引</span><a class="self-link"
            href="#index"></a></h2>
    <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">本仕様書で定義されている用語</span><a
            class="self-link" href="#index-defined-here"></a></h3>
    <ul class="index">
        <li><a href="#abort-the-request">要求の中止</a><span>, § 4.3</span>
        <li>
            agent
            <ul>
                <li><a href="#lock-request-agent">lock request の定義</a><span>, § 2.5</span>
                <li><a href="#lock-concept-agent">lock-concept の定義</a><span>, § 2.4</span>
            </ul>
        <li><a href="#lock-request-callback">callback</a><span>, § 2.5</span>
        <li>
            clientId
            <ul>
                <li><a href="#lock-request-clientid">lock request の定義</a><span>, § 2.5</span>
                <li><a href="#lock-concept-clientid">lock-concept の定義</a><span>, § 2.4</span>
                <li><a href="#dom-lockinfo-clientid">LockInfo の dict-member</a><span>, § 3.2</span>
            </ul>
        <li><a href="#dom-lockmode-exclusive">"exclusive"</a><span>, § 3.2</span>
        <li><a href="#get-the-lock-request-queue">ロック要求キューを取得する</a><span>, § 2.5</span>
        <li><a href="#grantable">付与可能（grantable）</a><span>, § 2.5</span>
        <li><a href="#dom-lockmanagersnapshot-held">held</a><span>, § 3.2</span>
        <li><a href="#lock-manager-held-lock-set">保持ロック集合</a><span>, § 2.4</span>
        <li><a href="#dom-lockoptions-ifavailable">ifAvailable</a><span>, § 3.2</span>
        <li><a href="#lock">Lock</a><span>, § 3.3</span>
        <li><a href="#lock-concept">lock-concept</a><span>, § 2.4</span>
        <li><a href="#callbackdef-lockgrantedcallback">LockGrantedCallback</a><span>, § 3.2</span>
        <li><a href="#dictdef-lockinfo">LockInfo</a><span>, § 3.2</span>
        <li><a href="#lock-manager">ロックマネージャ</a><span>, § 2.2</span>
        <li><a href="#lockmanager">LockManager</a><span>, § 3.2</span>
        <li><a href="#dictdef-lockmanagersnapshot">LockManagerSnapshot</a><span>, § 3.2</span>
        <li><a href="#enumdef-lockmode">LockMode</a><span>, § 3.2</span>
        <li><a href="#dictdef-lockoptions">LockOptions</a><span>, § 3.2</span>
        <li><a href="#lock-request">ロック要求</a><span>, § 2.5</span>
        <li><a href="#lock-request-queue">ロック要求キュー</a><span>, § 2.5</span>
        <li><a href="#lock-manager-lock-request-queue-map">ロック要求キュー・マップ</a><span>, § 2.5</span>
        <li><a href="#dom-navigatorlocks-locks">locks</a><span>, § 3.1</span>
        <li><a href="#lock-task-queue">ロックタスクキュー</a><span>, § 2</span>
        <li>
            manager
            <ul>
                <li><a href="#lock-request-manager">lock request の定義</a><span>, § 2.5</span>
                <li><a href="#lock-concept-manager">lock-concept の定義</a><span>, § 2.4</span>
            </ul>
        <li>
            mode
            <ul>
                <li><a href="#dom-lock-mode">Lock の属性</a><span>, § 3.3</span>
                <li><a href="#mode">定義</a><span>, § 2.3</span>
                <li><a href="#lock-request-mode">lock request の定義</a><span>, § 2.5</span>
                <li><a href="#lock-concept-mode">lock-concept の定義</a><span>, § 2.4</span>
                <li><a href="#dom-lockinfo-mode">LockInfo の dict-member</a><span>, § 3.2</span>
                <li><a href="#dom-lockoptions-mode">LockOptions の dict-member</a><span>, § 3.2</span>
            </ul>
        <li>
            name
            <ul>
                <li><a href="#dom-lock-name">Lock の属性</a><span>, § 3.3</span>
                <li><a href="#lock-request-name">lock request の定義</a><span>, § 2.5</span>
                <li><a href="#lock-concept-name">lock-concept の定義</a><span>, § 2.4</span>
                <li><a href="#dom-lockinfo-name">LockInfo の dict-member</a><span>, § 3.2</span>
            </ul>
        <li><a href="#navigatorlocks">NavigatorLocks</a><span>, § 3.1</span>
        <li><a href="#obtain-a-lock-manager">ロックマネージャを取得する</a><span>, § 2.2</span>
        <li><a href="#dom-lockmanagersnapshot-pending">pending</a><span>, § 3.2</span>
        <li><a href="#process-the-lock-request-queue">ロック要求キューを処理する</a><span>, § 4.4</span>
        <li><a href="#lock-request-promise">promise</a><span>, § 2.5</span>
        <li><a href="#dom-lockmanager-query">query()</a><span>, § 3.2.2</span>
        <li><a href="#lock-concept-released-promise">released promise</a><span>, § 2.4</span>
        <li><a href="#release-the-lock">ロックの解放</a><span>, § 4.2</span>
        <li><a href="#request-a-lock">ロックを要求する</a><span>, § 4.1</span>
        <li><a href="#dom-lockmanager-request">request(name, callback)</a><span>, § 3.2.1</span>
        <li><a href="#dom-lockmanager-request-name-options-callback">request(name, options, callback)</a><span>,
                § 3.2.1</span>
        <li><a href="#resource-name">リソース名</a><span>, § 2.1</span>
        <li><a href="#dom-lockmode-shared">"shared"</a><span>, § 3.2</span>
        <li>
            signal
            <ul>
                <li><a href="#lock-request-signal">lock request の定義</a><span>, § 2.5</span>
                <li><a href="#dom-lockoptions-signal">LockOptions の dict-member</a><span>, § 3.2</span>
            </ul>
        <li><a href="#signal-to-abort-the-request">要求中止のsignal通知</a><span>, § 4.3</span>
        <li><a href="#snapshot-the-lock-state">ロック状態のスナップショット</a><span>, § 4.5</span>
        <li><a href="#dom-lockoptions-steal">steal</a><span>, § 3.2</span>
        <li><a href="#terminate-remaining-locks-and-requests">残りのロックと要求の終了</a><span>, § 2.6</span>
        <li><a href="#lock-concept-waiting-promise">waiting promise</a><span>, § 2.4</span>
        <li><a href="#web-locks-tasks-source">Web Locksタスクソース</a><span>, § 2</span>
    </ul>
    <aside class="dfn-panel" data-for="term-for-user-agent">
        <a
            href="https://www.w3.org/TR/CSS2/conform.html#user-agent">https://www.w3.org/TR/CSS2/conform.html#user-agent</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-user-agent">2. Concepts</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal">
        <a href="https://dom.spec.whatwg.org/#abortsignal">https://dom.spec.whatwg.org/#abortsignal</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal">3.2. LockManager class</a>
            <li><a href="#ref-for-abortsignal①">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal-abort-reason">
        <a
            href="https://dom.spec.whatwg.org/#abortsignal-abort-reason">https://dom.spec.whatwg.org/#abortsignal-abort-reason</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal-abort-reason">3.2.1. The request() method</a>
            <li><a href="#ref-for-abortsignal-abort-reason①">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal-aborted">
        <a
            href="https://dom.spec.whatwg.org/#abortsignal-aborted">https://dom.spec.whatwg.org/#abortsignal-aborted</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal-aborted">3.2.1. The request() method</a>
            <li><a href="#ref-for-abortsignal-aborted①">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal-add">
        <a href="https://dom.spec.whatwg.org/#abortsignal-add">https://dom.spec.whatwg.org/#abortsignal-add</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal-add">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-document">
        <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-document">2.6. Termination of Locks</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-abortsignal-remove">
        <a href="https://dom.spec.whatwg.org/#abortsignal-remove">https://dom.spec.whatwg.org/#abortsignal-remove</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-abortsignal-remove">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-agent">
        <a href="https://tc39.github.io/ecma262/#agent">https://tc39.github.io/ecma262/#agent</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-agent">1. Introduction</a> <a href="#ref-for-agent①">(2)</a>
            <li><a href="#ref-for-agent②">2.1. Resources Names</a>
            <li><a href="#ref-for-agent③">2.2. Lock Managers</a>
            <li><a href="#ref-for-agent④">2.4. Locks</a>
            <li><a href="#ref-for-agent⑤">2.6. Termination of Locks</a> <a href="#ref-for-agent⑥">(2)</a>
            <li><a href="#ref-for-agent⑦">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-navigator">
        <a
            href="https://html.spec.whatwg.org/multipage/system-state.html#navigator">https://html.spec.whatwg.org/multipage/system-state.html#navigator</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-navigator">3.1. Navigator Mixins</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-workernavigator">
        <a
            href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator">https://html.spec.whatwg.org/multipage/workers.html#workernavigator</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-workernavigator">3.1. Navigator Mixins</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-integration-with-the-javascript-agent-cluster-formalism">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism">https://html.spec.whatwg.org/multipage/webappapis.html#integration-with-the-javascript-agent-cluster-formalism</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-integration-with-the-javascript-agent-cluster-formalism">1. Introduction</a> <a
                    href="#ref-for-integration-with-the-javascript-agent-cluster-formalism①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-document-window">
        <a
            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window">https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-document-window">3.2.1. The request() method</a>
            <li><a href="#ref-for-concept-document-window①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-browsing-context">
        <a
            href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context">https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-browsing-context">2.2. Lock Managers</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-enqueue-the-following-steps">
        <a
            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps">https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-enqueue-the-following-steps">2. Concepts</a>
            <li><a href="#ref-for-enqueue-the-following-steps①">2.4. Locks</a>
            <li><a href="#ref-for-enqueue-the-following-steps②">2.6. Termination of Locks</a>
            <li><a href="#ref-for-enqueue-the-following-steps③">3.2.2. The query() method</a>
            <li><a href="#ref-for-enqueue-the-following-steps④">4.1. Request a lock</a> <a
                    href="#ref-for-enqueue-the-following-steps⑤">(2)</a>
            <li><a href="#ref-for-enqueue-the-following-steps⑥">4.3. Abort a request</a>
            <li><a href="#ref-for-enqueue-the-following-steps⑦">4.4. Process a lock request queue for a given resource
                    name</a> <a href="#ref-for-enqueue-the-following-steps⑧">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-enqueue-the-following-steps">
        <a
            href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps">https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-enqueue-the-following-steps">2. Concepts</a>
            <li><a href="#ref-for-enqueue-the-following-steps①">2.4. Locks</a>
            <li><a href="#ref-for-enqueue-the-following-steps②">2.6. Termination of Locks</a>
            <li><a href="#ref-for-enqueue-the-following-steps③">3.2.2. The query() method</a>
            <li><a href="#ref-for-enqueue-the-following-steps④">4.1. Request a lock</a> <a
                    href="#ref-for-enqueue-the-following-steps⑤">(2)</a>
            <li><a href="#ref-for-enqueue-the-following-steps⑥">4.3. Abort a request</a>
            <li><a href="#ref-for-enqueue-the-following-steps⑦">4.4. Process a lock request queue for a given resource
                    name</a> <a href="#ref-for-enqueue-the-following-steps⑧">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-environment-settings-object">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-environment-settings-object">2.2. Lock Managers</a>
            <li><a href="#ref-for-environment-settings-object①">3.1. Navigator Mixins</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-fully-active">
        <a
            href="https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active">https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-fully-active">3.2.1. The request() method</a>
            <li><a href="#ref-for-fully-active①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-environment-id">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id">https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-environment-id">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-concept-relevant-global">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-concept-relevant-global">3.2.1. The request() method</a>
            <li><a href="#ref-for-concept-relevant-global①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-relevant-settings-object">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-relevant-settings-object">3.1. Navigator Mixins</a>
            <li><a href="#ref-for-relevant-settings-object①">3.2.1. The request() method</a>
            <li><a href="#ref-for-relevant-settings-object②">3.2.2. The query() method</a>
            <li><a href="#ref-for-relevant-settings-object③">4.1. Request a lock</a>
            <li><a href="#ref-for-relevant-settings-object④">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-responsible-event-loop">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop">https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-responsible-event-loop">4.1. Request a lock</a>
            <li><a href="#ref-for-responsible-event-loop①">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-starting-a-new-parallel-queue">
        <a
            href="https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue">https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-starting-a-new-parallel-queue">2. Concepts</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-task-source">
        <a
            href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">https://html.spec.whatwg.org/multipage/webappapis.html#task-source</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-task-source">2. Concepts</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-unloading-document-cleanup-steps">
        <a
            href="https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps">https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-unloading-document-cleanup-steps">2.6. Termination of Locks</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-append">
        <a href="https://infra.spec.whatwg.org/#list-append">https://infra.spec.whatwg.org/#list-append</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-append">4.5. Snapshot the lock state</a> <a href="#ref-for-list-append①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-set-append">
        <a href="https://infra.spec.whatwg.org/#set-append">https://infra.spec.whatwg.org/#set-append</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-set-append">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-assert">
        <a href="https://infra.spec.whatwg.org/#assert">https://infra.spec.whatwg.org/#assert</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-assert">4.2. Release a lock</a>
            <li><a href="#ref-for-assert①">4.3. Abort a request</a>
            <li><a href="#ref-for-assert②">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-assert③">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-queue-enqueue">
        <a href="https://infra.spec.whatwg.org/#queue-enqueue">https://infra.spec.whatwg.org/#queue-enqueue</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-queue-enqueue">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-map-exists">
        <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-map-exists">2.5. Lock Requests</a>
            <li><a href="#ref-for-map-exists①">3.2.1. The request() method</a> <a href="#ref-for-map-exists②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-iterate">
        <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-iterate">4.1. Request a lock</a>
            <li><a href="#ref-for-list-iterate①">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-list-iterate②">4.5. Snapshot the lock state</a> <a
                    href="#ref-for-list-iterate③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-map-iterate">
        <a href="https://infra.spec.whatwg.org/#map-iterate">https://infra.spec.whatwg.org/#map-iterate</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-map-iterate">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-is-empty">
        <a href="https://infra.spec.whatwg.org/#list-is-empty">https://infra.spec.whatwg.org/#list-is-empty</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-is-empty">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-item">
        <a href="https://infra.spec.whatwg.org/#list-item">https://infra.spec.whatwg.org/#list-item</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-item">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-struct-item">
        <a href="https://infra.spec.whatwg.org/#struct-item">https://infra.spec.whatwg.org/#struct-item</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-struct-item">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-string">
        <a href="https://infra.spec.whatwg.org/#string">https://infra.spec.whatwg.org/#string</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-string">2.1. Resources Names</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list">
        <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-list">4.5. Snapshot the lock state</a> <a href="#ref-for-list①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-ordered-map">
        <a href="https://infra.spec.whatwg.org/#ordered-map">https://infra.spec.whatwg.org/#ordered-map</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-ordered-map">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-prepend">
        <a href="https://infra.spec.whatwg.org/#list-prepend">https://infra.spec.whatwg.org/#list-prepend</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-prepend">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-queue">
        <a href="https://infra.spec.whatwg.org/#queue">https://infra.spec.whatwg.org/#queue</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-queue">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-list-remove">
        <a href="https://infra.spec.whatwg.org/#list-remove">https://infra.spec.whatwg.org/#list-remove</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-list-remove">4.1. Request a lock</a>
            <li><a href="#ref-for-list-remove①">4.2. Release a lock</a>
            <li><a href="#ref-for-list-remove②">4.3. Abort a request</a>
            <li><a href="#ref-for-list-remove③">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-ordered-set">
        <a href="https://infra.spec.whatwg.org/#ordered-set">https://infra.spec.whatwg.org/#ordered-set</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-ordered-set">2.4. Locks</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-map-set">
        <a href="https://infra.spec.whatwg.org/#map-set">https://infra.spec.whatwg.org/#map-set</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-map-set">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-struct">
        <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-struct">2.5. Lock Requests</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-map-getting-the-values">
        <a
            href="https://infra.spec.whatwg.org/#map-getting-the-values">https://infra.spec.whatwg.org/#map-getting-the-values</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-map-getting-the-values">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-client">
        <a href="https://www.w3.org/TR/service-workers-1/#client">https://www.w3.org/TR/service-workers-1/#client</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-client">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dom-client-id">
        <a
            href="https://www.w3.org/TR/service-workers-1/#dom-client-id">https://www.w3.org/TR/service-workers-1/#dom-client-id</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-client-id">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-obtain-a-local-storage-bottle-map">
        <a
            href="https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map">https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-obtain-a-local-storage-bottle-map">2.2. Lock Managers</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-storage-bottle">
        <a href="https://storage.spec.whatwg.org/#storage-bottle">https://storage.spec.whatwg.org/#storage-bottle</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-storage-bottle">2.2. Lock Managers</a> <a href="#ref-for-storage-bottle①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-storage-bucket">
        <a href="https://storage.spec.whatwg.org/#storage-bucket">https://storage.spec.whatwg.org/#storage-bucket</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-storage-bucket">1. Introduction</a>
            <li><a href="#ref-for-storage-bucket①">2.1. Resources Names</a>
            <li><a href="#ref-for-storage-bucket②">2.2. Lock Managers</a> <a href="#ref-for-storage-bucket③">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-aborterror">
        <a href="https://webidl.spec.whatwg.org/#aborterror">https://webidl.spec.whatwg.org/#aborterror</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-aborterror">3.2.1. The request() method</a> <a href="#ref-for-aborterror①">(2)</a>
            <li><a href="#ref-for-aborterror②">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-DOMException">
        <a
            href="https://webidl.spec.whatwg.org/#idl-DOMException">https://webidl.spec.whatwg.org/#idl-DOMException</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-DOMException">3.2.1. The request() method</a> <a
                    href="#ref-for-idl-DOMException①">(2)</a> <a href="#ref-for-idl-DOMException②">(3)</a> <a
                    href="#ref-for-idl-DOMException③">(4)</a> <a href="#ref-for-idl-DOMException④">(5)</a> <a
                    href="#ref-for-idl-DOMException⑤">(6)</a>
            <li><a href="#ref-for-idl-DOMException⑥">3.2.2. The query() method</a> <a
                    href="#ref-for-idl-DOMException⑦">(2)</a>
            <li><a href="#ref-for-idl-DOMException⑧">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-DOMString">
        <a href="https://webidl.spec.whatwg.org/#idl-DOMString">https://webidl.spec.whatwg.org/#idl-DOMString</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-DOMString">3.2. LockManager class</a> <a href="#ref-for-idl-DOMString①">(2)</a> <a
                    href="#ref-for-idl-DOMString②">(3)</a> <a href="#ref-for-idl-DOMString③">(4)</a>
            <li><a href="#ref-for-idl-DOMString④">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-Exposed">
        <a href="https://webidl.spec.whatwg.org/#Exposed">https://webidl.spec.whatwg.org/#Exposed</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-Exposed">3.2. LockManager class</a>
            <li><a href="#ref-for-Exposed①">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-invalidstateerror">
        <a
            href="https://webidl.spec.whatwg.org/#invalidstateerror">https://webidl.spec.whatwg.org/#invalidstateerror</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-invalidstateerror">3.2.1. The request() method</a>
            <li><a href="#ref-for-invalidstateerror①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-notsupportederror">
        <a
            href="https://webidl.spec.whatwg.org/#notsupportederror">https://webidl.spec.whatwg.org/#notsupportederror</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-notsupportederror">3.2.1. The request() method</a> <a
                    href="#ref-for-notsupportederror①">(2)</a> <a href="#ref-for-notsupportederror②">(3)</a> <a
                    href="#ref-for-notsupportederror③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-promise">
        <a href="https://webidl.spec.whatwg.org/#idl-promise">https://webidl.spec.whatwg.org/#idl-promise</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-promise">3.2. LockManager class</a> <a href="#ref-for-idl-promise①">(2)</a> <a
                    href="#ref-for-idl-promise②">(3)</a> <a href="#ref-for-idl-promise③">(4)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-SecureContext">
        <a href="https://webidl.spec.whatwg.org/#SecureContext">https://webidl.spec.whatwg.org/#SecureContext</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-SecureContext">3.1. Navigator Mixins</a>
            <li><a href="#ref-for-SecureContext①">3.2. LockManager class</a>
            <li><a href="#ref-for-SecureContext②">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-securityerror">
        <a href="https://webidl.spec.whatwg.org/#securityerror">https://webidl.spec.whatwg.org/#securityerror</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-securityerror">3.2.1. The request() method</a>
            <li><a href="#ref-for-securityerror①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-a-new-promise">
        <a href="https://webidl.spec.whatwg.org/#a-new-promise">https://webidl.spec.whatwg.org/#a-new-promise</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-a-new-promise">3.2.1. The request() method</a>
            <li><a href="#ref-for-a-new-promise①">3.2.2. The query() method</a>
            <li><a href="#ref-for-a-new-promise②">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-a-promise-rejected-with">
        <a
            href="https://webidl.spec.whatwg.org/#a-promise-rejected-with">https://webidl.spec.whatwg.org/#a-promise-rejected-with</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-a-promise-rejected-with">3.2.1. The request() method</a> <a
                    href="#ref-for-a-promise-rejected-with①">(2)</a> <a href="#ref-for-a-promise-rejected-with②">(3)</a>
                <a href="#ref-for-a-promise-rejected-with③">(4)</a> <a href="#ref-for-a-promise-rejected-with④">(5)</a>
                <a href="#ref-for-a-promise-rejected-with⑤">(6)</a> <a href="#ref-for-a-promise-rejected-with⑥">(7)</a>
            <li><a href="#ref-for-a-promise-rejected-with⑦">3.2.2. The query() method</a> <a
                    href="#ref-for-a-promise-rejected-with⑧">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-any">
        <a href="https://webidl.spec.whatwg.org/#idl-any">https://webidl.spec.whatwg.org/#idl-any</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-any">3.2. LockManager class</a> <a href="#ref-for-idl-any①">(2)</a> <a
                    href="#ref-for-idl-any②">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-boolean">
        <a href="https://webidl.spec.whatwg.org/#idl-boolean">https://webidl.spec.whatwg.org/#idl-boolean</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-boolean">3.2. LockManager class</a> <a href="#ref-for-idl-boolean①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-dfn-callback-function">
        <a
            href="https://webidl.spec.whatwg.org/#dfn-callback-function">https://webidl.spec.whatwg.org/#dfn-callback-function</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dfn-callback-function">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-invoke-a-callback-function">
        <a
            href="https://webidl.spec.whatwg.org/#invoke-a-callback-function">https://webidl.spec.whatwg.org/#invoke-a-callback-function</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-invoke-a-callback-function">4.1. Request a lock</a>
            <li><a href="#ref-for-invoke-a-callback-function①">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-reject">
        <a href="https://webidl.spec.whatwg.org/#reject">https://webidl.spec.whatwg.org/#reject</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-reject">4.1. Request a lock</a>
            <li><a href="#ref-for-reject①">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-resolve">
        <a href="https://webidl.spec.whatwg.org/#resolve">https://webidl.spec.whatwg.org/#resolve</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-resolve">2.4. Locks</a>
            <li><a href="#ref-for-resolve①">4.1. Request a lock</a>
            <li><a href="#ref-for-resolve②">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-resolve③">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-idl-sequence">
        <a href="https://webidl.spec.whatwg.org/#idl-sequence">https://webidl.spec.whatwg.org/#idl-sequence</a><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-idl-sequence">3.2. LockManager class</a> <a href="#ref-for-idl-sequence①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="term-for-this">
        <a href="https://webidl.spec.whatwg.org/#this">https://webidl.spec.whatwg.org/#this</a><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-this">3.1. Navigator Mixins</a>
            <li><a href="#ref-for-this①">3.2.1. The request() method</a>
            <li><a href="#ref-for-this②">3.2.2. The query() method</a>
        </ul>
    </aside>
    <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">参照によって定義される用語</span><a
            class="self-link" href="#index-defined-elsewhere"></a></h3>
    <ul class="index">
        <li>
            <a data-link-type="biblio">[CSS21]</a> で以下の用語が定義されています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-user-agent">ユーザーエージェント</span>
            </ul>
        <li>
            <a data-link-type="biblio">[DOM]</a> で以下の用語が定義されています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-abortsignal">AbortSignal</span>
                <li><span class="dfn-paneled" id="term-for-abortsignal-abort-reason">abort reason</span>
                <li><span class="dfn-paneled" id="term-for-abortsignal-aborted">aborted</span>
                <li><span class="dfn-paneled" id="term-for-abortsignal-add">add</span>
                <li><span class="dfn-paneled" id="term-for-concept-document">document</span>
                <li><span class="dfn-paneled" id="term-for-abortsignal-remove">remove</span>
            </ul>
        <li>
            <a data-link-type="biblio">[ECMA262]</a> で以下の用語が定義されています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-agent">agent</span>
            </ul>
        <li>
            <a data-link-type="biblio">[HTML]</a> で以下の用語が定義されています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-navigator">Navigator</span>
                <li><span class="dfn-paneled" id="term-for-workernavigator">WorkerNavigator</span>
                <li><span class="dfn-paneled"
                        id="term-for-integration-with-the-javascript-agent-cluster-formalism">agent cluster</span>
                <li><span class="dfn-paneled" id="term-for-concept-document-window">associated document</span>
                <li><span class="dfn-paneled" id="term-for-browsing-context">browsing context</span>
                <li><span class="dfn-paneled" id="term-for-enqueue-the-following-steps">enqueue steps</span>
                <li><span class="dfn-paneled" id="term-for-enqueue-the-following-steps①">enqueue the following
                        steps</span>
                <li><span class="dfn-paneled" id="term-for-environment-settings-object">environment settings
                        object</span>
                <li><span class="dfn-paneled" id="term-for-fully-active">fully active</span>
                <li><span class="dfn-paneled" id="term-for-concept-environment-id">id</span>
                <li><span class="dfn-paneled" id="term-for-concept-relevant-global">relevant global object</span>
                <li><span class="dfn-paneled" id="term-for-relevant-settings-object">relevant settings object</span>
                <li><span class="dfn-paneled" id="term-for-responsible-event-loop">responsible event loop</span>
                <li><span class="dfn-paneled" id="term-for-starting-a-new-parallel-queue">starting a new parallel
                        queue</span>
                <li><span class="dfn-paneled" id="term-for-task-source">task source</span>
                <li><span class="dfn-paneled" id="term-for-unloading-document-cleanup-steps">unloading document cleanup
                        steps</span>
            </ul>
        <li>
            <a data-link-type="biblio">[INFRA]</a> で以下の用語が定義されています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-list-append">append <small>(list向け)</small></span>
                <li><span class="dfn-paneled" id="term-for-set-append">append <small>(set向け)</small></span>
                <li><span class="dfn-paneled" id="term-for-assert">assert</span>
                <li><span class="dfn-paneled" id="term-for-queue-enqueue">enqueue</span>
                <li><span class="dfn-paneled" id="term-for-map-exists">exist</span>
                <li><span class="dfn-paneled" id="term-for-list-iterate">for each <small>(list向け)</small></span>
                <li><span class="dfn-paneled" id="term-for-map-iterate">for each <small>(map向け)</small></span>
                <li><span class="dfn-paneled" id="term-for-list-is-empty">is empty</span>
                <li><span class="dfn-paneled" id="term-for-list-item">item <small>(list向け)</small></span>
                <li><span class="dfn-paneled" id="term-for-struct-item">item <small>(struct向け)</small></span>
                <li><span class="dfn-paneled" id="term-for-string">javascript string</span>
                <li><span class="dfn-paneled" id="term-for-list">list</span>
                <li><span class="dfn-paneled" id="term-for-ordered-map">map</span>
                <li><span class="dfn-paneled" id="term-for-list-prepend">prepend</span>
                <li><span class="dfn-paneled" id="term-for-queue">queue</span>
                <li><span class="dfn-paneled" id="term-for-list-remove">remove</span>
                <li><span class="dfn-paneled" id="term-for-ordered-set">set</span>
                <li><span class="dfn-paneled" id="term-for-map-set">set <small>(map向け)</small></span>
                <li><span class="dfn-paneled" id="term-for-struct">struct</span>
                <li><span class="dfn-paneled" id="term-for-map-getting-the-values">values</span>
            </ul>
        <li>
            <a data-link-type="biblio">[Service-Workers]</a> で以下の用語が定義されています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-client">Client</span>
                <li><span class="dfn-paneled" id="term-for-dom-client-id">id</span>
            </ul>
        <li>
            <a data-link-type="biblio">[Storage]</a> で以下の用語が定義されています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-obtain-a-local-storage-bottle-map">obtain a local storage
                        bottle map</span>
                <li><span class="dfn-paneled" id="term-for-storage-bottle">storage bottle</span>
                <li><span class="dfn-paneled" id="term-for-storage-bucket">storage bucket</span>
            </ul>
        <li>
            <a data-link-type="biblio">[WEBIDL]</a> で以下の用語が定義されています：
            <ul>
                <li><span class="dfn-paneled" id="term-for-aborterror">AbortError</span>
                <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
                <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
                <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
                <li><span class="dfn-paneled" id="term-for-invalidstateerror">InvalidStateError</span>
                <li><span class="dfn-paneled" id="term-for-notsupportederror">NotSupportedError</span>
                <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
                <li><span class="dfn-paneled" id="term-for-SecureContext">SecureContext</span>
                <li><span class="dfn-paneled" id="term-for-securityerror">SecurityError</span>
                <li><span class="dfn-paneled" id="term-for-a-new-promise">新しいpromise</span>
                <li><span class="dfn-paneled" id="term-for-a-promise-rejected-with">rejectされたpromise</span>
                <li><span class="dfn-paneled" id="term-for-idl-any">any</span>
                <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean</span>
                <li><span class="dfn-paneled" id="term-for-dfn-callback-function">callback function</span>
                <li><span class="dfn-paneled" id="term-for-invoke-a-callback-function">invoke</span>
                <li><span class="dfn-paneled" id="term-for-reject">reject</span>
                <li><span class="dfn-paneled" id="term-for-resolve">resolve</span>
                <li><span class="dfn-paneled" id="term-for-idl-sequence">sequence</span>
                <li><span class="dfn-paneled" id="term-for-this">this</span>
            </ul>
    </ul>
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">参考文献</span><a class="self-link"
            href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">規範参考文献</span><a class="self-link"
            href="#normative"></a></h3>
    <dl>
        <dt id="biblio-css21">[CSS21]
        <dd>Bert Bos; 他. <a href="https://www.w3.org/TR/CSS21/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS
                    2.1) Specification</cite></a>. 2011年6月7日. REC. URL: <a
                href="https://www.w3.org/TR/CSS21/">https://www.w3.org/TR/CSS21/</a>
        <dt id="biblio-dom">[DOM]
        <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. 現行標準.
            URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
        <dt id="biblio-html">[HTML]
        <dd>Anne van Kesteren; 他. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>.
            現行標準. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
        <dt id="biblio-infra">[INFRA]
        <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra
                    Standard</cite></a>. 現行標準. URL: <a
                href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
        <dt id="biblio-rfc2119">[RFC2119]
        <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to
                    Indicate Requirement Levels</cite></a>. 1997年3月. Best Current Practice. URL: <a
                href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
        <dt id="biblio-storage">[Storage]
        <dd>Anne van Kesteren. <a href="https://storage.spec.whatwg.org/"><cite>Storage Standard</cite></a>. 現行標準.
            URL: <a href="https://storage.spec.whatwg.org/">https://storage.spec.whatwg.org/</a>
        <dt id="biblio-webidl">[WEBIDL]
        <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. 現行標準.
            URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">参考情報</span><a class="self-link"
            href="#informative"></a></h3>
    <dl>
        <dt id="biblio-indexeddb-2">[IndexedDB-2]
        <dd>Ali Alabbas; Joshua Bell. <a href="https://www.w3.org/TR/IndexedDB-2/"><cite>Indexed Database API
                    2.0</cite></a>. 2018年1月30日. REC. URL: <a
                href="https://www.w3.org/TR/IndexedDB-2/">https://www.w3.org/TR/IndexedDB-2/</a>
        <dt id="biblio-service-workers">[Service-Workers]
        <dd>Jake Archibald; Marijn Kruisselbrink. <a href="https://www.w3.org/TR/service-workers/"><cite>Service
                    Workers</cite></a>. 2022年7月12日. CR. URL: <a
                href="https://www.w3.org/TR/service-workers/">https://www.w3.org/TR/service-workers/</a>
    </dl>
    <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL索引</span><a class="self-link"
            href="#idl-index"></a></h2>
    <pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <c- b>mixin</c-> <a href="#navigatorlocks"><code><c- g>NavigatorLocks</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#lockmanager"><c- n>LockManager</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockManager" href="#dom-navigatorlocks-locks"><c- g>locks</c-></a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator"><c- n>Navigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks"><c- n>NavigatorLocks</c-></a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator"><c- n>WorkerNavigator</c-></a> <c- b>includes</c-> <a data-link-type="idl-name" href="#navigatorlocks"><c- n>NavigatorLocks</c-></a>;

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#lockmanager"><code><c- g>LockManager</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-lockmanager-request-name-callback-name"><code><c- g>name</c-></code></a>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback"><c- n>LockGrantedCallback</c-></a> <a href="#dom-lockmanager-request-name-callback-callback"><code><c- g>callback</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-request-name-options-callback"><c- g>request</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-lockmanager-request-name-options-callback-name"><code><c- g>name</c-></code></a>,
                       <a data-link-type="idl-name" href="#dictdef-lockoptions"><c- n>LockOptions</c-></a> <a href="#dom-lockmanager-request-name-options-callback-options"><code><c- g>options</c-></code></a>,
                       <a data-link-type="idl-name" href="#callbackdef-lockgrantedcallback"><c- n>LockGrantedCallback</c-></a> <a href="#dom-lockmanager-request-name-options-callback-callback"><code><c- g>callback</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockmanagersnapshot"><c- n>LockManagerSnapshot</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-lockmanager-query"><c- g>query</c-></a>();
};

<c- b>callback</c-> <a href="#callbackdef-lockgrantedcallback"><code><c- g>LockGrantedCallback</c-></code></a> = <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> (<a data-link-type="idl-name" href="#lock"><c- n>Lock</c-></a>? <a href="#dom-lockgrantedcallback-lock"><code><c- g>lock</c-></code></a>);

<c- b>enum</c-> <a href="#enumdef-lockmode"><code><c- g>LockMode</c-></code></a> { <a href="#dom-lockmode-shared"><code><c- s>"shared"</c-></code></a>, <a href="#dom-lockmode-exclusive"><code><c- s>"exclusive"</c-></code></a> };

<c- b>dictionary</c-> <a href="#dictdef-lockoptions"><code><c- g>LockOptions</c-></code></a> {
  <a data-link-type="idl-name" href="#enumdef-lockmode"><c- n>LockMode</c-></a> <a data-default="&quot;exclusive&quot;" data-type="LockMode " href="#dom-lockoptions-mode"><code><c- g>mode</c-></code></a> = "exclusive";
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-lockoptions-ifavailable"><code><c- g>ifAvailable</c-></code></a> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-lockoptions-steal"><code><c- g>steal</c-></code></a> = <c- b>false</c->;
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> <a data-type="AbortSignal " href="#dom-lockoptions-signal"><code><c- g>signal</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-lockmanagersnapshot"><code><c- g>LockManagerSnapshot</c-></code></a> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo"><c- n>LockInfo</c-></a>> <a data-type="sequence<LockInfo> " href="#dom-lockmanagersnapshot-held"><code><c- g>held</c-></code></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-lockinfo"><c- n>LockInfo</c-></a>> <a data-type="sequence<LockInfo> " href="#dom-lockmanagersnapshot-pending"><code><c- g>pending</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-lockinfo"><code><c- g>LockInfo</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-lockinfo-name"><code><c- g>name</c-></code></a>;
  <a data-link-type="idl-name" href="#enumdef-lockmode"><c- n>LockMode</c-></a> <a data-type="LockMode " href="#dom-lockinfo-mode"><code><c- g>mode</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-lockinfo-clientid"><code><c- g>clientId</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#lock"><code><c- g>Lock</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-lock-name"><c- g>name</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-lockmode"><c- n>LockMode</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="LockMode" href="#dom-lock-mode"><c- g>mode</c-></a>;
};

</pre>
    <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">課題索引</span><a class="self-link"
            href="#issues-index"></a></h2>
    <div style="counter-reset:issue">
        <div class="issue"> ここで <a data-link-type="biblio" href="#biblio-storage" title="Storage Standard">[Storage]</a>
            との統合を改善し、与えられた環境からどのようにロックマネージャを正しく取得するかを含めて明確にしてください。<a class="issue-return" href="#issue-73644ca1"
                title="Jump to section">↵</a></div>
        <div class="issue"> これは現在ワーカー専用であり、ワーカー終了時にステップを実行する規範的な方法がないため、定義が曖昧です。<a class="issue-return"
                href="#issue-9062c3e0" title="Jump to section">↵</a></div>
    </div>
    <aside class="dfn-panel" data-for="lock-task-queue">
        <b><a href="#lock-task-queue">#lock-task-queue</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-task-queue">2.4. Locks</a>
            <li><a href="#ref-for-lock-task-queue①">2.6. Termination of Locks</a>
            <li><a href="#ref-for-lock-task-queue②">3.2.2. The query() method</a>
            <li><a href="#ref-for-lock-task-queue③">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-task-queue④">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-task-queue⑤">4.3. Abort a request</a> <a href="#ref-for-lock-task-queue⑥">(2)</a>
            <li><a href="#ref-for-lock-task-queue⑦">4.4. Process a lock request queue for a given resource name</a> <a
                    href="#ref-for-lock-task-queue⑧">(2)</a>
            <li><a href="#ref-for-lock-task-queue⑨">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="resource-name">
        <b><a href="#resource-name">#resource-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-resource-name">1. Introduction</a> <a href="#ref-for-resource-name①">(2)</a>
            <li><a href="#ref-for-resource-name②">2.4. Locks</a>
            <li><a href="#ref-for-resource-name③">2.5. Lock Requests</a> <a href="#ref-for-resource-name④">(2)</a>
            <li><a href="#ref-for-resource-name⑤">3.2.1. The request() method</a>
            <li><a href="#ref-for-resource-name⑥">4.2. Release a lock</a>
            <li><a href="#ref-for-resource-name⑦">6.4. Checklist</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-manager">
        <b><a href="#lock-manager">#lock-manager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-manager">2.2. Lock Managers</a> <a href="#ref-for-lock-manager①">(2)</a> <a
                    href="#ref-for-lock-manager②">(3)</a>
            <li><a href="#ref-for-lock-manager③">2.4. Locks</a> <a href="#ref-for-lock-manager④">(2)</a>
            <li><a href="#ref-for-lock-manager⑤">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-manager⑥">3.2. LockManager class</a>
            <li><a href="#ref-for-lock-manager⑦">3.2.2. The query() method</a> <a href="#ref-for-lock-manager⑧">(2)</a>
            <li><a href="#ref-for-lock-manager⑨">5.1. Deadlocks</a>
            <li><a href="#ref-for-lock-manager①⓪">6.1. Lock Scope</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="obtain-a-lock-manager">
        <b><a href="#obtain-a-lock-manager">#obtain-a-lock-manager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-obtain-a-lock-manager">3.2.1. The request() method</a>
            <li><a href="#ref-for-obtain-a-lock-manager①">3.2.2. The query() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="mode">
        <b><a href="#mode">#mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-mode">1. Introduction</a> <a href="#ref-for-mode①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept">
        <b><a href="#lock-concept">#lock-concept</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept">1. Introduction</a>
            <li><a href="#ref-for-lock-concept①">2.2. Lock Managers</a>
            <li><a href="#ref-for-lock-concept②">2.4. Locks</a> <a href="#ref-for-lock-concept③">(2)</a> <a
                    href="#ref-for-lock-concept④">(3)</a> <a href="#ref-for-lock-concept⑤">(4)</a> <a
                    href="#ref-for-lock-concept⑥">(5)</a> <a href="#ref-for-lock-concept⑦">(6)</a> <a
                    href="#ref-for-lock-concept⑧">(7)</a> <a href="#ref-for-lock-concept⑨">(8)</a> <a
                    href="#ref-for-lock-concept①⓪">(9)</a>
            <li><a href="#ref-for-lock-concept①①">2.5. Lock Requests</a> <a href="#ref-for-lock-concept①②">(2)</a> <a
                    href="#ref-for-lock-concept①③">(3)</a>
            <li><a href="#ref-for-lock-concept①④">2.6. Termination of Locks</a>
            <li><a href="#ref-for-lock-concept①⑤">3.3. Lock class</a> <a href="#ref-for-lock-concept①⑥">(2)</a> <a
                    href="#ref-for-lock-concept①⑦">(3)</a>
            <li><a href="#ref-for-lock-concept①⑧">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-concept①⑨">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-concept②⓪">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-agent">
        <b><a href="#lock-concept-agent">#lock-concept-agent</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-agent">2.6. Termination of Locks</a>
            <li><a href="#ref-for-lock-concept-agent①">4.4. Process a lock request queue for a given resource name</a>
                <a href="#ref-for-lock-concept-agent②">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-clientid">
        <b><a href="#lock-concept-clientid">#lock-concept-clientid</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-clientid">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-concept-clientid①">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-manager">
        <b><a href="#lock-concept-manager">#lock-concept-manager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-manager">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-concept-manager①">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-name">
        <b><a href="#lock-concept-name">#lock-concept-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-name">2.5. Lock Requests</a> <a
                    href="#ref-for-lock-concept-name①">(2)</a>
            <li><a href="#ref-for-lock-concept-name②">3.3. Lock class</a>
            <li><a href="#ref-for-lock-concept-name③">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-concept-name④">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-concept-name⑤">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-mode">
        <b><a href="#lock-concept-mode">#lock-concept-mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-mode">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-concept-mode①">3.3. Lock class</a>
            <li><a href="#ref-for-lock-concept-mode②">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-concept-mode③">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-waiting-promise">
        <b><a href="#lock-concept-waiting-promise">#lock-concept-waiting-promise</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-waiting-promise">2.4. Locks</a> <a
                    href="#ref-for-lock-concept-waiting-promise①">(2)</a> <a
                    href="#ref-for-lock-concept-waiting-promise②">(3)</a> <a
                    href="#ref-for-lock-concept-waiting-promise③">(4)</a> <a
                    href="#ref-for-lock-concept-waiting-promise④">(5)</a>
            <li><a href="#ref-for-lock-concept-waiting-promise⑤">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-concept-released-promise">
        <b><a href="#lock-concept-released-promise">#lock-concept-released-promise</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-concept-released-promise">2.4. Locks</a> <a
                    href="#ref-for-lock-concept-released-promise①">(2)</a> <a
                    href="#ref-for-lock-concept-released-promise②">(3)</a> <a
                    href="#ref-for-lock-concept-released-promise③">(4)</a>
            <li><a href="#ref-for-lock-concept-released-promise④">3.2.1. The request() method</a>
            <li><a href="#ref-for-lock-concept-released-promise⑤">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-concept-released-promise⑥">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-manager-held-lock-set">
        <b><a href="#lock-manager-held-lock-set">#lock-manager-held-lock-set</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-manager-held-lock-set">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-manager-held-lock-set①">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-manager-held-lock-set②">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-manager-held-lock-set③">4.4. Process a lock request queue for a given resource
                    name</a>
            <li><a href="#ref-for-lock-manager-held-lock-set④">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request">
        <b><a href="#lock-request">#lock-request</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request">1. Introduction</a>
            <li><a href="#ref-for-lock-request①">2.2. Lock Managers</a>
            <li><a href="#ref-for-lock-request②">2.5. Lock Requests</a> <a href="#ref-for-lock-request③">(2)</a> <a
                    href="#ref-for-lock-request④">(3)</a>
            <li><a href="#ref-for-lock-request⑤">2.6. Termination of Locks</a>
            <li><a href="#ref-for-lock-request⑥">3.2. LockManager class</a>
            <li><a href="#ref-for-lock-request⑦">4.1. Request a lock</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-agent">
        <b><a href="#lock-request-agent">#lock-request-agent</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-agent">2.6. Termination of Locks</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-clientid">
        <b><a href="#lock-request-clientid">#lock-request-clientid</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-clientid">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-request-clientid①">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-manager">
        <b><a href="#lock-request-manager">#lock-request-manager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-manager">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-request-manager①">4.3. Abort a request</a>
            <li><a href="#ref-for-lock-request-manager②">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-name">
        <b><a href="#lock-request-name">#lock-request-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-name">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-request-name①">4.3. Abort a request</a>
            <li><a href="#ref-for-lock-request-name②">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-request-name③">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-mode">
        <b><a href="#lock-request-mode">#lock-request-mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-mode">2.5. Lock Requests</a>
            <li><a href="#ref-for-lock-request-mode①">4.4. Process a lock request queue for a given resource name</a>
            <li><a href="#ref-for-lock-request-mode②">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-callback">
        <b><a href="#lock-request-callback">#lock-request-callback</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-callback">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-promise">
        <b><a href="#lock-request-promise">#lock-request-promise</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-promise">4.3. Abort a request</a>
            <li><a href="#ref-for-lock-request-promise①">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-signal">
        <b><a href="#lock-request-signal">#lock-request-signal</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-signal">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-request-queue">
        <b><a href="#lock-request-queue">#lock-request-queue</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock-request-queue">2.5. Lock Requests</a> <a
                    href="#ref-for-lock-request-queue①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock-manager-lock-request-queue-map">
        <b><a href="#lock-manager-lock-request-queue-map">#lock-manager-lock-request-queue-map</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map">2.5. Lock Requests</a> <a
                    href="#ref-for-lock-manager-lock-request-queue-map①">(2)</a>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map②">4.1. Request a lock</a>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map③">4.2. Release a lock</a>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map④">4.3. Abort a request</a>
            <li><a href="#ref-for-lock-manager-lock-request-queue-map⑤">4.5. Snapshot the lock state</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="get-the-lock-request-queue">
        <b><a href="#get-the-lock-request-queue">#get-the-lock-request-queue</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-get-the-lock-request-queue">2.5. Lock Requests</a>
            <li><a href="#ref-for-get-the-lock-request-queue①">4.1. Request a lock</a>
            <li><a href="#ref-for-get-the-lock-request-queue②">4.2. Release a lock</a>
            <li><a href="#ref-for-get-the-lock-request-queue③">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="grantable">
        <b><a href="#grantable">#grantable</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-grantable">4.1. Request a lock</a>
            <li><a href="#ref-for-grantable①">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="terminate-remaining-locks-and-requests">
        <b><a
                href="#terminate-remaining-locks-and-requests">#terminate-remaining-locks-and-requests</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-terminate-remaining-locks-and-requests">2.6. Termination of Locks</a> <a
                    href="#ref-for-terminate-remaining-locks-and-requests①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="navigatorlocks">
        <b><a href="#navigatorlocks">#navigatorlocks</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-navigatorlocks">3.1. Navigator Mixins</a> <a href="#ref-for-navigatorlocks①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-navigatorlocks-locks">
        <b><a href="#dom-navigatorlocks-locks">#dom-navigatorlocks-locks</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-navigatorlocks-locks">3.1. Navigator Mixins</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lockmanager">
        <b><a href="#lockmanager">#lockmanager</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lockmanager">2.4. Locks</a>
            <li><a href="#ref-for-lockmanager①">3.1. Navigator Mixins</a> <a href="#ref-for-lockmanager②">(2)</a> <a
                    href="#ref-for-lockmanager③">(3)</a>
            <li><a href="#ref-for-lockmanager④">3.2. LockManager class</a> <a href="#ref-for-lockmanager⑤">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="callbackdef-lockgrantedcallback">
        <b><a href="#callbackdef-lockgrantedcallback">#callbackdef-lockgrantedcallback</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-callbackdef-lockgrantedcallback">3.2. LockManager class</a> <a
                    href="#ref-for-callbackdef-lockgrantedcallback①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="enumdef-lockmode">
        <b><a href="#enumdef-lockmode">#enumdef-lockmode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-enumdef-lockmode">3.2. LockManager class</a> <a
                    href="#ref-for-enumdef-lockmode①">(2)</a>
            <li><a href="#ref-for-enumdef-lockmode②">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmode-shared">
        <b><a href="#dom-lockmode-shared">#dom-lockmode-shared</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmode-shared">2.3. Modes and Scheduling</a> <a
                    href="#ref-for-dom-lockmode-shared①">(2)</a> <a href="#ref-for-dom-lockmode-shared②">(3)</a>
            <li><a href="#ref-for-dom-lockmode-shared③">2.4. Locks</a>
            <li><a href="#ref-for-dom-lockmode-shared④">2.5. Lock Requests</a>
            <li><a href="#ref-for-dom-lockmode-shared⑤">3.2.1. The request() method</a> <a
                    href="#ref-for-dom-lockmode-shared⑥">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmode-exclusive">
        <b><a href="#dom-lockmode-exclusive">#dom-lockmode-exclusive</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmode-exclusive">2.3. Modes and Scheduling</a> <a
                    href="#ref-for-dom-lockmode-exclusive①">(2)</a> <a href="#ref-for-dom-lockmode-exclusive②">(3)</a>
                <a href="#ref-for-dom-lockmode-exclusive③">(4)</a>
            <li><a href="#ref-for-dom-lockmode-exclusive④">2.4. Locks</a>
            <li><a href="#ref-for-dom-lockmode-exclusive⑤">2.5. Lock Requests</a> <a
                    href="#ref-for-dom-lockmode-exclusive⑥">(2)</a>
            <li><a href="#ref-for-dom-lockmode-exclusive⑦">3.2.1. The request() method</a> <a
                    href="#ref-for-dom-lockmode-exclusive⑧">(2)</a> <a href="#ref-for-dom-lockmode-exclusive⑨">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dictdef-lockoptions">
        <b><a href="#dictdef-lockoptions">#dictdef-lockoptions</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dictdef-lockoptions">3.2. LockManager class</a>
            <li><a href="#ref-for-dictdef-lockoptions①">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockoptions-mode">
        <b><a href="#dom-lockoptions-mode">#dom-lockoptions-mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockoptions-mode">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockoptions-ifavailable">
        <b><a href="#dom-lockoptions-ifavailable">#dom-lockoptions-ifavailable</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockoptions-ifavailable">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockoptions-steal">
        <b><a href="#dom-lockoptions-steal">#dom-lockoptions-steal</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockoptions-steal">3.2.1. The request() method</a> <a
                    href="#ref-for-dom-lockoptions-steal①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockoptions-signal">
        <b><a href="#dom-lockoptions-signal">#dom-lockoptions-signal</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockoptions-signal">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dictdef-lockmanagersnapshot">
        <b><a href="#dictdef-lockmanagersnapshot">#dictdef-lockmanagersnapshot</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dictdef-lockmanagersnapshot">3.2. LockManager class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dictdef-lockinfo">
        <b><a href="#dictdef-lockinfo">#dictdef-lockinfo</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dictdef-lockinfo">3.2. LockManager class</a> <a
                    href="#ref-for-dictdef-lockinfo①">(2)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmanager-request">
        <b><a href="#dom-lockmanager-request">#dom-lockmanager-request</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmanager-request">2.4. Locks</a>
            <li><a href="#ref-for-dom-lockmanager-request①">3.2. LockManager class</a>
            <li><a href="#ref-for-dom-lockmanager-request②">3.2.1. The request() method</a> <a
                    href="#ref-for-dom-lockmanager-request③">(2)</a> <a href="#ref-for-dom-lockmanager-request④">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmanager-request-name-options-callback">
        <b><a
                href="#dom-lockmanager-request-name-options-callback">#dom-lockmanager-request-name-options-callback</a></b><b>Referenced
            in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmanager-request-name-options-callback">3.2. LockManager class</a>
            <li><a href="#ref-for-dom-lockmanager-request-name-options-callback①">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lockmanager-query">
        <b><a href="#dom-lockmanager-query">#dom-lockmanager-query</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lockmanager-query">3.2. LockManager class</a>
            <li><a href="#ref-for-dom-lockmanager-query①">3.2.2. The query() method</a> <a
                    href="#ref-for-dom-lockmanager-query②">(2)</a> <a href="#ref-for-dom-lockmanager-query③">(3)</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="lock">
        <b><a href="#lock">#lock</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-lock">3.2. LockManager class</a>
            <li><a href="#ref-for-lock①">3.2.1. The request() method</a>
            <li><a href="#ref-for-lock②">3.3. Lock class</a> <a href="#ref-for-lock③">(2)</a>
            <li><a href="#ref-for-lock④">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lock-name">
        <b><a href="#dom-lock-name">#dom-lock-name</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lock-name">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="dom-lock-mode">
        <b><a href="#dom-lock-mode">#dom-lock-mode</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-dom-lock-mode">3.3. Lock class</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="request-a-lock">
        <b><a href="#request-a-lock">#request-a-lock</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-request-a-lock">3.2.1. The request() method</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="release-the-lock">
        <b><a href="#release-the-lock">#release-the-lock</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-release-the-lock">2.4. Locks</a>
            <li><a href="#ref-for-release-the-lock①">2.6. Termination of Locks</a>
            <li><a href="#ref-for-release-the-lock②">4.4. Process a lock request queue for a given resource name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="abort-the-request">
        <b><a href="#abort-the-request">#abort-the-request</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-abort-the-request">2.6. Termination of Locks</a>
            <li><a href="#ref-for-abort-the-request①">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="signal-to-abort-the-request">
        <b><a href="#signal-to-abort-the-request">#signal-to-abort-the-request</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-signal-to-abort-the-request">4.1. Request a lock</a>
            <li><a href="#ref-for-signal-to-abort-the-request①">4.4. Process a lock request queue for a given resource
                    name</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="process-the-lock-request-queue">
        <b><a href="#process-the-lock-request-queue">#process-the-lock-request-queue</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-process-the-lock-request-queue">4.1. Request a lock</a>
            <li><a href="#ref-for-process-the-lock-request-queue①">4.2. Release a lock</a>
            <li><a href="#ref-for-process-the-lock-request-queue②">4.3. Abort a request</a>
        </ul>
    </aside>
    <aside class="dfn-panel" data-for="snapshot-the-lock-state">
        <b><a href="#snapshot-the-lock-state">#snapshot-the-lock-state</a></b><b>Referenced in:</b>
        <ul>
            <li><a href="#ref-for-snapshot-the-lock-state">3.2.2. The query() method</a>
        </ul>
    </aside>
    <script>/* script-dfn-panel */

        document.body.addEventListener("click", function (e) {
            var queryAll = function (sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while (el.parentElement) {
                if (el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if (el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if (el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if (target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function (el) {
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if (target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if (dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if (panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if (target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
    </script>
    <script>/* script-mdn-anno */
        document.body.addEventListener("click", (e) => {
            if (e.target.closest(".mdn-anno-btn")) {
                e.target.closest(".mdn-anno").classList.toggle("wrapped");
            }
        });</script>
    <script>/* script-var-click-highlighting */

        "use strict";
        {
            document.addEventListener("click", e => {
                if (e.target.nodeName == "VAR") {
                    highlightSameAlgoVars(e.target);
                }
            });
            const indexCounts = new Map();
            const indexNames = new Map();
            function highlightSameAlgoVars(v) {
                // Find the algorithm container.
                let algoContainer = null;
                let searchEl = v;
                while (algoContainer == null && searchEl != document.body) {
                    searchEl = searchEl.parentNode;
                    if (searchEl.hasAttribute("data-algorithm")) {
                        algoContainer = searchEl;
                    }
                }

                // Not highlighting document-global vars,
                // too likely to be unrelated.
                if (algoContainer == null) return;

                const algoName = algoContainer.getAttribute("data-algorithm");
                const varName = getVarName(v);
                const addClass = !v.classList.contains("selected");
                let highlightClass = null;
                if (addClass) {
                    const index = chooseHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] += 1;
                    indexNames.set(algoName + "///" + varName, index);
                    highlightClass = nameFromIndex(index);
                } else {
                    const index = previousHighlightIndex(algoName, varName);
                    indexCounts.get(algoName)[index] -= 1;
                    highlightClass = nameFromIndex(index);
                }

                // Find all same-name vars, and toggle their class appropriately.
                for (const el of algoContainer.querySelectorAll("var")) {
                    if (getVarName(el) == varName) {
                        el.classList.toggle("selected", addClass);
                        el.classList.toggle(highlightClass, addClass);
                    }
                }
            }
            function getVarName(el) {
                return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
            }
            function chooseHighlightIndex(algoName, varName) {
                let indexes = null;
                if (indexCounts.has(algoName)) {
                    indexes = indexCounts.get(algoName);
                } else {
                    // 7 classes right now
                    indexes = [0, 0, 0, 0, 0, 0, 0];
                    indexCounts.set(algoName, indexes);
                }

                // If the element was recently unclicked,
                // *and* that color is still unclaimed,
                // give it back the same color.
                const lastIndex = previousHighlightIndex(algoName, varName);
                if (indexes[lastIndex] === 0) return lastIndex;

                // Find the earliest index with the lowest count.
                const minCount = Math.min.apply(null, indexes);
                let index = null;
                for (var i = 0; i < indexes.length; i++) {
                    if (indexes[i] == minCount) {
                        return i;
                    }
                }
            }
            function previousHighlightIndex(algoName, varName) {
                return indexNames.get(algoName + "///" + varName);
            }
            function nameFromIndex(index) {
                return "selected" + index;
            }
        }
    </script>
    <script src="https://htmlspecs.com/dropdown.js"></script>
