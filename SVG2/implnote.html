<!DOCTYPE html>

<!--
  Scalable Vector Graphics (SVG) 2
  Appendix B: Implementation Notes

  Note: This document is generated from ../master/implnote.html.
  Run "make" from the root of the repository to regenerate it.
  -->

<html lang="ja-JP" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8" />
    <title>実装に関する注意 — SVG 2</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Style sheets for local dev. Will be standardized in processing.
  Add attribute data-keep="" to any extra stylesheet link you do not want removed
  (or use <style>), and include it before here. -->


    <link rel="stylesheet" title="Default" href="https://www.w3.org/TR/SVG2/style/svg.css" type="text/css"
        media="screen" />
    <link rel="alternate stylesheet" title="Only annotations for publication"
        href="https://www.w3.org/TR/SVG2/style/default_no_maturity.css" type="text/css" media="screen" />
    <link rel="alternate stylesheet" title="No issues/annotations"
        href="https://www.w3.org/TR/SVG2/style/default_no_issues.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED" type="text/css" media="screen" />
    <script src="https://www.w3.org/TR/SVG2/style/link-fixup.js"></script>
    <script data-script-mathjax="" async=""
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG"></script>
</head>

<body class="chapter-implnote">

    <h1>付録B: 実装に関する注意</h1>
    <nav id="toc">
        <div class="header top"><a href="index.html">概要</a> . <a href="idl.html">前へ</a> . <a href="access.html">次へ</a> .
            <a href="eltindex.html">要素</a> . <a href="attindex.html">属性</a> . <a href="propidx.html">プロパティ</a>
        </div>
        <h2 id="Contents" class="contents">目次</h2>
        <ol class="toc appendix-toc">
            <li>
                <ol class="toc appendix-toc">
                    <li><a href="implnote.html#Introduction"><span class="secno">B.1.</span> はじめに</a></li>
                    <li><a href="implnote.html#ArcImplementationNotes"><span class="secno">B.2.</span> 楕円弧パラメータ変換</a>
                        <ol class="toc appendix-toc">
                            <li><a href="implnote.html#ArcSyntax"><span class="secno">B.2.1.</span> 楕円弧のエンドポイント構文</a>
                            </li>
                            <li><a href="implnote.html#ArcParameterizationAlternatives"><span
                                        class="secno">B.2.2.</span> パラメータ化の代替案</a></li>
                            <li><a href="implnote.html#ArcConversionCenterToEndpoint"><span class="secno">B.2.3.</span>
                                    中心からエンドポイントへのパラメータ変換</a></li>
                            <li><a href="implnote.html#ArcConversionEndpointToCenter"><span class="secno">B.2.4.</span>
                                    エンドポイントから中心へのパラメータ変換</a></li>
                            <li><a href="implnote.html#ArcCorrectionOutOfRangeRadii"><span class="secno">B.2.5.</span>
                                    範囲外半径の補正</a></li>
                        </ol>
                    </li>
                    <li><a href="implnote.html#NumericPrecisionImplementationNotes"><span class="secno">B.3.</span>
                            高精度ジオメトリ生成に関する注意</a></li>
                </ol>
            </li>
        </ol>
    </nav>

    <h2 id="Introduction" class="heading">B.1. はじめに<a class="self-link" href="#Introduction"></a></h2>

    <p>以下の注意事項は、SVG言語の機能で要求されるフォーマットへのコンテンツ変換や、そこからの変換を行う際に、ソフトウェア開発者が利用できるアルゴリズムやその他の手法について説明します。</p>

    <h2 id="ArcImplementationNotes" class="heading">B.2. 楕円弧パラメータ変換<a class="self-link"
            href="#ArcImplementationNotes"></a></h2>

    <p>
        他のパスセグメント表記と一貫性を持たせるため、SVGパス内の弧は曲線上の開始点と終了点で定義されます。
    </p>

    <p>
        この楕円弧のパラメータ化は<em>エンドポイントパラメータ化</em>と呼ばれます。エンドポイントパラメータ化の利点のひとつは、すべてのパスコマンドが新しい「現在の点」の座標で終わるという一貫したパス構文を可能にすることです。
    </p>

    <p>
        しかし、これはソフトウェアや数学で弧の幾何を記述する唯一の方法ではありません。
        この節では、もう一つの中心パラメータ化について説明し、SVGのエンドポイントパラメータ化との相互変換方法も示します。
    </p>

    <div class="math">

        <h3 id="ArcSyntax" class="heading">B.2.1. 楕円弧のエンドポイント構文<a class="self-link" href="#ArcSyntax"></a></h3>

        <p>SVGパスコマンドで表される楕円弧は、以下のパラメータで順番に記述されます：</p>

        <p>(<var>x</var><sub>1</sub>, <var>y</var><sub>1</sub>)は、パス上の現在の点の絶対座標で、前のパスコマンドの最後の2つのパラメータから取得されます。</p>

        <p><var>r<sub>x</sub></var>
            および<var>r<sub>y</sub></var>
            は楕円の半径（主軸・副軸とも呼ばれます）です。</p>

        <p><var>φ</var>は、現在の座標系のx軸から楕円のx軸への角度です。</p>

        <p><var>f<sub>A</sub></var>は
            ラージアークフラグで、180度以下の弧を選択する場合は0、180度を超える弧を選択する場合は1です。</p>

        <p><var>f<sub>S</sub></var>は
            スウィープフラグで、中心から弧への線が減少方向に角度を移動する場合は0、増加方向の場合は1です。</p>

        <p>(<var>x</var><sub>2</sub>, <var>y</var><sub>2</sub>)は弧の終点の絶対座標です。</p>

        <h3 id="ArcParameterizationAlternatives" class="heading">B.2.2. パラメータ化の代替案<a class="self-link"
                href="#ArcParameterizationAlternatives"></a></h3>

        <p>楕円弧上の任意の点(<var>x</var>, <var>y</var>)は、次の2次元行列式で表せます：</p>

        (eq. 3.1)
        <div role="math" aria-describedby="math-arbitrary-point-on-elliptical-arc">
            <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                <mrow>
                    <mo>(</mo>
                    <mtable>
                        <mtr>
                            <mtd>
                                <mi>x</mi>
                            </mtd>
                        </mtr>
                        <mtr>
                            <mtd>
                                <mi>y</mi>
                            </mtd>
                        </mtr>
                    </mtable>
                    <mo>)</mo>
                    <mo>=</mo>
                    <mo>(</mo>
                    <mtable>
                        <mtr>
                            <mtd>
                                <mrow>
                                    <mi>cos</mi>
                                    <mo>⁡</mo>
                                    <mi>φ</mi>
                                </mrow>
                            </mtd>
                            <mtd>
                                <mrow>
                                    <mo>-</mo>
                                    <mi>sin</mi>
                                    <mo>⁡</mo>
                                    <mi>φ</mi>
                                </mrow>
                            </mtd>
                        </mtr>
                        <mtr>
                            <mtd>
                                <mrow>
                                    <mi>sin</mi>
                                    <mo>⁡</mo>
                                    <mi>φ</mi>
                                </mrow>
                            </mtd>
                            <mtd>
                                <mrow>
                                    <mi>cos</mi>
                                    <mo>⁡</mo>
                                    <mi>φ</mi>
                                </mrow>
                            </mtd>
                        </mtr>
                    </mtable>
                    <mo>)</mo>
                    <mo>·</mo>
                    <mo>(</mo>
                    <mtable>
                        <mtr>
                            <mtd>
                                <mrow>
                                    <msub>
                                        <mi>r</mi>
                                        <mi>x</mi>
                                    </msub>
                                    <mo>⁢</mo>
                                    <mi>cos</mi>
                                    <mo>⁡</mo>
                                    <mi>θ</mi>
                                </mrow>
                            </mtd>
                        </mtr>
                        <mtr>
                            <mtd>
                                <mrow>
                                    <msub>
                                        <mi>r</mi>
                                        <mi>y</mi>
                                    </msub>
                                    <mo>⁢</mo>
                                    <mi>sin</mi>
                                    <mo>⁡</mo>
                                    <mi>θ</mi>
                                </mrow>
                            </mtd>
                        </mtr>
                    </mtable>
                    <mo>)</mo>
                    <mo>+</mo>
                    <mo>(</mo>
                    <mtable>
                        <mtr>
                            <mtd>
                                <msub>
                                    <mi>c</mi>
                                    <mi>x</mi>
                                </msub>
                            </mtd>
                        </mtr>
                        <mtr>
                            <mtd>
                                <msub>
                                    <mi>c</mi>
                                    <mi>y</mi>
                                </msub>
                            </mtd>
                        </mtr>
                    </mtable>
                    <mo>)</mo>
                </mrow>
            </math>
            <pre id="math-arbitrary-point-on-elliptical-arc">
    x = rx*cos(θ)*cos(φ) - ry*sin(θ)*sin(φ) + cx
    y = rx*cos(θ)*sin(φ) + ry*sin(θ)*cos(φ) + cy
  </pre>
        </div>

        <p>(<var>c<sub>x</sub></var>, <var>c<sub>y</sub></var>)は楕円の中心座標です。</p>

        <p><var>r<sub>x</sub></var>および<var>r<sub>y</sub></var>は楕円の半径（主軸・副軸とも呼ばれます）です。</p>

        <div class="ready-for-wider-review">
            <p><var>φ</var>は現在の座標系のx軸から楕円のx軸への角度です。</p>

            <p><var>θ</var>は弧上の点(<var>x</var>, <var>y</var>)が位置する弧周上の角度で、次の範囲になります：</p>

            <ul>
                <li><var>θ</var><sub>1</sub>は、ストレッチと回転操作前の楕円弧の開始角です。</li>

                <li><var>θ</var><sub>2</sub>は、ストレッチと回転操作前の楕円弧の終了角です。</li>

                <li>Δ<var>θ</var>は、これら2つの角度の差です。</li>
            </ul>
        </div>
        <p>楕円を伸ばして回転させた円と考える場合、<var>θ</var><sub>1</sub>、<var>θ</var><sub>2</sub>、Δ<var>θ</var>はストレッチ・回転前の開始角・終了角・スウィープ角となります。
            これはグラフィックスAPIで一般的な別のパラメータ化につながり、<em>中心パラメータ化</em>と呼ばれます。次節では中心パラメータ化とエンドポイントパラメータ化の相互変換式を示します。
        </p>

        <h3 id="ArcConversionCenterToEndpoint" class="heading">B.2.3. 中心からエンドポイントへのパラメータ変換<a class="self-link"
                href="#ArcConversionCenterToEndpoint"></a></h3>

        <p>次の変数が与えられます：</p>

        <p class="indented separated">
            <var>c<sub>x</sub></var>
            <var>c<sub>y</sub></var>
            <var>r<sub>x</sub></var>
            <var>r<sub>y</sub></var>
            <var>φ</var>
            <var>θ</var><sub>1</sub>
            Δ<var>θ</var>
        </p>

        <p>求めるべきは以下です：</p>

        <p class="indented separated">
            <var>x</var><sub>1</sub>
            <var>y</var><sub>1</sub>
            <var>x</var><sub>2</sub>
            <var>y</var><sub>2</sub>
            <var>f<sub>A</sub></var>
            <var>f<sub>S</sub></var>
        </p>

        <p>これらは以下の式を使って求めることができます：</p>

        <table style="width: 90%">
            <tr>
                <td>
                    <div role="math">
                        <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                            <mrow>
                                <mfenced open="(" close=")">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>x</mi>
                                                    <mi>1</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>y</mi>
                                                    <mi>1</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                                <mo>=</mo>
                                <mfenced open="(" close=")">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <mn>cos</mn>
                                                    <mi mathvariant="italic">φ</mi>
                                                </mrow>
                                            </mtd>
                                            <mtd>
                                                <mrow>
                                                    <mo lspace="2px" rspace="2px">-</mo>
                                                    <mn>sin</mn>
                                                    <mi mathvariant="italic">φ</mi>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <mn>sin</mn>
                                                    <mi mathvariant="italic">φ</mi>
                                                </mrow>
                                            </mtd>
                                            <mtd>
                                                <mrow>
                                                    <mn>cos</mn>
                                                    <mi mathvariant="italic">φ</mi>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                                <mo lspace="2px" rspace="2px">⋅</mo>
                                <mfenced open="(" close=")">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <msub>
                                                        <mi>r</mi>
                                                        <mi>x</mi>
                                                    </msub>
                                                    <mi> </mi>
                                                    <mn>cos</mn>
                                                    <msub>
                                                        <mi mathvariant="italic">θ</mi>
                                                        <mi mathvariant="italic">1</mi>
                                                    </msub>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <msub>
                                                        <mi>r</mi>
                                                        <mi>y</mi>
                                                    </msub>
                                                    <mi> </mi>
                                                    <mn>sin</mn>
                                                    <msub>
                                                        <mi mathvariant="italic">θ</mi>
                                                        <mi mathvariant="italic">1</mi>
                                                    </msub>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                                <mo lspace="2px" rspace="2px">+</mo>
                                <mfenced open="(" close=")">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>c</mi>
                                                    <mi>x</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>c</mi>
                                                    <mi>y</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                            </mrow>
                        </math>
                    </div>

                </td>
                <td style="text-align: right">(式 4.1)</td>
            </tr>
            <tr>
                <td>
                    <div role="math">
                        <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                            <mrow>
                                <mfenced open="(" close=")">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>x</mi>
                                                    <mi mathvariant="italic">2</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>y</mi>
                                                    <mi mathvariant="italic">2</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                                <mo>=</mo>
                                <mfenced open="(" close=")">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <mn>cos</mn>
                                                    <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">φ</mi>
                                                </mrow>
                                            </mtd>
                                            <mtd>
                                                <mrow>
                                                    <mo lspace="2px" rspace="2px">-</mo>
                                                    <mn>sin</mn>
                                                    <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">φ</mi>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <mn>sin</mn>
                                                    <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">φ</mi>
                                                </mrow>
                                            </mtd>
                                            <mtd>
                                                <mrow>
                                                    <mn>cos</mn>
                                                    <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">φ</mi>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                                <mo lspace="2px" rspace="2px">⋅</mo>
                                <mfenced open="(" close=")">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <msub>
                                                        <mi>r</mi>
                                                        <mi>x</mi>
                                                    </msub>
                                                    <mi> </mi>
                                                    <mn>cos</mn>
                                                    <mfenced open="(" close=")">
                                                        <mrow>
                                                            <msub>
                                                                <mi mathvariant="italic"
                                                                    fontfamily="Lucida Sans Unicode">θ</mi>
                                                                <mi mathvariant="italic">1</mi>
                                                            </msub>
                                                            <mo lspace="2px" rspace="2px">+</mo>
                                                            <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">Δ
                                                            </mi>
                                                            <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ
                                                            </mi>
                                                        </mrow>
                                                    </mfenced>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <msub>
                                                        <mi>r</mi>
                                                        <mi>y</mi>
                                                    </msub>
                                                    <mi> </mi>
                                                    <mn>sin</mn>
                                                    <mfenced open="(" close=")">
                                                        <mrow>
                                                            <msub>
                                                                <mi mathvariant="italic"
                                                                    fontfamily="Lucida Sans Unicode">θ</mi>
                                                                <mi mathvariant="italic">1</mi>
                                                            </msub>
                                                            <mo lspace="2px" rspace="2px">+</mo>
                                                            <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">Δ
                                                            </mi>
                                                            <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ
                                                            </mi>
                                                        </mrow>
                                                    </mfenced>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                                <mo lspace="2px" rspace="2px">+</mo>
                                <mfenced open="(" close=")">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>c</mi>
                                                    <mi>x</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>c</mi>
                                                    <mi>y</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                            </mrow>
                        </math>
                    </div>
                </td>
                <td style="text-align: right">(式 4.2)</td>
            </tr>
            <tr>
                <td>
                    <div role="math">
                        <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                            <mrow>
                                <msub>
                                    <mi>f</mi>
                                    <mi>A</mi>
                                </msub>
                                <mo>=</mo>
                                <mfenced open="{" close="">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <mn>1</mn>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mtext>if</mtext>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mfenced open="|" close="|">
                                                        <mrow>
                                                            <mi>Δ</mi>
                                                            <mi mathvariant="italic">θ</mi>
                                                        </mrow>
                                                    </mfenced>
                                                    <mo mathvariant="italic">></mo>
                                                    <mn>180</mn>
                                                    <mi mathvariant="normal">°</mi>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <mtext>0</mtext>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mtext>if</mtext>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mfenced open="|" close="|">
                                                        <mrow>
                                                            <mi>Δ</mi>
                                                            <mi mathvariant="italic">θ</mi>
                                                        </mrow>
                                                    </mfenced>
                                                    <mo lspace="3px" rspace="3px">≤</mo>
                                                    <mn>180</mn>
                                                    <mi mathvariant="normal">°</mi>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                            </mrow>
                        </math>
                    </div>

                </td>
                <td style="text-align: right">(式 4.3)</td>
            </tr>
            <tr>
                <td>
                    <div role="math">
                        <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                            <mrow>
                                <msub>
                                    <mi>f</mi>
                                    <mi>S</mi>
                                </msub>
                                <mo>=</mo>
                                <mfenced open="{" close="">
                                    <mtable rowalign="center">
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <mn>1</mn>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mtext>if</mtext>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mi>Δ</mi>
                                                    <mi mathvariant="italic">θ</mi>
                                                    <mn> </mn>
                                                    <mo lspace="0px" rspace="0px">></mo>
                                                    <mtext> </mtext>
                                                    <mn>0</mn>
                                                    <mi mathvariant="normal">°</mi>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <mrow>
                                                    <mtext>0</mtext>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mtext>if</mtext>
                                                    <mi mathvariant="italic"> </mi>
                                                    <mi>Δ</mi>
                                                    <mi mathvariant="italic">θ</mi>
                                                    <mn> </mn>
                                                    <mo lspace="0px" rspace="0px">&lt;</mo>
                                                    <mtext> </mtext>
                                                    <mn>0</mn>
                                                    <mi mathvariant="normal">°</mi>
                                                </mrow>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </mfenced>
                            </mrow>
                        </math>
                    </div>
                </td>
                <td style="text-align: right">(式 4.4)</td>
            </tr>
        </table>

        <h3 id="ArcConversionEndpointToCenter" class="heading">B.2.4. エンドポイントから中心へのパラメータ変換<a class="self-link"
                href="#ArcConversionEndpointToCenter"></a></h3>

        <p>次の変数が与えられます：</p>

        <p class="indented separated">
            <var>x</var><sub>1</sub>
            <var>y</var><sub>1</sub>
            <var>x</var><sub>2</sub>
            <var>y</var><sub>2</sub>
            <var>f<sub>A</sub></var>
            <var>f<sub>S</sub></var>
            <var>r<sub>x</sub></var>
            <var>r<sub>y</sub></var>
            <var>φ</var>
        </p>

        <p>求めるべきは以下です：</p>

        <p class="indented separated">
            <var>c<sub>x</sub></var>
            <var>c<sub>y</sub></var>
            <var>θ</var><sub>1</sub>
            Δ<var>θ</var>
        </p>

        <p>式は、(<var>x</var><sub>1</sub>, <var>y</var><sub>1</sub>)から(<var>x</var><sub>2</sub>,
            <var>y</var><sub>2</sub>)への線分の中点に原点を移動し、座標軸を楕円の軸に合わせて回転することで簡略化されます。
            変換後の座標はプライム記号で表記され、中間値として求められます。この手順は以下のステップで構成されます：
        </p>

        <ul>
            <li>
                <p><em>ステップ1: 計算</em> (<var>x</var><sub>1</sub>′, <var>y</var><sub>1</sub>′)</p>
                <table style="width: 90%">
                    <tr>
                        <td>
                            <div role="math">
                                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                                    <mrow>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <msup>
                                                            <msub>
                                                                <mi>x</mi>
                                                                <mi mathvariant="italic">1</mi>
                                                            </msub>
                                                            <mo mathvariant="italic" fontfamily="Lucida Sans Unicode">′
                                                            </mo>
                                                        </msup>
                                                    </mtd>
                                                </mtr>
                                                <mtr>
                                                    <mtd>
                                                        <msup>
                                                            <msub>
                                                                <mi>y</mi>
                                                                <mi mathvariant="italic">1</mi>
                                                            </msub>
                                                            <mo mathvariant="italic" fontfamily="Lucida Sans Unicode">′
                                                            </mo>
                                                        </msup>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                        <mo>=</mo>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <mrow>
                                                            <mn>cos</mn>
                                                            <mi mathvariant="italic">φ</mi>
                                                        </mrow>
                                                    </mtd>
                                                    <mtd>
                                                        <mrow>
                                                            <mn>sin</mn>
                                                            <mi mathvariant="italic">φ</mi>
                                                        </mrow>
                                                    </mtd>
                                                </mtr>
                                                <mtr>
                                                    <mtd>
                                                        <mrow>
                                                            <mo>-</mo>
                                                            <mn>sin</mn>
                                                            <mi mathvariant="italic">φ</mi>
                                                        </mrow>
                                                    </mtd>
                                                    <mtd>
                                                        <mrow>
                                                            <mn>cos</mn>
                                                            <mi mathvariant="italic">φ</mi>
                                                        </mrow>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                        <mo lspace="2px" rspace="2px">⋅</mo>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <mfrac>
                                                            <mrow>
                                                                <msub>
                                                                    <mi>x</mi>
                                                                    <mi mathvariant="italic">1</mi>
                                                                </msub>
                                                                <mo mathvariant="italic">-</mo>
                                                                <msub>
                                                                    <mi>x</mi>
                                                                    <mi mathvariant="italic">2</mi>
                                                                </msub>
                                                            </mrow>
                                                            <mi mathvariant="italic">2</mi>
                                                        </mfrac>
                                                    </mtd>
                                                </mtr>
                                                <mtr>
                                                    <mtd>
                                                        <mfrac>
                                                            <mrow>
                                                                <msub>
                                                                    <mi>y</mi>
                                                                    <mi mathvariant="italic">1</mi>
                                                                </msub>
                                                                <mo mathvariant="italic">-</mo>
                                                                <msub>
                                                                    <mi>y</mi>
                                                                    <mi mathvariant="italic">2</mi>
                                                                </msub>
                                                            </mrow>
                                                            <mi mathvariant="italic">2</mi>
                                                        </mfrac>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                    </mrow>
                                </math>
                            </div>
                        </td>
                        <td style="text-align: right">(式 5.1)</td>
                    </tr>
                </table>
            </li>

            <li>
                <p><em>ステップ2: 計算</em> (<var>c<sub>x</sub></var>′, <var>c<sub>y</sub></var>′)</p>
                <table style="width: 90%">
                    <tr>
                        <td>
                            <div role="math">
                                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                                    <mrow>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <msup>
                                                            <msub>
                                                                <mi>c</mi>
                                                                <mi>x</mi>
                                                            </msub>
                                                            <mo>′</mo>
                                                        </msup>
                                                    </mtd>
                                                </mtr>
                                                <mtr>
                                                    <mtd>
                                                        <msup>
                                                            <msub>
                                                                <mi>c</mi>
                                                                <mi>y</mi>
                                                            </msub>
                                                            <mo>′</mo>
                                                        </msup>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                        <mo>=</mo>
                                        <mo lspace="2px" rspace="2px">±</mo>
                                        <msqrt>
                                            <mfrac>
                                                <mrow>
                                                    <msup>
                                                        <msub>
                                                            <mi>r</mi>
                                                            <mi>x</mi>
                                                        </msub>
                                                        <mn>2</mn>
                                                    </msup>
                                                    <mtext> </mtext>
                                                    <msup>
                                                        <msub>
                                                            <mi>r</mi>
                                                            <mi>y</mi>
                                                        </msub>
                                                        <mn>2</mn>
                                                    </msup>
                                                    <mo>-</mo>
                                                    <msup>
                                                        <msub>
                                                            <mi>r</mi>
                                                            <mi>x</mi>
                                                        </msub>
                                                        <mn>2</mn>
                                                    </msup>
                                                    <msup>
                                                        <mfenced open="(" close=")">
                                                            <msup>
                                                                <msub>
                                                                    <mi>y</mi>
                                                                    <mn>1</mn>
                                                                </msub>
                                                                <mo>′</mo>
                                                            </msup>
                                                        </mfenced>
                                                        <mn>2</mn>
                                                    </msup>
                                                    <mo>-</mo>
                                                    <msup>
                                                        <msub>
                                                            <mi>r</mi>
                                                            <mi>y</mi>
                                                        </msub>
                                                        <mn>2</mn>
                                                    </msup>
                                                    <msup>
                                                        <mfenced open="(" close=")">
                                                            <msup>
                                                                <msub>
                                                                    <mi>x</mi>
                                                                    <mn>1</mn>
                                                                </msub>
                                                                <mo>′</mo>
                                                            </msup>
                                                        </mfenced>
                                                        <mn>2</mn>
                                                    </msup>
                                                </mrow>
                                                <mrow>
                                                    <msup>
                                                        <msub>
                                                            <mi>r</mi>
                                                            <mi>x</mi>
                                                        </msub>
                                                        <mn>2</mn>
                                                    </msup>
                                                    <msup>
                                                        <mfenced open="(" close=")">
                                                            <msup>
                                                                <msub>
                                                                    <mi>y</mi>
                                                                    <mn>1</mn>
                                                                </msub>
                                                                <mo>′</mo>
                                                            </msup>
                                                        </mfenced>
                                                        <mn>2</mn>
                                                    </msup>
                                                    <mo>+</mo>
                                                    <msup>
                                                        <msub>
                                                            <mi>r</mi>
                                                            <mi>y</mi>
                                                        </msub>
                                                        <mn>2</mn>
                                                    </msup>
                                                    <msup>
                                                        <mfenced open="(" close=")">
                                                            <msup>
                                                                <msub>
                                                                    <mi>x</mi>
                                                                    <mn>1</mn>
                                                                </msub>
                                                                <mo>′</mo>
                                                            </msup>
                                                        </mfenced>
                                                        <mn>2</mn>
                                                    </msup>
                                                </mrow>
                                            </mfrac>
                                        </msqrt>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <mfrac>
                                                            <mrow>
                                                                <msub>
                                                                    <mi>r</mi>
                                                                    <mi>x</mi>
                                                                </msub>
                                                                <mtext> </mtext>
                                                                <msup>
                                                                    <msub>
                                                                        <mi>y</mi>
                                                                        <mn>1</mn>
                                                                    </msub>
                                                                    <mo>′</mo>
                                                                </msup>
                                                            </mrow>
                                                            <msub>
                                                                <mi>r</mi>
                                                                <mi>y</mi>
                                                            </msub>
                                                        </mfrac>
                                                    </mtd>
                                                </mtr>
                                                <mtr>
                                                    <mtd>
                                                        <mrow>
                                                            <mo>-</mo>
                                                            <mfrac>
                                                                <mrow>
                                                                    <msub>
                                                                        <mi>r</mi>
                                                                        <mi>y</mi>
                                                                    </msub>
                                                                    <mtext> </mtext>
                                                                    <msup>
                                                                        <msub>
                                                                            <mi>x</mi>
                                                                            <mn>1</mn>
                                                                        </msub>
                                                                        <mo>′</mo>
                                                                    </msup>
                                                                </mrow>
                                                                <msub>
                                                                    <mi>r</mi>
                                                                    <mi>x</mi>
                                                                </msub>
                                                            </mfrac>
                                                        </mrow>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                    </mrow>
                                </math>
                            </div>
                        </td>
                        <td style="text-align: right">(式 5.2)</td>
                    </tr>
                </table>
                <p>ここで、+記号は<var>f<sub>A</sub></var> ≠ <var>f<sub>S</sub></var>の場合に選択し、−記号は<var>f<sub>A</sub></var> =
                    <var>f<sub>S</sub></var>の場合に選択します。
                </p>
            </li>

            <li>
                <p><em>ステップ3: 計算</em> (<var>c<sub>x</sub></var>, <var>c<sub>y</sub></var>)
                    <em>from</em> (<var>c<sub>x</sub></var>′, <var>c<sub>y</sub></var>′)
                </p>
                <table style="width: 90%">
                    <tr>
                        <td>
                            <div role="math">
                                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                                    <mrow>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <msub>
                                                            <mi>c</mi>
                                                            <mi>x</mi>
                                                        </msub>
                                                    </mtd>
                                                </mtr>
                                                <mtr>
                                                    <mtd>
                                                        <msub>
                                                            <mi>c</mi>
                                                            <mi>y</mi>
                                                        </msub>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                        <mo>=</mo>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <mrow>
                                                            <mn>cos</mn>
                                                            <mi mathvariant="italic">φ</mi>
                                                        </mrow>
                                                    </mtd>
                                                    <mtd>
                                                        <mrow>
                                                            <mo>-</mo>
                                                            <mn>sin</mn>
                                                            <mi mathvariant="italic">φ</mi>
                                                        </mrow>
                                                    </mtd>
                                                </mtr>
                                                <mtr>
                                                    <mtd>
                                                        <mrow>
                                                            <mn>sin</mn>
                                                            <mi mathvariant="italic">φ</mi>
                                                        </mrow>
                                                    </mtd>
                                                    <mtd>
                                                        <mrow>
                                                            <mn>cos</mn>
                                                            <mi mathvariant="italic">φ</mi>
                                                        </mrow>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                        <mo lspace="2px" rspace="2px">⋅</mo>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <msup>
                                                            <msub>
                                                                <mi>c</mi>
                                                                <mi>x</mi>
                                                            </msub>
                                                            <mo lspace="0px" form="infix">'</mo>
                                                        </msup>
                                                    </mtd>
                                                </mtr>
                                                <mtr>
                                                    <mtd>
                                                        <msup>
                                                            <msub>
                                                                <mi>c</mi>
                                                                <mi>y</mi>
                                                            </msub>
                                                            <mo lspace="0px" form="infix">'</mo>
                                                        </msup>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                        <mo>+</mo>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <mfrac>
                                                            <mrow>
                                                                <msub>
                                                                    <mi>x</mi>
                                                                    <mn>1</mn>
                                                                </msub>
                                                                <mo>+</mo>
                                                                <msub>
                                                                    <mi>x</mi>
                                                                    <mn>2</mn>
                                                                </msub>
                                                            </mrow>
                                                            <mn>2</mn>
                                                        </mfrac>
                                                    </mtd>
                                                </mtr>
                                                <mtr>
                                                    <mtd>
                                                        <mfrac>
                                                            <mrow>
                                                                <msub>
                                                                    <mi>y</mi>
                                                                    <mn>1</mn>
                                                                </msub>
                                                                <mo>+</mo>
                                                                <msub>
                                                                    <mi>y</mi>
                                                                    <mn>2</mn>
                                                                </msub>
                                                            </mrow>
                                                            <mn>2</mn>
                                                        </mfrac>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                    </mrow>
                                </math>
                            </div>
                        </td>
                        <td style="text-align: right">(式 5.3)</td>
                    </tr>
                </table>
            </li>

            <li>
                <p><em>ステップ4: 計算</em> <var>θ</var><sub>1</sub> および Δ<var>θ</var></p>
                <p>一般に、2つのベクトル(<var>u<sub>x</sub></var>, <var>u<sub>y</sub></var>)と(<var>v<sub>x</sub></var>,
                    <var>v<sub>y</sub></var>)間の角度は次式で求められます：
                </p>
                <table style="width: 90%">
                    <tr>
                        <td>
                            <div role="math">
                                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                                    <mrow>
                                        <mo lspace="3px" rspace="3px">∠</mo>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <mover>
                                                            <mi>u</mi>
                                                            <mo>⇀</mo>
                                                        </mover>
                                                    </mtd>
                                                    <mtd>
                                                        <mn>,</mn>
                                                    </mtd>
                                                    <mtd>
                                                        <mover>
                                                            <mi>v</mi>
                                                            <mo>⇀</mo>
                                                        </mover>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                        <mo>=</mo>
                                        <mo lspace="2px" rspace="2px">±</mo>
                                        <mn>arccos</mn>
                                        <mfenced open="(" close=")">
                                            <mfrac>
                                                <mrow>
                                                    <mover>
                                                        <mi>u</mi>
                                                        <mo>⇀</mo>
                                                    </mover>
                                                    <mo lspace="6px" rspace="6px">⋅</mo>
                                                    <mover>
                                                        <mi>v</mi>
                                                        <mo>⇀</mo>
                                                    </mover>
                                                </mrow>
                                                <mrow>
                                                    <mfenced open="‖" close="‖">
                                                        <mover>
                                                            <mi>u</mi>
                                                            <mo>⇀</mo>
                                                        </mover>
                                                    </mfenced>
                                                    <mi> </mi>
                                                    <mfenced open="‖" close="‖">
                                                        <mover>
                                                            <mi>v</mi>
                                                            <mo>⇀</mo>
                                                        </mover>
                                                    </mfenced>
                                                </mrow>
                                            </mfrac>
                                        </mfenced>
                                    </mrow>
                                </math>
                            </div>
                        </td>
                        <td style="text-align: right">(式 5.4)</td>
                    </tr>
                </table>

                <p>この±記号は、<var>u<sub>x</sub></var> <var>v<sub>y</sub></var> − <var>u<sub>y</sub></var>
                    <var>v<sub>x</sub></var>の符号です。
                </p>

                <p>この角度関数を用いて、<var>θ</var><sub>1</sub> および Δ<var>θ</var> は以下で表されます：</p>

                <table style="width: 90%">
                    <tr>
                        <td>
                            <div role="math">
                                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                                    <mrow>
                                        <msub>
                                            <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ</mi>
                                            <mi>1</mi>
                                        </msub>
                                        <mo>=</mo>
                                        <mo lspace="3px" rspace="3px">∠</mo>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <mfenced open="(" close=")">
                                                            <mtable rowalign="center">
                                                                <mtr>
                                                                    <mtd>
                                                                        <mn>1</mn>
                                                                    </mtd>
                                                                </mtr>
                                                                <mtr>
                                                                    <mtd>
                                                                        <mn>0</mn>
                                                                    </mtd>
                                                                </mtr>
                                                            </mtable>
                                                        </mfenced>
                                                    </mtd>
                                                    <mtd>
                                                        <mi mathvariant="italic">,</mi>
                                                    </mtd>
                                                    <mtd>
                                                        <mfenced open="(" close=")">
                                                            <mtable rowalign="center">
                                                                <mtr>
                                                                    <mtd>
                                                                        <mfrac>
                                                                            <mrow>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>x</mi>
                                                                                        <mi mathvariant="italic">1</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                                <mo>-</mo>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>c</mi>
                                                                                        <mi>x</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                            </mrow>
                                                                            <msub>
                                                                                <mi>r</mi>
                                                                                <mi>x</mi>
                                                                            </msub>
                                                                        </mfrac>
                                                                    </mtd>
                                                                </mtr>
                                                                <mtr>
                                                                    <mtd>
                                                                        <mfrac>
                                                                            <mrow>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>y</mi>
                                                                                        <mi mathvariant="italic">1</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                                <mo>-</mo>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>c</mi>
                                                                                        <mi>y</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                            </mrow>
                                                                            <msub>
                                                                                <mi>r</mi>
                                                                                <mi>y</mi>
                                                                            </msub>
                                                                        </mfrac>
                                                                    </mtd>
                                                                </mtr>
                                                            </mtable>
                                                        </mfenced>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                    </mrow>
                                </math>
                            </div>
                        </td>
                        <td style="text-align: right">(式 5.5)</td>
                    </tr>
                    <tr>
                        <td>
                            <div role="math">
                                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                                    <mrow>
                                        <mi>Δ</mi>
                                        <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ</mi>
                                        <mo lspace="3px" rspace="3px">≡</mo>
                                        <mo lspace="3px" rspace="3px">∠</mo>
                                        <mfenced open="(" close=")">
                                            <mtable rowalign="center">
                                                <mtr>
                                                    <mtd>
                                                        <mfenced open="(" close=")">
                                                            <mtable rowalign="center">
                                                                <mtr>
                                                                    <mtd>
                                                                        <mfrac>
                                                                            <mrow>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>x</mi>
                                                                                        <mi mathvariant="italic">1</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                                <mo>-</mo>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>c</mi>
                                                                                        <mi>x</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                            </mrow>
                                                                            <msub>
                                                                                <mi>r</mi>
                                                                                <mi>x</mi>
                                                                            </msub>
                                                                        </mfrac>
                                                                    </mtd>
                                                                </mtr>
                                                                <mtr>
                                                                    <mtd>
                                                                        <mfrac>
                                                                            <mrow>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>y</mi>
                                                                                        <mi mathvariant="italic">1</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                                <mo>-</mo>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>c</mi>
                                                                                        <mi>y</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                            </mrow>
                                                                            <msub>
                                                                                <mi>r</mi>
                                                                                <mi>y</mi>
                                                                            </msub>
                                                                        </mfrac>
                                                                    </mtd>
                                                                </mtr>
                                                            </mtable>
                                                        </mfenced>
                                                    </mtd>
                                                    <mtd>
                                                        <mi mathvariant="italic">,</mi>
                                                    </mtd>
                                                    <mtd>
                                                        <mfenced open="(" close=")">
                                                            <mtable rowalign="center">
                                                                <mtr>
                                                                    <mtd>
                                                                        <mfrac>
                                                                            <mrow>
                                                                                <msup>
                                                                                    <mrow>
                                                                                        <mo>-</mo>
                                                                                        <msub>
                                                                                            <mi>x</mi>
                                                                                            <mi mathvariant="italic">1
                                                                                            </mi>
                                                                                        </msub>
                                                                                    </mrow>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                                <mo>-</mo>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>c</mi>
                                                                                        <mi>x</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                            </mrow>
                                                                            <msub>
                                                                                <mi>r</mi>
                                                                                <mi>x</mi>
                                                                            </msub>
                                                                        </mfrac>
                                                                    </mtd>
                                                                </mtr>
                                                                <mtr>
                                                                    <mtd>
                                                                        <mfrac>
                                                                            <mrow>
                                                                                <msup>
                                                                                    <mrow>
                                                                                        <mo>-</mo>
                                                                                        <msub>
                                                                                            <mi>y</mi>
                                                                                            <mi mathvariant="italic">1
                                                                                            </mi>
                                                                                        </msub>
                                                                                    </mrow>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                                <mo>-</mo>
                                                                                <msup>
                                                                                    <msub>
                                                                                        <mi>c</mi>
                                                                                        <mi>y</mi>
                                                                                    </msub>
                                                                                    <mo>′</mo>
                                                                                </msup>
                                                                            </mrow>
                                                                            <msub>
                                                                                <mi>r</mi>
                                                                                <mi>y</mi>
                                                                            </msub>
                                                                        </mfrac>
                                                                    </mtd>
                                                                </mtr>
                                                            </mtable>
                                                        </mfenced>
                                                    </mtd>
                                                </mtr>
                                            </mtable>
                                        </mfenced>
                                        <mi mathvariant="italic"> </mi>
                                        <mn>mod 360</mn>
                                        <mi>°</mi>
                                    </mrow>
                                </math>
                            </div>
                        </td>
                        <td style="text-align: right">(式 5.6)</td>
                    </tr>
                </table>

                <p>ここでΔ<var>θ</var>は
                    −360° &lt; Δ<var>θ</var> &lt; 360°の範囲で次を満たします：</p>

                <p class="indented">もし<var>f<sub>S</sub></var> = 0ならΔ<var>θ</var> &lt; 0,</p>
                <p class="indented">もし<var>f<sub>S</sub></var> = 1ならΔ<var>θ</var> > 0.</p>

                <p>つまり、<var>f<sub>S</sub></var> = 0で(式 5.6)の右辺が0より大きければ360°を減算し、<var>f<sub>S</sub></var> =
                    1で右辺が0より小さければ360°を加算します。それ以外はそのままにします。</p>
            </li>
        </ul>

        <h3 id="ArcCorrectionOutOfRangeRadii" class="heading">B.2.5. 範囲外半径の補正<a class="self-link"
                href="#ArcCorrectionOutOfRangeRadii"></a></h3>

        <p>この節では、<a href="paths.html#ArcOutOfRangeParameters">パス実装に関する注意</a>で説明されている範囲外の<var>r<sub>x</sub></var>および
            <var>r<sub>y</sub></var>に対して必要な数学的調整について説明します。
            アルゴリズムとしては、以下のステップで構成されます：
        </p>

        <ul>
            <li>
                <p><em>ステップ1: 半径がゼロでないことを確認する</em></p>
                <p>もし<var>r<sub>x</sub></var> = 0 または
                    <var>r<sub>y</sub></var> = 0 であれば、
                    (<var>x</var><sub>1</sub>, <var>y</var><sub>1</sub>)から(<var>x</var><sub>2</sub>,
                    <var>y</var><sub>2</sub>)への直線として扱い、処理を終了します。そうでなければ、
                </p>
            </li>

            <li>
                <p><em>ステップ2: 半径が正であることを確認する</em></p>
                <p><var>r<sub>x</sub></var>と<var>r<sub>y</sub></var>の絶対値を取得します：</p>
                <table style="width: 90%">
                    <tr>
                        <td>
                            <div role="math">
                                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                                    <mtable columnalign="left">
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>r</mi>
                                                    <mi>y</mi>
                                                </msub>
                                                <mo lspace="3px" rspace="3px">←</mo>
                                                <mfenced open="|" close="|">
                                                    <msub>
                                                        <mi>r</mi>
                                                        <mi>y</mi>
                                                    </msub>
                                                </mfenced>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <mrow />
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>r</mi>
                                                    <mi>y</mi>
                                                </msub>
                                                <mo lspace="3px" rspace="3px">←</mo>
                                                <mfenced open="|" close="|">
                                                    <msub>
                                                        <mi>r</mi>
                                                        <mi>y</mi>
                                                    </msub>
                                                </mfenced>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </math>
                            </div>
                        </td>
                        <td style="text-align: right">(式 6.1)</td>
                    </tr>
                </table>
            </li>

            <li>
                <p><em>ステップ3: 半径が十分大きいことを確認する</em></p>
                <p>式（式 5.1）のプライム座標値を用いて、以下を計算します</p>
                <table style="width: 90%">
                    <tr>
                        <td>
                            <div role="math">
                                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                                    <mrow>
                                        <mi mathvariant="italic">Λ</mi>
                                        <mo>=</mo>
                                        <mfrac>
                                            <msup>
                                                <mfenced open="(" close=")">
                                                    <msup>
                                                        <msub>
                                                            <mi>x</mi>
                                                            <mi mathvariant="italic">1</mi>
                                                        </msub>
                                                        <mo fontfamily="Lucida Sans Unicode">′</mo>
                                                    </msup>
                                                </mfenced>
                                                <mi mathvariant="italic">2</mi>
                                            </msup>
                                            <msup>
                                                <msub>
                                                    <mi>r</mi>
                                                    <mi>x</mi>
                                                </msub>
                                                <mi mathvariant="italic">2</mi>
                                            </msup>
                                        </mfrac>
                                        <mo>+</mo>
                                        <mfrac>
                                            <msup>
                                                <mfenced open="(" close=")">
                                                    <msup>
                                                        <msub>
                                                            <mi>y</mi>
                                                            <mi mathvariant="italic">1</mi>
                                                        </msub>
                                                        <mo fontfamily="Lucida Sans Unicode">′</mo>
                                                    </msup>
                                                </mfenced>
                                                <mi mathvariant="italic">2</mi>
                                            </msup>
                                            <msup>
                                                <msub>
                                                    <mi>r</mi>
                                                    <mi>y</mi>
                                                </msub>
                                                <mi mathvariant="italic">2</mi>
                                            </msup>
                                        </mfrac>
                                    </mrow>
                                </math>
                            </div>
                        </td>
                        <td style="text-align: right">(式 6.2)</td>
                    </tr>
                </table>
                <p>上記の式の結果が1以下であれば、<var>r<sub>x</sub></var>および<var>r<sub>y</sub></var>はさらに変更する必要はありません。
                    上記の式の結果が1より大きい場合、以下のように置き換えます：</p>
                <table style="width: 90%">
                    <tr>
                        <td>
                            <div role="math">
                                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                                    <mtable columnalign="left">
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>r</mi>
                                                    <mi>x</mi>
                                                </msub>
                                                <mo lspace="3px" rspace="3px">←</mo>
                                                <msqrt>
                                                    <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">Λ</mi>
                                                </msqrt>
                                                <mi mathvariant="italic"> </mi>
                                                <msub>
                                                    <mi>r</mi>
                                                    <mi>x</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <mrow />
                                            </mtd>
                                        </mtr>
                                        <mtr>
                                            <mtd>
                                                <msub>
                                                    <mi>r</mi>
                                                    <mi>y</mi>
                                                </msub>
                                                <mo lspace="3px" rspace="3px">←</mo>
                                                <msqrt>
                                                    <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">Λ</mi>
                                                </msqrt>
                                                <mi mathvariant="italic"> </mi>
                                                <msub>
                                                    <mi>r</mi>
                                                    <mi>y</mi>
                                                </msub>
                                            </mtd>
                                        </mtr>
                                    </mtable>
                                </math>
                            </div>
                        </td>
                        <td style="text-align: right">(式 6.3)</td>
                    </tr>
                </table>
            </li>

            <li>
                <p><em>ステップ4: 計算を続行する</em></p>
                <p>残りの楕円弧計算（<a href="#ArcConversionEndpointToCenter">エンドポイントから中心へのパラメータ変換</a>アルゴリズムなど）を続行します。
                    注意：この節の半径補正の結果、楕円の中心を求める式（式 5.2）は常に少なくとも1つの解を持ちます（根号内は絶対に負になりません）。もし式（式 6.3）で半径が拡大される場合、式（式
                    5.2）の根号内は0となり、楕円の中心の解はちょうど1つだけになります。</p>
            </li>
        </ul>

    </div>

    <h2 id="NumericPrecisionImplementationNotes" class="heading">B.3. 高精度ジオメトリ生成に関する注意<a class="self-link"
            href="#NumericPrecisionImplementationNotes"></a></h2>

    <p class="normativity">この節は参考情報です。</p>

    <p>SVGの<a href="types.html#Precision">実数精度</a>は単精度です。
        技術データを扱う<a href="conform.html#ConformingSVGGenerators">適合SVG生成器</a>で、単精度を超える情報表現が必要な場合（地図や技術図面など）には、一貫した表示を<a
            href="conform.html#ConformingSVGViewers">適合SVGビューア</a>で保証するため、この節で説明されている手順に従うことが推奨されます。
    </p>

    <p>
        単精度よりも高い有効精度で表示したい場合は、CTM生成時に少なくとも倍精度浮動小数点が使用されることを利用することで可能となります（<a
            href="conform.html#ConformingSVGViewers">適合SVGビューア</a>節のCTM生成処理参照）。
        これを活用したコンテンツ生成手順は次の通りです：
    </p>
    <ol>
        <li>コンテンツをタイルに分割し、各オブジェクトの位置やサイズに必要な有効桁数が単精度浮動小数点の範囲内となるようにします。なお、この記述において、元のコンテンツが持つ座標系をソース空間と呼びます。</li>
        <li>各タイルごとに、ソース空間からタイル空間への座標変換行列を生成します。タイル空間は、タイルの左上を原点<var>(0,0)</var>とする座標系です。変換行列の各要素は単精度の範囲内でなければなりません。</li>
        <li>各タイルの内容を、生成した座標変換行列を用いてソース空間からタイル空間へ変換します。その結果、各オブジェクトのパラメータは単精度の範囲内の有効桁数で表現できます。</li>
        <li>各タイルごとに、タイル空間からソース空間への逆変換行列を生成します。これは次のステップで要素の<a class="property"
                href="coords.html#TransformProperty">transform</a>属性として使用されます。</li>
        <li>SVG内で各タイルを個別のユーザー座標系として配置します。例えば、タイルは<a href="struct.html#GElement"><span
                    class="element-name">‘g’</span></a>要素として表現し、transform属性に前のステップで生成した変換行列を指定します。そして、ステップ3で生成した分割グラフィックスはその子要素として配置します。
        </li>
    </ol>

    <table>
        <caption>
            タイルより大きいベクターグラフィックの分割例
        </caption>
        <tr>
            <th>分割前</th>
            <th> </th>
            <th>分割後</th>
        </tr>
        <tr>
            <td><img alt="分割前の例" src="https://www.w3.org/TR/SVG2/images/conform/betterPrecisionTiling3.png"
                    width="200" /></td>
            <td> </td>
            <td><img alt="分割後の例" src="https://www.w3.org/TR/SVG2/images/conform/betterPrecisionTiling4.png"
                    width="200" /></td>
        </tr>
    </table>

    <table>
        <caption>
            有効桁数の改善例
        </caption>
        <tr>
            <th>ステップ1：分割</th>
            <th> </th>
            <th>ステップ5：有効桁数を小さくしつつ適切な配置</th>
        </tr>
        <tr>
            <td><img alt="タイルへの分割例" src="https://www.w3.org/TR/SVG2/images/conform/betterPrecisionTiling1.png"
                    width="400" /></td>
            <td> </td>
            <td><img alt="分割内容の配置例" src="https://www.w3.org/TR/SVG2/images/conform/betterPrecisionTiling2.png"
                    width="400" /></td>
        </tr>
        <tr>
            <td colspan="3">この例ではユーザー座標系が7桁のタイルを用いることで8桁の有効数字を提供しています。</td>
        </tr>
    </table>

    <script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
    <script src="https://htmlspecs.com/dropdown.js"></script>
</body>

</html>