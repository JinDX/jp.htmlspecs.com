<!DOCTYPE html>
<html lang="ja-JP" dir="ltr">

<head>
    <meta charset="utf-8">
    <!-- <meta name="generator" content="ReSpec 35.2.2"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        .issue-label {
            text-transform: initial
        }

        .warning>p:first-child {
            margin-top: 0
        }

        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid
        }

        span.warning {
            padding: .1em .5em .15em
        }

        .issue.closed span.issue-number {
            text-decoration: line-through
        }

        .issue.closed span.issue-number::after {
            content: " (Closed)";
            font-size: smaller
        }

        .warning {
            border-color: #f11;
            border-color: var(--warning-border, #f11);
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9;
            background: var(--warning-bg, #fbe9e9);
            color: #000;
            color: var(--text, #000)
        }

        .warning-title:before {
            content: "⚠";
            font-size: 1.3em;
            float: left;
            padding-right: .3em;
            margin-top: -.3em
        }

        li.task-list-item {
            list-style: none
        }

        input.task-list-item-checkbox {
            margin: 0 .35em .25em -1.6em;
            vertical-align: middle
        }

        .issue a.respec-gh-label {
            padding: 5px;
            margin: 0 2px 0 2px;
            font-size: 10px;
            text-transform: none;
            text-decoration: none;
            font-weight: 700;
            border-radius: 4px;
            position: relative;
            bottom: 2px;
            border: none;
            display: inline-block
        }
    </style>
    <style>
        pre.idl {
            padding: 1em;
            position: relative
        }

        pre.idl>code {
            color: #000;
            color: var(--text, #000)
        }

        @media print {
            pre.idl {
                white-space: pre-wrap
            }
        }

        .idlHeader {
            display: block;
            width: 150px;
            background: #8ccbf2;
            background: var(--def-border, #8ccbf2);
            color: #fff;
            color: var(--defrow-border, #fff);
            font-family: sans-serif;
            font-weight: 700;
            margin: -1em 0 1em -1em;
            height: 28px;
            line-height: 28px
        }

        .idlHeader a.self-link {
            margin-left: .3cm;
            text-decoration: none;
            border-bottom: none;
            color: inherit
        }

        .idlID {
            font-weight: 700;
            color: #005a9c
        }

        .idlType {
            color: #005a9c
        }

        .idlName {
            color: #ff4500
        }

        .idlName a {
            color: #ff4500;
            border-bottom: 1px dotted #ff4500;
            text-decoration: none
        }

        a.idlEnumItem {
            color: #000;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        .idlSuperclass {
            font-style: italic;
            color: #005a9c
        }

        .idlDefaultValue,
        .idlParamName {
            font-style: italic
        }

        .extAttr {
            color: #666
        }

        .idlSectionComment {
            color: gray
        }

        .idlIncludes a {
            font-weight: 700
        }

        .respec-button-copy-paste:focus {
            text-decoration: none;
            border-color: #51a7e8;
            outline: 0;
            box-shadow: 0 0 5px rgba(81, 167, 232, .5)
        }

        .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
            border-color: #51a7e8
        }

        .respec-button-copy-paste:is(:hover, :active, .zeroclipboard-is-hover, .zeroclipboard-is-active) {
            text-decoration: none;
            background-color: #ddd;
            background-image: linear-gradient(#eee, #ddd);
            border-color: #ccc
        }

        .respec-button-copy-paste:is(:active, .selected, .zeroclipboard-is-active) {
            background-color: #dcdcdc;
            background-image: none;
            border-color: #b5b5b5;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .15)
        }

        .respec-button-copy-paste.selected:hover {
            background-color: #cfcfcf
        }

        .respec-button-copy-paste:is(:disabled, :disabled:hover, .disabled, .disabled:hover) {
            color: rgba(102, 102, 102, .5);
            cursor: default;
            background-color: rgba(229, 229, 229, .5);
            background-image: none;
            border-color: rgba(197, 197, 197, .5);
            box-shadow: none
        }

        @media print {
            .respec-button-copy-paste {
                visibility: hidden
            }
        }
    </style>
    <style>
        dfn {
            cursor: pointer
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            min-width: 300px;
            max-width: 500px;
            padding: .5em .75em;
            margin-top: .6em;
            font-family: "Helvetica Neue", sans-serif;
            font-size: small;
            background: #fff;
            background: var(--indextable-hover-bg, #fff);
            color: #000;
            color: var(--text, #000);
            box-shadow: 0 1em 3em -.4em rgba(0, 0, 0, .3), 0 0 1px 1px rgba(0, 0, 0, .05);
            box-shadow: 0 1em 3em -.4em var(--tocsidebar-shadow, rgba(0, 0, 0, .3)), 0 0 1px 1px var(--tocsidebar-shadow, rgba(0, 0, 0, .05));
            border-radius: 2px
        }

        .dfn-panel:not(.docked)>.caret {
            position: absolute;
            top: -9px
        }

        .dfn-panel:not(.docked)>.caret::after,
        .dfn-panel:not(.docked)>.caret::before {
            content: "";
            position: absolute;
            border: 10px solid transparent;
            border-top: 0;
            border-bottom: 10px solid #fff;
            border-bottom-color: var(--indextable-hover-bg, #fff);
            top: 0
        }

        .dfn-panel:not(.docked)>.caret::before {
            border-bottom: 9px solid #a2a9b1;
            border-bottom-color: var(--indextable-hover-bg, #a2a9b1)
        }

        .dfn-panel * {
            margin: 0
        }

        .dfn-panel b {
            display: block;
            color: #000;
            color: var(--text, #000);
            margin-top: .25em
        }

        .dfn-panel ul a[href] {
            color: #333;
            color: var(--text, #333)
        }

        .dfn-panel>div {
            display: flex
        }

        .dfn-panel a.self-link {
            font-weight: 700;
            margin-right: auto
        }

        .dfn-panel .marker {
            padding: .1em;
            margin-left: .5em;
            border-radius: .2em;
            text-align: center;
            white-space: nowrap;
            font-size: 90%;
            color: #040b1c
        }

        .dfn-panel .marker.dfn-exported {
            background: #d1edfd;
            box-shadow: 0 0 0 .125em #1ca5f940
        }

        .dfn-panel .marker.idl-block {
            background: #8ccbf2;
            box-shadow: 0 0 0 .125em #0670b161
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important
        }

        .dfn-panel a[href]:hover {
            border-bottom-width: 1px
        }

        .dfn-panel ul {
            padding: 0
        }

        .dfn-panel li {
            margin-left: 1em
        }

        .dfn-panel.docked {
            position: fixed;
            left: .5em;
            top: unset;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - .75em * 2 - .5em - .2em * 2);
            max-height: 30vh;
            overflow: auto
        }
    </style>


    <title>選択 API</title>



    <style id="respec-mainstyle">
        @keyframes pop {
            0% {
                transform: scale(1, 1)
            }

            25% {
                transform: scale(1.25, 1.25);
                opacity: .75
            }

            100% {
                transform: scale(1, 1)
            }
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        a.bibref {
            text-decoration: none
        }

        .respec-offending-element:target {
            animation: pop .25s ease-in-out 0s 1
        }

        .respec-offending-element,
        a[href].respec-offending-element {
            text-decoration: red wavy underline
        }

        @supports not (text-decoration:red wavy underline) {
            .respec-offending-element:not(pre) {
                display: inline-block
            }

            .respec-offending-element {
                background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x
            }
        }

        #references :target {
            background: #eaf3ff;
            animation: pop .4s ease-in-out 0s 1
        }

        cite .bibref {
            font-style: normal
        }

        a[href].orcid {
            padding-left: 4px;
            padding-right: 4px
        }

        a[href].orcid>svg {
            margin-bottom: -2px
        }

        ol.tof,
        ul.tof {
            list-style: none outside none
        }

        .caption {
            margin-top: .5em;
            font-style: italic
        }

        #issue-summary>ul {
            column-count: 2
        }

        #issue-summary li {
            list-style: none;
            display: inline-block
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top
        }

        details.respec-tests-details>* {
            padding-right: 2em
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: #fff;
            padding-bottom: .5em
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -.3em
        }

        details.respec-tests-details>li {
            padding-left: 1em
        }

        .self-link:hover {
            opacity: 1;
            text-decoration: none;
            background-color: transparent
        }

        aside.example .marker>a.self-link {
            color: inherit
        }

        .header-wrapper {
            display: flex;
            align-items: baseline
        }

        :is(h2, h3, h4, h5, h6):not(#toc>h2, #abstract>h2, #sotd>h2, .head>h2) {
            position: relative;
            left: -.5em
        }

        :is(h2, h3, h4, h5, h6):not(#toch2)+a.self-link {
            color: inherit;
            order: -1;
            position: relative;
            left: -1.1em;
            font-size: 1rem;
            opacity: .5
        }

        :is(h2, h3, h4, h5, h6)+a.self-link::before {
            content: "§";
            text-decoration: none;
            color: var(--heading-text)
        }

        :is(h2, h3)+a.self-link {
            top: -.2em
        }

        :is(h4, h5, h6)+a.self-link::before {
            color: #000
        }

        @media (max-width:767px) {
            dd {
                margin-left: 0
            }
        }

        @media print {
            .removeOnSave {
                display: none
            }
        }
    </style>
    <meta name="color-scheme" content="light">
    <!-- <meta name="revision" content="04da02f9aa4e5531f1a92e2d8e4c119c6d8eada3"> -->
    <meta name="description" content="この文書は、Selection API および選択に関連する機能の仕様の予備草案です。
        これは HTML 仕様のいくつかの古いセクションと、古い
        DOM Range 仕様の選択部分を置き換えるものです。">
    <link rel="canonical" href="https://www.w3.org/TR/selection-api/">
    <style>
        var {
            position: relative;
            cursor: pointer
        }

        var[data-type]::after,
        var[data-type]::before {
            position: absolute;
            left: 50%;
            top: -6px;
            opacity: 0;
            transition: opacity .4s;
            pointer-events: none
        }

        var[data-type]::before {
            content: "";
            transform: translateX(-50%);
            border-width: 4px 6px 0 6px;
            border-style: solid;
            border-color: transparent;
            border-top-color: #222
        }

        var[data-type]::after {
            content: attr(data-type);
            transform: translateX(-50%) translateY(-100%);
            background: #222;
            text-align: center;
            font-family: "Dank Mono", "Fira Code", monospace;
            font-style: normal;
            padding: 6px;
            border-radius: 3px;
            color: #daca88;
            text-indent: 0;
            font-weight: 400
        }

        var[data-type]:hover::after,
        var[data-type]:hover::before {
            opacity: 1
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
  "specStatus": "WD",
  "shortName": "selection-api",
  "editors": [
    {
      "name": "Ryosuke Niwa",
      "mailto": "rniwa@apple.com",
      "company": "Apple Inc.",
      "companyURL": "https://www.apple.com/",
      "w3cid": "49910",
      "url": "mailto:rniwa@apple.com"
    }
  ],
  "group": "webediting",
  "testSuiteURI": "https://wpt.fyi/results/selection/",
  "github": "w3c/selection-api",
  "xref": "web-platform",
  "gitRevision": "04da02f9aa4e5531f1a92e2d8e4c119c6d8eada3",
  "publishDate": "2025-01-05",
  "previousMaturity": "WD",
  "previousPublishDate": "2024-12-19",
  "publishISODate": "2025-01-05T00:00:00.000Z",
  "generatedSubtitle": "W3C Working Draft 05 January 2025"
}</script>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>

<body class="h-entry" data-cite="WEBIDL HTML INFRA URL WEBIDL DOM FETCH">
    <div class="head">
        <p class="logos"><a class="logo" href="https://www.w3.org/"><img alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a></p>
        <h1 id="title" class="title">選択 API</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C ワーキングドラフト</a> <time class="dt-published"
                datetime="2025-01-05">2025年1月5日</time></p>
        <details open="">
            <summary>この文書の詳細</summary>
            <dl>
                <dt>This version:</dt>
                <dd>
                    <a class="u-url"
                        href="https://www.w3.org/TR/2025/WD-selection-api-20250105/">https://www.w3.org/TR/2025/WD-selection-api-20250105/</a>
                </dd>
                <dt>Latest published version:</dt>
                <dd>
                    <a href="https://www.w3.org/TR/selection-api/">https://www.w3.org/TR/selection-api/</a>
                </dd>
                <dt>Latest editor's draft:</dt>
                <dd><a href="https://w3c.github.io/selection-api/">https://w3c.github.io/selection-api/</a></dd>
                <dt>History:</dt>
                <dd>
                    <a
                        href="https://www.w3.org/standards/history/selection-api/">https://www.w3.org/standards/history/selection-api/</a>
                </dd>
                <dd>
                    <a href="https://github.com/w3c/selection-api/commits/">コミット履歴</a>
                </dd>
                <dt>Test suite:</dt>
                <dd><a href="https://wpt.fyi/results/selection/">https://wpt.fyi/results/selection/</a></dd>




                <dt>Editor:</dt>
                <dd class="editor p-author h-card vcard" data-editor-id="49910">
                    <a class="ed_mailto u-email email p-name" href="mailto:rniwa@apple.com">Ryosuke Niwa</a> (<a
                        class="p-org org h-org" href="https://www.apple.com/">Apple Inc.</a>)
                </dd>


                <dt>Feedback:</dt>
                <dd>
                    <a href="https://github.com/w3c/selection-api/">GitHub w3c/selection-api</a>
                    (<a href="https://github.com/w3c/selection-api/pulls/">プルリクエスト</a>,
                    <a href="https://github.com/w3c/selection-api/issues/new/choose">新しい issue</a>,
                    <a href="https://github.com/w3c/selection-api/issues/">未解決の issue</a>)
                </dd>


            </dl>
        </details>


        <p class="copyright">
            <a href="https://www.w3.org/policies/#copyright">Copyright</a>
            ©
            2025

            <a href="https://www.w3.org/">World Wide Web Consortium</a>.
            <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
            <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
            <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
            <a rel="license" href="https://www.w3.org/copyright/software-license-2023/"
                title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>
    <section id="abstract" class="introductory">
        <h2>概要</h2>
        <p>
            この文書は、Selection API および選択に関連する機能の仕様の予備草案です。これは
            <a href="https://www.w3.org/TR/html5/">HTML specification</a> のいくつかの古いセクションと、古い
            <a href="https://www.w3.org/TR/2000/REC-DOM-Level-2-Traversal-Range-20001113/ranges.html">
                DOM Range specification</a> の選択に関する部分を置き換えるものです。
        </p>
        <p>
            この文書は選択のための API を定義しており、ユーザーや作成者が文書の一部を選択したり、コピー、貼り付け、その他の編集操作のための関心点を指定したりできるようにします。
        </p>
    </section>
    <section id="sotd" class="introductory">
        <h2>この文書の状態</h2>
        <p><em>このセクションは、本書の公開時点での状態を説明します。現行の <abbr title="World Wide Web Consortium">W3C</abbr>
                出版物の一覧およびこの技術報告書の最新の改訂は、<a href="https://www.w3.org/TR/"><abbr
                        title="World Wide Web Consortium">W3C</abbr> technical
                    reports index</a>（https://www.w3.org/TR/）で確認できます。</em></p>
        <p>
            本文書は作業中です。
        </p>
        <p>
            この文書は<a href="https://www.w3.org/groups/wg/webediting">Web Editing Working
                Group</a>によって、<a href="https://www.w3.org/policies/process/20231103/#recs-and-notes">Recommendation
                track</a> を用いてWorking Draftとして公開されました。
        </p>
        <p>Working Draft としての公開は、<abbr title="World Wide Web Consortium">W3C</abbr> およびそのメンバーによる承認を意味するものではありません。 </p>
        <p>
            本文書は草案であり、いつでも更新、置換、または他の文書により廃止される可能性があります。本稿を作業中以外のものとして引用することは適切ではありません。

        </p>
        <p>

            この文書は、<a href="https://www.w3.org/policies/patent-policy/"><abbr
                    title="World Wide Web Consortium">W3C</abbr>
                Patent
                Policy</a> の下で運営されるグループによって作成されました。


            <abbr title="World Wide Web Consortium">W3C</abbr> は、グループの成果物に関連して行われた
            <a rel="disclosure" href="https://www.w3.org/groups/wg/webediting/ipr">特許開示の公開リスト</a>
            を維持しています；そのページには特許を開示するための手順も記載されています。個人が自身が本質的請求（<a
                href="https://www.w3.org/policies/patent-policy/#def-essential">Essential
                Claim(s)</a>）を含むと考える特許について実際に知識を有する場合は、<a
                href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">W3C 特許方針の第6節</a> に従って情報を開示しなければなりません。

        </p>
        <p>
            この文書は、<a id="w3c_process_revision" href="https://www.w3.org/policies/process/20231103/">2023年11月03日付の W3C
                プロセス文書</a> に準拠して管理されています。
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">目次</h2>
        <ol class="toc">
            <li class="tocline"><a class="tocxref" href="#abstract">概要</a></li>
            <li class="tocline"><a class="tocxref" href="#sotd">この文書の状態</a></li>
            <li class="tocline"><a class="tocxref" href="#background"><bdi class="secno">1. </bdi>
                    背景
                </a></li>
            <li class="tocline"><a class="tocxref" href="#definition"><bdi class="secno">2. </bdi>
                    定義
                </a></li>
            <li class="tocline"><a class="tocxref" href="#selection-interface"><bdi class="secno">3. </bdi>
                    Selection インターフェース
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-other-interfaces"><bdi class="secno">4. </bdi>
                    他のインターフェースへの拡張
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#extensions-to-document-interface"><bdi
                                class="secno">4.1 </bdi>
                            <code>Document</code> インターフェースへの拡張
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#extensions-to-window-interface"><bdi class="secno">4.2
                            </bdi>
                            <code>Window</code> インターフェースへの拡張
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#extensions-to-globaleventhandlers-interface"><bdi
                                class="secno">4.3 </bdi>
                            <code>GlobalEventHandlers</code> インターフェースへの拡張
                        </a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#responding-to-dom-mutations"><bdi class="secno">5. </bdi>
                    DOM 変更への対応
                </a></li>
            <li class="tocline"><a class="tocxref" href="#user-interactions"><bdi class="secno">6. </bdi>
                    ユーザー操作
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#selectstart-event"><bdi class="secno">6.1 </bdi>
                            <code><span data-dfn-type="event">selectstart</span></code> イベント
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#selectionchange-event"><bdi class="secno">6.2 </bdi>
                            <code><span data-dfn-type="event">selectionchange</span></code> イベント
                        </a>
                        <ol class="toc">
                            <li class="tocline"><a class="tocxref" href="#scheduling-selectionchange-event"><bdi
                                        class="secno">6.2.1 </bdi>
                                    <code>selectionchange</code> イベントのスケジューリング
                                </a></li>
                            <li class="tocline"><a class="tocxref" href="#firing-selectionchange-event"><bdi
                                        class="secno">6.2.2 </bdi>
                                    <code>selectionchange</code> イベントの発火
                                </a></li>
                        </ol>
                    </li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">7. </bdi>適合性</a></li>
            <li class="tocline"><a class="tocxref" href="#security-and-privacy-considerations"><bdi class="secno">8.
                    </bdi>
                    セキュリティとプライバシーに関する考慮事項
                </a></li>
            <li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">A. </bdi>
                    謝辞
                </a></li>
            <li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>参考文献</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1
                            </bdi>規範的参考文献</a></li>
                </ol>
            </li>
        </ol>
    </nav>
    <section class="informative" id="background">
        <div class="header-wrapper">
            <h2 id="x1-background"><bdi class="secno">1. </bdi>
                背景
            </h2><a class="self-link" href="#background" aria-label="Permalink for Section 1."></a>
        </div>
        <p><em>このセクションは規範的ではありません。</em></p>

        <p>
            IE9 と Firefox 6.0a2
            は、選択内の任意の範囲を許可しており、これは元々この仕様書が述べていた内容に従っています。しかし、これにより著者・実装者・仕様書の作成者が対処しなければならない不都合なコーナーケースが発生し、実際にはあまり理にかなっていません。Chrome
            14 dev と Opera 11.11 は、空の要素内に選択が入らないようにするなど、選択を積極的に正規化していますが、これも著者の柔軟性を奪うという理由から良くない考え方とされています。
        </p>
        <p>
            そこで私は、ある程度の単純化を可能にしつつも著者をあまり制限しない妥協案として仕様を変更しました。<a
                href="https://lists.w3.org/Archives/Public/public-whatwg-archive/2011Jun/0193.html">
                ディスカッション</a> を参照してください。基本的には、要素ノードやテキストノード以外の <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-bp">境界点</a> を含む範囲や、Document
            から派生しない境界点を選択に含めようとすると、いくつかの場面で例外を投げる形になります。
        </p>
        <p>
            しかし、これにより getRangeAt() は参照ではなくコピーを返す必要が生じました。また、コーナーケースで妙な故障が発生しやすくなります。特に重要なのは、DOM
            変更が発生した際（たとえば、境界点のノードが親から取り除かれ、新しい境界点が非テキスト/非要素ノード内に配置される場合など）、さまざまな問題が発生する可能性があることです。さらに、従来の仕様は2つの主要な実装に合致するという利点がありましたが、新しい挙動はどの実装にも一致しませんでした。そこで元に戻しました。
        </p>
        <div class="note" role="note" id="issue-container-generatedID">
            <div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>注</span></div>
            <div class="">
                <p>
                    <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=15470">バグ 15470</a> を参照。
                    IE9、Firefox 12.0a1、Chrome 17 dev、Opera Next 12.00 alpha では、範囲は初期状態で null です。
                </p>
            </div>
        </div>
    </section>
    <section id="definition">
        <div class="header-wrapper">
            <h2 id="x2-definition"><bdi class="secno">2. </bdi>
                定義
            </h2><a class="self-link" href="#definition" aria-label="Permalink for Section 2."></a>
        </div>

        <p>
            <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a> はそれぞれ <a
                data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc">ブラウジングコンテキスト</a>
            を持つ場合、
            一意な <dfn id="dfn-selection" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">selection</dfn>
            が関連付けられます。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-0">
            <div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>注</span></div>
            <p class="">
                これは HTML 仕様の要件です。IE9 と Opera Next 12.00 alpha はこれに従うようですが、Firefox 12.0a1 と Chrome 17 dev はそうではないようです。<a
                    href="https://bugzilla.mozilla.org/show_bug.cgi?id=717339">Mozilla バグ</a>、
                <a href="https://bugs.webkit.org/show_bug.cgi?id=76114">WebKit バグ</a> を参照。
            </p>
        </div>
        <p>
            この <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-1">selection</a> は、<a data-link-type="idl"
                href="https://dom.spec.whatwg.org/#document">document</a> 内のすべてのコンテンツ（ネストされた <a data-link-type="idl"
                href="https://dom.spec.whatwg.org/#document">document</a> を除く）や、その <a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/interaction.html#editing-host">編集ホスト</a>
            を含めて、共有されなければなりません。
        </p>
        <p>
            各 <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-2">selection</a> は、1つの <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> と関連付けできます。
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> が <a
                href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-3">selection</a> に関連付けられていない場合、
            選択状態は <dfn id="dfn-empty" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">空</dfn> です。選択状態は初期状態で
            <a href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-1">空</a> でなければなりません。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-1">
            <div role="heading" class="note-title marker" id="h-note-1" aria-level="3"><span>注</span></div>
            <p class="">
                <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a> の <a
                    href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-4">selection</a> は、その <a data-link-type="idl"
                    href="https://dom.spec.whatwg.org/#document">document</a> に紐づいたシングルトンオブジェクトであり、
                <code>Document.open()</code> が呼ばれると新しいオブジェクトに置き換えられます。<a
                    href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=15470">バグ 15470</a> を参照。
                IE9 と Opera Next 12.00 alpha は、クリックにより後から範囲を null にできますが、Firefox 12.0a1 と Chrome 17 dev
                はできません。Gecko/WebKit の動作に従います。なぜなら、getRangeAt(0) が例外を投げる可能性が減少するからです。
            </p>
        </div>
        <p>
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-5">selection</a>
            が <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> と関連付けられると、
            仕様で別途要求されない限り、そのまま同じ <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
            と紐づき続けなければなりません。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-2">
            <div role="heading" class="note-title marker" id="h-note-2" aria-level="3"><span>注</span></div>
            <p class="" data-link-for="Selection">
                たとえば、DOM が範囲の境界点を変更するような形で変化した場合、またはスクリプトが範囲の境界点を変更した場合でも、
                同じ range オブジェクトが引き続き selection に紐づく必要があります。ただし、ユーザーが selection を変更したりスクリプトが <a data-link-type="idl"
                    data-lt="addRange()" href="#dom-selection-addrange" class="internalDFN"
                    id="ref-for-dom-selection-addrange-1"><code>addRange</code></a><code>()</code> を呼んだ場合は、
                selection は新しい range オブジェクトと関連付け直されなければなりません。
            </p>
        </div>
        <p>
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-6">selection</a>
            の <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> が null でなく、かつ
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#range-collapsed">折りたたまれている</a> 場合は、キャレットの位置はその
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> の <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp">境界点</a>
            でなければなりません。折りたたまれていない場合、本仕様はキャレットの位置を定義しません。ユーザーエージェントは、キャレットを選択の開始・終了・その他どこに表示するかを、プラットフォームの慣習に則って決定すべきです。
        </p>
        <p>
            各 <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-10">selection</a> には <dfn id="dfn-direction" tabindex="0"
                aria-haspopup="dialog" data-dfn-type="dfn">direction</dfn>（<dfn id="dfn-forwards" tabindex="0"
                aria-haspopup="dialog" data-dfn-type="dfn">forwards</dfn>・
            <dfn id="dfn-backwards" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">backwards</dfn>・<dfn
                id="dfn-directionless" tabindex="0" aria-haspopup="dialog"
                data-dfn-type="dfn">directionless</dfn>）があります。ユーザーが
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-11">selection</a> を、
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp">境界点</a>
            のいずれかをまず指定してから（例：一点をクリックし、他方へドラッグする）、もう一方を指定した場合、最初に指定した <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-bp">境界点</a> が二番目より <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-bp-after">後</a> であれば、その <a href="#dfn-selection"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-12">selection</a> の初期状態は <a
                href="#dfn-backwards" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-backwards-1">backwards</a> でなければなりません。最初が <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-bp-before">前</a> であれば
            <a href="#dfn-forwards" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-forwards-1">forwards</a>。
            それ以外の場合は <a href="#dfn-directionless" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-directionless-1">directionless</a> とします。
        </p>
        <p>
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-14">selection</a> の <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> がスクリプトで変更された場合（例：<a data-link-type="method"
                data-lt="selectNode(node)"
                href="https://dom.spec.whatwg.org/#dom-range-selectnode"><code>selectNode</code></a><code>(<var>node</var>)</code>
            など）、
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-15">selection</a> の <a href="#dfn-direction" class="internalDFN"
                data-link-type="dfn" id="ref-for-dfn-direction-1">direction</a> は保持されなければなりません。
        </p>
        <p>
            各 <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-16">selection</a> は <dfn id="dfn-anchor" tabindex="0" aria-haspopup="dialog"
                data-dfn-type="dfn">anchor</dfn> と
            <dfn id="dfn-focus" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">focus</dfn> も持ちます。<a
                href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-17">selection</a> の <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> が null のときは、
            <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-1">anchor</a>、
            <a href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-1">focus</a> のいずれも null
            です。
            <a href="#dfn-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-direction-2">direction</a>
            が <a href="#dfn-forwards" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-forwards-2">forwards</a>
            なら、<a href="#dfn-anchor" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-2">anchor</a> は <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> の <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a>、<a
                href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-2">focus</a> は <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> です。
            それ以外は <a href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-3">focus</a> が <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a>、<a
                href="#dfn-anchor" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-3">anchor</a> が <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-end">end</a> です。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-3">
            <div role="heading" class="note-title marker" id="h-note-3" aria-level="3"><span>注</span></div>
            <p class="">
                <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-19">selection</a> の <a href="#dfn-anchor" class="internalDFN"
                    data-link-type="dfn" id="ref-for-dfn-anchor-4">anchor</a> および
                <a href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-4">focus</a> は必ずしも
                <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>
                内にある必要はありません。
                同じ <a data-link-type="dfn|abstract-op" href="https://dom.spec.whatwg.org/#document">document</a> の <a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree">shadow tree</a>
                内にあっても構いません。
            </p>
        </div>
        <p>
            各 <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a>、<a
                data-link-type="element"
                href="https://html.spec.whatwg.org/multipage/input.html#the-input-element">input</a> 要素、<a
                data-link-type="element"
                href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element">textarea</a> 要素
            には、boolean型の <dfn id="dfn-has-scheduled-selectionchange-event" tabindex="0" aria-haspopup="dialog"
                data-dfn-type="dfn">has scheduled selectionchange event</dfn> があり、
            その初期値は false です。
        </p>
    </section>
    <section data-dfn-for="Selection" id="selection-interface">
        <div class="header-wrapper">
            <h2 id="x3-selection-interface"><bdi class="secno">3. </bdi>
                Selection インターフェース
            </h2><a class="self-link" href="#selection-interface" aria-label="Permalink for Section 3."></a>
        </div>

        <p>
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-20">Selection</a> インターフェースは、各 document に関連付けられている
            <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-21">selection</a> を操作するための手段を提供します。
        </p>
        <pre class="idl def" id="webidl-1987235205"><span class="idlHeader"><a class="self-link" href="#webidl-1987235205">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-selection" data-title="Selection">[<span class="extAttr"><a data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed">Exposed</a>=Window</span>]
interface <dfn data-export="" data-dfn-type="interface" id="dom-selection" data-idl="interface" data-title="Selection" data-dfn-for="" class="idlID" tabindex="0" aria-haspopup="dialog"><code>Selection</code></dfn> {<span data-idl="" class="idlAttribute" id="idl-def-selection-anchornode" data-title="anchorNode" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a>?</span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-anchornode" id="ref-for-dom-selection-anchornode-1"><code>anchorNode</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-anchoroffset" data-title="anchorOffset" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-anchoroffset" id="ref-for-dom-selection-anchoroffset-1"><code>anchorOffset</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-focusnode" data-title="focusNode" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a>?</span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-focusnode" id="ref-for-dom-selection-focusnode-1"><code>focusNode</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-focusoffset" data-title="focusOffset" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-focusoffset" id="ref-for-dom-selection-focusoffset-1"><code>focusOffset</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-iscollapsed" data-title="isCollapsed" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-iscollapsed" id="ref-for-dom-selection-iscollapsed-1"><code>isCollapsed</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-rangecount" data-title="rangeCount" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-rangecount" id="ref-for-dom-selection-rangecount-1"><code>rangeCount</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-type" data-title="type" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-type" id="ref-for-dom-selection-type-1"><code>type</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-selection-direction" data-title="direction" data-dfn-for="Selection">
  readonly attribute<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-selection-direction" id="ref-for-dom-selection-direction-1"><code>direction</code></a>;</span><span data-idl="" class="idlMethod" id="idl-def-selection-getrangeat-index" data-title="getRangeAt" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://dom.spec.whatwg.org/#range">Range</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-getrangeat" id="ref-for-dom-selection-getrangeat-1"><code>getRangeAt</code></a>(<span class="idlType"><a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">index</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-addrange-range" data-title="addRange" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-addrange" id="ref-for-dom-selection-addrange-2"><code>addRange</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#range">Range</a></span> <span class="idlParamName">range</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-removerange-range" data-title="removeRange" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-removerange" id="ref-for-dom-selection-removerange-1"><code>removeRange</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#range">Range</a></span> <span class="idlParamName">range</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-removeallranges" data-title="removeAllRanges" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-removeallranges" id="ref-for-dom-selection-removeallranges-1"><code>removeAllRanges</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-empty" data-title="empty" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-empty" id="ref-for-dom-selection-empty-1"><code>empty</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-getcomposedranges-options" data-title="getComposedRanges" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence">sequence</a>&lt;<a data-link-type="interface" href="https://dom.spec.whatwg.org/#staticrange">StaticRange</a>&gt;</span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-getcomposedranges" id="ref-for-dom-selection-getcomposedranges-1"><code>getComposedRanges</code></a>(optional<span class="idlType"> <a data-link-type="idl" href="#dom-getcomposedrangesoptions" class="internalDFN" id="ref-for-dom-getcomposedrangesoptions-1"><code>GetComposedRangesOptions</code></a></span> <span class="idlParamName">options</span> = {});</span><span data-idl="" class="idlMethod" id="idl-def-selection-collapse-node-offset" data-title="collapse" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-collapse" id="ref-for-dom-selection-collapse-1"><code>collapse</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a>?</span> <span class="idlParamName">node</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">offset</span> = 0);</span><span data-idl="" class="idlMethod" id="idl-def-selection-setposition-node-offset" data-title="setPosition" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-setposition" id="ref-for-dom-selection-setposition-1"><code>setPosition</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a>?</span> <span class="idlParamName">node</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">offset</span> = 0);</span><span data-idl="" class="idlMethod" id="idl-def-selection-collapsetostart" data-title="collapseToStart" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-collapsetostart" id="ref-for-dom-selection-collapsetostart-1"><code>collapseToStart</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-collapsetoend" data-title="collapseToEnd" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-collapsetoend" id="ref-for-dom-selection-collapsetoend-1"><code>collapseToEnd</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-extend-node-offset" data-title="extend" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-extend" id="ref-for-dom-selection-extend-1"><code>extend</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">node</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">offset</span> = 0);</span><span data-idl="" class="idlMethod" id="idl-def-selection-setbaseandextent-anchornode-anchoroffset-focusnode-focusoffset" data-title="setBaseAndExtent" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-setbaseandextent" id="ref-for-dom-selection-setbaseandextent-1"><code>setBaseAndExtent</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">anchorNode</span>,<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">anchorOffset</span>,<span class="idlType"> <a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">focusNode</span>,<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long">unsigned long</a></span> <span class="idlParamName">focusOffset</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-selectallchildren-node" data-title="selectAllChildren" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-selectallchildren" id="ref-for-dom-selection-selectallchildren-1"><code>selectAllChildren</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">node</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-modify-alter-direction-granularity" data-title="modify" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-modify" id="ref-for-dom-selection-modify-1"><code>modify</code></a>(optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <span class="idlParamName">alter</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <span class="idlParamName">direction</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <span class="idlParamName">granularity</span>);</span><span data-idl="" class="idlMethod" id="idl-def-selection-deletefromdocument" data-title="deleteFromDocument" data-dfn-for="Selection">
  [<span class="extAttr"><a data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions">CEReactions</a></span>]<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-deletefromdocument" id="ref-for-dom-selection-deletefromdocument-1"><code>deleteFromDocument</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-selection-containsnode-node-allowpartialcontainment" data-title="containsNode" data-dfn-for="Selection"><span class="idlType">
  <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-selection-containsnode" id="ref-for-dom-selection-containsnode-1"><code>containsNode</code></a>(<span class="idlType"><a data-link-type="interface" href="https://dom.spec.whatwg.org/#node">Node</a></span> <span class="idlParamName">node</span>, optional<span class="idlType"> <a data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <span class="idlParamName">allowPartialContainment</span> = false);</span><span data-idl="" class="idlMethod" id="idl-def-selection-anonymous-stringifier" data-title="stringifier" data-dfn-for="Selection">
  <a class="internalDFN" data-link-type="method" href="#dom-selection-stringifier" id="ref-for-dom-selection-stringifier-1"><code>stringifier</code></a>;</span>
};</span><span data-idl="" class="idlDictionary" id="idl-def-getcomposedrangesoptions" data-title="GetComposedRangesOptions">

dictionary <dfn data-export="" data-dfn-type="dictionary" id="dom-getcomposedrangesoptions" data-idl="dictionary" data-title="GetComposedRangesOptions" data-dfn-for="" class="idlID" tabindex="0" aria-haspopup="dialog"><code>GetComposedRangesOptions</code></dfn> {<span data-idl="" class="idlMember" id="idl-def-getcomposedrangesoptions-shadowroots" data-title="shadowRoots" data-dfn-for="GetComposedRangesOptions"><span class="idlType">
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence">sequence</a>&lt;<a data-link-type="interface" href="https://dom.spec.whatwg.org/#shadowroot">ShadowRoot</a>&gt;</span> <dfn data-export="" data-dfn-type="dict-member" id="dom-getcomposedrangesoptions-shadowroots" data-idl="field" data-title="shadowRoots" data-dfn-for="GetComposedRangesOptions" data-type="sequence" class="idlName" tabindex="0" aria-haspopup="dialog"><code>shadowRoots</code></dfn> = [];</span>
};</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-anchornode" data-idl="attribute"
                    data-title="anchorNode" data-dfn-for="Selection" data-type="Node" data-lt="anchorNode"
                    data-local-lt="Selection.anchorNode" tabindex="0"
                    aria-haspopup="dialog"><code>anchorNode</code></dfn>
            </dt>
            <dd>
                <p>
                    この属性は、<a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-5">anchor</a> の <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#boundary-point-node">node</a> を <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> から返す必要があります。あるいは、<a href="#dfn-anchor"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-6">anchor</a> が null であるか、または <a
                        href="#dfn-anchor" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-7">anchor</a>
                    が <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-tree">document
                        tree</a> に存在しない場合は <code>null</code> を返します。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-anchoroffset" data-idl="attribute"
                    data-title="anchorOffset" data-dfn-for="Selection" data-type="unsigned long" data-lt="anchorOffset"
                    data-local-lt="Selection.anchorOffset" tabindex="0"
                    aria-haspopup="dialog"><code>anchorOffset</code></dfn>
            </dt>
            <dd>
                <p>
                    この属性は、<a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-8">anchor</a> の <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-bp-offset">offset</a> を <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> から返す必要があります。あるいは、<code>anchor</code> が null
                    であるか、または <a href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-10">anchor</a> が <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a> に存在しない場合は
                    <code>0</code> を返します。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-focusnode" data-idl="attribute"
                    data-title="focusNode" data-dfn-for="Selection" data-type="Node" data-lt="focusNode"
                    data-local-lt="Selection.focusNode" tabindex="0" aria-haspopup="dialog"><code>focusNode</code></dfn>
            </dt>
            <dd>
                <p>
                    この属性は、<a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-5">focus</a> の <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#boundary-point-node">node</a> を <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> から返す必要があります。あるいは、<a href="#dfn-focus"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-6">focus</a> が null であるか、または <a
                        href="#dfn-focus" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-7">focus</a> が
                    <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>
                    に存在しない場合は <code>null</code> を返します。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-focusoffset" data-idl="attribute"
                    data-title="focusOffset" data-dfn-for="Selection" data-type="unsigned long" data-lt="focusOffset"
                    data-local-lt="Selection.focusOffset" tabindex="0"
                    aria-haspopup="dialog"><code>focusOffset</code></dfn>
            </dt>
            <dd>
                <p>
                    この属性は、<a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-8">focus</a> の <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-bp-offset">offset</a> を <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> から返す必要があります。あるいは、<a href="#dfn-focus"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-9">focus</a>
                    が null であるか、または <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-10">focus</a> が <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a> に存在しない場合は
                    <code>0</code> を返します。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-iscollapsed" data-idl="attribute"
                    data-title="isCollapsed" data-dfn-for="Selection" data-type="boolean" data-lt="isCollapsed"
                    data-local-lt="Selection.isCollapsed" tabindex="0"
                    aria-haspopup="dialog"><code>isCollapsed</code></dfn>
            </dt>
            <dd>
                <p>
                    この属性は、<span>anchor</span> と <span>focus</span> が同一である場合に限り <code>true</code> を返さなければなりません（両方が null
                    の場合を含む）。それ以外の場合は <code>false</code> を返します。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-rangecount" data-idl="attribute"
                    data-title="rangeCount" data-dfn-for="Selection" data-type="unsigned long" data-lt="rangeCount"
                    data-local-lt="Selection.rangeCount" tabindex="0"
                    aria-haspopup="dialog"><code>rangeCount</code></dfn>
            </dt>
            <dd>
                <p>
                    この属性は、<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> が <a
                        href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-2">empty</a>
                    であるか、または <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-11">focus</a> または <a href="#dfn-anchor" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-anchor-11">anchor</a> のいずれかが <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a> に存在しない場合は
                    <code>0</code> を返し、そうでない場合は <code>1</code> を返さなければなりません。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-type" data-idl="attribute"
                    data-title="type" data-dfn-for="Selection" data-type="DOMString" data-lt="type"
                    data-local-lt="Selection.type" tabindex="0" aria-haspopup="dialog"><code>type</code></dfn>
            </dt>
            <dd>
                <p>
                    この属性は、<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> が <a
                        href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-3">empty</a>
                    であるか、または <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-12">focus</a> または <a href="#dfn-anchor" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-anchor-12">anchor</a> のいずれかが <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a> に存在しない場合は
                    <code>"None"</code> を返す必要があります。<a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range">range</a> が <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#range-collapsed">collapsed</a> である場合は
                    <code>"Caret"</code>、それ以外の場合は <code>"Range"</code> を返します。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-selection-direction" data-idl="attribute"
                    data-title="direction" data-dfn-for="Selection" data-type="DOMString" data-lt="direction"
                    data-local-lt="Selection.direction" tabindex="0" aria-haspopup="dialog"><code>direction</code></dfn>
            </dt>
            <dd>
                <p>
                    この属性は、<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> が <a
                        href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-4">empty</a>
                    であるか、またはこの選択が <a href="#dfn-directionless" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-directionless-2">directionless</a> である場合は <code>"none"</code>
                    を返さなければなりません。選択の方向が <a href="#dfn-forwards" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-forwards-3">forwards</a> の場合は <code>"forward"</code>、選択の方向が <a
                        href="#dfn-backwards" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-backwards-2">backwards</a> の場合は <code>"backward"</code> を返します。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-getrangeat" data-idl="operation"
                    data-title="getRangeAt()" data-dfn-for="Selection" data-type="Range"
                    data-lt="getRangeAt()|getRangeAt(index)"
                    data-local-lt="Selection.getRangeAt|Selection.getRangeAt()|getRangeAt" tabindex="0"
                    aria-haspopup="dialog"><code>getRangeAt()</code></dfn> method
            </dt>
            <dd>
                <p data-tests="getRangeAt.html">
                    <a data-link-type="exception" data-lt="IndexSizeError"
                        href="https://webidl.spec.whatwg.org/#indexsizeerror"><code>IndexSizeError</code></a>
                    例外を、<var>index</var> が <code>0</code> でない場合、または <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> が <a href="#dfn-empty" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-empty-5">empty</a> である場合、あるいは <a href="#dfn-focus"
                        class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-13">focus</a> または <a
                        href="#dfn-anchor" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-anchor-13">anchor</a> のいずれかが <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a>
                    に存在しない場合に投げなければなりません。そうでなければ、このオブジェクトの <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range">range</a> への参照（コピーではなく）を返す必要があります。
                </p>
                <div class="note" role="note" id="issue-container-generatedID-4">
                    <div role="heading" class="note-title marker" id="h-note-4" aria-level="3"><span>Note</span></div>
                    <p class="">
                        したがって、このメソッドを続けて呼び出しても、途中でこのオブジェクトの range が取り除かれていなければ同じ <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a> オブジェクトが返されます。特に、<code>getSelection().getRangeAt(0) ===
            getSelection().getRangeAt(0)</code> は、選択が <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-22">empty</a> でない場合に <code>true</code> と評価されます。
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-addrange" data-idl="operation"
                    data-title="addRange()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="addRange()|addRange(range)"
                    data-local-lt="Selection.addRange|Selection.addRange()|addRange" tabindex="0"
                    aria-haspopup="dialog"><code>addRange()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは次の手順に従わなければなりません:
                </p>
                <ol>
                    <li>もし <var>range</var> の境界点の <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> が、<a data-link-type="idl"
                            href="https://dom.spec.whatwg.org/#document">document</a> （<a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a> に関連付けられているもの）でなければ、これらの手順を中止します。
                    </li>
                    <li>もし <code>rangeCount</code> が <code>0</code> でない場合、これらの手順を中止します。
                    </li>
                    <li><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の range
                        を、強い参照（コピーを作らない）によって <var>range</var> に設定します。
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-5">
                    <div role="heading" class="note-title marker" id="h-note-5" aria-level="3"><span>Note</span></div>
                    <p class="">
                        range を参照で追加するため、後続の <code>getRangeAt(0)</code> 呼び出しは同一のオブジェクトを返し、スクリプトが range
                        に対して行った変更は、それが取り除かれたり置換されたりするまで <a href="#dfn-selection" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-selection-23">selection</a>
                        に反映されなければなりません。具体的には、次のコードを実行すると <a href="#dfn-selection" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-selection-24">selection</a> は <var>b</var>
                        を含むようになります（<var>a</var> ではなく）: <code>var r =
            document.createRange(); r.selectNode(a);
            getSelection().addRange(r); r.selectNode(b);</code>
                    </p>
                </div>
                <div class="note" role="note" id="issue-container-generatedID-6">
                    <div role="heading" class="note-title marker" id="h-note-6" aria-level="3"><span>Note</span></div>
                    <div class="">
                        <p>
                            手順2では、Chrome 58 と Edge 25 は何もしません。Firefox 51 はマルチレンジ選択を返します。少なくとも既存の <a data-link-type="dfn"
                                href="https://dom.spec.whatwg.org/#concept-range">range</a> は保持します。
                        </p>
                        <p>
                            手順3では、Chrome 58 と Firefox 51 は参照を保存します（ここで説明されている通り）。Edge 25 はコピーを保存します。Firefox 51 は range
                            が変更されると選択を変更します。
                        </p>
                    </div>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-removerange" data-idl="operation"
                    data-title="removeRange()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="removeRange()|removeRange(range)"
                    data-local-lt="Selection.removeRange|Selection.removeRange()|removeRange" tabindex="0"
                    aria-haspopup="dialog"><code>removeRange()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは、もし <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                        href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-7">empty</a>
                    にするために、その <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> が
                    <var>range</var> と等しい場合は関連付けを解除して this を empty にしなければなりません。そうでない場合は <a data-link-type="exception"
                        data-lt="NotFoundError"
                        href="https://webidl.spec.whatwg.org/#notfounderror"><code>NotFoundError</code></a> を投げます。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-removeallranges" data-idl="operation"
                    data-title="removeAllRanges()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="removeAllRanges()"
                    data-local-lt="Selection.removeAllRanges|Selection.removeAllRanges()|removeAllRanges" tabindex="0"
                    aria-haspopup="dialog"><code>removeAllRanges()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは、<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> が関連付けられた <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
                    を持っている場合、その関連付けを解除して this を <a href="#dfn-empty" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-empty-8">empty</a> にしなければなりません。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-empty" data-idl="operation"
                    data-title="empty()" data-dfn-for="Selection" data-type="undefined" data-lt="empty()"
                    data-local-lt="Selection.empty|Selection.empty()|empty" tabindex="0"
                    aria-haspopup="dialog"><code>empty()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは <code>removeAllRanges()</code> のエイリアスであり、同一の動作をしなければなりません。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-getcomposedranges" data-idl="operation"
                    data-title="getComposedRanges()" data-dfn-for="Selection" data-type="sequence"
                    data-lt="getComposedRanges()|getComposedRanges(options)"
                    data-local-lt="Selection.getComposedRanges|Selection.getComposedRanges()|getComposedRanges"
                    tabindex="0" aria-haspopup="dialog"><code>getComposedRanges()</code></dfn> method
            </dt>
            <dd>
                <ol>
                    <li>もし <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> が <a
                            href="#dfn-empty" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-empty-9">empty</a> であれば、空の配列を返します。
                    </li>
                    <li>それ以外の場合、<var>startNode</var> を <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start-node">range</a>
                        に関連付けられた開始ノードとし、<var>startOffset</var> をその <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-start-offset">開始オフセット</a> とします。
                    </li>
                    <li>もし <var>startNode</var> がノードであり、かつその <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> が <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-root">shadow root</a> であり、かつその root が
                        <var>options</var>["<a data-link-type="idl" href="#dom-getcomposedrangesoptions-shadowroots"
                            class="internalDFN"
                            id="ref-for-dom-getcomposedrangesoptions-shadowroots-1"><code>shadowRoots</code></a>"]
                        のいずれかの <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> でない限り、次の手順を繰り返します:
                        <ol>
                            <li><var>startOffset</var> を <var>startNode</var> の root の <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-index">index</a> に設定します。
                            </li>
                            <li><var>startNode</var> をその root の <a data-link-type="dfn"
                                    href="https://url.spec.whatwg.org/#concept-host">host</a> の親に設定します。
                            </li>
                        </ol>
                    </li>
                    <li><var>endNode</var> を <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end-node">range</a>
                        に関連付けられた終了ノードとし、<var>endOffset</var> をその <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-end-offset">終了オフセット</a> とします。
                    </li>
                    <li>もし <var>endNode</var> がノードであり、その <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> が <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-root">shadow root</a> であり、かつその root が
                        <var>options</var>["<a data-link-type="idl" href="#dom-getcomposedrangesoptions-shadowroots"
                            class="internalDFN"
                            id="ref-for-dom-getcomposedrangesoptions-shadowroots-2"><code>shadowRoots</code></a>"]
                        のいずれかの <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> でない限り、次の手順を繰り返します:
                        <ol>
                            <li><var>endOffset</var> を <var>endNode</var> の root の <a data-link-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-tree-index">index</a> プラス 1 に設定します。
                            </li>
                            <li><var>endNode</var> をその root の <a data-link-type="dfn"
                                    href="https://url.spec.whatwg.org/#concept-host">host</a> の親に設定します。
                            </li>
                        </ol>
                    </li>
                    <li>開始ノードが <var>startNode</var>、開始オフセットが <var>startOffset</var>、終了ノードが <var>endNode</var>、終了オフセットが
                        <var>endOffset</var> の新しい <a data-link-type="interface" data-lt="StaticRange"
                            href="https://dom.spec.whatwg.org/#staticrange"><code>StaticRange</code></a> を含む配列を返します。
                    </li>
                </ol>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-collapse" data-idl="operation"
                    data-title="collapse()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="collapse()|collapse(node)|collapse(node, offset)"
                    data-local-lt="Selection.collapse|Selection.collapse()|collapse" tabindex="0"
                    aria-haspopup="dialog"><code>collapse()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは次の手順に従わなければなりません:
                </p>
                <ol>
                    <li>もし <var>node</var> が null であれば、このメソッドは <code>removeAllRanges()</code> と同一に振る舞い、これらの手順を中止します。
                    </li>
                    <li>もし <var>node</var> が <a data-link-type="interface" data-lt="DocumentType"
                            href="https://dom.spec.whatwg.org/#documenttype"><code>DocumentType</code></a> であれば、<a
                            data-link-type="exception" data-lt="InvalidNodeTypeError"
                            href="https://webidl.spec.whatwg.org/#invalidnodetypeerror"><code>InvalidNodeTypeError</code></a>
                        を投げてこれらの手順を中止します。
                    </li>
                    <li>もし <var>offset</var> が <var>node</var> の <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-node-length">length</a> より大きければ、<a
                            data-link-type="exception" data-lt="IndexSizeError"
                            href="https://webidl.spec.whatwg.org/#indexsizeerror"><code>IndexSizeError</code></a>
                        を投げてこれらの手順を中止します。
                    </li>
                    <li>もし <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a> が <a
                            data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> でない場合、これらの手順を中止します。
                    </li>
                    <li>それ以外の場合、<var>newRange</var> を新しい <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a> とします。
                    </li>
                    <li><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-set">開始点を設定</a>
                        し、<var>newRange</var> の開始および終了を (<var>node</var>, <var>offset</var>) に設定します。
                    </li>
                    <li><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> を
                        <var>newRange</var> に設定します。
                    </li>
                </ol>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-setposition" data-idl="operation"
                    data-title="setPosition()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="setPosition()|setPosition(node)|setPosition(node, offset)"
                    data-local-lt="Selection.setPosition|Selection.setPosition()|setPosition" tabindex="0"
                    aria-haspopup="dialog"><code>setPosition()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは <code>collapse()</code> のエイリアスであり、同一の動作をしなければなりません。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-collapsetostart" data-idl="operation"
                    data-title="collapseToStart()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="collapseToStart()"
                    data-local-lt="Selection.collapseToStart|Selection.collapseToStart()|collapseToStart" tabindex="0"
                    aria-haspopup="dialog"><code>collapseToStart()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは、もし <a data-link-type="exception" data-lt="InvalidStateError"
                        href="https://webidl.spec.whatwg.org/#invalidstateerror"><code>InvalidStateError</code></a>
                    を投げるべき条件（すなわちこのオブジェクトが <a href="#dfn-empty" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-empty-10">empty</a> である場合）でなければ、新しい <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range">range</a> を作成し、その開始と終了の両方をこのオブジェクトの range
                    の開始位置に設定し、作成した range を this の range に設定しなければなりません。
                </p>
                <div class="note" role="note" id="issue-container-generatedID-7">
                    <div role="heading" class="note-title marker" id="h-note-7" aria-level="3"><span>Note</span></div>
                    <p class="">
                        collapseToStart/End について、IE9 は既存の range を変更しますが、Firefox 9.0a2 と Chrome 15 dev は新しい range
                        に置き換えます。仕様は多数派に従い、新しい range に置き換えて古い Range オブジェクトを変更しないようにしています。
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-collapsetoend" data-idl="operation"
                    data-title="collapseToEnd()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="collapseToEnd()"
                    data-local-lt="Selection.collapseToEnd|Selection.collapseToEnd()|collapseToEnd" tabindex="0"
                    aria-haspopup="dialog"><code>collapseToEnd()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは、もし <a data-link-type="exception" data-lt="InvalidStateError"
                        href="https://webidl.spec.whatwg.org/#invalidstateerror"><code>InvalidStateError</code></a>
                    を投げるべき条件（すなわち this が <a href="#dfn-empty" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-empty-11">empty</a> である場合）でなければ、新しい <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range">range</a> を作成し、その開始と終了の両方をこのオブジェクトの range
                    の終了位置に設定し、作成した range を this の range に設定しなければなりません。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-extend" data-idl="operation"
                    data-title="extend()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="extend()|extend(node)|extend(node, offset)"
                    data-local-lt="Selection.extend|Selection.extend()|extend" tabindex="0"
                    aria-haspopup="dialog"><code>extend()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは次の手順に従わなければなりません:
                </p>
                <ol>
                    <li>もし <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a> （<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> に関連付けられているもの）が <a
                            data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> でない場合、これらの手順を中止します。
                    </li>
                    <li>もし <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> が <a
                            href="#dfn-empty" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-empty-12">empty</a> であれば、<a data-link-type="exception"
                            data-lt="InvalidStateError"
                            href="https://webidl.spec.whatwg.org/#invalidstateerror"><code>InvalidStateError</code></a>
                        を投げてこれらの手順を中止します。
                    </li>
                    <li><var>oldAnchor</var> と <var>oldFocus</var> を this の <a href="#dfn-anchor" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-anchor-14">anchor</a> および <a href="#dfn-focus"
                            class="internalDFN" data-link-type="dfn" id="ref-for-dfn-focus-14">focus</a>
                        とし、<var>newFocus</var> を境界点 (<var>node</var>, <var>offset</var>) とします。
                    </li>
                    <li><var>newRange</var> を新しい <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a> とします。
                    </li>
                    <li>もし <var>node</var> の <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> が this の range の root
                        と同じでない場合、<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-set">newRange の開始と終了を
                            <var>newFocus</var> に設定</a> します。
                    </li>
                    <li>そうでなく、もし <var>oldAnchor</var> が <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a> または
                        <var>newFocus</var> と等しい場合、<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-set">newRange の開始を <var>oldAnchor</var>
                            に設定</a> し、その終了を <var>newFocus</var> に設定します。
                    </li>
                    <li>それ以外の場合、<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-set">newRange の開始を <var>newFocus</var>
                            に設定</a> し、その終了を <var>oldAnchor</var> に設定します。
                    </li>
                    <li><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> を
                        <var>newRange</var> に設定します。
                    </li>
                    <li>もし <var>newFocus</var> が <var>oldAnchor</var> より <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a> であれば、<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            href="#dfn-direction" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-direction-3">direction</a> を <a href="#dfn-backwards" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-backwards-3">backwards</a> に設定します。そうでなければ <a
                            href="#dfn-forwards" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-forwards-4">forwards</a> に設定します。
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-8">
                    <div role="heading" class="note-title marker" id="h-note-8" aria-level="3"><span>Note</span></div>
                    <p class="">
                        2011年1月頃にリバースエンジニアリングされた実装に基づきます。IE はサポートしておらず、Firefox（2000年以前に実装）と
                        WebKit（2007年に実装）に依拠しています。Opera の実装は互換性がないため主に無視しています。Firefox 12.0a1 は既存の range を変更するようです。IE9 は
                        extend() をサポートしておらず、Chrome 17 dev や Opera Next 12.00 alpha が変更または置換するかは判別できません（getRangeAt()
                        がコピーを返すため）。それでも仕様は collapse() と一貫させるために Gecko の挙動とは異なる決定をしています。
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-setbaseandextent" data-idl="operation"
                    data-title="setBaseAndExtent()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="setBaseAndExtent()|setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset)"
                    data-local-lt="Selection.setBaseAndExtent|Selection.setBaseAndExtent()|setBaseAndExtent"
                    tabindex="0" aria-haspopup="dialog"><code>setBaseAndExtent()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは次の手順に従わなければなりません:
                </p>
                <ol>
                    <li>もし <var>anchorOffset</var> が <var>anchorNode</var> の <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-node-length">length</a> より大きい、または
                        <var>focusOffset</var> が <var>focusNode</var> の <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-node-length">length</a> より大きい場合、<a
                            data-link-type="exception" data-lt="IndexSizeError"
                            href="https://webidl.spec.whatwg.org/#indexsizeerror"><code>IndexSizeError</code></a>
                        を投げてこれらの手順を中止します。
                    </li>
                    <li>もし <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document">document</a> が <a
                            data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-ancestor">shadow-including
                            inclusive ancestor</a> でない場合、これらの手順を中止します。
                    </li>
                    <li><var>anchor</var> を境界点 (<var>anchorNode</var>, <var>anchorOffset</var>)、<var>focus</var> を境界点
                        (<var>focusNode</var>, <var>focusOffset</var>) とします。
                    </li>
                    <li><var>newRange</var> を新しい <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a> とします。
                    </li>
                    <li>もし <var>anchor</var> が <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a> <var>focus</var>
                        であれば、<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-set">newRange
                            の開始を <var>anchor</var>、終了を <var>focus</var> に設定</a> します。そうでなければ開始を <var>focus</var>、終了を
                        <var>anchor</var> に設定します。
                    </li>
                    <li><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> を
                        <var>newRange</var> に設定します。
                    </li>
                    <li>もし <var>focus</var> が <var>anchor</var> より <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range-bp-before">before</a> であれば、<a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            href="#dfn-direction" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-direction-4">direction</a> を <a href="#dfn-backwards" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-backwards-4">backwards</a> に設定します。そうでなければ <a
                            href="#dfn-forwards" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-forwards-5">forwards</a> に設定します。
                    </li>
                </ol>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-selectallchildren" data-idl="operation"
                    data-title="selectAllChildren()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="selectAllChildren()|selectAllChildren(node)"
                    data-local-lt="Selection.selectAllChildren|Selection.selectAllChildren()|selectAllChildren"
                    tabindex="0" aria-haspopup="dialog"><code>selectAllChildren()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは次の手順に従わなければなりません:
                </p>
                <ol>
                    <li>もし <var>node</var> が <a data-link-type="interface" data-lt="DocumentType"
                            href="https://dom.spec.whatwg.org/#documenttype"><code>DocumentType</code></a> であれば、<a
                            data-link-type="exception" data-lt="InvalidNodeTypeError"
                            href="https://webidl.spec.whatwg.org/#invalidnodetypeerror"><code>InvalidNodeTypeError</code></a>
                        を投げてこれらの手順を中止します。
                    </li>
                    <li>もし <var>node</var> の <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> が、<a data-link-type="idl"
                            href="https://dom.spec.whatwg.org/#document">document</a>（<a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a> に関連付けられているもの）でない場合、これらの手順を中止します。
                    </li>
                    <li><var>newRange</var> を新しい <a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-range">range</a> とし、<var>childCount</var> を
                        <var>node</var> の子の数として定義します。
                    </li>
                    <li><var>newRange</var> の開始を (<var>node</var>, <code>0</code>) に設定します。
                    </li>
                    <li><var>newRange</var> の終了を (<var>node</var>, <var>childCount</var>) に設定します。
                    </li>
                    <li><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> を
                        <var>newRange</var> に設定します。
                    </li>
                    <li><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            href="#dfn-direction" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-direction-5">direction</a> を <var>forwards</var> に設定します。
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-9">
                    <div role="heading" class="note-title marker" id="h-note-9" aria-level="3"><span>Note</span></div>
                    <div class="">
                        <p>
                            主に Firefox 9.0a2 に基づきます。引数に Document を渡すと終了オフセットが子の数ではなく 1 になるバグがありました。また、実装が DOMException と
                            RangeException の統合に先行していたため、RangeException を投げます。
                        </p>
                        <p>
                            IE9 も類似の振る舞いですが不具合があります。ノードがデタッチされているか display:none の場合に "Unspecified error."
                            を投げたり、デタッチされたコメントに対して "Invalid argument." を投げたりします。コメントを渡すとテキストノードとは異なりコメント全体を選択するようです。
                        </p>
                        <p>
                            Chrome 16 dev は Selection 実装に従った動作をします。表示されていないものは選択しないため、多くの場合誤っています。Opera 11.50
                            はテストでは何もしませんでした。
                        </p>
                        <p>
                            新しい range は既存のものを置換し、変異させません。これは IE9 と Firefox 12.0a1 に一致します。（Chrome 17 dev と Opera Next
                            12.00 alpha は getRangeAt() がコピーを返すためテスト不可。）
                        </p>
                    </div>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-modify" data-idl="operation"
                    data-title="modify()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="modify()|modify(alter)|modify(alter, direction)|modify(alter, direction, granularity)"
                    data-local-lt="Selection.modify|Selection.modify()|modify" tabindex="0"
                    aria-haspopup="dialog"><code>modify()</code></dfn> method
            </dt>
            <dd data-cite="css-writing-modes-4">
                <p>
                    このメソッドは次の手順に従わなければなりません:
                </p>
                <ol>
                    <li>もし <var>alter</var> が "extend" または "move" と ASCII 大文字小文字を区別しない一致でない場合、これらの手順を中止します。
                    </li>
                    <li>もし <var>direction</var> が "forward", "backward", "left", または "right" と ASCII
                        大文字小文字を区別しない一致でない場合、これらの手順を中止します。
                    </li>
                    <li>もし <var>granularity</var> が "character", "word", "sentence", "line", "paragraph",
                        "lineboundary", "sentenceboundary", "paragraphboundary", "documentboundary" のいずれとも ASCII
                        大文字小文字を区別しない一致でない場合、これらの手順を中止します。
                    </li>
                    <li>もし <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-25">selection</a> が empty であれば、これらの手順を中止します。
                    </li>
                    <li><var>effectiveDirection</var> を <a href="#dfn-backwards" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-backwards-5">backwards</a> にします。
                    </li>
                    <li>もし <var>direction</var> が "forward" と ASCII 大文字小文字を区別しない一致であれば、<var>effectiveDirection</var> を
                        <a href="#dfn-forwards" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-forwards-6">forwards</a> に設定します。
                    </li>
                    <li>もし <var>direction</var> が "right" と一致し、かつ this の選択の <a data-link-type="dfn"
                            href="https://www.w3.org/TR/css-writing-modes-4/#inline-base-direction">inline base
                            direction</a> が <a data-link-type="css-value"
                            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-direction-ltr">ltr</a>
                        であれば、<var>effectiveDirection</var> を <a href="#dfn-forwards" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-forwards-7">forwards</a> に設定します。
                    </li>
                    <li>もし <var>direction</var> が "left" と一致し、かつ this の選択の <a data-link-type="dfn"
                            href="https://www.w3.org/TR/css-writing-modes-4/#inline-base-direction">inline base
                            direction</a> が <a data-link-type="css-value"
                            href="https://www.w3.org/TR/css-writing-modes-4/#valdef-direction-rtl">rtl</a>
                        であれば、<var>effectiveDirection</var> を <a href="#dfn-forwards" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-forwards-8">forwards</a> に設定します。
                    </li>
                    <li><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-28">selection</a> の <a href="#dfn-direction" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-direction-6">direction</a> を
                        <var>effectiveDirection</var> に設定します。
                    </li>
                    <li>もし <var>alter</var> が "extend" と一致する場合、<a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a> の <a href="#dfn-selection"
                            class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-29">selection</a> の <a
                            href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-focus-17">focus</a> を、ユーザーが <var>granularity</var>
                        で選択を拡張するように要求したかのような位置に設定します。
                    </li>
                    <li>それ以外の場合、<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-30">selection</a> の <a href="#dfn-focus" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-focus-18">focus</a> と <a href="#dfn-anchor"
                            class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anchor-15">anchor</a> を、ユーザーが
                        <var>granularity</var> で選択を移動するように要求したかのような位置に設定します。
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-10">
                    <div role="heading" class="note-title marker" id="h-note-10" aria-level="3"><span>Note</span></div>
                    <p class="">
                        各 granularity ごとに選択を拡張または移動するということが具体的に何を意味するのか、より正確に定義する必要があります。
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-deletefromdocument" data-idl="operation"
                    data-title="deleteFromDocument()" data-dfn-for="Selection" data-type="undefined"
                    data-lt="deleteFromDocument()"
                    data-local-lt="Selection.deleteFromDocument|Selection.deleteFromDocument()|deleteFromDocument"
                    tabindex="0" aria-haspopup="dialog"><code>deleteFromDocument()</code></dfn> method
            </dt>
            <dd>
                <p>
                    このメソッドは、もし <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> が <a
                        href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-13">empty</a>
                    でなく、かつ <a href="#dfn-focus" class="internalDFN" data-link-type="dfn"
                        id="ref-for-dfn-focus-19">focus</a> と <a href="#dfn-anchor" class="internalDFN"
                        data-link-type="dfn" id="ref-for-dfn-anchor-16">anchor</a> の両方が <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-document-tree">document tree</a> に存在する場合、<a
                        data-link-type="method" data-lt="deleteContents()"
                        href="https://dom.spec.whatwg.org/#dom-range-deletecontents"><code>deleteContents</code></a><code>()</code>
                    を this の <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
                    に対して呼び出さなければなりません。そうでない場合は何もしません。
                </p>
                <div class="note" role="note" id="issue-container-generatedID-11">
                    <div role="heading" class="note-title marker" id="h-note-11" aria-level="3"><span>Note</span></div>
                    <p class="">
                        これは range を置換するのではなく実際に変異させる唯一のメソッドです。IE9 と Firefox 12.0a1 に一致します。（Chrome 17 dev と Opera Next
                        12.00 alpha は getRangeAt() がコピーを返すためテスト不可。）
                    </p>
                </div>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-containsnode" data-idl="operation"
                    data-title="containsNode()" data-dfn-for="Selection" data-type="boolean"
                    data-lt="containsNode()|containsNode(node)|containsNode(node, allowPartialContainment)"
                    data-local-lt="Selection.containsNode|Selection.containsNode()|containsNode" tabindex="0"
                    aria-haspopup="dialog"><code>containsNode()</code></dfn> method
            </dt>
            <dd>
                <p>
                    もし <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> が <a
                        href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-14">empty</a>
                    であるか、または <var>node</var> の <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-tree-root">root</a> がこの <a data-link-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> に関連付けられたドキュメントでない場合、このメソッドは
                    <code>false</code> を返さなければなりません。
                </p>
                <p>
                    そうでない場合、もし <var>allowPartialContainment</var> が <code>false</code> であれば、このメソッドは、(1) 自身の <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> の <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> が
                    <var>node</var> 内の最初の境界点と等しいかそれより前であり、かつ (2) 自身の range の <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-end">end</a> が <var>node</var>
                    内の最後の境界点と等しいかそれより後である場合に限り <code>true</code> を返さなければなりません（視覚的に等価である場合を含む）。
                </p>
                <p>
                    もし <var>allowPartialContainment</var> が <code>true</code> であれば、このメソッドは、(1) 自身の range の <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">start</a> が
                    <var>node</var> 内の最後の境界点と等しいかそれより前であり、かつ (2) 自身の range の <a data-link-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-range-end">end</a> が <var>node</var>
                    内の最初の境界点と等しいかそれより後である場合に限り <code>true</code> を返さなければなりません（視覚的に等価である場合を含む）。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-selection-stringifier" data-idl="operation"
                    data-title="stringifier" data-dfn-for="Selection" data-type="" data-lt="stringifier()"
                    data-local-lt="Selection.stringifier|Selection.stringifier()|stringifier" tabindex="0"
                    aria-haspopup="dialog"><code>stringifier</code></dfn>
            </dt>
            <dd>
                <p>
                    文字列化は、この <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> に関連付けられた <a
                        data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
                    のレンダリングされたテキストの連結を返さなければなりません。
                </p>
                <p>
                    選択が <a data-link-type="element"
                        href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element">textarea</a>
                    または <a data-link-type="element"
                        href="https://html.spec.whatwg.org/multipage/input.html#the-input-element">input</a>
                    要素内にある場合は、その value の選択された部分文字列を返さなければなりません。
                </p>
            </dd>
        </dl>
        <div class="note" role="note" id="issue-container-generatedID-12">
            <div role="heading" class="note-title marker" id="h-note-12" aria-level="3"><span>注</span></div>
            <p class="">
                また、Geckoの <a href="https://mxr.mozilla.org/mozilla/source/content/base/public/nsISelection.idl">
                    nsISelection.idl</a> も参照してください。この仕様にはまだすべての内容が含まれているわけではなく、特に selectionLanguageChange() や
                containsNode() がありません。これらは、Rangeの定義で表現する方法が分からなかったため、欠落しています。
            </p>
        </div>
        <div class="note" role="note" id="issue-container-generatedID-13">
            <div role="heading" class="note-title marker" id="h-note-13" aria-level="3"><span>注</span></div>
            <div class="">
                <p>
                    元々、SelectionインターフェースはNetscapeの機能でした。最初の実装はGecko（Firefox）に受け継がれ、後に他のブラウザーエンジンによって独立して実装されました。Netscapeの実装では、単一選択内で常に複数の範囲を許可していました。例えば、ユーザーが表の列を選択できるようにするためです。しかし、マルチレンジ選択はウェブ開発者が把握しておらず、Geckoの開発者でさえ正しく処理することはほとんどありませんでした。他のブラウザーエンジンはその機能を実装せず、さまざまな非互換な方法で選択を単一範囲に制限していました。
                </p>
                <p>
                    この仕様は、選択を最大で一つの範囲に制限する点でGecko以外のエンジンに従っていますが、APIは元々任意個数の範囲の選択を想定して設計されています。これが
                    <code>removeRange()</code> と <code>removeAllRanges()</code> が併存していたり、常にゼロでなければならない整数引数を取る
                    <code>getRangeAt()</code> メソッドがあったりするなどの奇妙さの理由です。
                </p>
            </div>
        </div>
        <p>
            <a data-link-type="idl" data-lt="Selection" href="#dom-selection" class="internalDFN"
                id="ref-for-dom-selection-1"><code>Selection</code></a>
            インターフェースのすべてのメンバーは、そのオブジェクトによって表される（存在すれば）<code><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a></code>
            オブジェクトに対する操作の観点から定義されています。これらの操作は、<a data-link-type="interface" data-lt="Range"
                href="https://dom.spec.whatwg.org/#range"><code>Range</code></a> インターフェースで定義されるように例外を投げることがあります。したがって、<a
                href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-31">Selection</a> インターフェースのメンバーも、上記で明示的に記述された場合に加え、例外をスローする可能性があります。
        </p>
    </section>
    <section id="extensions-to-other-interfaces">
        <div class="header-wrapper">
            <h2 id="x4-extensions-to-other-interfaces"><bdi class="secno">4. </bdi>
                他のインターフェースへの拡張
            </h2><a class="self-link" href="#extensions-to-other-interfaces" aria-label="Permalink for Section 4."></a>
        </div>

        <p>
            この仕様は、ここで定義されるインターフェースへのエントリーポイントを提供するために、いくつかのインターフェースを拡張します。
        </p>
        <section data-dfn-for="Document" id="extensions-to-document-interface">
            <div class="header-wrapper">
                <h3 id="x4-1-extensions-to-document-interface"><bdi class="secno">4.1 </bdi>
                    <code>Document</code> インターフェースへの拡張
                </h3><a class="self-link" href="#extensions-to-document-interface"
                    aria-label="Permalink for Section 4.1"></a>
            </div>

            <p>
                <code><dfn data-plurals="documents" id="dom-document" data-idl="interface" data-title="Document" data-dfn-for="" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://dom.spec.whatwg.org/#document">Document</a></dfn></code>
                インターフェースは [<cite><a class="bibref" data-link-type="biblio" href="#bib-html"
                        title="HTML Standard">HTML</a></cite>] で定義されています。
            </p>
            <pre class="idl def" data-cite="WEBIDL HTML" id="webidl-313315997"><span class="idlHeader"><a class="self-link" href="#webidl-313315997">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-document-partial-1" data-title="Document">partial interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-document"><code>Document</code></a> {<span data-idl="" class="idlMethod" id="idl-def-document-getselection" data-title="getSelection" data-dfn-for="Document"><span class="idlType">
  <a data-link-type="idl" href="#dom-selection" class="internalDFN" id="ref-for-dom-selection-2"><code>Selection</code></a>?</span> <a class="internalDFN idlName" data-link-type="method" href="#dom-document-getselection" id="ref-for-dom-document-getselection-1"><code>getSelection</code></a>();</span>
};</span></code></pre>
            <dl>
                <dt>
                    <dfn data-export="" data-dfn-type="method" id="dom-document-getselection" data-idl="operation"
                        data-title="getSelection()" data-dfn-for="Document" data-type="Selection"
                        data-lt="getSelection()"
                        data-local-lt="Document.getSelection|Document.getSelection()|getSelection" tabindex="0"
                        aria-haspopup="dialog"><code>getSelection()</code></dfn> メソッド
                </dt>
                <dd>
                    <p>
                        このメソッドは、<a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selection-32">selection</a> を <a data-link-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a> に関連付けられた <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc">ブラウジングコンテキスト</a>
                        がある場合は返し、それ以外の場合は <code>null</code> を返さなければなりません。
                    </p>
                </dd>
            </dl>
        </section>
        <section data-dfn-for="Window" data-link-for="Window" id="extensions-to-window-interface">
            <div class="header-wrapper">
                <h3 id="x4-2-extensions-to-window-interface"><bdi class="secno">4.2 </bdi>
                    <code>Window</code> インターフェースへの拡張
                </h3><a class="self-link" href="#extensions-to-window-interface"
                    aria-label="Permalink for Section 4.2"></a>
            </div>

            <p>
                <code><dfn id="dom-window" data-idl="interface" data-title="Window" data-dfn-for="" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a></dfn></code>
                インターフェースは [<cite><a class="bibref" data-link-type="biblio" href="#bib-html"
                        title="HTML Standard">HTML</a></cite>] で定義されています。
            </p>
            <pre class="idl def" id="webidl-1016100280"><span class="idlHeader"><a class="self-link" href="#webidl-1016100280">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-window-partial-1" data-title="Window">partial interface <a class="internalDFN idlID" data-link-type="interface" href="#dom-window"><code>Window</code></a> {<span data-idl="" class="idlMethod" id="idl-def-window-getselection" data-title="getSelection" data-dfn-for="Window"><span class="idlType">
  <a data-link-type="idl" href="#dom-selection" class="internalDFN" id="ref-for-dom-selection-3"><code>Selection</code></a>?</span> <a class="internalDFN idlName" data-link-type="method" href="#dom-window-getselection" id="ref-for-dom-window-getselection-1"><code>getSelection</code></a>();</span>
};</span></code></pre>
            <dl>
                <dt>
                    <dfn data-export="" data-dfn-type="method" id="dom-window-getselection" data-idl="operation"
                        data-title="getSelection()" data-dfn-for="Window" data-type="Selection" data-lt="getSelection()"
                        data-local-lt="Window.getSelection|Window.getSelection()|getSelection" tabindex="0"
                        aria-haspopup="dialog"><code>getSelection()</code></dfn> メソッド
                </dt>
                <dd>
                    <p>
                        このメソッドは、<a data-link-type="idl" data-lt="getSelection()" href="#dom-document-getselection"
                            class="internalDFN"
                            id="ref-for-dom-document-getselection-2"><code>getSelection</code></a><code>()</code> を <a
                            data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this">this</a> の <a
                            data-link-type="idl" data-lt="Window"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#window"><code>Window</code></a>
                        の <a data-link-type="idl" href="https://dom.spec.whatwg.org/#document"><code>document</code></a>
                        属性で呼び出し、その結果を返さなければなりません。
                    </p>
                </dd>
            </dl>
        </section>
        <section data-dfn-for="GlobalEventHandlers" id="extensions-to-globaleventhandlers-interface">
            <div class="header-wrapper">
                <h3 id="x4-3-extensions-to-globaleventhandlers-interface"><bdi class="secno">4.3 </bdi>
                    <code>GlobalEventHandlers</code> インターフェースへの拡張
                </h3><a class="self-link" href="#extensions-to-globaleventhandlers-interface"
                    aria-label="Permalink for Section 4.3"></a>
            </div>

            <p>
                <code><dfn id="dom-globaleventhandlers" data-idl="interface mixin" data-title="GlobalEventHandlers" data-dfn-for="" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://html.spec.whatwg.org/multipage/webappapis.html#globaleventhandlers">GlobalEventHandlers</a></dfn></code>
                インターフェースは [<cite><a class="bibref" data-link-type="biblio" href="#bib-html"
                        title="HTML Standard">HTML</a></cite>] で定義されています。
            </p>
            <pre class="idl def" id="webidl-1185742786"><span class="idlHeader"><a class="self-link" href="#webidl-1185742786">WebIDL</a></span><code><span data-idl="" class="idlInterface mixin" id="idl-def-globaleventhandlers-partial-1" data-title="GlobalEventHandlers">partial interface mixin <a class="internalDFN idlID" data-link-type="interface" href="#dom-globaleventhandlers"><code>GlobalEventHandlers</code></a> {<span data-idl="" class="idlAttribute" id="idl-def-globaleventhandlers-onselectstart" data-title="onselectstart" data-dfn-for="GlobalEventHandlers">
  attribute<span class="idlType"> <a data-link-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-globaleventhandlers-onselectstart" id="ref-for-dom-globaleventhandlers-onselectstart-1"><code>onselectstart</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-globaleventhandlers-onselectionchange" data-title="onselectionchange" data-dfn-for="GlobalEventHandlers">
  attribute<span class="idlType"> <a data-link-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-globaleventhandlers-onselectionchange" id="ref-for-dom-globaleventhandlers-onselectionchange-1"><code>onselectionchange</code></a>;</span>
};</span></code></pre>
            <dl>
                <dt>
                    <dfn data-export="" data-dfn-type="attribute" id="dom-globaleventhandlers-onselectstart"
                        data-idl="attribute" data-title="onselectstart" data-dfn-for="GlobalEventHandlers"
                        data-type="EventHandler" data-lt="onselectstart"
                        data-local-lt="GlobalEventHandlers.onselectstart" tabindex="0"
                        aria-haspopup="dialog"><code>onselectstart</code></dfn>
                </dt>
                <dd>
                    <p>
                        この属性は、すべての<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">イベントハンドラIDL属性</a>の
                        <a href="#dfn-selectstart" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selectstart-1"><code>selectstart</code></a> イベントに対して、すべての <a
                            data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#html-elements">HTML
                            要素</a>、<a data-link-type="idl" data-lt="Document"
                            href="https://dom.spec.whatwg.org/#document"><code>Document</code></a> オブジェクト、および <a
                            data-link-type="idl" data-lt="Window"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#window"><code>Window</code></a>
                        オブジェクトでサポートされるためのものです。
                    </p>
                </dd>
                <dt>
                    <dfn data-export="" data-dfn-type="attribute" id="dom-globaleventhandlers-onselectionchange"
                        data-idl="attribute" data-title="onselectionchange" data-dfn-for="GlobalEventHandlers"
                        data-type="EventHandler" data-lt="onselectionchange"
                        data-local-lt="GlobalEventHandlers.onselectionchange" tabindex="0"
                        aria-haspopup="dialog"><code>onselectionchange</code></dfn>
                </dt>
                <dd>
                    <p>
                        この属性は、すべての<a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">イベントハンドラIDL属性</a>の
                        <a href="#dfn-selectionchange" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-selectionchange-1"><code>selectionchange</code></a> イベントに対して、すべての
                        <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/infrastructure.html#html-elements">HTML
                            要素</a>、<a data-link-type="idl" data-lt="Document"
                            href="https://dom.spec.whatwg.org/#document"><code>Document</code></a> オブジェクト、および <a
                            data-link-type="idl" data-lt="Window"
                            href="https://html.spec.whatwg.org/multipage/window-object.html#window"><code>Window</code></a>
                        オブジェクトでサポートされるためのものです。
                    </p>
                </dd>
            </dl>
        </section>
    </section>
    <section id="responding-to-dom-mutations">
        <div class="header-wrapper">
            <h2 id="x5-responding-to-dom-mutations"><bdi class="secno">5. </bdi>
                DOM 変更への対応
            </h2><a class="self-link" href="#responding-to-dom-mutations" aria-label="Permalink for Section 5."></a>
        </div>

        <p>
            ユーザーエージェントが <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-cd-replace">データを置換</a> または <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-cd-substring">部分文字列</a> を <a
                data-link-type="interface" data-lt="CharacterData"
                href="https://dom.spec.whatwg.org/#characterdata"><code>CharacterData</code></a> に対して行う場合、ユーザーエージェントは、その
            <a data-link-type="interface" data-lt="CharacterData"
                href="https://dom.spec.whatwg.org/#characterdata"><code>CharacterData</code></a> の <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a> の <a
                href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-33">selection</a> に関連付けられた <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> を <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-live-range">live range</a> として更新しなければなりません。
        </p>
        <p>
            ユーザーエージェントが <a data-link-type="interface" data-lt="Text"
                href="https://dom.spec.whatwg.org/#text"><code>Text</code></a> <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-node">ノード</a> を分割する場合、ユーザーエージェントは、
            <a data-link-type="interface" data-lt="Text" href="https://dom.spec.whatwg.org/#text"><code>Text</code></a>
            の <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a> の <a
                href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-34">selection</a> に関連付けられた <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> を <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-live-range">live range</a> として更新しなければなりません。
        </p>
        <p>
            ユーザーエージェントが <code>normalize()</code> メソッドの手順を実行する場合、ユーザーエージェントは <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a> の <a href="#dfn-selection"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-35">selection</a> に関連付けられた <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> を <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-live-range">live range</a>
            として更新しなければなりません。
        </p>
        <p>
            ユーザーエージェントが <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-remove">ノードを削除</a> または
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-insert">挿入</a> する場合、ユーザーエージェントは、その
            <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node">ノード</a> の <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a> の <a href="#dfn-selection"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-36">selection</a> に関連付けられた <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> を <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-live-range">live range</a>
            として更新しなければなりません。
        </p>
    </section>
    <section id="user-interactions">
        <div class="header-wrapper">
            <h2 id="x6-user-interactions"><bdi class="secno">6. </bdi>
                ユーザー操作
            </h2><a class="self-link" href="#user-interactions" aria-label="Permalink for Section 6."></a>
        </div>

        <p>
            ユーザーエージェントは、<a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-37">selection</a>（<a data-link-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document">アクティブドキュメント</a>に関連付けられたもの）を
            ユーザーが変更できるようにすべきです。ユーザーが <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-38">selection</a> を何らかの方法で変更した場合、ユーザーエージェントは <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> の <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-start">開始</a> と <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range-end">終了</a> を適切に設定した新しい <a data-link-type="dfn"
                href="https://dom.spec.whatwg.org/#concept-range">range</a> を作成し、この <a href="#dfn-selection"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-39">selection</a> にこの新しい <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> を関連付けなければなりません（既存の <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a> を変更しないこと）、また、開始が終了より <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-before">前</a> あるいは等しい場合は <a
                href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selection-40">selection</a> の <a href="#dfn-direction" class="internalDFN"
                data-link-type="dfn" id="ref-for-dfn-direction-7">direction</a> を <a href="#dfn-forwards"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-forwards-9">forwards</a> に、終了が開始より <a
                data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-bp-before">前</a> の場合は <a
                href="#dfn-backwards" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-backwards-6">backwards</a> に、開始と終了がプラットフォームの慣習により順序付けできない場合は <a
                href="#dfn-directionless" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-directionless-3">directionless</a> に設定しなければなりません。
        </p>
        <p>
            ユーザーエージェントは、ユーザーによるいかなる操作（例：編集不可領域のクリック）に対しても、もともと <a href="#dfn-empty" class="internalDFN"
                data-link-type="dfn" id="ref-for-dfn-empty-15">empty</a> でなかった <a href="#dfn-selection"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-41">selection</a> を <a
                href="#dfn-empty" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-empty-16">empty</a>
            にしてはなりません。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-14">
            <div role="heading" class="note-title marker" id="h-note-14" aria-level="3"><span>注</span></div>
            <p class="">
                <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=15470">バグ15470</a> を参照。IE9 と Opera Next 12.00
                alpha は、ユーザーがどこかをクリックすることで範囲を null にリセットできるが、Firefox 12.0a1 と Chrome 17 dev はそうではない。私は Gecko/WebKit
                の挙動に従います。なぜなら getRangeAt(0) が例外を投げる可能性が減るためです。
            </p>
        </div>
        <section id="selectstart-event">
            <div class="header-wrapper">
                <h3 id="x6-1-selectstart-event"><bdi class="secno">6.1 </bdi>
                    <code><dfn data-dfn-type="event" id="dfn-selectstart" tabindex="0" aria-haspopup="dialog" data-export="">selectstart</dfn></code>
                    イベント
                </h3><a class="self-link" href="#selectstart-event" aria-label="Permalink for Section 6.1"></a>
            </div>

            <p>
                ユーザーエージェントがユーザーの操作に応答して <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-42">selection</a> に新しい範囲 <var>newRange</var> を関連付ける直前、<a
                    data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-range-bp">境界点</a>のノード（<var>newRange</var> の <a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range-start">開始点</a>に対応する）で、<a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire">selectstart
                    という名前のイベント</a>（バブルし、キャンセル可能）を発火しなければなりません。これは selection が以前 <a href="#dfn-empty" class="internalDFN"
                    data-link-type="dfn" id="ref-for-dfn-empty-17">empty</a> であったか、または以前の範囲が <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#range-collapsed">collapsed</a> だった場合に限ります。
            </p>
            <p>
                イベントがキャンセルされた場合、ユーザーエージェントは <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-44">selection</a> を変更してはなりません。
            </p>
            <p>
                ユーザーエージェントが selection を <a href="#dfn-empty" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-empty-18">empty</a> に設定する場合、イベントは発火しません。
            </p>
        </section>
        <section id="selectionchange-event">
            <div class="header-wrapper">
                <h3 id="x6-2-selectionchange-event"><bdi class="secno">6.2 </bdi>
                    <code><dfn data-dfn-type="event" id="dfn-selectionchange" tabindex="0" aria-haspopup="dialog" data-export="">selectionchange</dfn></code>
                    イベント
                </h3><a class="self-link" href="#selectionchange-event" aria-label="Permalink for Section 6.2"></a>
            </div>

            <p>
                <a href="#dfn-selection" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-selection-46">selection</a> がその <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-range">range</a> との関連付けを解除した場合、新しい <a
                    data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-range">range</a>
                に関連付けられた場合、または関連付けられている range の <a data-link-type="dfn"
                    href="https://dom.spec.whatwg.org/#concept-range-bp">boundary point</a>
                がユーザーやコンテンツスクリプトによって変異された場合、ユーザーエージェントは <a href="#dfn-schedule-a-selectionchange-event"
                    class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-schedule-a-selectionchange-event-1">selectionchange イベントをスケジュール</a> しなければなりません。
            </p>
            <p>
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/input.html#the-input-element">input</a></code>
                または
                <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element">textarea</a></code>
                要素内でテキスト選択が提供され、その選択が範囲または <a data-link-type="dfn|abstract-op" href="#dfn-direction" class="internalDFN"
                    id="ref-for-dfn-direction-8">direction</a> のいずれかで変化したとき、ユーザーエージェントはその要素で <a
                    href="#dfn-schedule-a-selectionchange-event" class="internalDFN" data-link-type="dfn"
                    id="ref-for-dfn-schedule-a-selectionchange-event-2">selectionchange イベントをスケジュール</a> しなければなりません。
            </p>
            <section id="scheduling-selectionchange-event">
                <div class="header-wrapper">
                    <h4 id="x6-2-1-scheduling-selectionchange-event"><bdi class="secno">6.2.1 </bdi>
                        <code>selectionchange</code> イベントのスケジューリング
                    </h4><a class="self-link" href="#scheduling-selectionchange-event"
                        aria-label="Permalink for Section 6.2.1"></a>
                </div>

                <p>
                    ノード <var>target</var> で <dfn id="dfn-schedule-a-selectionchange-event" tabindex="0"
                        aria-haspopup="dialog" data-dfn-type="dfn">selectionchange イベントをスケジュールする</dfn> ための手順は以下の通りです：
                </p>
                <ol>
                    <li>もし <var>target</var> の <a href="#dfn-has-scheduled-selectionchange-event" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-has-scheduled-selectionchange-event-1">has scheduled
                            selectionchange
                            event</a> が true なら、これらのステップを中止します。
                    </li>
                    <li>
                        <a data-link-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">ユーザーインタラクションタスクソースでタスクをキューに追加</a>
                        し、
                        <a href="#dfn-fire-a-selectionchange-event" class="internalDFN" data-link-type="dfn"
                            id="ref-for-dfn-fire-a-selectionchange-event-1">selectionchange イベントを発火</a> します。
                    </li>
                </ol>
            </section>
            <section id="firing-selectionchange-event">
                <div class="header-wrapper">
                    <h4 id="x6-2-2-firing-selectionchange-event"><bdi class="secno">6.2.2 </bdi>
                        <code>selectionchange</code> イベントの発火
                    </h4><a class="self-link" href="#firing-selectionchange-event"
                        aria-label="Permalink for Section 6.2.2"></a>
                </div>

                <p>
                    ノード <var>target</var> で <dfn id="dfn-fire-a-selectionchange-event" tabindex="0"
                        aria-haspopup="dialog" data-dfn-type="dfn">selectionchange イベントを発火する</dfn> 手順は以下の通りです：
                </p>
                <ol>
                    <li><var>target</var> の <a href="#dfn-has-scheduled-selectionchange-event" class="internalDFN"
                            data-link-type="dfn" id="ref-for-dfn-has-scheduled-selectionchange-event-2">has scheduled
                            selectionchange
                            event</a> を false に設定します。
                    </li>
                    <li>もし <var>target</var> が要素なら、<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-event-fire">selectionchange
                            という名前のイベント</a>（バブルし、キャンセル不可）を <var>target</var> で発火します。
                    </li>
                    <li>それ以外で <var>target</var> がドキュメントなら、<a data-link-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-event-fire">selectionchange
                            という名前のイベント</a>（バブルせず、キャンセル不可）を <var>target</var> で発火します。
                    </li>
                </ol>
            </section>
        </section>
    </section>
    <section id="conformance">
        <div class="header-wrapper">
            <h2 id="x7-conformance"><bdi class="secno">7. </bdi>適合性</h2><a class="self-link" href="#conformance"
                aria-label="Permalink for Section 7."></a>
        </div>
        <p>非規範的と記載されたセクションだけでなく、本仕様書中のすべての執筆ガイドライン、図、例、および注記は規範的ではありません。それ以外のすべては規範的です。</p>
        <p>
            この仕様書は、含まれるインターフェースを実装する <a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#user-agent">ユーザーエージェント</a> という単一製品に適用される適合基準を定義します。
        </p>
    </section>
    <section id="security-and-privacy-considerations">
        <div class="header-wrapper">
            <h2 id="x8-security-and-privacy-considerations"><bdi class="secno">8. </bdi>
                セキュリティとプライバシーに関する考慮事項
            </h2><a class="self-link" href="#security-and-privacy-considerations"
                aria-label="Permalink for Section 8."></a>
        </div>

        <p>
            この標準には既知のセキュリティ上の考慮事項はありません。
        </p>
        <p>
            支援技術のユーザー利用を開示することによる潜在的なプライバシーリスクを軽減するため、たとえば<a data-link-type="dfn"
                href="https://infra.spec.whatwg.org/#user-agent">ユーザーエージェント</a> は、ドキュメントの <a href="#dfn-selection"
                class="internalDFN" data-link-type="dfn" id="ref-for-dfn-selection-47">selection</a> をユーザーが変更した場合、通常は <a
                href="#dfn-selectstart" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selectstart-2"><code>selectstart</code></a> や <a href="#dfn-selectionchange"
                class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-selectionchange-2"><code>selectionchange</code></a>
            イベントに関連付けられるマウスやキーボードイベントをエミュレートすることを選択することがあります。
        </p>
    </section>
    <section class="appendix" id="acknowledgements">
        <div class="header-wrapper">
            <h2 id="a-acknowledgements"><bdi class="secno">A. </bdi>
                謝辞
            </h2><a class="self-link" href="#acknowledgements" aria-label="Permalink for Appendix A."></a>
        </div>

        <p>
            多大なる感謝を捧げます
        </p>
        <ul>
            <li>Aryeh Gregor。彼は本仕様の原著者であり、<a href="https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html">HTML
                    Editing
                    API仕様</a>の原著者でもあります。
            </li>
            <li><a href="https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html">HTML Editing
                    API仕様</a>の貢献者たち — Ehsan Akhgari、Tab Atkins、Mathias Bynens、Tim
                Down、Markus Ernst、Daniel Glazman、Tali Gregor（旧姓Fuss）、Stig
                Halvorsen、Jeff Harris、Ian Hickson、Cameron Heavon-Jones、Anne van
                Kesteren、Alfonso Martínez de Lizarrondo、Glenn Maynard、Ms2ger、Robert
                O'Callahan、Julie Parent、Simon Pieters、Michael A. Puls II、Rich
                Schwerdtfeger、Jonas Sicking、Henri Sivonen、Smylers、Hallvord R. M.
                Steen、Roland Steiner、Annie Sullivan、timeless、Ojan Vafai、Brett
                Zamir、およびBoris Zbarsky。彼らのフィードバック、参加、あるいは他の有益な貢献に対して。
            </li>
        </ul>
    </section>

    <section id="references" class="appendix">
        <div class="header-wrapper">
            <h2 id="b-references"><bdi class="secno">B. </bdi>参考文献</h2><a class="self-link" href="#references"
                aria-label="Permalink for Appendix B."></a>
        </div>
        <section id="normative-references">
            <div class="header-wrapper">
                <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>規範的参考文献</h3><a class="self-link"
                    href="#normative-references" aria-label="Permalink for Appendix B.1"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-css-writing-modes-4">[css-writing-modes-4]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/css-writing-modes-4/"><cite>CSS Writing Modes Level 4</cite></a>.
                    Elika Etemad; Koji Ishii. W3C. 2019年7月30日. W3C Candidate Recommendation. URL: <a
                        href="https://www.w3.org/TR/css-writing-modes-4/">https://www.w3.org/TR/css-writing-modes-4/</a>
                </dd>
                <dt id="bib-dom">[dom]</dt>
                <dd>
                    <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Anne van Kesteren. WHATWG.
                    Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-html">[HTML]</dt>
                <dd>
                    <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van
                    Kesteren;
                    Domenic Denicola; Dominic Farolino; Ian Hickson; Philip Jägenstedt; Simon Pieters. WHATWG.
                    Living
                    Standard. URL: <a
                        href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
                </dd>
                <dt id="bib-infra">[infra]</dt>
                <dd>
                    <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Anne van Kesteren;
                    Domenic
                    Denicola. WHATWG. Living Standard. URL: <a
                        href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-url">[url]</dt>
                <dd>
                    <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Anne van Kesteren. WHATWG.
                    Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-webidl">[WEBIDL]</dt>
                <dd>
                    <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Edgar Chen; Timothy
                    Gu.
                    WHATWG. Living Standard. URL: <a
                        href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="Back to Top">↑</abbr></a>
    </p>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-selection"
        aria-label="Links in this document to definition: selection">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-selection"
                aria-label="Permalink for definition: selection. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-selection-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-selection-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-selection-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-selection-5" title="Reference 5">(5)</a> <a href="#ref-for-dfn-selection-6"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-selection-7" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-selection-8" title="Reference 8">(8)</a> <a href="#ref-for-dfn-selection-9"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-selection-10" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-selection-11" title="Reference 11">(11)</a> <a href="#ref-for-dfn-selection-12"
                    title="Reference 12">(12)</a> <a href="#ref-for-dfn-selection-13" title="Reference 13">(13)</a> <a
                    href="#ref-for-dfn-selection-14" title="Reference 14">(14)</a> <a href="#ref-for-dfn-selection-15"
                    title="Reference 15">(15)</a> <a href="#ref-for-dfn-selection-16" title="Reference 16">(16)</a> <a
                    href="#ref-for-dfn-selection-17" title="Reference 17">(17)</a> <a href="#ref-for-dfn-selection-18"
                    title="Reference 18">(18)</a> <a href="#ref-for-dfn-selection-19" title="Reference 19">(19)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-20" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-selection-21" title="Reference 2">(2)</a> <a href="#ref-for-dfn-selection-22"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-23" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-selection-24" title="Reference 5">(5)</a> <a href="#ref-for-dfn-selection-25"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-selection-26" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-selection-27" title="Reference 8">(8)</a> <a href="#ref-for-dfn-selection-28"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-selection-29" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-selection-30" title="Reference 11">(11)</a> <a href="#ref-for-dfn-selection-31"
                    title="Reference 12">(12)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-32" title="§ 4.1 Extensions to Document interface">§ 4.1 Extensions
                    to
                    Document interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-33" title="§ 5. Responding to DOM Mutations">§ 5. Responding to DOM
                    Mutations</a> <a href="#ref-for-dfn-selection-34" title="Reference 2">(2)</a> <a
                    href="#ref-for-dfn-selection-35" title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-36"
                    title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-37" title="§ 6. User Interactions">§ 6. User Interactions</a> <a
                    href="#ref-for-dfn-selection-38" title="Reference 2">(2)</a> <a href="#ref-for-dfn-selection-39"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-40" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-selection-41" title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-42" title="§ 6.1 selectstart event">§ 6.1 selectstart event</a> <a
                    href="#ref-for-dfn-selection-43" title="Reference 2">(2)</a> <a href="#ref-for-dfn-selection-44"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-selection-45" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-46" title="§ 6.2 selectionchange event">§ 6.2 selectionchange
                    event</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selection-47" title="§ 8. Security and Privacy considerations">§ 8. Security
                    and
                    Privacy considerations</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-empty"
        aria-label="Links in this document to definition: empty">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-empty"
                aria-label="Permalink for definition: empty. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-empty-1" title="§ 2. Definition">§ 2. Definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-empty-2" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-empty-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-empty-4"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-empty-5" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-empty-6" title="Reference 5">(5)</a> <a href="#ref-for-dfn-empty-7"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-empty-8" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-empty-9" title="Reference 8">(8)</a> <a href="#ref-for-dfn-empty-10"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-empty-11" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-empty-12" title="Reference 11">(11)</a> <a href="#ref-for-dfn-empty-13"
                    title="Reference 12">(12)</a> <a href="#ref-for-dfn-empty-14" title="Reference 13">(13)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-empty-15" title="§ 6. User Interactions">§ 6. User Interactions</a> <a
                    href="#ref-for-dfn-empty-16" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-empty-17" title="§ 6.1 selectstart event">§ 6.1 selectstart event</a> <a
                    href="#ref-for-dfn-empty-18" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-direction"
        aria-label="Links in this document to definition: direction">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-direction"
                aria-label="Permalink for definition: direction. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-direction-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-direction-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-direction-3" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-direction-4" title="Reference 2">(2)</a> <a href="#ref-for-dfn-direction-5"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-direction-6" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-direction-7" title="§ 6. User Interactions">§ 6. User Interactions</a>
            </li>
            <li>
                <a href="#ref-for-dfn-direction-8" title="§ 6.2 selectionchange event">§ 6.2 selectionchange
                    event</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-forwards"
        aria-label="Links in this document to definition: forwards">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-forwards"
                aria-label="Permalink for definition: forwards. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-forwards-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-forwards-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-forwards-3" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-forwards-4" title="Reference 2">(2)</a> <a href="#ref-for-dfn-forwards-5"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-forwards-6" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-forwards-7" title="Reference 5">(5)</a> <a href="#ref-for-dfn-forwards-8"
                    title="Reference 6">(6)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-forwards-9" title="§ 6. User Interactions">§ 6. User Interactions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-backwards"
        aria-label="Links in this document to definition: backwards">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-backwards"
                aria-label="Permalink for definition: backwards. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-backwards-1" title="§ 2. Definition">§ 2. Definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-backwards-2" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-backwards-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-backwards-4"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-backwards-5" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-backwards-6" title="§ 6. User Interactions">§ 6. User Interactions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-directionless"
        aria-label="Links in this document to definition: directionless">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-directionless"
                aria-label="Permalink for definition: directionless. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-directionless-1" title="§ 2. Definition">§ 2. Definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-directionless-2" title="§ 3. Selection interface">§ 3. Selection interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-directionless-3" title="§ 6. User Interactions">§ 6. User Interactions</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-anchor"
        aria-label="Links in this document to definition: anchor">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-anchor"
                aria-label="Permalink for definition: anchor. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-anchor-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-anchor-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-anchor-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-anchor-4" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-anchor-5" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-anchor-6" title="Reference 2">(2)</a> <a href="#ref-for-dfn-anchor-7"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-anchor-8" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-anchor-9" title="Reference 5">(5)</a> <a href="#ref-for-dfn-anchor-10"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-anchor-11" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-anchor-12" title="Reference 8">(8)</a> <a href="#ref-for-dfn-anchor-13"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-anchor-14" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-anchor-15" title="Reference 11">(11)</a> <a href="#ref-for-dfn-anchor-16"
                    title="Reference 12">(12)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-focus"
        aria-label="Links in this document to definition: focus">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-focus"
                aria-label="Permalink for definition: focus. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-focus-1" title="§ 2. Definition">§ 2. Definition</a> <a
                    href="#ref-for-dfn-focus-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-focus-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-focus-4" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-focus-5" title="§ 3. Selection interface">§ 3. Selection interface</a> <a
                    href="#ref-for-dfn-focus-6" title="Reference 2">(2)</a> <a href="#ref-for-dfn-focus-7"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-focus-8" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-focus-9" title="Reference 5">(5)</a> <a href="#ref-for-dfn-focus-10"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-focus-11" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-focus-12" title="Reference 8">(8)</a> <a href="#ref-for-dfn-focus-13"
                    title="Reference 9">(9)</a> <a href="#ref-for-dfn-focus-14" title="Reference 10">(10)</a> <a
                    href="#ref-for-dfn-focus-15" title="Reference 11">(11)</a> <a href="#ref-for-dfn-focus-16"
                    title="Reference 12">(12)</a> <a href="#ref-for-dfn-focus-17" title="Reference 13">(13)</a> <a
                    href="#ref-for-dfn-focus-18" title="Reference 14">(14)</a> <a href="#ref-for-dfn-focus-19"
                    title="Reference 15">(15)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-has-scheduled-selectionchange-event"
        aria-label="Links in this document to definition: has scheduled selectionchange event">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-has-scheduled-selectionchange-event"
                aria-label="Permalink for definition: has scheduled selectionchange event. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-has-scheduled-selectionchange-event-1"
                    title="§ 6.2.1 Scheduling selectionchange event">§ 6.2.1 Scheduling selectionchange event</a>
            </li>
            <li>
                <a href="#ref-for-dfn-has-scheduled-selectionchange-event-2"
                    title="§ 6.2.2 Firing selectionchange event">§ 6.2.2 Firing selectionchange event</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection"
        aria-label="Links in this document to definition: Selection">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection"
                aria-label="Permalink for definition: Selection. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-1" title="§ 3. Selection interface">§ 3. Selection interface</a>
            </li>
            <li>
                <a href="#ref-for-dom-selection-2" title="§ 4.1 Extensions to Document interface">§ 4.1 Extensions
                    to
                    Document interface</a>
            </li>
            <li>
                <a href="#ref-for-dom-selection-3" title="§ 4.2 Extensions to Window interface">§ 4.2 Extensions to
                    Window interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-getcomposedrangesoptions"
        aria-label="Links in this document to definition: GetComposedRangesOptions">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-getcomposedrangesoptions"
                aria-label="Permalink for definition: GetComposedRangesOptions. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-getcomposedrangesoptions-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-getcomposedrangesoptions-shadowroots"
        aria-label="Links in this document to definition: shadowRoots">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-getcomposedrangesoptions-shadowroots"
                aria-label="Permalink for definition: shadowRoots. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-getcomposedrangesoptions-shadowroots-1" title="§ 3. Selection interface">§ 3.
                    Selection interface</a> <a href="#ref-for-dom-getcomposedrangesoptions-shadowroots-2"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-anchornode"
        aria-label="Links in this document to definition: anchorNode">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-anchornode"
                aria-label="Permalink for definition: anchorNode. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-anchornode-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-anchoroffset"
        aria-label="Links in this document to definition: anchorOffset">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-anchoroffset"
                aria-label="Permalink for definition: anchorOffset. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-anchoroffset-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-focusnode"
        aria-label="Links in this document to definition: focusNode">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-focusnode"
                aria-label="Permalink for definition: focusNode. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-focusnode-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-focusoffset"
        aria-label="Links in this document to definition: focusOffset">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-focusoffset"
                aria-label="Permalink for definition: focusOffset. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-focusoffset-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-iscollapsed"
        aria-label="Links in this document to definition: isCollapsed">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-iscollapsed"
                aria-label="Permalink for definition: isCollapsed. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-iscollapsed-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-rangecount"
        aria-label="Links in this document to definition: rangeCount">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-rangecount"
                aria-label="Permalink for definition: rangeCount. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-rangecount-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-type"
        aria-label="Links in this document to definition: type">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-type"
                aria-label="Permalink for definition: type. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-type-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-direction"
        aria-label="Links in this document to definition: direction">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-direction"
                aria-label="Permalink for definition: direction. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-direction-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-getrangeat"
        aria-label="Links in this document to definition: getRangeAt()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-getrangeat"
                aria-label="Permalink for definition: getRangeAt(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-getrangeat-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-addrange"
        aria-label="Links in this document to definition: addRange()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-addrange"
                aria-label="Permalink for definition: addRange(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-addrange-1" title="§ 2. Definition">§ 2. Definition</a>
            </li>
            <li>
                <a href="#ref-for-dom-selection-addrange-2" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-removerange"
        aria-label="Links in this document to definition: removeRange()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-removerange"
                aria-label="Permalink for definition: removeRange(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-removerange-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-removeallranges"
        aria-label="Links in this document to definition: removeAllRanges()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-removeallranges"
                aria-label="Permalink for definition: removeAllRanges(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-removeallranges-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-empty"
        aria-label="Links in this document to definition: empty()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-empty"
                aria-label="Permalink for definition: empty(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-empty-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-getcomposedranges"
        aria-label="Links in this document to definition: getComposedRanges()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-getcomposedranges"
                aria-label="Permalink for definition: getComposedRanges(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-getcomposedranges-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-collapse"
        aria-label="Links in this document to definition: collapse()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-collapse"
                aria-label="Permalink for definition: collapse(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-collapse-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-setposition"
        aria-label="Links in this document to definition: setPosition()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-setposition"
                aria-label="Permalink for definition: setPosition(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-setposition-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-collapsetostart"
        aria-label="Links in this document to definition: collapseToStart()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-collapsetostart"
                aria-label="Permalink for definition: collapseToStart(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-collapsetostart-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-collapsetoend"
        aria-label="Links in this document to definition: collapseToEnd()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-collapsetoend"
                aria-label="Permalink for definition: collapseToEnd(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-collapsetoend-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-extend"
        aria-label="Links in this document to definition: extend()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-extend"
                aria-label="Permalink for definition: extend(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-extend-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-setbaseandextent"
        aria-label="Links in this document to definition: setBaseAndExtent()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-setbaseandextent"
                aria-label="Permalink for definition: setBaseAndExtent(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-setbaseandextent-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-selectallchildren"
        aria-label="Links in this document to definition: selectAllChildren()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-selectallchildren"
                aria-label="Permalink for definition: selectAllChildren(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-selectallchildren-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-modify"
        aria-label="Links in this document to definition: modify()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-modify"
                aria-label="Permalink for definition: modify(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-modify-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-deletefromdocument"
        aria-label="Links in this document to definition: deleteFromDocument()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-deletefromdocument"
                aria-label="Permalink for definition: deleteFromDocument(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-deletefromdocument-1" title="§ 3. Selection interface">§ 3.
                    Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-containsnode"
        aria-label="Links in this document to definition: containsNode()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-containsnode"
                aria-label="Permalink for definition: containsNode(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-containsnode-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-selection-stringifier"
        aria-label="Links in this document to definition: stringifier">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-selection-stringifier"
                aria-label="Permalink for definition: stringifier. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1987235205">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-selection-stringifier-1" title="§ 3. Selection interface">§ 3. Selection
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-document-getselection"
        aria-label="Links in this document to definition: getSelection()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-document-getselection"
                aria-label="Permalink for definition: getSelection(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-313315997">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-document-getselection-1" title="§ 4.1 Extensions to Document interface">§ 4.1
                    Extensions to Document interface</a>
            </li>
            <li>
                <a href="#ref-for-dom-document-getselection-2" title="§ 4.2 Extensions to Window interface">§ 4.2
                    Extensions to Window interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-window-getselection"
        aria-label="Links in this document to definition: getSelection()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-window-getselection"
                aria-label="Permalink for definition: getSelection(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1016100280">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-window-getselection-1" title="§ 4.2 Extensions to Window interface">§ 4.2
                    Extensions to Window interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-globaleventhandlers-onselectstart"
        aria-label="Links in this document to definition: onselectstart">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-globaleventhandlers-onselectstart"
                aria-label="Permalink for definition: onselectstart. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1185742786">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-globaleventhandlers-onselectstart-1"
                    title="§ 4.3 Extensions to GlobalEventHandlers interface">§ 4.3 Extensions to
                    GlobalEventHandlers
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-globaleventhandlers-onselectionchange"
        aria-label="Links in this document to definition: onselectionchange">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-globaleventhandlers-onselectionchange"
                aria-label="Permalink for definition: onselectionchange. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1185742786">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-globaleventhandlers-onselectionchange-1"
                    title="§ 4.3 Extensions to GlobalEventHandlers interface">§ 4.3 Extensions to
                    GlobalEventHandlers
                    interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-selectstart"
        aria-label="Links in this document to definition: selectstart">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-selectstart"
                aria-label="Permalink for definition: selectstart. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-selectstart-1" title="§ 4.3 Extensions to GlobalEventHandlers interface">§ 4.3
                    Extensions to GlobalEventHandlers interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selectstart-2" title="§ 8. Security and Privacy considerations">§ 8. Security
                    and
                    Privacy considerations</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-selectionchange"
        aria-label="Links in this document to definition: selectionchange">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-selectionchange"
                aria-label="Permalink for definition: selectionchange. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-selectionchange-1" title="§ 4.3 Extensions to GlobalEventHandlers interface">§
                    4.3
                    Extensions to GlobalEventHandlers interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-selectionchange-2" title="§ 8. Security and Privacy considerations">§ 8.
                    Security
                    and Privacy considerations</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dfn-schedule-a-selectionchange-event"
        aria-label="Links in this document to definition: schedule a selectionchange event">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-schedule-a-selectionchange-event"
                aria-label="Permalink for definition: schedule a selectionchange event. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-schedule-a-selectionchange-event-1" title="§ 6.2 selectionchange event">§ 6.2
                    selectionchange event</a> <a href="#ref-for-dfn-schedule-a-selectionchange-event-2"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-fire-a-selectionchange-event"
        aria-label="Links in this document to definition: fire a selectionchange event">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-fire-a-selectionchange-event"
                aria-label="Permalink for definition: fire a selectionchange event. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-fire-a-selectionchange-event-1" title="§ 6.2.1 Scheduling selectionchange event">§
                    6.2.1 Scheduling selectionchange event</a>
            </li>
        </ul>
    </div>
    <script id="respec-dfn-panel">(() => {
            // @ts-check
            if (document.respec) {
                document.respec.ready.then(setupPanel);
            } else {
                setupPanel();
            }

            function setupPanel() {
                const listener = panelListener();
                document.body.addEventListener("keydown", listener);
                document.body.addEventListener("click", listener);
            }

            function panelListener() {
                /** @type {HTMLElement} */
                let panel = null;
                return event => {
                    const { target, type } = event;

                    if (!(target instanceof HTMLElement)) return;

                    // For keys, we only care about Enter key to activate the panel
                    // otherwise it's activated via a click.
                    if (type === "keydown" && event.key !== "Enter") return;

                    const action = deriveAction(event);

                    switch (action) {
                        case "show": {
                            hidePanel(panel);
                            /** @type {HTMLElement} */
                            const dfn = target.closest("dfn, .index-term");
                            panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
                            const coords = deriveCoordinates(event);
                            displayPanel(dfn, panel, coords);
                            break;
                        }
                        case "dock": {
                            panel.style.left = null;
                            panel.style.top = null;
                            panel.classList.add("docked");
                            break;
                        }
                        case "hide": {
                            hidePanel(panel);
                            panel = null;
                            break;
                        }
                    }
                };
            }

            /**
             * @param {MouseEvent|KeyboardEvent} event
             */
            function deriveCoordinates(event) {
                const target = /** @type HTMLElement */ (event.target);

                // We prevent synthetic AT clicks from putting
                // the dialog in a weird place. The AT events sometimes
                // lack coordinates, so they have clientX/Y = 0
                const rect = target.getBoundingClientRect();
                if (
                    event instanceof MouseEvent &&
                    event.clientX >= rect.left &&
                    event.clientY >= rect.top
                ) {
                    // The event probably happened inside the bounding rect...
                    return { x: event.clientX, y: event.clientY };
                }

                // Offset to the middle of the element
                const x = rect.x + rect.width / 2;
                // Placed at the bottom of the element
                const y = rect.y + rect.height;
                return { x, y };
            }

            /**
             * @param {Event} event
             */
            function deriveAction(event) {
                const target = /** @type {HTMLElement} */ (event.target);
                const hitALink = !!target.closest("a");
                if (target.closest("dfn:not([data-cite]), .index-term")) {
                    return hitALink ? "none" : "show";
                }
                if (target.closest(".dfn-panel")) {
                    if (hitALink) {
                        return target.classList.contains("self-link") ? "hide" : "dock";
                    }
                    const panel = target.closest(".dfn-panel");
                    return panel.classList.contains("docked") ? "hide" : "none";
                }
                if (document.querySelector(".dfn-panel:not([hidden])")) {
                    return "hide";
                }
                return "none";
            }

            /**
             * @param {HTMLElement} dfn
             * @param {HTMLElement} panel
             * @param {{ x: number, y: number }} clickPosition
             */
            function displayPanel(dfn, panel, { x, y }) {
                panel.hidden = false;
                // distance (px) between edge of panel and the pointing triangle (caret)
                const MARGIN = 20;

                const dfnRects = dfn.getClientRects();
                // Find the `top` offset when the `dfn` can be spread across multiple lines
                let closestTop = 0;
                let minDiff = Infinity;
                for (const rect of dfnRects) {
                    const { top, bottom } = rect;
                    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
                    if (diffFromClickY < minDiff) {
                        minDiff = diffFromClickY;
                        closestTop = top;
                    }
                }

                const top = window.scrollY + closestTop + dfnRects[0].height;
                const left = x - MARGIN;
                panel.style.left = `${left}px`;
                panel.style.top = `${top}px`;

                // Find if the panel is flowing out of the window
                const panelRect = panel.getBoundingClientRect();
                const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
                if (panelRect.right > SCREEN_WIDTH) {
                    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
                    const newCaretOffset = left - newLeft;
                    panel.style.left = `${newLeft}px`;
                    /** @type {HTMLElement} */
                    const caret = panel.querySelector(".caret");
                    caret.style.left = `${newCaretOffset}px`;
                }

                // As it's a dialog, we trap focus.
                // TODO: when <dialog> becomes a implemented, we should really
                // use that.
                trapFocus(panel, dfn);
            }

            /**
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function trapFocus(panel, dfn) {
                /** @type NodeListOf<HTMLAnchorElement> elements */
                const anchors = panel.querySelectorAll("a[href]");
                // No need to trap focus
                if (!anchors.length) return;

                // Move focus to first anchor element
                const first = anchors.item(0);
                first.focus();

                const trapListener = createTrapListener(anchors, panel, dfn);
                panel.addEventListener("keydown", trapListener);

                // Hiding the panel releases the trap
                const mo = new MutationObserver(records => {
                    const [record] = records;
                    const target = /** @type HTMLElement */ (record.target);
                    if (target.hidden) {
                        panel.removeEventListener("keydown", trapListener);
                        mo.disconnect();
                    }
                });
                mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
            }

            /**
             *
             * @param {NodeListOf<HTMLAnchorElement>} anchors
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function createTrapListener(anchors, panel, dfn) {
                const lastIndex = anchors.length - 1;
                let currentIndex = 0;
                return event => {
                    switch (event.key) {
                        // Hitting "Tab" traps us in a nice loop around elements.
                        case "Tab": {
                            event.preventDefault();
                            currentIndex += event.shiftKey ? -1 : +1;
                            if (currentIndex < 0) {
                                currentIndex = lastIndex;
                            } else if (currentIndex > lastIndex) {
                                currentIndex = 0;
                            }
                            anchors.item(currentIndex).focus();
                            break;
                        }

                        // Hitting "Enter" on an anchor releases the trap.
                        case "Enter":
                            hidePanel(panel);
                            break;

                        // Hitting "Escape" returns focus to dfn.
                        case "Escape":
                            hidePanel(panel);
                            dfn.focus();
                            return;
                    }
                };
            }

            /** @param {HTMLElement} panel */
            function hidePanel(panel) {
                if (!panel) return;
                panel.hidden = true;
                panel.classList.remove("docked");
            }
        })()</script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <script src="https://htmlspecs.com/dropdown.js"></script>
</body>

</html>