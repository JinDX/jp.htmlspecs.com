<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="ja-JP">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>RFC 8441 - HTTP/2 を用いた WebSocket のブートストラップ</title>
    <script>
        function getMeta(rfcno, container) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://www.rfc-editor.org/rfc/rfc" + rfcno + ".json", true);
            xhr.onload = function (e) {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        var data = JSON.parse(xhr.response);

                        var cont = document.getElementById(container);
                        // empty the container
                        while (cont.firstChild) {
                            cont.removeChild(myNode.firstChild);
                        }

                        var c = data.status;
                        if (c) {
                            var bld = newElementWithText("b", c);
                            cont.appendChild(bld);
                        } else {
                            cont.appendChild(newElementWithText("i", "(document status unknown)"));
                        }

                        c = data.updated_by;
                        if (c && c.length > 0 && c[0] !== null && c[0].length > 0) {
                            cont.appendChild(newElement("br"));
                            cont.appendChild(newText("Updated by: "));
                            appendRfcLinks(cont, c);
                        }

                        c = data.obsoleted_by;
                        if (c && c.length > 0 && c[0] !== null && c[0].length > 0) {
                            cont.appendChild(newElement("br"));
                            cont.appendChild(newText("Obsoleted by: "));
                            appendRfcLinks(cont, c);
                        }

                        c = data.errata_url;
                        if (c) {
                            cont.appendChild(newElement("br"));
                            var link = newElementWithText("a", "errata");
                            link.setAttribute("href", c);
                            var errata = newElementWithText("i", "This document has ");
                            errata.appendChild(link);
                            errata.appendChild(newText("."));
                            cont.appendChild(errata);
                        }

                        cont.style.display = "block";
                    } else {
                        console.error(xhr.statusText);
                    }
                }
            };
            xhr.onerror = function (e) {
                console.error(xhr.status + " " + xhr.statusText);
            };
            xhr.send(null);
        }
        function appendRfcLinks(parent, updates) {
            var template = "https://www.rfc-editor.org/rfc/rfc{rfc}.html";
            for (var i = 0; i < updates.length; i++) {
                var rfc = updates[i].trim().toLowerCase();
                if (rfc.substring(0, 3) == "rfc") {
                    var no = parseInt(rfc.substring(3), 10);

                    var link = newElement("a");
                    link.setAttribute("href", template.replace("{rfc}", no));
                    link.appendChild(newText(no));
                    parent.appendChild(link);
                } else {
                    parent.appendChild(newText(rfc));
                }
                if (i != updates.length - 1) {
                    parent.appendChild(newText(", "));
                }
            }
        }

        // DOM helpers
        function newElement(name) {
            return document.createElement(name);
        }
        function newElementWithText(name, txt) {
            var e = document.createElement(name);
            e.appendChild(newText(txt));
            return e;
        }
        function newText(text) {
            return document.createTextNode(text);
        }
    </script>
    <script>
        function anchorRewrite() {
            map = {};
            if (window.location.hash.length >= 1) {
                var fragid = window.location.hash.substr(1);
                if (fragid) {
                    if (!document.getElementById(fragid)) {
                        var prefix = "rfc.";
                        var mapped = map[fragid];
                        if (mapped) {
                            window.location.hash = mapped;
                        } else if (fragid.indexOf("section-") == 0) {
                            window.location.hash = prefix + "section." + fragid.substring(8).replace("-", ".p.");
                        } else if (fragid.indexOf("appendix-") == 0) {
                            window.location.hash = prefix + "section." + fragid.substring(9).replace("-", ".p.");
                        } else if (fragid.indexOf("s-") == 0) {
                            var postfix = fragid.substring(2);
                            if (postfix.startsWith("abstract")) {
                                window.location.hash = prefix + postfix;
                            } else if (postfix.startsWith("note-")) {
                                window.location.hash = prefix + "note." + postfix.substring(5).replace("-", ".p.");
                            } else {
                                window.location.hash = prefix + "section." + postfix.replace("-", ".p.");
                            }
                        } else if (fragid.indexOf("p-") == 0) {
                            var r = fragid.substring(2);
                            var p = r.indexOf("-");
                            if (p >= 0) {
                                window.location.hash = prefix + "section." + r.substring(0, p) + ".p." + r.substring(p + 1);
                            }
                        }
                    }
                }
            }
        }
        window.addEventListener('hashchange', anchorRewrite);
        window.addEventListener('DOMContentLoaded', anchorRewrite);
    </script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:type" content="article">
    <meta property="og:title" content="RFC8441">
    <meta property="og:description" content="Bootstrapping WebSockets with HTTP/2">
    <meta property="og:url" content="https://httpwg.org/specs/rfc8441.html">
    <meta property="og:site_name" content="IETF HTTP Working Group Specifications">
    <meta property="og:image" content="https://httpwg.org/assets/favicon/apple-icon-180x180.png">
    <link rel="stylesheet" type="text/css"
        href="https://httpwg.org/assets/node_modules/bootstrap/dist/css/bootstrap.min.css">
    <style type="text/css">
        body {
            padding-top: 80px;
            padding-bottom: 80px;
            position: relative;
        }

        .table.header th,
        .table.header td {
            border-top: none;
            padding: 0;
        }

        #sidebar {
            margin-top: -10px;
            height: 90%;
            overflow-y: auto;
            font-size: 90%;
        }

        #rfc\.meta {
            width: 40%;
            float: right
        }

        .toc ul {
            list-style: none;
        }

        .filename {
            color: rgb(119, 119, 119);
            font-size: 23px;
            font-weight: normal;
            height: auto;
            line-height: 23px;
        }

        dl {
            margin-left: 1em;
        }

        dl.dl-horizontal {
            margin-left: 0;
        }

        dl>dt {
            float: left;
            margin-right: 1em;
        }

        dl.nohang>dt {
            float: none;
        }

        dl>dd {
            margin-bottom: .5em;
        }

        dl.compact>dd {
            margin-bottom: 0em;
        }

        dl>dd>dl {
            margin-top: 0.5em;
            margin-bottom: 0em;
        }

        ul.empty {
            list-style-type: none;
        }

        ul.empty li {
            margin-top: .5em;
        }

        td.reference {
            padding-right: 1em;
            vertical-align: top;
        }

        .feedback {
            position: fixed;
            bottom: 5px;
            right: 5px;
        }

        .fbbutton {
            margin-left: 5px;
        }

        h1 a,
        h2 a,
        h3 a,
        h4 a,
        h5 a,
        h6 a {
            color: rgb(51, 51, 51);
        }

        span.tt {
            font: 11pt consolas, monospace;
            font-size-adjust: none;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="https://httpwg.org/assets/site.css">
    <link rel="Contents" href="#rfc.toc">
    <link rel="Author" href="#rfc.authors">
    <link rel="License" href="#rfc.copyrightnotice">
    <link rel="Chapter" title="1 Introduction" href="#rfc.section.1">
    <link rel="Chapter" title="2 Terminology" href="#rfc.section.2">
    <link rel="Chapter" title="3 The SETTINGS_ENABLE_CONNECT_PROTOCOL SETTINGS Parameter" href="#rfc.section.3">
    <link rel="Chapter" title="4 The Extended CONNECT Method" href="#rfc.section.4">
    <link rel="Chapter" title="5 Using Extended CONNECT to Bootstrap the WebSocket Protocol" href="#rfc.section.5">
    <link rel="Chapter" title="6 Design Considerations" href="#rfc.section.6">
    <link rel="Chapter" title="7 About Intermediaries" href="#rfc.section.7">
    <link rel="Chapter" title="8 Security Considerations" href="#rfc.section.8">
    <link rel="Chapter" title="9 IANA Considerations" href="#rfc.section.9">
    <link rel="Chapter" title="10 Normative References" href="#rfc.section.10">
    <link rel="Appendix" title="Acknowledgments" href="#rfc.section.unnumbered-1">
    <link rel="Alternate" title="Plain Text Version" href="http://www.ietf.org/rfc/rfc8441.txt">
    <link rel="Help" title="RFC-Editor's Status Page" href="https://www.rfc-editor.org/info/rfc8441">
    <meta name="viewport" content="initial-scale=1">
    <meta name="generator"
        content="https://github.com/mnot/RFCBootstrap XSLT vendor: Saxonica http://www.saxonica.com/">
    <meta name="keywords" content="Internet-Draft">
    <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
    <meta name="dcterms.creator" content="McManus, P.">
    <meta name="dcterms.identifier" content="urn:ietf:rfc:8441">
    <meta name="dcterms.issued" content="2018-09">
    <meta name="dcterms.abstract"
        content="This document defines a mechanism for running the WebSocket Protocol (RFC 6455) over a single stream of an HTTP/2 connection.">
    <meta name="dcterms.isPartOf" content="urn:issn:2070-1721">
    <meta name="description"
        content="This document defines a mechanism for running the WebSocket Protocol (RFC 6455) over a single stream of an HTTP/2 connection.">
</head>

<body onload="getMeta(8441,'rfc.meta');">
    <nav class="navbar navbar-dark bg-dark d-print-none navbar-expand-lg fixed-top ps-3 pe-3" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapse"
                aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <a class="navbar-brand" href="https://httpwg.org/"><img src="https://httpwg.org/assets/http.svg"
                    height="23"></a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse">

            <div class="navbar-nav me-auto">

                <a class="nav-item ms-1 text-white" href="https://httpwg.org/specs/">📄 Documentation</a>

                <div class="dropdown ms-4">
                    <a href="#" class="nav-item dropdown-toggle text-white" data-bs-toggle="dropdown">Work in
                        Progress</a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-item"><a href="https://httpwg.org/http-extensions/">HTTP Extensions</a></li>
                        <li class="dropdown-item"><a
                                href="https://github.com/httpwg/admin/issues?q=is%3Aissue+is%3Aopen+label%3Aadoption">Future
                                Work</a></li>
                    </ul>
                </div>

                <div class="dropdown ms-4">
                    <a href="#" class="nav-item dropdown-toggle text-white" data-bs-toggle="dropdown">Participate</a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-item"><a href="https://httpwg.org/about/">About the HTTP Working Group</a>
                        </li>
                        <li class="divider"></li>
                        <li class="dropdown-item"><a href="https://httpwg.org/CONTRIBUTING.html">Contribution Policy</a>
                        </li>
                        <li class="dropdown-item"><a href="http://datatracker.ietf.org/wg/httpbis/charter/">WG
                                Charter</a></li>
                        <li class="dropdown-item"><a href="http://lists.w3.org/Archives/Public/ietf-http-wg/">Group
                                Mailing List 📨</a></li>
                        <li class="dropdown-item"><a href="https://httpwg.org/wg-materials/">Meeting Materials</a></li>
                        <li class="dropdown-item"><a href="https://httpwg.org/admin/editors/">Document Editor
                                Resources</a></li>
                    </ul>
                </div>
            </div>

        </div>
    </nav>
    <div class="container" id="top">
        <div class="row">
            <div class="col-lg-4 order-last d-none d-lg-block" id="sidebar" role="navigation">
                <div class="navbar">
                    <div class="navbar-brand"><a href="#top"><strong>RFC </strong>8441</a></div><br clear="all">
                    <div class="">
                        <div class="toc ">
                            <ul>
                                <li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">導入</a></li>
                                <li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#terminology">用語</a></li>
                                <li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#the-settingsenableconnectprotocol-settings-parameter">SETTINGS_ENABLE_CONNECT_PROTOCOL
                                        SETTINGS パラメータ</a></li>
                                <li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a href="#method">拡張 CONNECT
                                        メソッド</a></li>
                                <li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#usingExtended">拡張 CONNECT
                                        を用いた WebSocket プロトコルのブートストラップ</a>
                                    <ul>
                                        <li><a href="#rfc.section.5.1">5.1.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#example">例</a></li>
                                    </ul>
                                </li>
                                <li><a href="#rfc.section.6">6.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#design-considerations">設計上の考慮事項</a></li>
                                <li><a href="#rfc.section.7">7.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#about-intermediaries">仲介者に関して</a></li>
                                <li><a href="#rfc.section.8">8.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#security-considerations">セキュリティに関する考慮事項</a></li>
                                <li><a href="#rfc.section.9">9.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA
                                        に関する考慮事項</a>
                                    <ul>
                                        <li><a href="#rfc.section.9.1">9.1.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#a-new-http2-setting">新しい HTTP/2 設定</a></li>
                                        <li><a href="#rfc.section.9.2">9.2.</a>&nbsp;&nbsp;&nbsp;<a
                                                href="#a-new-http-upgrade-token">新しい HTTP Upgrade トークン</a></li>
                                    </ul>
                                </li>
                                <li><a href="#rfc.section.10">10.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#rfc.references">規範的参考文献</a></li>
                                <li><a href="#acknowledgments">謝辞</a></li>
                                <li><a href="#rfc.authors">著者の連絡先</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 order-first main" role="main">
                <header>
                    <table class="table table-condensed header" id="rfc.headerblock">
                        <tbody>
                            <tr>
                                <td class="text-left">インターネット技術タスクフォース (IETF)</td>
                                <td class="text-right">P. McManus</td>
                            </tr>
                            <tr>
                                <td class="text-left">Request for Comments: 8441</td>
                                <td class="text-right">Mozilla</td>
                            </tr>
                            <tr>
                                <td class="text-left">Updates: <a href="#RFC6455">6455</a></td>
                                <td class="text-right">2018年9月</td>
                            </tr>
                            <tr>
                                <td class="text-left">カテゴリー: Standards Track</td>
                                <td class="text-right"></td>
                            </tr>
                            <tr>
                                <td class="text-left">ISSN: 2070-1721</td>
                                <td class="text-right"></td>
                            </tr>
                        </tbody>
                    </table>
                    <div id="rfc.title">
                        <h1>HTTP/2 による WebSocket のブートストラップ</h1>
                    </div>
                </header>
                <hr>
                <h2 id="rfc.abstract"><a href="#rfc.abstract">概要</a></h2>
                <div class="lead">
                    <div id="rfc.abstract.p.1">
                        <p>本書は、WebSocket プロトコル (RFC 6455) を HTTP/2 接続の単一ストリーム上で実行するためのメカニズムを定義します。</p>
                    </div>
                </div>
                <aside id="rfc.meta" class="alert alert-info"></aside>
                <section id="rfc.status">
                    <h2><a href="#rfc.status">本メモの状態</a></h2>
                    <div id="rfc.boilerplate.1.p.1">
                        <p>これはインターネット標準トラックの文書です。</p>
                    </div>
                    <div id="rfc.boilerplate.1.p.2">
                        <p>この文書は Internet Engineering Task Force (IETF) の成果物です。IETF コミュニティの合意を表しています。公開審査を受け、Internet
                            Engineering Steering Group (IESG) によって公開が承認されています。インターネット標準に関するさらなる情報は <a
                                href="https://www.rfc-editor.org/rfc/rfc7841.html#section-2">RFC 7841 のセクション 2</a>
                            をご覧ください。
                        </p>
                    </div>
                    <div id="rfc.boilerplate.1.p.3">
                        <p>この文書の現状、訂正情報、およびフィードバックの送付方法に関する情報は <a
                                href="https://www.rfc-editor.org/info/rfc8441">https://www.rfc-editor.org/info/rfc8441</a>
                            で入手できます。
                        </p>
                    </div>
                </section>
                <section id="rfc.copyrightnotice">
                    <h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2>
                    <div id="rfc.boilerplate.2.p.1">
                        <p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors. All rights
                            reserved.</p>
                    </div>
                    <div id="rfc.boilerplate.2.p.2">
                        <p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF
                            Documents (<a
                                href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>)
                            in effect on the date of publication of this document. Please review these documents
                            carefully, as they describe your rights and restrictions with respect to this document. Code
                            Components extracted from this document must include Simplified BSD License text as
                            described in Section 4.e of the Trust Legal Provisions and are provided without warranty as
                            described in the Simplified BSD License.</p>
                    </div>
                </section>
                <div class="toc d-lg-none">
                    <ul>
                        <li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">導入</a>
                        </li>
                        <li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#terminology">用語</a></li>
                        <li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a
                                href="#the-settingsenableconnectprotocol-settings-parameter">SETTINGS_ENABLE_CONNECT_PROTOCOL
                                SETTINGS パラメータ</a></li>
                        <li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a href="#method">拡張 CONNECT メソッド</a></li>
                        <li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#usingExtended">拡張 CONNECT を用いた
                                WebSocket プロトコルのブートストラップ</a>
                            <ul>
                                <li><a href="#rfc.section.5.1">5.1.</a>&nbsp;&nbsp;&nbsp;<a href="#example">例</a>
                                </li>
                            </ul>
                        </li>
                        <li><a href="#rfc.section.6">6.</a>&nbsp;&nbsp;&nbsp;<a
                                href="#design-considerations">設計上の考慮事項</a></li>
                        <li><a href="#rfc.section.7">7.</a>&nbsp;&nbsp;&nbsp;<a href="#about-intermediaries">仲介者に関して</a>
                        </li>
                        <li><a href="#rfc.section.8">8.</a>&nbsp;&nbsp;&nbsp;<a
                                href="#security-considerations">セキュリティに関する考慮事項</a></li>
                        <li><a href="#rfc.section.9">9.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA
                                に関する考慮事項</a>
                            <ul>
                                <li><a href="#rfc.section.9.1">9.1.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#a-new-http2-setting">新しい HTTP/2 設定</a></li>
                                <li><a href="#rfc.section.9.2">9.2.</a>&nbsp;&nbsp;&nbsp;<a
                                        href="#a-new-http-upgrade-token">新しい HTTP Upgrade トークン</a></li>
                            </ul>
                        </li>
                        <li><a href="#rfc.section.10">10.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">規範的参考文献</a>
                        </li>
                        <li><a href="#acknowledgments">謝辞</a></li>
                        <li><a href="#rfc.authors">著者の連絡先</a></li>
                    </ul>
                </div>
                <section id="introduction">
                    <h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a
                            href="#introduction">導入</a></h2>
                    <div id="rfc.section.1.p.1">
                        <p>The Hypertext Transfer Protocol (HTTP) <a href="#RFC7230"><cite
                                    title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>
                            は異なるバージョン間でリソースレベルの互換的セマンティクスを提供しますが、接続管理レベルでの互換性は提供しません。WebSockets のように HTTP
                            の接続管理の詳細に依存する他のプロトコルは、HTTP の新しいバージョンに合わせて更新する必要があります。</p>
                    </div>
                    <div id="rfc.section.1.p.2">
                        <p>The WebSocket Protocol <a href="#RFC6455"><cite
                                    title="The WebSocket Protocol">[RFC6455]</cite></a> は、HTTP/1.1 の Upgrade メカニズム（<a
                                href="https://www.rfc-editor.org/rfc/rfc7230.html#section-6.7">Section 6.7</a> of <a
                                href="#RFC7230"><cite
                                    title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>）を用いて、TCP
                            接続を HTTP から WebSocket 接続へ遷移させます。HTTP/2 <a href="#RFC7540"><cite
                                    title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a>
                            では異なるアプローチが必要です。マルチプレクシングの性質上、HTTP/2 では Upgrade や Connection のような接続全体に関わるヘッダーフィールドや 101
                            (Switching Protocols) のようなステータスコードを使用できません。これらは <a href="#RFC6455"><cite
                                    title="The WebSocket Protocol">[RFC6455]</cite></a> のオープニングハンドシェイクで必須とされている要素です。</p>
                    </div>
                    <div id="rfc.section.1.p.3">
                        <p>HTTP/2 から WebSockets をブートストラップできるようにすることで、単一の TCP 接続を両方のプロトコルで共有でき、HTTP/2 によるネットワークの効率的利用を
                            WebSockets にも拡張できます。</p>
                    </div>
                    <div id="rfc.section.1.p.4">
                        <p>本書は HTTP/2 における CONNECT メソッド（<a
                                href="https://www.rfc-editor.org/rfc/rfc7540.html#section-8.3">Section 8.3</a> of <a
                                href="#RFC7540"><cite
                                    title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a>）を拡張します。この拡張により、通常
                            CONNECT が指定する外部ホストの代わりに接続先として新しいプロトコル名を置換できるようになります。その結果、単一の HTTP/2
                            ストリーム上のトンネルが生成され、WebSockets（または他の任意のプロトコル）のデータを運ぶことができます。接続上の他のストリームは拡張 CONNECT トンネル、従来の
                            HTTP/2 データ、またはその混在を運ぶことができます。</p>
                    </div>
                    <div id="rfc.section.1.p.5">
                        <p>このトンネル化されたストリームは接続上の他の通常ストリームとマルチプレクスされ、HTTP/2 の通常の優先度、キャンセル、フロー制御の機能を享受します。</p>
                    </div>
                    <div id="rfc.section.1.p.6">
                        <p>本仕様で定義するオープニングハンドシェイクの修正を用いてトンネル化ストリーム上で WebSocket 接続を確立したストリームは、その後は従来の WebSocket
                            プロトコルを使用し、当該ストリームを RFC6455 が参照する TCP 接続として扱います。</p>
                    </div>
                </section>
                <section id="terminology">
                    <h2 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;<a href="#terminology">用語</a>
                    </h2>
                    <div id="rfc.section.2.p.1">
                        <p>この文書内のキーワード “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
                            “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, および “OPTIONAL” は、すべて大文字で表示される場合に限り、BCP 14 の定義（<a
                                href="#RFC2119"><cite
                                    title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a>
                            と <a href="#RFC8174"><cite
                                    title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">[RFC8174]</cite></a>）に従って解釈されます。
                        </p>
                    </div>
                </section>
                <section id="the-settingsenableconnectprotocol-settings-parameter">
                    <h2 id="rfc.section.3"><a href="#rfc.section.3">3.</a>&nbsp;<a
                            href="#the-settingsenableconnectprotocol-settings-parameter">SETTINGS_ENABLE_CONNECT_PROTOCOL
                            SETTINGS パラメータ</a></h2>
                    <div id="rfc.section.3.p.1">
                        <p>本書は <a href="#RFC7540"><cite
                                    title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a> の定義する
                            SETTINGS パラメータに新しいパラメータを追加します（<a
                                href="https://www.rfc-editor.org/rfc/rfc7540.html#section-6.5.2">Section 6.5.2</a>）。</p>
                    </div>
                    <div id="rfc.section.3.p.2">
                        <p>新しいパラメータ名は SETTINGS_ENABLE_CONNECT_PROTOCOL です。パラメータの値は 0 または 1 でなければなりません。</p>
                    </div>
                    <div id="rfc.section.3.p.3">
                        <p>SETTINGS_ENABLE_CONNECT_PROTOCOL の値が 1 で受信された場合、クライアントは新しいストリームを作成する際に本書で定義する拡張 CONNECT
                            を使用してもよい（MAY）ものとします。サーバーがこのパラメータを受信しても、サーバー側に影響はありません。</p>
                    </div>
                    <div id="rfc.section.3.p.4">
                        <p>送信者は、一度 1 を送信した後に 0 の SETTINGS_ENABLE_CONNECT_PROTOCOL を送信してはなりません（MUST NOT）。</p>
                    </div>
                    <div id="rfc.section.3.p.5">
                        <p>互換性のないプロトコル変更へのオプトインに SETTINGS パラメータを用いることは、<a href="#RFC7540"><cite
                                    title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a> の
                            “Extending HTTP/2” の利用法です（<a
                                href="https://www.rfc-editor.org/rfc/rfc7540.html#section-5.5">Section
                                5.5</a>）。具体的には、新しい疑似ヘッダフィールド “:protocol” の追加と、<a href="#method"
                                title="The Extended CONNECT Method">Section 4</a> における :authority
                            疑似ヘッダの意味の変更はオプトインの交渉を必要とします。クライアントが SETTINGS_ENABLE_CONNECT_PROTOCOL
                            を先に受け取らずに本拡張を用いると、非対応のピアは不正な要求を検出してストリームエラーを生成します（<a
                                href="https://www.rfc-editor.org/rfc/rfc7540.html#section-8.1.2.6">Section 8.1.2.6</a>）。
                        </p>
                    </div>
                </section>
                <section id="method">
                    <h2 id="rfc.section.4"><a href="#rfc.section.4">4.</a>&nbsp;<a href="#method">拡張 CONNECT メソッド</a>
                    </h2>
                    <div id="rfc.section.4.p.1" class="avoidbreakafter">
                        <p>HTTP/2 における CONNECT メソッドの利用は <a
                                href="https://www.rfc-editor.org/rfc/rfc7540.html#section-8.3">Section 8.3</a> of <a
                                href="#RFC7540"><cite
                                    title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a>
                            で定義されています。本拡張は次の点でメソッドを修正します：</p>
                    </div>
                    <div id="rfc.section.4.p.2">
                        <ul>
                            <li>要求 HEADERS に新しい疑似ヘッダフィールド <span class="tt">:protocol</span> を含めることができ、これは CONNECT
                                により作成されるトンネル上で使用したいプロトコルを示します。疑似ヘッダは単一値であり、値は IANA の “Hypertext Transfer Protocol (HTTP)
                                Upgrade Token Registry” にあるトークンから選ばれます（&lt;<a
                                    href="https://www.iana.org/assignments/http-upgrade-tokens/">https://www.iana.org/assignments/http-upgrade-tokens/</a>&gt;）。
                            </li>
                            <li><span class="tt">:protocol</span> 疑似ヘッダを含む要求では、ターゲット URI の疑似ヘッダ <span
                                    class="tt">:scheme</span> と <span class="tt">:path</span>（<a href="#usingExtended"
                                    title="Using Extended CONNECT to Bootstrap the WebSocket Protocol">Section 5</a>
                                を参照）も必ず含めなければなりません（MUST）。</li>
                            <li><span class="tt">:protocol</span> 疑似ヘッダを付けた要求では、<span class="tt">:authority</span>
                                疑似ヘッダは本拡張においては <a
                                    href="https://www.rfc-editor.org/rfc/rfc7540.html#section-8.1.2.3">Section
                                    8.1.2.3</a> の解釈に従い扱われます。これは、通常の拡張されていない CONNECT リクエストで行われるように、<span
                                    class="tt">:authority</span> で示されたホストへトンネルを作成するという動作をサーバーが行ってはならない（MUST
                                NOT）ことを意味します。</li>
                        </ul>
                    </div>
                    <div id="rfc.section.4.p.3">
                        <p><span class="tt">:protocol</span> 疑似ヘッダを持つ CONNECT
                            リクエストを受け取ると、サーバーは疑似ヘッダで示されたプロトコル種別の別のサービスへトンネルを確立します。このサービスはサーバーと同一ホストである場合もあれば、そうでない場合もあります。
                        </p>
                    </div>
                </section>
                <section id="usingExtended">
                    <h2 id="rfc.section.5"><a href="#rfc.section.5">5.</a>&nbsp;<a href="#usingExtended">拡張 CONNECT を用いた
                            WebSocket プロトコルのブートストラップ</a></h2>
                    <div id="rfc.section.5.p.1">
                        <p><span class="tt">:protocol</span> 疑似ヘッダは CONNECT リクエストに必ず含められなければならず（MUST）、HTTP/2 ストリーム上で
                            WebSocket 接続を開始するためにはその値が <span class="tt">websocket</span> でなければなりません。クッキー操作などの他の HTTP
                            リクエスト/レスポンスヘッダーフィールドは、従来どおり CONNECT の HEADERS に含めることができます。この要求は <a href="#RFC6455"><cite
                                    title="The WebSocket Protocol">[RFC6455]</cite></a> の GET ベースの要求に代わるものであり、WebSockets
                            のオープニングハンドシェイクを処理するために使用されます。</p>
                    </div>
                    <div id="rfc.section.5.p.2">
                        <p>ターゲット URI のスキーム（<a href="https://www.rfc-editor.org/rfc/rfc7230.html#section-5.1">Section
                                5.1</a> of <a href="#RFC7230"><cite
                                    title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>）は、"wss"
                            スキームの WebSockets については “https”、"ws" スキームの WebSockets については “http” でなければなりません。ターゲット URI
                            の残りの部分は WebSocket URI と同じです。WebSocket URI は依然としてプロキシ自動構成に使用されます。本仕様で使用される HTTP/2
                            接続のセキュリティ要件は、https リクエストについては <a href="#RFC7540"><cite
                                    title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a> に、http
                            リクエストについては <a href="#RFC8164"><cite
                                    title="Opportunistic Security for HTTP/2">[RFC8164]</cite></a> によって確立されます。</p>
                    </div>
                    <div id="rfc.section.5.p.3">
                        <p><a href="#RFC6455"><cite title="The WebSocket Protocol">[RFC6455]</cite></a> は、HTTP/2 の一部ではない
                            Connection および Upgrade ヘッダーフィールドの使用を要求しています。これらはここで定義する CONNECT リクエストには含めてはなりません（MUST NOT）。
                        </p>
                    </div>
                    <div id="rfc.section.5.p.4">
                        <p><a href="#RFC6455"><cite title="The WebSocket Protocol">[RFC6455]</cite></a> は Host
                            ヘッダーフィールドの使用も要求していますが、HTTP/2 では Host 情報は各トランザクションで必須の疑似ヘッダフィールド <span
                                class="tt">:authority</span> として伝えられます。</p>
                    </div>
                    <div id="rfc.section.5.p.5">
                        <p>本拡張を使って WebSockets をブートストラップする実装では、<span class="tt">Sec-WebSocket-Key</span> および <span
                                class="tt">Sec-WebSocket-Accept</span> ヘッダーフィールドの処理は行いません。これらの機能は <span
                                class="tt">:protocol</span> 疑似ヘッダフィールドによって置き換えられるためです。</p>
                    </div>
                    <div id="rfc.section.5.p.6">
                        <p>Origin (<a href="#RFC6454"><cite title="The Web Origin Concept">[RFC6454]</cite></a>), <span
                                class="tt">Sec-WebSocket-Version</span>, <span class="tt">Sec-WebSocket-Protocol</span>,
                            および <span class="tt">Sec-WebSocket-Extensions</span> ヘッダーフィールドは、<a href="#RFC6455"><cite
                                    title="The WebSocket Protocol">[RFC6455]</cite></a> に定義されたとおりに CONNECT
                            のリクエストおよびレスポンスヘッダーフィールドで使用されます。なお、HTTP/1 のヘッダーフィールド名は大文字小文字を区別しませんでしたが、HTTP/2
                            では小文字でエンコードすることが要求される点に注意してください。</p>
                    </div>
                    <div id="rfc.section.5.p.7">
                        <p>オープニングハンドシェイクを正常に処理した後、ピアは CONNECT トランザクションの HTTP/2 ストリームを RFC6455 が参照する TCP
                            接続の代わりとして扱い、WebSocket プロトコルを進めます。この時点で WebSocket 接続の状態は RFC6455 の定義どおり OPEN になります（<a
                                href="#RFC6455"><cite title="The WebSocket Protocol">[RFC6455]</cite></a>, <a
                                href="https://www.rfc-editor.org/rfc/rfc6455.html#section-4.1">Section 4.1</a>）。</p>
                    </div>
                    <div id="rfc.section.5.p.8">
                        <p>HTTP/2 ストリームのクローズは RFC6455 の TCP 接続クローズに相当します。順序だてられた TCP レベルのクローズは END_STREAM フラグで表現され（<a
                                href="#RFC7540"><cite
                                    title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a>, <a
                                href="https://www.rfc-editor.org/rfc/rfc7540.html#section-6.1">Section 6.1</a>）、RST の例外は
                            RST_STREAM フレーム（<a href="#RFC7540"><cite
                                    title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a>, <a
                                href="https://www.rfc-editor.org/rfc/rfc7540.html#section-6.4">Section 6.4</a>）と CANCEL
                            エラーコードで表現されます（<a href="#RFC7540"><cite
                                    title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a>, <a
                                href="https://www.rfc-editor.org/rfc/rfc7540.html#section-7">Section 7</a>）。</p>
                    </div>
                    <section id="example">
                        <h3 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a>&nbsp;<a href="#example">例</a>
                        </h3>
                        <div id="rfc.figure.u.1">
                            <div>
                                <pre class="text">
[[ From Client ]]                       [[ From Server ]]

                                        SETTINGS
                                        SETTINGS_ENABLE_CONNECT_[..] = 1

HEADERS + END_HEADERS
:method = CONNECT
:protocol = websocket
:scheme = https
:path = /chat
:authority = server.example.com
sec-websocket-protocol = chat, superchat
sec-websocket-extensions = permessage-deflate
sec-websocket-version = 13
origin = http://www.example.com

                                        HEADERS + END_HEADERS
                                        :status = 200
                                        sec-websocket-protocol = chat

DATA
WebSocket Data

                                        DATA + END_STREAM
                                        WebSocket Data

DATA + END_STREAM
WebSocket Data
</pre>
                            </div>
                        </div>
                    </section>
                </section>
                <section id="design-considerations">
                    <h2 id="rfc.section.6"><a href="#rfc.section.6">6.</a>&nbsp;<a
                            href="#design-considerations">設計上の考慮事項</a></h2>
                    <div id="rfc.section.6.p.1">
                        <p>HTTP/2 とよりネイティブに統合するには、HTTP/2 にさらなる追加を行うことで可能ですが、本設計は複雑さを最小限に抑えつつ、HTTP/2 と WebSockets
                            を同時に動作させる主要な課題に対処するために選択されました。</p>
                    </div>
                </section>
                <section id="about-intermediaries">
                    <h2 id="rfc.section.7"><a href="#rfc.section.7">7.</a>&nbsp;<a
                            href="#about-intermediaries">仲介者に関して</a></h2>
                    <div id="rfc.section.7.p.1">
                        <p>本書は WebSockets と HTTP フォワードプロキシの相互作用を変更しません。WebSockets を使用したいクライアントが HTTP/2 経由で HTTP
                            プロキシに接続する場合、そのクライアントは従来の CONNECT（すなわち <span class="tt">:protocol</span> 疑似ヘッダを使わない通常の
                            CONNECT）を用いて、そのプロキシ経由で WebSocket サーバーへトンネルするべきです。</p>
                    </div>
                    <div id="rfc.section.7.p.2">
                        <p>その結果得られるトンネル上で使用される HTTP のバージョンが、WebSockets を直接開始するか、本書で説明された修正された CONNECT 要求を介して開始するかを決定します。
                        </p>
                    </div>
                </section>
                <section id="security-considerations">
                    <h2 id="rfc.section.8"><a href="#rfc.section.8">8.</a>&nbsp;<a
                            href="#security-considerations">セキュリティに関する考慮事項</a></h2>
                    <div id="rfc.section.8.p.1" class="avoidbreakafter">
                        <p><a href="#RFC6455"><cite title="The WebSocket Protocol">[RFC6455]</cite></a> は、特に
                            XMLHttpRequest ベースのクライアントのような非 WebSockets クライアントが WebSocket
                            接続を確立できないようにする仕組みを提供します。その主なメカニズムは、XMLHttpRequest ベースのクライアントが作成できない Sec-
                            プレフィックスの付いたリクエストヘッダーフィールドの使用です。本仕様はこの懸念に二つの方法で対処します：</p>
                    </div>
                    <div id="rfc.section.8.p.2">
                        <ul>
                            <li>XMLHttpRequest は Sec- プレフィックスのヘッダーフィールドに加え、CONNECT メソッドの使用も禁止しています。</li>
                            <li>疑似ヘッダフィールドの使用は接続固有のものであり、HTTP/2 ではプロトコルスタック外で疑似ヘッダを作成することは決して許されません。</li>
                        </ul>
                    </div>
                    <div id="rfc.section.8.p.3">
                        <p><a href="#RFC6455"><cite title="The WebSocket Protocol">[RFC6455]</cite></a> のセキュリティ考慮事項（<a
                                href="https://www.rfc-editor.org/rfc/rfc6455.html#section-10">Section
                                10</a>）は、本仕様を用いる場合の WebSocket プロトコルの使用にも引き続き適用されます。ただし、<a
                                href="https://www.rfc-editor.org/rfc/rfc6455.html#section-10.8">Section 10.8</a>
                            は、本書で変更されたブートストラップハンドシェイク固有の内容であるため該当しません。</p>
                    </div>
                </section>
                <section id="iana-considerations">
                    <h2 id="rfc.section.9"><a href="#rfc.section.9">9.</a>&nbsp;<a href="#iana-considerations">IANA
                            に関する考慮事項</a></h2>
                    <section id="a-new-http2-setting">
                        <h3 id="rfc.section.9.1"><a href="#rfc.section.9.1">9.1.</a>&nbsp;<a
                                href="#a-new-http2-setting">新しい HTTP/2 設定</a></h3>
                        <div id="rfc.section.9.1.p.1">
                            <p>本書は <a href="https://www.rfc-editor.org/rfc/rfc7540.html#section-11.3">Section 11.3</a>
                                of <a href="#RFC7540"><cite
                                        title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a>
                                で確立された “HTTP/2 Settings” レジストリにエントリを登録します。</p>
                        </div>
                        <div id="rfc.section.9.1.p.2">
                            <dl>
                                <dt>Code:</dt>
                                <dd>0x8</dd>
                                <dt>Name:</dt>
                                <dd>SETTINGS_ENABLE_CONNECT_PROTOCOL</dd>
                                <dt>Initial Value:</dt>
                                <dd>0</dd>
                                <dt>Specification:</dt>
                                <dd>本書</dd>
                            </dl>
                        </div>
                    </section>
                    <section id="a-new-http-upgrade-token">
                        <h3 id="rfc.section.9.2"><a href="#rfc.section.9.2">9.2.</a>&nbsp;<a
                                href="#a-new-http-upgrade-token">新しい HTTP Upgrade トークン</a></h3>
                        <div id="rfc.section.9.2.p.1">
                            <p>本書は <a href="#RFC7230"><cite
                                        title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a>
                                によって確立された “HTTP Upgrade Tokens” レジストリにエントリを登録します。</p>
                        </div>
                        <div id="rfc.section.9.2.p.2">
                            <dl>
                                <dt>Value:</dt>
                                <dd>websocket</dd>
                                <dt>Description:</dt>
                                <dd>The Web Socket Protocol</dd>
                                <dt>Expected Version Tokens:</dt>
                                <dd>&nbsp;</dd>
                                <dt>References:</dt>
                                <dd><a href="#RFC6455"><cite title="The WebSocket Protocol">[RFC6455]</cite></a>
                                    [RFC8441]</dd>
                            </dl>
                        </div>
                    </section>
                </section>
                <section>
                    <div id="rfc.references">
                        <h2 id="rfc.section.10"><a href="#rfc.section.10">10.</a> 規範的参考文献</h2>
                        <dl class="dl-horizontal">
                            <dt id="RFC2119">[<a href="#RFC2119" class="smpl">RFC2119</a>]</dt>
                            <dd>Bradner, S., “<a href="https://www.rfc-editor.org/rfc/rfc2119.html">Key words for use in
                                    RFCs to Indicate Requirement Levels</a>”, <a
                                    href="https://www.rfc-editor.org/info/bcp14">BCP 14</a>, RFC 2119, <a
                                    href="https://dx.doi.org/10.17487/RFC2119">DOI 10.17487/RFC2119</a>, March 1997,
                                &lt;<a
                                    href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.
                            </dd>
                            <dt id="RFC6454">[<a href="#RFC6454" class="smpl">RFC6454</a>]</dt>
                            <dd>Barth, A., “<a href="https://www.rfc-editor.org/rfc/rfc6454.html">The Web Origin
                                    Concept</a>”, RFC 6454, <a href="https://dx.doi.org/10.17487/RFC6454">DOI
                                    10.17487/RFC6454</a>, December 2011, &lt;<a
                                    href="https://www.rfc-editor.org/info/rfc6454">https://www.rfc-editor.org/info/rfc6454</a>&gt;.
                            </dd>
                            <dt id="RFC6455">[<a href="#RFC6455" class="smpl">RFC6455</a>]</dt>
                            <dd>Fette, I. and A. Melnikov, “<a href="https://www.rfc-editor.org/rfc/rfc6455.html">The
                                    WebSocket Protocol</a>”, RFC 6455, <a href="https://dx.doi.org/10.17487/RFC6455">DOI
                                    10.17487/RFC6455</a>, December 2011, &lt;<a
                                    href="https://www.rfc-editor.org/info/rfc6455">https://www.rfc-editor.org/info/rfc6455</a>&gt;.
                            </dd>
                            <dt id="RFC7230">[<a href="#RFC7230" class="smpl">RFC7230</a>]</dt>
                            <dd>Fielding, R., Ed. and J. Reschke, Ed., “<a
                                    href="https://www.rfc-editor.org/rfc/rfc7230.html">Hypertext Transfer Protocol
                                    (HTTP/1.1): Message Syntax and Routing</a>”, RFC 7230, <a
                                    href="https://dx.doi.org/10.17487/RFC7230">DOI 10.17487/RFC7230</a>, June 2014,
                                &lt;<a
                                    href="https://www.rfc-editor.org/info/rfc7230">https://www.rfc-editor.org/info/rfc7230</a>&gt;.
                            </dd>
                            <dt id="RFC7540">[<a href="#RFC7540" class="smpl">RFC7540</a>]</dt>
                            <dd>Belshe, M., Peon, R., and M. Thomson, Ed., “<a
                                    href="https://www.rfc-editor.org/rfc/rfc7540.html">Hypertext Transfer Protocol
                                    Version 2 (HTTP/2)</a>”, RFC 7540, <a href="https://dx.doi.org/10.17487/RFC7540">DOI
                                    10.17487/RFC7540</a>, May 2015, &lt;<a
                                    href="https://www.rfc-editor.org/info/rfc7540">https://www.rfc-editor.org/info/rfc7540</a>&gt;.
                            </dd>
                            <dt id="RFC8164">[<a href="#RFC8164" class="smpl">RFC8164</a>]</dt>
                            <dd>Nottingham, M. and M. Thomson, “<a
                                    href="https://www.rfc-editor.org/rfc/rfc8164.html">Opportunistic Security for
                                    HTTP/2</a>”, RFC 8164, <a href="https://dx.doi.org/10.17487/RFC8164">DOI
                                    10.17487/RFC8164</a>, May 2017, &lt;<a
                                    href="https://www.rfc-editor.org/info/rfc8164">https://www.rfc-editor.org/info/rfc8164</a>&gt;.
                            </dd>
                            <dt id="RFC8174">[<a href="#RFC8174" class="smpl">RFC8174</a>]</dt>
                            <dd>Leiba, B., “<a href="https://www.rfc-editor.org/rfc/rfc8174.html">Ambiguity of Uppercase
                                    vs Lowercase in RFC 2119 Key Words</a>”, BCP 14, RFC 8174, <a
                                    href="https://dx.doi.org/10.17487/RFC8174">DOI 10.17487/RFC8174</a>, May 2017,
                                &lt;<a
                                    href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.
                            </dd>
                        </dl>
                    </div>
                </section>
                <section id="acknowledgments">
                    <h2 id="rfc.section.unnumbered-1"><a href="#acknowledgments">謝辞</a></h2>
                    <div id="rfc.section.unnumbered-1.p.1">
                        <p>2017 年の HTTP ワークショップでは、この問題の主要点と許容される解決の複雑さのレベルを決定する上で非常に生産的な議論が行われました。</p>
                    </div>
                </section>
                <section id="rfc.authors" class="avoidbreakinside">
                    <h2><a href="#rfc.authors">著者の連絡先</a></h2>
                    <address><b>Patrick McManus</b><br>Mozilla<br>EMail: <a
                            href="mailto:mcmanus@ducksong.com">mcmanus@ducksong.com</a></address>
                </section>
            </div>
        </div>
    </div>
    <script src="https://httpwg.org/assets/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="https://httpwg.org/assets/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="https://htmlspecs.com/dropdown.js"></script>
</body>

</html>