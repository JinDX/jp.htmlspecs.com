<!DOCTYPE html>
<html lang="ja-JP">

<head>
    <meta charset="utf-8">
    <meta name="generator" content="ReSpec 35.1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        span.example-title {
            text-transform: none
        }

        :is(aside, div).example,
        div.illegal-example {
            padding: .5em;
            margin: 1em 0;
            position: relative;
            clear: both
        }

        div.illegal-example {
            color: red
        }

        div.illegal-example p {
            color: #000
        }

        aside.example div.example {
            border-left-width: .1em;
            border-color: #999;
            background: #fff
        }
    </style>
    <style>
        .issue-label {
            text-transform: initial
        }

        .warning>p:first-child {
            margin-top: 0
        }

        .warning {
            padding: .5em;
            border-left-width: .5em;
            border-left-style: solid
        }

        span.warning {
            padding: .1em .5em .15em
        }

        .issue.closed span.issue-number {
            text-decoration: line-through
        }

        .issue.closed span.issue-number::after {
            content: " (Closed)";
            font-size: smaller
        }

        .warning {
            border-color: #f11;
            border-color: var(--warning-border, #f11);
            border-width: .2em;
            border-style: solid;
            background: #fbe9e9;
            background: var(--warning-bg, #fbe9e9);
            color: #000;
            color: var(--text, #000)
        }

        .warning-title:before {
            content: "⚠";
            font-size: 1.3em;
            float: left;
            padding-right: .3em;
            margin-top: -.3em
        }

        li.task-list-item {
            list-style: none
        }

        input.task-list-item-checkbox {
            margin: 0 .35em .25em -1.6em;
            vertical-align: middle
        }

        .issue a.respec-gh-label {
            padding: 5px;
            margin: 0 2px 0 2px;
            font-size: 10px;
            text-transform: none;
            text-decoration: none;
            font-weight: 700;
            border-radius: 4px;
            position: relative;
            bottom: 2px;
            border: none;
            display: inline-block
        }
    </style>
    <style>
        pre.idl {
            padding: 1em;
            position: relative
        }

        pre.idl>code {
            color: #000;
            color: var(--text, #000)
        }

        @media print {
            pre.idl {
                white-space: pre-wrap
            }
        }

        .idlHeader {
            display: block;
            width: 150px;
            background: #8ccbf2;
            background: var(--def-border, #8ccbf2);
            color: #fff;
            color: var(--defrow-border, #fff);
            font-family: sans-serif;
            font-weight: 700;
            margin: -1em 0 1em -1em;
            height: 28px;
            line-height: 28px
        }

        .idlHeader a.self-link {
            margin-left: .3cm;
            text-decoration: none;
            border-bottom: none;
            color: inherit
        }

        .idlID {
            font-weight: 700;
            color: #005a9c
        }

        .idlType {
            color: #005a9c
        }

        .idlName {
            color: #ff4500
        }

        .idlName a {
            color: #ff4500;
            border-bottom: 1px dotted #ff4500;
            text-decoration: none
        }

        a.idlEnumItem {
            color: #000;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        .idlSuperclass {
            font-style: italic;
            color: #005a9c
        }

        .idlDefaultValue,
        .idlParamName {
            font-style: italic
        }

        .extAttr {
            color: #666
        }

        .idlSectionComment {
            color: gray
        }

        .idlIncludes a {
            font-weight: 700
        }

        .respec-button-copy-paste:focus {
            text-decoration: none;
            border-color: #51a7e8;
            outline: 0;
            box-shadow: 0 0 5px rgba(81, 167, 232, .5)
        }

        .respec-button-copy-paste:is(:focus:hover, .selected:focus) {
            border-color: #51a7e8
        }

        .respec-button-copy-paste:is(:hover, :active, .zeroclipboard-is-hover, .zeroclipboard-is-active) {
            text-decoration: none;
            background-color: #ddd;
            background-image: linear-gradient(#eee, #ddd);
            border-color: #ccc
        }

        .respec-button-copy-paste:is(:active, .selected, .zeroclipboard-is-active) {
            background-color: #dcdcdc;
            background-image: none;
            border-color: #b5b5b5;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, .15)
        }

        .respec-button-copy-paste.selected:hover {
            background-color: #cfcfcf
        }

        .respec-button-copy-paste:is(:disabled, :disabled:hover, .disabled, .disabled:hover) {
            color: rgba(102, 102, 102, .5);
            cursor: default;
            background-color: rgba(229, 229, 229, .5);
            background-image: none;
            border-color: rgba(197, 197, 197, .5);
            box-shadow: none
        }

        @media print {
            .respec-button-copy-paste {
                visibility: hidden
            }
        }
    </style>
    <style>
        dfn {
            cursor: pointer
        }

        .dfn-panel {
            position: absolute;
            z-index: 35;
            min-width: 300px;
            max-width: 500px;
            padding: .5em .75em;
            margin-top: .6em;
            font-family: "Helvetica Neue", sans-serif;
            font-size: small;
            background: #fff;
            background: var(--indextable-hover-bg, #fff);
            color: #000;
            color: var(--text, #000);
            box-shadow: 0 1em 3em -.4em rgba(0, 0, 0, .3), 0 0 1px 1px rgba(0, 0, 0, .05);
            box-shadow: 0 1em 3em -.4em var(--tocsidebar-shadow, rgba(0, 0, 0, .3)), 0 0 1px 1px var(--tocsidebar-shadow, rgba(0, 0, 0, .05));
            border-radius: 2px
        }

        .dfn-panel:not(.docked)>.caret {
            position: absolute;
            top: -9px
        }

        .dfn-panel:not(.docked)>.caret::after,
        .dfn-panel:not(.docked)>.caret::before {
            content: "";
            position: absolute;
            border: 10px solid transparent;
            border-top: 0;
            border-bottom: 10px solid #fff;
            border-bottom-color: var(--indextable-hover-bg, #fff);
            top: 0
        }

        .dfn-panel:not(.docked)>.caret::before {
            border-bottom: 9px solid #a2a9b1;
            border-bottom-color: var(--indextable-hover-bg, #a2a9b1)
        }

        .dfn-panel * {
            margin: 0
        }

        .dfn-panel b {
            display: block;
            color: #000;
            color: var(--text, #000);
            margin-top: .25em
        }

        .dfn-panel ul a[href] {
            color: #333;
            color: var(--text, #333)
        }

        .dfn-panel>div {
            display: flex
        }

        .dfn-panel a.self-link {
            font-weight: 700;
            margin-right: auto
        }

        .dfn-panel .marker {
            padding: .1em;
            margin-left: .5em;
            border-radius: .2em;
            text-align: center;
            white-space: nowrap;
            font-size: 90%;
            color: #040b1c
        }

        .dfn-panel .marker.dfn-exported {
            background: #d1edfd;
            box-shadow: 0 0 0 .125em #1ca5f940
        }

        .dfn-panel .marker.idl-block {
            background: #8ccbf2;
            box-shadow: 0 0 0 .125em #0670b161
        }

        .dfn-panel a:not(:hover) {
            text-decoration: none !important;
            border-bottom: none !important
        }

        .dfn-panel a[href]:hover {
            border-bottom-width: 1px
        }

        .dfn-panel ul {
            padding: 0
        }

        .dfn-panel li {
            margin-left: 1em
        }

        .dfn-panel.docked {
            position: fixed;
            left: .5em;
            top: unset;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - .75em * 2 - .5em - .2em * 2);
            max-height: 30vh;
            overflow: auto
        }
    </style>

    <title>ポインターロック 2.0</title>



    <style id="respec-mainstyle">
        @keyframes pop {
            0% {
                transform: scale(1, 1)
            }

            25% {
                transform: scale(1.25, 1.25);
                opacity: .75
            }

            100% {
                transform: scale(1, 1)
            }
        }

        a.internalDFN {
            color: inherit;
            border-bottom: 1px solid #99c;
            text-decoration: none
        }

        a.externalDFN {
            color: inherit;
            border-bottom: 1px dotted #ccc;
            text-decoration: none
        }

        a.bibref {
            text-decoration: none
        }

        .respec-offending-element:target {
            animation: pop .25s ease-in-out 0s 1
        }

        .respec-offending-element,
        a[href].respec-offending-element {
            text-decoration: red wavy underline
        }

        @supports not (text-decoration:red wavy underline) {
            .respec-offending-element:not(pre) {
                display: inline-block
            }

            .respec-offending-element {
                background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x
            }
        }

        #references :target {
            background: #eaf3ff;
            animation: pop .4s ease-in-out 0s 1
        }

        cite .bibref {
            font-style: normal
        }

        a[href].orcid {
            padding-left: 4px;
            padding-right: 4px
        }

        a[href].orcid>svg {
            margin-bottom: -2px
        }

        ol.tof,
        ul.tof {
            list-style: none outside none
        }

        .caption {
            margin-top: .5em;
            font-style: italic
        }

        #issue-summary>ul {
            column-count: 2
        }

        #issue-summary li {
            list-style: none;
            display: inline-block
        }

        details.respec-tests-details {
            margin-left: 1em;
            display: inline-block;
            vertical-align: top
        }

        details.respec-tests-details>* {
            padding-right: 2em
        }

        details.respec-tests-details[open] {
            z-index: 999999;
            position: absolute;
            border: thin solid #cad3e2;
            border-radius: .3em;
            background-color: #fff;
            padding-bottom: .5em
        }

        details.respec-tests-details[open]>summary {
            border-bottom: thin solid #cad3e2;
            padding-left: 1em;
            margin-bottom: 1em;
            line-height: 2em
        }

        details.respec-tests-details>ul {
            width: 100%;
            margin-top: -.3em
        }

        details.respec-tests-details>li {
            padding-left: 1em
        }

        .self-link:hover {
            opacity: 1;
            text-decoration: none;
            background-color: transparent
        }

        aside.example .marker>a.self-link {
            color: inherit
        }

        .header-wrapper {
            display: flex;
            align-items: baseline
        }

        :is(h2, h3, h4, h5, h6):not(#toc>h2, #abstract>h2, #sotd>h2, .head>h2) {
            position: relative;
            left: -.5em
        }

        :is(h2, h3, h4, h5, h6):not(#toch2)+a.self-link {
            color: inherit;
            order: -1;
            position: relative;
            left: -1.1em;
            font-size: 1rem;
            opacity: .5
        }

        :is(h2, h3, h4, h5, h6)+a.self-link::before {
            content: "§";
            text-decoration: none;
            color: var(--heading-text)
        }

        :is(h2, h3)+a.self-link {
            top: -.2em
        }

        :is(h4, h5, h6)+a.self-link::before {
            color: #000
        }

        @media (max-width:767px) {
            dd {
                margin-left: 0
            }
        }

        @media print {
            .removeOnSave {
                display: none
            }
        }
    </style>


    <meta name="color-scheme" content="light">
    <meta name="revision" content="0e99fcf3daa23269bf2b019f5269a154088d2347">
    <link rel="canonical" href="https://www.w3.org/TR/pointerlock-2/">
    <style>
        .hljs {
            --base: #fafafa;
            --mono-1: #383a42;
            --mono-2: #686b77;
            --mono-3: #717277;
            --hue-1: #0b76c5;
            --hue-2: #336ae3;
            --hue-3: #a626a4;
            --hue-4: #42803c;
            --hue-5: #ca4706;
            --hue-5-2: #c91243;
            --hue-6: #986801;
            --hue-6-2: #9a6a01
        }

        @media (prefers-color-scheme:dark) {
            .hljs {
                --base: #282c34;
                --mono-1: #abb2bf;
                --mono-2: #818896;
                --mono-3: #5c6370;
                --hue-1: #56b6c2;
                --hue-2: #61aeee;
                --hue-3: #c678dd;
                --hue-4: #98c379;
                --hue-5: #e06c75;
                --hue-5-2: #be5046;
                --hue-6: #d19a66;
                --hue-6-2: #e6c07b
            }
        }

        .hljs {
            display: block;
            overflow-x: auto;
            padding: .5em;
            color: #383a42;
            color: var(--mono-1, #383a42);
            background: #fafafa;
            background: var(--base, #fafafa)
        }

        .hljs-comment,
        .hljs-quote {
            color: #717277;
            color: var(--mono-3, #717277);
            font-style: italic
        }

        .hljs-doctag,
        .hljs-formula,
        .hljs-keyword {
            color: #a626a4;
            color: var(--hue-3, #a626a4)
        }

        .hljs-deletion,
        .hljs-name,
        .hljs-section,
        .hljs-selector-tag,
        .hljs-subst {
            color: #ca4706;
            color: var(--hue-5, #ca4706);
            font-weight: 700
        }

        .hljs-literal {
            color: #0b76c5;
            color: var(--hue-1, #0b76c5)
        }

        .hljs-addition,
        .hljs-attribute,
        .hljs-meta-string,
        .hljs-regexp,
        .hljs-string {
            color: #42803c;
            color: var(--hue-4, #42803c)
        }

        .hljs-built_in,
        .hljs-class .hljs-title {
            color: #9a6a01;
            color: var(--hue-6-2, #9a6a01)
        }

        .hljs-attr,
        .hljs-number,
        .hljs-selector-attr,
        .hljs-selector-class,
        .hljs-selector-pseudo,
        .hljs-template-variable,
        .hljs-type,
        .hljs-variable {
            color: #986801;
            color: var(--hue-6, #986801)
        }

        .hljs-bullet,
        .hljs-link,
        .hljs-meta,
        .hljs-selector-id,
        .hljs-symbol,
        .hljs-title {
            color: #336ae3;
            color: var(--hue-2, #336ae3)
        }

        .hljs-emphasis {
            font-style: italic
        }

        .hljs-strong {
            font-weight: 700
        }

        .hljs-link {
            text-decoration: underline
        }
    </style>
    <style>
        var {
            position: relative;
            cursor: pointer
        }

        var[data-type]::after,
        var[data-type]::before {
            position: absolute;
            left: 50%;
            top: -6px;
            opacity: 0;
            transition: opacity .4s;
            pointer-events: none
        }

        var[data-type]::before {
            content: "";
            transform: translateX(-50%);
            border-width: 4px 6px 0 6px;
            border-style: solid;
            border-color: transparent;
            border-top-color: #222
        }

        var[data-type]::after {
            content: attr(data-type);
            transform: translateX(-50%) translateY(-100%);
            background: #222;
            text-align: center;
            font-family: "Dank Mono", "Fira Code", monospace;
            font-style: normal;
            padding: 6px;
            border-radius: 3px;
            color: #daca88;
            text-indent: 0;
            font-weight: 400
        }

        var[data-type]:hover::after,
        var[data-type]:hover::before {
            opacity: 1
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
  "specStatus": "WD",
  "caniuse": "pointerlock",
  "previousPublishDate": "2024-05-16",
  "previousMaturity": "WD",
  "testSuiteURI": "https://github.com/web-platform-tests/wpt/tree/master/pointerlock",
  "editors": [
    {
      "name": "Mustaq Ahmed",
      "company": "Google",
      "companyURL": "http://www.google.com/",
      "w3cid": "75206"
    },
    {
      "name": "Vincent Scheib",
      "url": "http://www.scheib.net",
      "company": "Google",
      "companyURL": "http://www.google.com/",
      "w3cid": "49724"
    }
  ],
  "formerEditors": [
    {
      "name": "Navid Zolghadr",
      "company": "Google",
      "companyURL": "http://www.google.com/",
      "w3cid": "92361"
    }
  ],
  "github": "w3c/pointerlock",
  "group": "webapps",
  "xref": {
    "specs": [
      "uievents"
    ],
    "profile": "web-platform"
  },
  "shortName": "pointerlock-2",
  "gitRevision": "0e99fcf3daa23269bf2b019f5269a154088d2347",
  "publishDate": "2024-06-17",
  "publishISODate": "2024-06-17T00:00:00.000Z",
  "generatedSubtitle": "W3C Working Draft 17 June 2024"
}</script>
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD">
</head>

<body data-cite="WEBIDL uievents uievents HTML INFRA URL WEBIDL DOM FETCH" class="h-entry">
    <div class="head">
        <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48"
                    src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
            </a></p>
        <h1 id="title" class="title">ポインターロック 2.0</h1>
        <p id="w3c-state"><a href="https://www.w3.org/standards/types#WD">W3C 作業草案</a> <time class="dt-published"
                datetime="2024-06-17">2024年6月17日</time></p>
        <details open="">
            <summary>この文書についての詳細</summary>
            <dl>
                <dt>このバージョン：</dt>
                <dd>
                    <a class="u-url"
                        href="https://www.w3.org/TR/2024/WD-pointerlock-2-20240617/">https://www.w3.org/TR/2024/WD-pointerlock-2-20240617/</a>
                </dd>
                <dt>最新の公表バージョン：</dt>
                <dd>
                    <a href="https://www.w3.org/TR/pointerlock-2/">https://www.w3.org/TR/pointerlock-2/</a>
                </dd>
                <dt>最新の編集者草案：</dt>
                <dd><a href="https://w3c.github.io/pointerlock/">https://w3c.github.io/pointerlock/</a></dd>
                <dt>履歴：</dt>
                <dd>
                    <a
                        href="https://www.w3.org/standards/history/pointerlock-2/">https://www.w3.org/standards/history/pointerlock-2/</a>
                </dd>
                <dd>
                    <a href="https://github.com/w3c/pointerlock/commits/">コミット履歴</a>
                </dd>
                <dt>テストスイート：</dt>
                <dd><a
                        href="https://github.com/web-platform-tests/wpt/tree/master/pointerlock">https://github.com/web-platform-tests/wpt/tree/master/pointerlock</a>
                </dd>




                <dt>編集者：</dt>
                <dd class="editor p-author h-card vcard" data-editor-id="75206">
                    <span class="p-name fn">Mustaq Ahmed</span> (<a class="p-org org h-org"
                        href="https://www.google.com/">Google</a>)
                </dd>
                <dd class="editor p-author h-card vcard" data-editor-id="49724">
                    <a class="u-url url p-name fn" href="http://www.scheib.net">Vincent Scheib</a> (<a
                        class="p-org org h-org" href="https://www.google.com/">Google</a>)
                </dd>
                <dt>
                    以前の編集者：
                </dt>
                <dd class="editor p-author h-card vcard" data-editor-id="92361">
                    <span class="p-name fn">Navid Zolghadr</span> (<a class="p-org org h-org"
                        href="https://www.google.com/">Google</a>)
                </dd>

                <dt>フィードバック：</dt>
                <dd>
                    <a href="https://github.com/w3c/pointerlock/">GitHub w3c/pointerlock</a>
                    (<a href="https://github.com/w3c/pointerlock/pulls/">プルリクエスト</a>,
                    <a href="https://github.com/w3c/pointerlock/issues/new/choose">新しい課題</a>,
                    <a href="https://github.com/w3c/pointerlock/issues/">オープン課題</a>)
                </dd>


                <dt class="caniuse-title">ブラウザー対応状況：</dt>
                <dd class="caniuse-stats"><a href="https://caniuse.com/pointerlock">caniuse.com</a></dd>
            </dl>
        </details>


        <p class="copyright">
            <a href="https://www.w3.org/policies/#copyright">Copyright</a>
            ©
            2024

            <a href="https://www.w3.org/">World Wide Web Consortium</a>.
            <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
            <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
            <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
            <a rel="license" href="https://www.w3.org/copyright/software-license-2023/"
                title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
        </p>
        <hr title="Separator for header">
    </div>
    <section id="abstract" class="introductory">
        <h2>概要</h2>
        この仕様は、スクリプトによる生のマウス移動データへのアクセスを提供するAPIを定義し、マウスイベントのターゲットを1つの要素にロックし、カーソルを非表示にします。これは、特定の種類のアプリケーション、特に一人称視点の3Dアプリケーションや3Dモデリングソフトウェアにとって不可欠な入力モードです。
    </section>
    <section id="sotd" class="introductory">
        <h2>この文書のステータス</h2>
        <p><em>このセクションは、この文書が公開された時点でのステータスを説明しています。現在の<abbr title="World Wide Web Consortium">W3C</abbr>
                公開物の一覧と、この技術レポートの最新改訂版は、<a href="https://www.w3.org/TR/"><abbr
                        title="World Wide Web Consortium">W3C</abbr> 技術レポート索引</a>にて
                https://www.w3.org/TR/ で確認できます。</em></p>

        <p>
            この文書の変更履歴は <a
                href="https://github.com/w3c/pointerlock/commits/gh-pages/index.html">https://github.com/w3c/pointerlock/commits/gh-pages/index.html</a>
            で確認できます。
        </p>
        <p>
            2016年10月27日付 <a href="https://www.w3.org/TR/2016/WD-pointerlock-2-20161122/"><abbr
                    title="World Wide Web Consortium">W3C</abbr>
                勧告</a> 以降の変更点の概要：
        </p>
        <ul>
            <li>
                <a href="https://github.com/w3c/pointerlock/commit/027f57ae80cf5bdb03379203828aa234f3e7e433">
                    IDLブロックを更新</a>し、機械で<a
                    href="https://github.com/w3c/pointerlock/issues/13">パース可能</a>になりましたが、実質的な変更はありません。
            </li>
        </ul>
        <p>
            この文書は、<a href="https://www.w3.org/groups/wg/webapps">Web Applications Working
                Group</a> によって、
            <a href="https://www.w3.org/2023/Process-20231103/#recs-and-notes">勧告プロセス</a>に基づく作業草案として公開されました。
        </p>
        <p>作業草案としての公開は、<abbr title="World Wide Web Consortium">W3C</abbr>およびそのメンバーによる承認を意味するものではありません。</p>
        <p>
            この文書はドラフトであり、随時更新、差し替え、廃止される可能性があります。他の文書として引用するのは適切ではなく、進行中の作業として扱ってください。

        </p>
        <p>

            この文書は、
            <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr>
                特許ポリシー</a>
            の下で運営されているグループによって作成されました。


            <abbr title="World Wide Web Consortium">W3C</abbr>は、
            <a rel="disclosure" href="https://www.w3.org/groups/wg/webapps/ipr">特許開示の公開リスト</a>
            をグループの成果物に関連して管理しています。また、そのページには特許を開示する方法も記載されています。ある個人が、<a
                href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">必須クレーム</a>
            を含むと考える特許を実際に知っている場合、
            <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">W3C特許ポリシー第6節</a>に従い情報を開示しなければなりません。

        </p>
        <p>
            この文書は
            <a id="w3c_process_revision" href="https://www.w3.org/2023/Process-20231103/">2023年11月3日 <abbr
                    title="World Wide Web Consortium">W3C</abbr>プロセス文書</a>によって管理されています。
        </p>
    </section>
    <nav id="toc">
        <h2 class="introductory" id="table-of-contents">目次</h2>
        <ol class="toc">
            <li class="tocline"><a class="tocxref" href="#abstract">概要</a></li>
            <li class="tocline"><a class="tocxref" href="#sotd">この文書のステータス</a></li>
            <li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>
                    はじめに
                </a></li>
            <li class="tocline"><a class="tocxref" href="#pointer-lock-and-interfaces"><bdi class="secno">2. </bdi>
                    ポインターロックとインターフェース
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#the-pointer-lock-state-definition"><bdi
                                class="secno">2.1 </bdi>
                            <span>pointer lock state</span> の定義
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#pointerlockoptions-dictionary"><bdi class="secno">2.2
                            </bdi>
                            <code>PointerLockOptions</code> 辞書
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#pointerlockchange-and-pointerlockerror-events"><bdi
                                class="secno">2.3 </bdi>
                            <code>pointerlockchange</code> および <code>pointerlockerror</code> イベント
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#exit-pointer-lock"><bdi class="secno">2.4 </bdi>
                            <span>ポインターロックの解除</span>
                        </a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#requestPointerLock"><bdi class="secno">3. </bdi>
                    <code>Element</code> インターフェースの拡張
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-the-document-interface"><bdi class="secno">4.
                    </bdi>
                    <code>Document</code> インターフェースの拡張
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-the-documentorshadowroot-mixin"><bdi
                        class="secno">5. </bdi>
                    <code>DocumentOrShadowRoot</code> ミックスインの拡張
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-the-mouseevent-interface"><bdi class="secno">6.
                    </bdi>
                    <code>MouseEvent</code> インターフェースの拡張
                </a></li>
            <li class="tocline"><a class="tocxref" href="#extensions-to-the-mouseeventinit-dictionary"><bdi
                        class="secno">7. </bdi>
                    <code>MouseEventInit</code> 辞書の拡張
                </a></li>
            <li class="tocline"><a class="tocxref" href="#requirements"><bdi class="secno">8. </bdi>
                    要件
                </a></li>
            <li class="tocline"><a class="tocxref" href="#use-cases"><bdi class="secno">9. </bdi>
                    ユースケース
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref"
                            href="#relative-view-port-rotation-of-free-moving-virtual-actors"><bdi class="secno">9.1
                            </bdi>
                            自由に動く仮想アクターの相対的なビューポート回転
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#free-rotation-of-3d-models-or-panning-of-2d-layers"><bdi class="secno">9.2 </bdi>
                            3Dモデルの自由回転または2Dレイヤーのパン
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#relative-movement-of-actors"><bdi class="secno">9.3
                            </bdi>
                            アクターの相対移動
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#jog-movement-over-spinner-controls"><bdi
                                class="secno">9.4 </bdi>
                            スピナーコントロール上でのジョグ移動
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#synthetic-cursor-interaction-with-html-dom-ui"><bdi
                                class="secno">9.5 </bdi>
                            HTML DOM UI との合成カーソル操作
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#view-port-panning-by-moving-a-mouse-cursor-against-the-bounds-of-a-view-port"><bdi
                                class="secno">9.6 </bdi>
                            ビューポート境界に対してマウスカーソルを動かすことによるビューポートのパン
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#game-lobby-timer-based-pointer-lock"><bdi
                                class="secno">9.7 </bdi>
                            ゲームロビー、タイマーによるポインターロック
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#game-portal"><bdi class="secno">9.8 </bdi>
                            ゲームポータル
                        </a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#security"><bdi class="secno">10. </bdi>
                    セキュリティ
                </a></li>
            <li class="tocline"><a class="tocxref" href="#frequently-asked-questions"><bdi class="secno">11. </bdi>
                    よくある質問
                </a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#why-not-merge-with-mouse-capture-setcapture"><bdi
                                class="secno">11.1 </bdi>
                            Mouse Capture: setCapture() と統合しない理由
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#why-not-repurpose-mouseevent-s-clientx-y-screenx-y"><bdi class="secno">11.2 </bdi>
                            MouseEvent の .clientX/Y .screenX/Y を再利用しない理由
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#why-use-movementx-y-instead-of-deltax-y"><bdi
                                class="secno">11.3 </bdi>
                            .movementX/Y を .deltaX/Y の代わりに使う理由
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#why-bundle"><bdi class="secno">11.4 </bdi>
                            すべての機能（カーソルの非表示、マウスデルタの提供）をまとめている理由（CSSでカーソルを非表示にしたり、常にデルタ値を提供したり、カーソル移動をウェブページの一部に制限するAPIを提供するのではなく）
                        </a></li>
                    <li class="tocline"><a class="tocxref" href="#high-resolution-deltas-high-frequency-updates"><bdi
                                class="secno">11.5 </bdi>
                            高解像度デルタ／高頻度アップデート？
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#why-modify-mouseevent-and-reuse-existing-mouse-events-instead-of-creating-a-mouse-delta-event"><bdi
                                class="secno">11.6 </bdi>
                            MouseEvent を修正して既存のマウスイベントを再利用し、マウスデルタイベントを新たに作成しない理由
                        </a></li>
                    <li class="tocline"><a class="tocxref"
                            href="#why-separate-targets-for-mouse-events-under-pointer-lock-and-keyboard-input-focus"><bdi
                                class="secno">11.7 </bdi>
                            ポインターロック下のマウスイベントとキーボード入力フォーカスのターゲットを分ける理由
                        </a></li>
                </ol>
            </li>
            <li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">12. </bdi>適合性</a></li>
            <li class="tocline"><a class="tocxref" href="#acknowledgments"><bdi class="secno">A. </bdi>
                    謝辞
                </a></li>
            <li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>参考文献</a>
                <ol class="toc">
                    <li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1
                            </bdi>規範的参考文献</a></li>
                    <li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">B.2
                            </bdi>参考情報文献</a></li>
                </ol>
            </li>
        </ol>
    </nav>
    <section id="introduction" class="informative">
        <div class="header-wrapper">
            <h2 id="x1-introduction"><bdi class="secno">1. </bdi>
                はじめに
            </h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a>
        </div>
        <p><em>このセクションは規範的ではありません。</em></p>

        <p>
            Pointer Lock
            APIは、アプリケーションがマウスカーソルの位置を読み取るだけでなく、マウスの動きを直接入力手段として解釈する機能を提供します。一般的な例としては、三次元グラフィックスアプリケーション（例：ゲーム）における一人称の操作があります。マウスの動きがプレイヤーのカメラの回転や方向制御に利用され、マウスカーソルは表示されません。また、マウスカーソルが通常制限される従来の境界（ユーザーエージェントのウィンドウや画面全体など）に縛られず、マウスの動きを任意の方向に無制限で追跡できます。
        </p>
        <p>
            Pointer LockはMouse Capture［<cite><a class="bibref" data-link-type="biblio" href="#bib-mdn-setcapture"
                    title="Element.setCapture()">MDN-SETCAPTURE</a></cite>］（Mouse Captureは仕様未定義：バグ <a
                href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=14600">14600</a>）と関連しています。Captureは、マウスをドラッグ中にターゲット要素へのイベント配信を継続しますが、マウスボタンが離されると終了します。Pointer
            Lockは、継続的であり、画面の境界に制限されず、マウスボタンの状態に関係なくイベントを送信し、カーソルを非表示にし、API呼び出しやユーザーによる特定の<a
                href="#dfn-default-unlock-gesture" class="internalDFN" data-link-type="dfn"
                id="ref-for-dfn-default-unlock-gesture-1">デフォルト解除ジェスチャー</a>まで解除されません。
        </p>
        <p>
            Pointer Lockは単一のリソースをキャプチャし、それを単一の要素に関連付ける処理を扱います。これはFullscreen API［<cite><a class="bibref"
                    data-link-type="biblio" href="#bib-fullscreen"
                    title="Fullscreen API Standard">FULLSCREEN</a></cite>］と類似しており、Fullscreen
            APIは単一要素をフルスクリーン化します。Pointer Lock APIは、リソースのキャプチャ、状態変更、解除APIの設計を可能な限りFullscreen APIに倣っています。
        </p>
        <p>
            Pointer Lockのインタラクションモードは、以前はmouse
            lockと呼ばれていました。名前が変更されたのは、マウス以外にも様々なコントローラーが画面上のカーソルを操作できるためであり、それらも影響を受けるからです。
        </p>
    </section>
    <section id="pointer-lock-and-interfaces">
        <div class="header-wrapper">
            <h2 id="x2-pointer-lock-and-interfaces"><bdi class="secno">2. </bdi>
                ポインターロックとインターフェース
            </h2><a class="self-link" href="#pointer-lock-and-interfaces" aria-label="Permalink for Section 2."></a>
        </div>

        <section id="the-pointer-lock-state-definition">
            <div class="header-wrapper">
                <h3 id="x2-1-the-pointer-lock-state-definition"><bdi class="secno">2.1 </bdi>
                    <dfn id="dfn-pointer-lock-state" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">pointer
                        lock state</dfn> の定義
                </h3><a class="self-link" href="#the-pointer-lock-state-definition"
                    aria-label="Permalink for Section 2.1"></a>
            </div>

            <p>
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-state-1">pointer lock state</a>は、単一のDOM要素（<dfn
                    id="dfn-pointer-lock-target" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">pointer-lock
                    target</dfn>）が全てのマウスイベントを受け取り、カーソルが非表示となる状態です。
            </p>
            <p>
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-state-2">pointer lock state</a>に入ると、<a data-link-type="dfn|abstract-op"
                    href="#dfn-user-agent" class="internalDFN" id="ref-for-dfn-user-agent-1">ユーザーエージェント</a>は
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-target-1">pointer-lock target</a>、
                <dfn id="dfn-pointer-lock-options" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">pointer-lock
                    options</dfn>
                （<a data-link-type="idl" data-lt="PointerLockOptions" href="#dom-pointerlockoptions" class="internalDFN"
                    id="ref-for-dom-pointerlockoptions-1"><code>PointerLockOptions</code></a>）、
                <dfn id="dfn-cursor-position" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">cursor
                    position</dfn>（Pointer Lock Stateに入った時点のシステムマウスカーソルの位置（<code>screenX</code>,
                <code>screenY</code>）を表す数値のペア）を持ちます。<a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                    class="internalDFN" id="ref-for-dfn-pointer-lock-target-2">pointer-lock target</a>は、ユーザーが生成した全ての<a
                    data-link-type="idl" data-lt="MouseEvent" data-type="interface"
                    href="https://www.w3.org/TR/uievents/#mouseevent"><code>MouseEvent</code></a>イベント（<code>mousemove</code>,
                <code>mousedown</code>, <code>mouseup</code>, <code>click</code>,
                <code>dblclick</code>, <code>auxclick</code>, <code>wheel</code>［<cite><a class="bibref"
                        data-link-type="biblio" href="#bib-ui-events"
                        title="UI Events">ui-events</a></cite>］）を受け取ります。他の要素は、<a data-link-type="dfn|abstract-op"
                    href="#dfn-pointer-lock-state" class="internalDFN" id="ref-for-dfn-pointer-lock-state-3">pointer
                    lock state</a>中はこれらのイベントを受け取りません。マウスカーソルの概念が必要なイベント（<code>mouseenter</code>,
                <code>mouseleave</code>, <code>mouseover</code>, <code>mouseout</code>,
                <code>drag</code>, <code>drop</code>）のディスパッチは行われません。
            </p>
            <div class="issue" id="issue-container-number-97">
                <div role="heading" class="issue-title marker" id="h-issue" aria-level="4"><a
                        href="https://github.com/w3c/pointerlock/issues/97"><span class="issue-number">Issue
                            97</span></a><span class="issue-label">: セクション2.1はポインターイベントへのロックの影響も記載するべき</span></div>
                <p dir="auto">この内容は<a href="https://github.com/w3c/pointerlock/pull/49#discussion_r468133933"
                        data-hovercard-type="pull_request"
                        data-hovercard-url="/w3c/pointerlock/pull/49/hovercard">この議論</a>
                    (<a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="468848569"
                        data-permission-text="Title is private" data-url="https://github.com/w3c/pointerlock/issues/49"
                        data-hovercard-type="pull_request" data-hovercard-url="/w3c/pointerlock/pull/49/hovercard"
                        href="https://github.com/w3c/pointerlock/pull/49">#49</a>) で挙がりました：</p>
                <blockquote>
                    <p dir="auto">例だけでなく、これらのイベントを規範的にリストアップすることは可能ですか？</p>
                    <p dir="auto">現状の文章でも問題ありませんが、精度不足はマウスイベント全体の仕様の不十分さの表れでもあります。<a class="issue-link js-issue-link"
                            data-error-text="Failed to load title" data-id="312692962"
                            data-permission-text="Title is private"
                            data-url="https://github.com/w3c/uievents/issues/200" data-hovercard-type="issue"
                            data-hovercard-url="/w3c/uievents/issues/200/hovercard"
                            href="https://github.com/w3c/uievents/issues/200">w3c/uievents#200</a>で進展があり次第、この段落はUI
                        Events仕様に処理モデルの実際の変更として移せるでしょう。</p>
                    <p dir="auto">一方、現状でも相互運用性のためにイベントリストを明確にすることが助けになります。</p>
                    <p dir="auto">例えば、pointer eventsがこの変更の影響を受けるかどうかは明確ではありません。</p>
                </blockquote>
            </div>
            <p></p>
            <p>
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-state-4">pointer lock state</a>中で<a data-link-type="dfn|abstract-op"
                    href="#dfn-pointer-lock-options" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-options-1">pointer-lock options</a>の
                <a data-link-type="idl" href="#dom-pointerlockoptions-unadjustedmovement" class="internalDFN"
                    id="ref-for-dom-pointerlockoptions-unadjustedmovement-1"><code>unadjustedMovement</code></a>メンバーが<code>true</code>の場合、イベント座標はマウス加速などの基盤プラットフォームの挙動に影響されません。つまり、ユーザーエージェントは基盤プラットフォームのAPIを利用して生のイベントを取得できることを保証します。<a
                    data-link-type="idl" data-lt="PointerLockOptions" href="#dom-pointerlockoptions" class="internalDFN"
                    id="ref-for-dom-pointerlockoptions-2"><code>PointerLockOptions</code></a>の
                <a data-link-type="idl" href="#dom-pointerlockoptions-unadjustedmovement" class="internalDFN"
                    id="ref-for-dom-pointerlockoptions-unadjustedmovement-2"><code>unadjustedMovement</code></a>が<code>false</code>の場合、ユーザーエージェントは基盤プラットフォームのデフォルトのマウス加速挙動に従います。
            </p>
            <p>
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-state-5">pointer lock
                    state</a>中は、システムマウスカーソルが非表示となり、ウィンドウがマウス移動やボタン操作に関係なくフォーカスを失わないようにします。これは基盤となるOS
                APIを直接または間接的に利用して実現されます。
            </p>
            <div class="note" role="note" id="issue-container-generatedID">
                <div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>注</span></div>
                <p class="">
                    アプリケーションスクリプトで生成された合成マウスイベントは、ロック状態に関係なく同じように動作します。
                </p>
            </div>
        </section>
        <section data-dfn-for="PointerLockOptions" id="pointerlockoptions-dictionary">
            <div class="header-wrapper">
                <h3 id="x2-2-pointerlockoptions-dictionary"><bdi class="secno">2.2 </bdi>
                    <code>PointerLockOptions</code> 辞書
                </h3><a class="self-link" href="#pointerlockoptions-dictionary"
                    aria-label="Permalink for Section 2.2"></a>
            </div>

            <pre class="idl def" id="webidl-1846476394"><span class="idlHeader"><a class="self-link" href="#webidl-1846476394">WebIDL</a></span><code><span data-idl="" class="idlDictionary" id="idl-def-pointerlockoptions" data-title="PointerLockOptions">dictionary <a class="internalDFN idlID" data-link-type="dictionary" href="#dom-pointerlockoptions" id="ref-for-dom-pointerlockoptions-3"><code>PointerLockOptions</code></a> {<span data-idl="" class="idlMember" id="idl-def-pointerlockoptions-unadjustedmovement" data-title="unadjustedMovement" data-dfn-for="PointerLockOptions"><span class="idlType">
  <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-pointerlockoptions-unadjustedmovement" id="ref-for-dom-pointerlockoptions-unadjustedmovement-3"><code>unadjustedMovement</code></a> = false;</span>
};</span></code></pre>
            <dl>
                <dt>
                    <dfn data-export="" data-dfn-type="dictionary" id="dom-pointerlockoptions" data-idl="dictionary"
                        data-title="PointerLockOptions" data-dfn-for="" tabindex="0"
                        aria-haspopup="dialog"><code>PointerLockOptions</code></dfn> 辞書
                </dt>
                <dd>
                    <p>
                        ロックモードでポインターの挙動をカスタマイズするためのオプション辞書です。
                    </p>
                </dd>
                <dt>
                    <dfn data-export="" data-dfn-type="dict-member" id="dom-pointerlockoptions-unadjustedmovement"
                        data-idl="field" data-title="unadjustedMovement" data-dfn-for="PointerLockOptions"
                        data-type="boolean" tabindex="0" aria-haspopup="dialog"><code>unadjustedMovement</code></dfn>
                    メンバー
                </dt>
                <dd>
                    <p>
                        この値が<code>true</code>の場合、ポインターの動きはマウス加速などの基盤プラットフォームによる変更の影響を受けません。
                    </p>
                </dd>
            </dl>
        </section>
        <section id="pointerlockchange-and-pointerlockerror-events">
            <div class="header-wrapper">
                <h3 id="x2-3-pointerlockchange-and-pointerlockerror-events"><bdi class="secno">2.3 </bdi>
                    <code>pointerlockchange</code> および <code>pointerlockerror</code> イベント
                </h3><a class="self-link" href="#pointerlockchange-and-pointerlockerror-events"
                    aria-label="Permalink for Section 2.3"></a>
            </div>

            <p>
                ポインターロック状態の変更、または状態変更時のエラーを通知するために2つのイベントがあります。イベント名は<dfn class="event" data-dfn-type="event"
                    id="dfn-pointerlockchange" tabindex="0" aria-haspopup="dialog"
                    data-export="">pointerlockchange</dfn>および<dfn class="event" data-dfn-type="event"
                    id="dfn-pointerlockerror" tabindex="0" aria-haspopup="dialog"
                    data-export="">pointerlockerror</dfn>です。詳細は
                <a href="#requestPointerLock" data-matched-text="[[[#requestPointerLock]]]" class="sec-ref"><bdi
                        class="secno">3. </bdi>
                    <code>Element</code>インターフェースの拡張</a>のアルゴリズムを参照してください。
            </p>
            <div class="note" role="note" id="issue-container-generatedID-0">
                <div role="heading" class="note-title marker" id="h-note-0" aria-level="4"><span>注</span></div>
                <p class="">
                    拡大表示ソフトウェアは画面上のコンテンツを拡大します。マウスを使って拡大表示のフォーカス位置を移動しますが、ポインターロックが開始されると、拡大表示ソフトウェアはキーボードによる移動に切り替える必要があります。<a
                        data-link-type="idl" data-lt="pointerlockchange" href="#dfn-pointerlockchange"
                        class="internalDFN" id="ref-for-dfn-pointerlockchange-1"><code>pointerlockchange</code></a>
                    イベントが発火された際、Webブラウザは画面拡大ツールなどの支援技術に確実にイベントを通知する必要があります。
                </p>
            </div>
        </section>
        <section id="exit-pointer-lock">
            <div class="header-wrapper">
                <h3 id="x2-4-exit-pointer-lock"><bdi class="secno">2.4 </bdi>
                    <dfn id="dfn-exit-pointer-lock" tabindex="0" aria-haspopup="dialog"
                        data-dfn-type="dfn">ポインターロックの解除</dfn>
                </h3><a class="self-link" href="#exit-pointer-lock" aria-label="Permalink for Section 2.4"></a>
            </div>

            <p>
                <var data-type="Element">element</var>に対してポインターロックを解除する手順は以下の通りです：
            </p>
            <ol class="algorithm">
                <li>システムマウスカーソルを再度表示し、<a data-link-type="dfn|abstract-op" href="#dfn-cursor-position"
                        class="internalDFN" id="ref-for-dfn-cursor-position-1">cursor position</a>に配置する。</li>
                <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">要素タスクをキューに追加</a>し、<a
                        data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">ユーザー操作タスクソース</a>で
                    <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-event-fire">イベント発火</a>を行い、
                    <a data-link-type="idl" data-lt="pointerlockchange" href="#dfn-pointerlockchange"
                        class="internalDFN" id="ref-for-dfn-pointerlockchange-2"><code>pointerlockchange</code></a>イベントを
                    <var data-type="Element">element</var>の<a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>で発火する。
                </li>
                <li><a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state" class="internalDFN"
                        id="ref-for-dfn-pointer-lock-state-6">pointer lock state</a>を終了し、<a
                        data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                        id="ref-for-dfn-pointer-lock-target-3">pointer-lock target</a>、<a
                        data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-options" class="internalDFN"
                        id="ref-for-dfn-pointer-lock-options-2">pointer-lock options</a>、<a
                        data-link-type="dfn|abstract-op" href="#dfn-cursor-position" class="internalDFN"
                        id="ref-for-dfn-cursor-position-2">cursor position</a>をnullに設定する。
                </li>
            </ol>
        </section>
    </section>
    <section data-dfn-for="Element" data-link-for="Element" id="requestPointerLock">
        <div class="header-wrapper">
            <h2 id="x3-extensions-to-the-element-interface"><bdi class="secno">3. </bdi>
                <code>Element</code> インターフェースの拡張
            </h2><a class="self-link" href="#requestPointerLock" aria-label="Permalink for Section 3."></a>
        </div>

        <p>
            <a data-link-type="idl" data-lt="Element" data-type="interface"
                href="https://dom.spec.whatwg.org/#element"><code>Element</code></a>インターフェースは、ポインターのロックを要求する機能が追加されています。
        </p>
        <pre class="idl def" id="webidl-1328413902"><span class="idlHeader"><a class="self-link" href="#webidl-1328413902">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-element-partial-1" data-title="Element">partial interface <a data-idl="partial" data-link-type="interface" data-title="Element" class="idlID" data-dfn-for="Element" data-type="interface" href="https://dom.spec.whatwg.org/#element">Element</a> {<span data-idl="" class="idlMethod" id="idl-def-element-requestpointerlock-options" data-title="requestPointerLock" data-dfn-for="Element"><span class="idlType">
  <a data-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise">Promise</a>&lt;<a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a>&gt;</span> <a class="internalDFN idlName" data-link-type="method" href="#dom-element-requestpointerlock" id="ref-for-dom-element-requestpointerlock-1"><code>requestPointerLock</code></a>(optional<span class="idlType"> <a data-link-type="idl" href="#dom-pointerlockoptions" class="internalDFN" id="ref-for-dom-pointerlockoptions-4"><code>PointerLockOptions</code></a></span> <span class="idlParamName">options</span> = {});</span>
};</span></code></pre>
        <div class="example" id="example-1">
            <div class="marker">
                <a class="self-link" href="#example-1">例<bdi> 1</bdi></a>
            </div>
            <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-keyword">const</span> lock_element = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"lock_element"</span>);
<span class="hljs-keyword">const</span> lock_button = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"lock"</span>);
lock_button.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-keyword">async</span> (event) =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> lock_element.requestPointerLock({ <span class="hljs-attr">unadjustedMovement</span>: <span class="hljs-literal">true</span> });
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"successfully locked!"</span>);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"lock failed with error: "</span>, e);
    }
});</code></pre>
        </div>
        <dl>
            <dt>
                requestPointerLock(<a data-link-type="idl" data-lt="PointerLockOptions" href="#dom-pointerlockoptions"
                    class="internalDFN" id="ref-for-dom-pointerlockoptions-5"><code>PointerLockOptions</code></a>
                options) メソッド
            </dt>
            <dd>
                <p>
                    <dfn id="dfn-lock-requests-queue" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">lock
                        requests queue</dfn>という名前の<a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-queue">並列キュー</a>が全てのリクエストのために使用されます。<dfn
                        data-export="" data-dfn-type="method" id="dom-element-requestpointerlock" data-idl="operation"
                        data-title="requestPointerLock()" data-dfn-for="Element" data-type="Promise"
                        data-lt="requestPointerLock()|requestPointerLock(options)"
                        data-local-lt="Element.requestPointerLock|Element.requestPointerLock()|requestPointerLock"
                        tabindex="0" aria-haspopup="dialog"><code>requestPointerLock()</code></dfn>
                    が呼び出されたとき、次の手順を実行します：
                </p>
                <ol class="algorithm">
                    <li><var data-type="Promise">promise</var>を<a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#a-new-promise">新しいPromise</a>として作成する。</li>
                    <li><a data-link-type="idl" data-type="attribute"
                            href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window"><code>window</code></a>
                        が<a data-link-type="dfn|abstract-op" data-type="event"
                            href="https://html.spec.whatwg.org/multipage/indices.html#event-focus">フォーカス</a>状態で、
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a data-link-type="dfn|abstract-op"
                            data-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including root</a>
                        が<a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document">アクティブドキュメント</a>の
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc">ブラウジングコンテキスト</a>（または
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-tree-ancestor">祖先</a>が
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context">ブラウジングコンテキスト</a>）でフォーカスがない場合：
                        <ol>
                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">要素タスクをキューに追加</a>し、
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">ユーザー操作タスクソース</a>で
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">this</a>に対して以下を実行する：
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-event-fire">イベント発火</a>
                                        <a data-link-type="idl" data-lt="pointerlockerror" href="#dfn-pointerlockerror"
                                            class="internalDFN"
                                            id="ref-for-dfn-pointerlockerror-1"><code>pointerlockerror</code></a>を
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a
                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>で発火する。
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#reject">promiseをReject</a>し、
                                        <a data-link-type="idl" data-type="exception"
                                            href="https://webidl.spec.whatwg.org/#wrongdocumenterror"><code>WrongDocumentError</code></a>
                                        <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>を返す。
                                    </li>
                                </ol>
                            </li>
                            <li><var data-type="Promise">promise</var>を返す。
                            </li>
                        </ol>
                        <div class="issue" id="issue-container-number-93">
                            <div role="heading" class="issue-title marker" id="h-issue-0" aria-level="3"><a
                                    href="https://github.com/w3c/pointerlock/issues/93"><span class="issue-number">Issue
                                        93</span></a><span class="issue-label">: 可視状態のチェック</span></div>
                            <p dir="auto">仕様ではhiddenドキュメントがpointer lockを要求できないようにすべき。</p>
                            <p dir="auto">また、ドキュメントがhiddenになった場合、pointer lockを解除する必要があります。</p>
                        </div>
                    </li>
                    <li>「関連するグローバルオブジェクト」が<a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation">一時的なアクティベーション</a>を持たず、
                        <a data-link-type="idl" data-lt="Document" data-type="interface"
                            href="https://dom.spec.whatwg.org/#document"><code>Document</code></a>が過去に
                        <a data-link-type="idl" data-lt="exitPointerLock()" href="#dom-document-exitpointerlock"
                            class="internalDFN"
                            id="ref-for-dom-document-exitpointerlock-1"><code>exitPointerLock</code></a><code>()</code>で
                        成功したpointer lockを解除したことがない場合：
                        <ol>
                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">要素タスクをキューに追加</a>し、
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">ユーザー操作タスクソース</a>で
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">this</a>に対して以下を実行する：
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-event-fire">イベント発火</a>
                                        <a data-link-type="idl" data-lt="pointerlockerror" href="#dfn-pointerlockerror"
                                            class="internalDFN"
                                            id="ref-for-dfn-pointerlockerror-2"><code>pointerlockerror</code></a>を
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a
                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>で発火する。
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#reject">promiseをReject</a>し、
                                        <a data-link-type="idl" data-lt="NotAllowedError" data-type="exception"
                                            href="https://webidl.spec.whatwg.org/#notallowederror"><code>NotAllowedError</code></a>
                                        <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>を返す。
                                    </li>
                                </ol>
                            </li>
                            <li><var data-type="Promise">promise</var>を返す。
                            </li>
                        </ol>
                        <div class="note" role="note" id="issue-container-generatedID-1">
                            <div role="heading" class="note-title marker" id="h-note-1" aria-level="3"><span>注</span>
                            </div>
                            <aside class="">
                                ひとつの<a data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/interaction.html#tracking-user-activation">ユーザーアクティベーション</a>で
                                pointer lockとフルスクリーン［<cite><a class="bibref" data-link-type="biblio"
                                        href="#bib-fullscreen"
                                        title="Fullscreen API Standard">FULLSCREEN</a></cite>］を同時に開始した場合、
                                <a data-link-type="idl" data-lt="requestPointerLock()"
                                    href="#dom-element-requestpointerlock" class="internalDFN"
                                    id="ref-for-dom-element-requestpointerlock-2"><code>requestPointerLock</code></a><code>()</code>
                                の呼び出しは、フルスクリーン要求より前に行われた場合のみ成功します。なぜならフルスクリーンは
                                <a data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/interaction.html#activation-consuming-api">一時的アクティベーション消費API</a>だからです。
                            </aside>
                        </div>
                    </li>
                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a data-link-type="dfn|abstract-op"
                            data-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>の
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set">active
                            sandboxing flag set</a>に
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://html.spec.whatwg.org/multipage/browsers.html#sandboxed-pointer-lock-browsing-context-flag">sandboxed
                            pointer lock browsing context flag</a>が設定されている場合：
                        <ol>
                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">要素タスクをキューに追加</a>し、
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">ユーザー操作タスクソース</a>で
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">this</a>に対して以下を実行する：
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-event-fire">イベント発火</a>
                                        <a data-link-type="idl" data-lt="pointerlockerror" href="#dfn-pointerlockerror"
                                            class="internalDFN"
                                            id="ref-for-dfn-pointerlockerror-3"><code>pointerlockerror</code></a>を
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a
                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>で発火する。
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#reject">promiseをReject</a>し、
                                        <a data-link-type="idl" data-lt="SecurityError" data-type="exception"
                                            href="https://webidl.spec.whatwg.org/#securityerror"><code>SecurityError</code></a>
                                        <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>を返す。
                                    </li>
                                </ol>
                            </li>
                            <li><var data-type="Promise">promise</var>を返す。
                            </li>
                        </ol>
                    </li>
                    <li>options["<a data-link-type="idl" href="#dom-pointerlockoptions-unadjustedmovement"
                            class="internalDFN"
                            id="ref-for-dom-pointerlockoptions-unadjustedmovement-4"><code>unadjustedMovement</code></a>"]
                        がtrueであり、プラットフォームが
                        <a data-link-type="idl" href="#dom-pointerlockoptions-unadjustedmovement" class="internalDFN"
                            id="ref-for-dom-pointerlockoptions-unadjustedmovement-5"><code>unadjustedMovement</code></a>を
                        サポートしていない場合：
                        <ol>
                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">要素タスクをキューに追加</a>し、
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">ユーザー操作タスクソース</a>で
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">this</a>に対して以下を実行する：
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-event-fire">イベント発火</a>
                                        <a data-link-type="idl" data-lt="pointerlockerror" href="#dfn-pointerlockerror"
                                            class="internalDFN"
                                            id="ref-for-dfn-pointerlockerror-4"><code>pointerlockerror</code></a>を
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a
                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>で発火する。
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#reject">promiseをReject</a>し、
                                        <a data-link-type="idl" data-lt="NotSupportedError" data-type="exception"
                                            href="https://webidl.spec.whatwg.org/#notsupportederror"><code>NotSupportedError</code></a>
                                        <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>を返す。
                                    </li>
                                </ol>
                            </li>
                            <li><var data-type="Promise">promise</var>を返す。
                            </li>
                        </ol>
                        <div class="issue" id="issue-container-number-90">
                            <div role="heading" class="issue-title marker" id="h-issue-1" aria-level="3"><a
                                    href="https://github.com/w3c/pointerlock/issues/90"><span class="issue-number">Issue
                                        90</span></a><span class="issue-label">:
                                    `unadjustedMovement`がサポートされているかどうかを示す静的フィールド追加の提案</span></div>
                            <p dir="auto">PR <a class="issue-link js-issue-link" data-error-text="Failed to load title"
                                    data-id="468848569" data-permission-text="Title is private"
                                    data-url="https://github.com/w3c/pointerlock/issues/49"
                                    data-hovercard-type="pull_request"
                                    data-hovercard-url="/w3c/pointerlock/pull/49/hovercard"
                                    href="https://github.com/w3c/pointerlock/pull/49">#49</a>で<code
                                    class="notranslate">PointerLockOptions</code>が導入されましたが、<code
                                    class="notranslate">PointerLockOptions</code>の<code
                                    class="notranslate">unadjustedMovement</code>は全てのプラットフォームでサポートされるわけではありません。直接利用する前にサポート可否を判定できる静的フィールドが有用です。
                            </p>
                        </div>
                    </li>
                    <li><a data-link-type="dfn|abstract-op" href="#dfn-lock-requests-queue" class="internalDFN"
                            id="ref-for-dfn-lock-requests-queue-1">lock requests queue</a>に以下の手順をエンキューする：
                        <ol>
                            <li>ユーザーエージェントの<a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                                    class="internalDFN" id="ref-for-dfn-pointerlock-target-4">pointer-lock target</a>が
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including
                                    root</a>が
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">this</a>の
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including
                                    root</a>と
                                異なる要素の場合：
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">要素タスクをキューに追加</a>し、
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">ユーザー操作タスクソース</a>で
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>に対して以下を実行する：
                                        <ol>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-event-fire">イベント発火</a>し
                                                <a data-link-type="idl" data-lt="pointerlockerror"
                                                    href="#dfn-pointerlockerror" class="internalDFN"
                                                    id="ref-for-dfn-pointerlockerror-5"><code>pointerlockerror</code></a>を
                                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#this">this</a>の<a
                                                    data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>で発火する。
                                            </li>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#reject">promiseをReject</a>し
                                                <a data-link-type="idl" data-lt="InvalidStateError"
                                                    data-type="exception"
                                                    href="https://webidl.spec.whatwg.org/#invalidstateerror"><code>InvalidStateError</code></a>
                                                <a data-link-type="idl" data-lt="DOMException" data-type="interface"
                                                    href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>を返す。
                                            </li>
                                        </ol>
                                    </li>
                                </ol>
                            </li>
                            <li>ユーザーエージェントの<a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                                    class="internalDFN" id="ref-for-dfn-pointerlock-target-5">pointer-lock target</a>の
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including
                                    root</a>が
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://webidl.spec.whatwg.org/#this">this</a>の
                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                    href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including
                                    root</a>と等しく、
                                optionsが現在の<a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-options"
                                    class="internalDFN" id="ref-for-dfn-pointer-lock-options-3">pointer-lock
                                    options</a>と
                                等しい場合：
                                <ol>
                                    <li><a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                                            class="internalDFN" id="ref-for-dfn-pointerlock-target-6">pointer-lock
                                            target</a>を
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>に設定する。
                                    </li>
                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">要素タスクをキューに追加</a>し、
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">ユーザー操作タスクソース</a>で
                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                            href="https://webidl.spec.whatwg.org/#this">this</a>に対して以下を実行する：
                                        <ol>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-event-fire">イベント発火</a>し
                                                <a data-link-type="idl" data-lt="pointerlockchange"
                                                    href="#dfn-pointerlockchange" class="internalDFN"
                                                    id="ref-for-dfn-pointerlockchange-3"><code>pointerlockchange</code></a>を
                                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#this">this</a>の<a
                                                    data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>で発火する。
                                            </li>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#resolve">promiseをResolve</a>する。
                                            </li>
                                        </ol>
                                    </li>
                                </ol>
                            </li>
                            <li><a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                                    id="ref-for-dfn-pointerlock-target-7">pointer-lock target</a>が
                                null、またはoptionsが現在の<a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-options"
                                    class="internalDFN" id="ref-for-dfn-pointer-lock-options-4">pointer-lock
                                    options</a>と
                                等しくない場合、ロックリクエストを処理し、結果に応じて以下を実行：
                                <ol>
                                    <li>ロックリクエストが失敗した場合：
                                        <ol>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">要素タスクをキューに追加</a>し、
                                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">ユーザー操作タスクソース</a>で
                                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#this">this</a>に対して以下を実行する：
                                                <ol>
                                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://dom.spec.whatwg.org/#concept-event-fire">イベント発火</a>し
                                                        <a data-link-type="idl" data-lt="pointerlockerror"
                                                            href="#dfn-pointerlockerror" class="internalDFN"
                                                            id="ref-for-dfn-pointerlockerror-6"><code>pointerlockerror</code></a>を
                                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a
                                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>で発火する。
                                                    </li>
                                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#reject">promiseをReject</a>
                                                        <a data-link-type="idl" data-lt="NotSupportedError"
                                                            data-type="exception"
                                                            href="https://webidl.spec.whatwg.org/#notsupportederror"><code>NotSupportedError</code></a>
                                                        <a data-link-type="idl" data-lt="DOMException"
                                                            data-type="interface"
                                                            href="https://webidl.spec.whatwg.org/#idl-DOMException"><code>DOMException</code></a>を返す。
                                                    </li>
                                                </ol>
                                            </li>
                                        </ol>
                                        <div class="issue" id="issue-container-number-91">
                                            <div role="heading" class="issue-title marker" id="h-issue-2"
                                                aria-level="3"><a
                                                    href="https://github.com/w3c/pointerlock/issues/91"><span
                                                        class="issue-number">Issue 91</span></a><span
                                                    class="issue-label">:
                                                    後続のrequestPointerLockが拒否された場合、既にロックされたターゲットはロック状態を解除すべきか？ </span>
                                            </div>
                                            <p dir="auto">PR <a class="issue-link js-issue-link"
                                                    data-error-text="Failed to load title" data-id="468848569"
                                                    data-permission-text="Title is private"
                                                    data-url="https://github.com/w3c/pointerlock/issues/49"
                                                    data-hovercard-type="pull_request"
                                                    data-hovercard-url="/w3c/pointerlock/pull/49/hovercard"
                                                    href="https://github.com/w3c/pointerlock/pull/49">#49</a>の
                                                <code
                                                    class="notranslate">requestPointerLock</code>アルゴリズムは、後続リクエストが失敗した場合に既存のロックターゲットがロック状態を解除すべきかの記述が抜けています。
                                            </p>
                                        </div>
                                    </li>
                                    <li>ロックリクエストが成功した場合：
                                        <ol>
                                            <li><a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-state"
                                                    class="internalDFN" id="ref-for-dfn-pointer-lock-state-7">pointer
                                                    lock state</a>に入る：
                                                <ol>
                                                    <li>ユーザーエージェントの<a data-link-type="dfn|abstract-op"
                                                            href="#dfn-pointer-lock-target" class="internalDFN"
                                                            id="ref-for-dfn-pointerlock-target-8">pointer-lock
                                                            target</a>を
                                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#this">this</a>に設定する。
                                                    </li>
                                                    <li>ユーザーエージェントの<a data-link-type="dfn|abstract-op"
                                                            href="#dfn-cursor-position" class="internalDFN"
                                                            id="ref-for-dfn-cursor-position-3">cursor position</a>を
                                                        現在のシステムマウス位置に設定する。
                                                    </li>
                                                    <li><a data-link-type="dfn|abstract-op"
                                                            href="#dfn-pointer-lock-options" class="internalDFN"
                                                            id="ref-for-dfn-pointer-lock-options-5">pointer-lock
                                                            options</a>を
                                                        optionsに設定する。
                                                    </li>
                                                </ol>
                                            </li>
                                            <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task">要素タスクをキューに追加</a>し、
                                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source">ユーザー操作タスクソース</a>で
                                                <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                    href="https://webidl.spec.whatwg.org/#this">this</a>に対して以下を実行する：
                                                <ol>
                                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://dom.spec.whatwg.org/#concept-event-fire">イベント発火</a>
                                                        <a data-link-type="idl" data-lt="pointerlockchange"
                                                            href="#dfn-pointerlockchange" class="internalDFN"
                                                            id="ref-for-dfn-pointerlockchange-4"><code>pointerlockchange</code></a>を
                                                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#this">this</a>の<a
                                                            data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://dom.spec.whatwg.org/#concept-node-document">ノードドキュメント</a>で発火する。
                                                    </li>
                                                    <li><a data-link-type="dfn|abstract-op" data-type="dfn"
                                                            href="https://webidl.spec.whatwg.org/#resolve">promiseをResolve</a>
                                                        する。
                                                    </li>
                                                </ol>
                                            </li>
                                        </ol>
                                    </li>
                                </ol>
                            </li>
                        </ol>
                        <div class="issue" id="issue-container-number-96">
                            <div role="heading" class="issue-title marker" id="h-issue-3" aria-level="3"><a
                                    href="https://github.com/w3c/pointerlock/issues/96"><span class="issue-number">Issue
                                        96</span></a><span class="issue-label">: lock requests queueの処理が不完全</span></div>
                            <p dir="auto">PR<a href="https://github.com/w3c/pointerlock/pull/49"
                                    data-hovercard-type="pull_request"
                                    data-hovercard-url="/w3c/pointerlock/pull/49/hovercard">#49</a>の
                                requestPointerLockアルゴリズムは、<code class="notranslate">lock requests queue</code>の
                                エントリがどのように処理されるかの説明が抜けています。明示的な記述がないと、すべてのエントリが同期的にデキューされるという誤った(?)仮定が残ります。</p>
                        </div>
                    </li>
                    <li><var data-type="Promise">promise</var>を返す。
                    </li>
                </ol>
                <div class="note" role="note" id="issue-container-generatedID-2">
                    <div role="heading" class="note-title marker" id="h-note-2" aria-level="3"><span>注</span></div>
                    <aside class="">
                        このアルゴリズムは現在開発中であり、今後のアップデートで変更される可能性があります。
                    </aside>
                </div>
            </dd>
        </dl>
    </section>
    <section data-dfn-for="Document" data-link-for="Document" id="extensions-to-the-document-interface">
        <div class="header-wrapper">
            <h2 id="x4-extensions-to-the-document-interface"><bdi class="secno">4. </bdi>
                <code>Document</code> インターフェースの拡張
            </h2><a class="self-link" href="#extensions-to-the-document-interface"
                aria-label="Permalink for Section 4."></a>
        </div>

        <pre class="idl def" id="webidl-131603804"><span class="idlHeader"><a class="self-link" href="#webidl-131603804">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-document-partial-1" data-title="Document">partial interface <a data-idl="partial" data-link-type="interface" data-title="Document" class="idlID" data-dfn-for="Document" data-type="interface" href="https://dom.spec.whatwg.org/#document">Document</a> {<span data-idl="" class="idlAttribute" id="idl-def-document-onpointerlockchange" data-title="onpointerlockchange" data-dfn-for="Document">
  attribute<span class="idlType"> <a data-link-type="idl" data-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-document-onpointerlockchange" id="ref-for-dom-document-onpointerlockchange-1"><code>onpointerlockchange</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-document-onpointerlockerror" data-title="onpointerlockerror" data-dfn-for="Document">
  attribute<span class="idlType"> <a data-link-type="idl" data-type="typedef" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-document-onpointerlockerror" id="ref-for-dom-document-onpointerlockerror-1"><code>onpointerlockerror</code></a>;</span><span data-idl="" class="idlMethod" id="idl-def-document-exitpointerlock" data-title="exitPointerLock" data-dfn-for="Document"><span class="idlType">
  <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined">undefined</a></span> <a class="internalDFN idlName" data-link-type="method" href="#dom-document-exitpointerlock" id="ref-for-dom-document-exitpointerlock-2"><code>exitPointerLock</code></a>();</span>
};</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-document-onpointerlockchange" data-idl="attribute"
                    data-title="onpointerlockchange" data-dfn-for="Document" data-type="EventHandler"
                    data-lt="onpointerlockchange" data-local-lt="Document.onpointerlockchange" tabindex="0"
                    aria-haspopup="dialog"><code>onpointerlockchange</code></dfn> 属性
            </dt>
            <dd>
                <p>
                    <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">イベントハンドラーIDL属性</a>であり、
                    <a data-link-type="idl" href="#dfn-pointerlockchange" class="internalDFN"
                        id="ref-for-dfn-pointerlockchange-5"><code>pointerlockchange</code></a> イベント用です。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-document-onpointerlockerror" data-idl="attribute"
                    data-title="onpointerlockerror" data-dfn-for="Document" data-type="EventHandler"
                    data-lt="onpointerlockerror" data-local-lt="Document.onpointerlockerror" tabindex="0"
                    aria-haspopup="dialog"><code>onpointerlockerror</code></dfn> 属性
            </dt>
            <dd>
                <p>
                    <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">イベントハンドラーIDL属性</a>であり、
                    <a data-link-type="idl" href="#dfn-pointerlockerror" class="internalDFN"
                        id="ref-for-dfn-pointerlockerror-7"><code>pointerlockerror</code></a> イベント用です。
                </p>
            </dd>
            <dt>
                <dfn data-export="" data-dfn-type="method" id="dom-document-exitpointerlock" data-idl="operation"
                    data-title="exitPointerLock()" data-dfn-for="Document" data-type="undefined"
                    data-lt="exitPointerLock()"
                    data-local-lt="Document.exitPointerLock|Document.exitPointerLock()|exitPointerLock" tabindex="0"
                    aria-haspopup="dialog"><code>exitPointerLock()</code></dfn> メソッド
            </dt>
            <dd>
                <ol>
                    <li>ユーザーエージェントの pointer-lock target が null の場合、何もせず戻る。
                    </li>
                    <li><a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                            id="ref-for-dfn-pointerlock-target-9">pointer-lock target</a> の <a
                            data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-shadow-including-root">shadow-including root</a>
                        が
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://webidl.spec.whatwg.org/#this">this</a> の <a data-link-type="dfn|abstract-op"
                            data-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document">node document</a>
                        と
                        異なる場合、何もせず戻る。
                    </li>
                    <li>ユーザーエージェントの <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                            class="internalDFN" id="ref-for-dfn-pointerlock-target-10">pointer-lock target</a> で <a
                            data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock" class="internalDFN"
                            id="ref-for-dfn-exit-pointer-lock-1">ポインターロックの解除</a> を行う。
                    </li>
                </ol>
            </dd>
        </dl>
    </section>
    <section data-dfn-for="DocumentOrShadowRoot" id="extensions-to-the-documentorshadowroot-mixin">
        <div class="header-wrapper">
            <h2 id="x5-extensions-to-the-documentorshadowroot-mixin"><bdi class="secno">5. </bdi>
                <code>DocumentOrShadowRoot</code> ミックスインの拡張
            </h2><a class="self-link" href="#extensions-to-the-documentorshadowroot-mixin"
                aria-label="Permalink for Section 5."></a>
        </div>

        <pre class="idl def" id="webidl-748339506"><span class="idlHeader"><a class="self-link" href="#webidl-748339506">WebIDL</a></span><code><span data-idl="" class="idlInterface mixin" id="idl-def-documentorshadowroot-partial-1" data-title="DocumentOrShadowRoot">partial interface mixin <a data-idl="partial" data-link-type="interface" data-title="DocumentOrShadowRoot" class="idlID" data-dfn-for="DocumentOrShadowRoot" data-type="interface" href="https://dom.spec.whatwg.org/#documentorshadowroot">DocumentOrShadowRoot</a> {<span data-idl="" class="idlAttribute" id="idl-def-documentorshadowroot-pointerlockelement" data-title="pointerLockElement" data-dfn-for="DocumentOrShadowRoot">
  readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://dom.spec.whatwg.org/#element">Element</a>?</span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-documentorshadowroot-pointerlockelement" id="ref-for-dom-documentorshadowroot-pointerlockelement-1"><code>pointerLockElement</code></a>;</span>
};</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-documentorshadowroot-pointerlockelement"
                    data-idl="attribute" data-title="pointerLockElement" data-dfn-for="DocumentOrShadowRoot"
                    data-type="Element" data-lt="pointerLockElement"
                    data-local-lt="DocumentOrShadowRoot.pointerLockElement" tabindex="0"
                    aria-haspopup="dialog"><code>pointerLockElement</code></dfn>
            </dt>
            <dd>
                <p>
                    ポインターがロックされている間、マウスイベントのターゲット要素を
                    <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://dom.spec.whatwg.org/#retarget">retargeting</a> した結果を返します。
                    結果の要素と <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://webidl.spec.whatwg.org/#this">this</a> 要素が同じツリーにある場合はその要素を返し、
                    それ以外の場合は null を返します。
                </p>
                <p>
                    ロックが保留中、またはポインターがアンロックされている場合は null を返します。
                </p>
                <div class="example" id="example-retarget-pointerlock">
                    <div class="marker">
                        <a class="self-link" href="#example-retarget-pointerlock">例<bdi> 2</bdi></a>
                    </div>
                    <pre aria-busy="false"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"host1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">shadow-root</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">shadow-root</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"host2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">shadow-root</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root2"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">shadow-root</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre>
                </div>
                <div class="note" role="note" id="issue-container-generatedID-3">
                    <div role="heading" class="note-title marker" id="h-note-3" aria-level="3"><span>注</span></div>
                    <p class="">
                        この例では <code>shadow-root</code> 要素は
                        <a data-link-type="dfn|abstract-op" data-type="dfn"
                            href="https://dom.spec.whatwg.org/#concept-element-shadow-root">shadow root</a>
                        インスタンスを表します（架空要素）。
                    </p>
                </div>
                <p>
                    <code>#canvas1</code> がターゲットの場合、<code>document.pointerLockElement</code> は <code>#host1</code> を返し、
                    <code>root1.pointerLockElement</code> は <code>#canvas1</code> を返します。
                    <a data-link-type="dfn|abstract-op" data-type="dfn"
                        href="https://dom.spec.whatwg.org/#retarget">retargeting</a> の結果 <code>#canvas1</code> を
                    <code>#root2</code> に対して retarget すると <code>#host1</code> になりますが、
                    <code>#host1</code> は <code>#root2</code> と同じツリーにないため、
                    <code>root2.pointerLockElement</code> は null を返します。
                </p>
            </dd>
        </dl>
    </section>
    <section data-dfn-for="MouseEvent" data-link-for="MouseEvent" data-cite="WEBIDL ui-events"
        id="extensions-to-the-mouseevent-interface">
        <div class="header-wrapper">
            <h2 id="x6-extensions-to-the-mouseevent-interface"><bdi class="secno">6. </bdi>
                <code>MouseEvent</code> インターフェースの拡張
            </h2><a class="self-link" href="#extensions-to-the-mouseevent-interface"
                aria-label="Permalink for Section 6."></a>
        </div>

        <pre class="idl def" id="webidl-1698756137"><span class="idlHeader"><a class="self-link" href="#webidl-1698756137">WebIDL</a></span><code><span data-idl="" class="idlInterface" id="idl-def-mouseevent-partial-1" data-title="MouseEvent">partial interface <a data-idl="partial" data-link-type="interface" data-title="MouseEvent" class="idlID" data-dfn-for="MouseEvent" data-type="interface" href="https://www.w3.org/TR/uievents/#mouseevent">MouseEvent</a> {<span data-idl="" class="idlAttribute" id="idl-def-mouseevent-movementx" data-title="movementX" data-dfn-for="MouseEvent">
  readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-double">double</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-mouseevent-movementx" id="ref-for-dom-mouseevent-movementx-1"><code>movementX</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-mouseevent-movementy" data-title="movementY" data-dfn-for="MouseEvent">
  readonly attribute<span class="idlType"> <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-double">double</a></span> <a class="internalDFN idlName" data-link-type="attribute" href="#dom-mouseevent-movementy" id="ref-for-dom-mouseevent-movementy-1"><code>movementY</code></a>;</span>
};</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-mouseevent-movementx" data-idl="attribute"
                    data-title="movementX" data-dfn-for="MouseEvent" data-type="double" data-lt="movementX"
                    data-local-lt="MouseEvent.movementX" tabindex="0"
                    aria-haspopup="dialog"><code>movementX</code></dfn> 属性
            </dt>
            <dt>
                <dfn data-export="" data-dfn-type="attribute" id="dom-mouseevent-movementy" data-idl="attribute"
                    data-title="movementY" data-dfn-for="MouseEvent" data-type="double" data-lt="movementY"
                    data-local-lt="MouseEvent.movementY" tabindex="0"
                    aria-haspopup="dialog"><code>movementY</code></dfn> 属性
            </dt>
            <dd>
                <p>
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-2"><code>movementX</code></a> および <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-2"><code>movementY</code></a> 属性は、ポインターの位置変化を提供します。
                    これは <code>mousemove</code> イベントごとに、前回の <code>screenX</code>, <code>screenY</code> の値と
                    今回の値の差分、すなわち <code>movementX = eNow.screenX - ePrevious.screenX</code> のように計算されます。
                </p>
                <p>
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-3"><code>movementX</code></a> および <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-3"><code>movementY</code></a> は、<code>mousemove</code>
                    以外のマウスイベントでは 0 でなければなりません。
                    すべてのモーションデータは <code>mousemove</code> イベントで配信され、例えば <code>earlierEvent</code> と
                    <code>currentEvent</code> の間で
                    <code>currentEvent.screenX - earlierEvent.screenX</code> は、2つのイベント間の <a data-link-type="idl"
                        data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-4"><code>movementX</code></a> の合計値に等しくなります。
                    ただし、ポインターがユーザーエージェントの画面境界によってクリップされた場合は例外です。
                </p>
                <p>
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-5"><code>movementX</code></a> および <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-4"><code>movementY</code></a>
                    は、ポインターロック状態に関係なく更新されなければなりません。
                </p>
                <p>
                    アンロック状態では、システムカーソルはユーザーエージェントウィンドウを出入りできます。
                    この際、ユーザーエージェントがOSのマウス移動イベントのターゲットでない場合、最新のポインタ位置は不明となり、
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-6"><code>movementX</code></a> / <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-5"><code>movementY</code></a> は計算できず、0 にしなければなりません。
                </p>
                <p>
                    ポインターロックが有効な場合、<code>clientX</code>, <code>clientY</code>, <code>screenX</code>,
                    <code>screenY</code> は
                    ポインターが動いていないかのような一定値を保ちますが、
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-7"><code>movementX</code></a> および
                    <a data-link-type="idl" data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-6"><code>movementY</code></a> は、アンロック時と同様に位置変化を提供し続けます。
                    マウスを連続して同一方向に動かし続けた場合、値に制限はありません。マウスカーソルという概念がなくなり、ウィンドウ外や画面端で制限されなくなります。
                </p>
                <p>
                    <a data-link-type="idl" data-lt="movementX" href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-9"><code>movementX</code></a> および <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-8"><code>movementY</code></a> の未初期化値は <code>0</code> です。
                </p>
                <p>
                    マウス入力が中断される（例えばマウスカーソルがウィンドウ外に出て再度別の位置で戻るなど）場合、
                    大きな movement 値が出てはいけません。ユーザーエージェントがOSからのマウス入力を受け取れないギャップが発生した場合、
                    次の <code>mousemove</code> イベントでは <a data-link-type="idl" data-lt="movementX"
                        href="#dom-mouseevent-movementx" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementx-10"><code>movementX</code></a> および <a data-link-type="idl"
                        data-lt="movementY" href="#dom-mouseevent-movementy" class="internalDFN"
                        id="ref-for-dom-mouseevent-movementy-9"><code>movementY</code></a> を <code>0</code> にしなければなりません。
                    例えばウィンドウシステムAPIでマウス離脱イベントを受信したときなどにこのギャップが発生します。
                    例外として、マウスキャプチャが有効な場合は、カーソルがウィンドウ外に出てもユーザーエージェントがマウスイベントを受信し続けることがあります。
                </p>
            </dd>
        </dl>
    </section>
    <section data-dfn-for="MouseEventInit" data-link-for="MouseEventInit" data-cite="WEBIDL ui-events"
        id="extensions-to-the-mouseeventinit-dictionary">
        <div class="header-wrapper">
            <h2 id="x7-extensions-to-the-mouseeventinit-dictionary"><bdi class="secno">7. </bdi>
                <code>MouseEventInit</code> 辞書の拡張
            </h2><a class="self-link" href="#extensions-to-the-mouseeventinit-dictionary"
                aria-label="Permalink for Section 7."></a>
        </div>

        <pre class="idl def" id="webidl-788447252"><span class="idlHeader"><a class="self-link" href="#webidl-788447252">WebIDL</a></span><code><span data-idl="" class="idlDictionary" id="idl-def-mouseeventinit-partial-1" data-title="MouseEventInit">partial dictionary <a data-idl="partial" data-link-type="dictionary" data-title="MouseEventInit" class="idlID" data-dfn-for="MouseEventInit" data-type="dictionary" href="https://www.w3.org/TR/uievents/#dictdef-mouseeventinit">MouseEventInit</a> {<span data-idl="" class="idlMember" id="idl-def-mouseeventinit-movementx" data-title="movementX" data-dfn-for="MouseEventInit"><span class="idlType">
  <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-double">double</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-mouseeventinit-movementx" id="ref-for-dom-mouseeventinit-movementx-1"><code>movementX</code></a> = 0;</span><span data-idl="" class="idlMember" id="idl-def-mouseeventinit-movementy" data-title="movementY" data-dfn-for="MouseEventInit"><span class="idlType">
  <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-double">double</a></span> <a class="internalDFN idlName" data-link-type="dict-member" href="#dom-mouseeventinit-movementy" id="ref-for-dom-mouseeventinit-movementy-1"><code>movementY</code></a> = 0;</span>
};</span></code></pre>
        <dl>
            <dt>
                <dfn data-export="" data-dfn-type="dict-member" id="dom-mouseeventinit-movementx" data-idl="field"
                    data-title="movementX" data-dfn-for="MouseEventInit" data-type="double" tabindex="0"
                    aria-haspopup="dialog"><code>movementX</code></dfn> メンバー
            </dt>
            <dt>
                <dfn data-export="" data-dfn-type="dict-member" id="dom-mouseeventinit-movementy" data-idl="field"
                    data-title="movementY" data-dfn-for="MouseEventInit" data-type="double" tabindex="0"
                    aria-haspopup="dialog"><code>movementY</code></dfn> メンバー
            </dt>
            <dd>
                <a data-link-type="idl" data-lt="movementX" href="#dom-mouseeventinit-movementx" class="internalDFN"
                    id="ref-for-dom-mouseeventinit-movementx-2"><code>movementX</code></a> および <a data-link-type="idl"
                    data-lt="movementY" href="#dom-mouseeventinit-movementy" class="internalDFN"
                    id="ref-for-dom-mouseeventinit-movementy-2"><code>movementY</code></a> メンバーは、それぞれ <a
                    data-link-type="idl" data-lt="MouseEvent" data-type="interface"
                    href="https://www.w3.org/TR/uievents/#mouseevent"><code>MouseEvent</code></a> のメンバーを初期化するために使用されます。
            </dd>
        </dl>
    </section>
    <section id="requirements">
        <div class="header-wrapper">
            <h2 id="x8-requirements"><bdi class="secno">8. </bdi>
                要件
            </h2><a class="self-link" href="#requirements" aria-label="Permalink for Section 8."></a>
        </div>

        <p>
            <dfn id="dfn-default-unlock-gesture" tabindex="0" aria-haspopup="dialog"
                data-dfn-type="dfn">デフォルト解除ジェスチャー</dfn>は常に利用可能でなければならず、<a data-link-type="dfn|abstract-op"
                href="#dfn-exit-pointer-lock" class="internalDFN" id="ref-for-dfn-exit-pointer-lock-2">ポインターロックの解除</a>を
            <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                id="ref-for-dfn-user-agent-9">ユーザーエージェント</a>の <a data-link-type="dfn|abstract-op"
                href="#dfn-pointer-lock-target" class="internalDFN" id="ref-for-dfn-pointer-lock-target-11">pointer-lock
                target</a> で行うことができなければならない。
        </p>
        <div class="note" role="note" id="issue-container-generatedID-4">
            <div role="heading" class="note-title marker" id="h-note-4" aria-level="3"><span>注</span></div>
            <aside class="">
                <p>
                    キーボード入力が可能な <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                        id="ref-for-dfn-user-agent-10">ユーザーエージェント</a>には、ESCキーが推奨される<a data-link-type="dfn|abstract-op"
                        href="#dfn-default-unlock-gesture" class="internalDFN"
                        id="ref-for-dfn-default-unlock-gesture-2">デフォルト解除ジェスチャー</a>です。解除ジェスチャーは、フルスクリーン解除に使われるものと一致することも推奨されます［<cite><a
                            class="bibref" data-link-type="biblio" href="#bib-fullscreen"
                            title="Fullscreen API Standard">FULLSCREEN</a></cite>］。
                </p>
            </aside>
        </div>
        <p>
            <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                id="ref-for-dfn-pointer-lock-target-12">pointer-lock target</a>が<a data-lt="become disconnected"
                data-type="dfn"
                href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-disconnected">切断された</a>場合や、<a
                data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                id="ref-for-dfn-user-agent-11">ユーザーエージェント</a>、ウィンドウ、タブがフォーカスを失った場合は、ポインターロックを解除しなければならない。<a
                data-link-type="dfn|abstract-op" data-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document">アクティブドキュメント</a>の要素間や、<a
                data-link-type="dfn|abstract-op" data-type="dfn"
                href="https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc">ブラウジングコンテキスト</a>間でのフォーカス移動は、<a
                data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock" class="internalDFN"
                id="ref-for-dfn-exit-pointer-lock-3">ポインターロックの解除</a>を引き起こさない。たとえば、キーボードでフレームやiframeの内容間でフォーカスを移動しても解除されない。
        </p>
        <p>
            フルスクリーン［<cite><a class="bibref" data-link-type="biblio" href="#bib-fullscreen"
                    title="Fullscreen API Standard">FULLSCREEN</a></cite>］が開始または終了した際、ユーザーエージェントのグラフィカルユーザーインターフェース操作にポインターが必要な場合、<a
                data-link-type="dfn|abstract-op" href="#dfn-default-unlock-gesture" class="internalDFN"
                id="ref-for-dfn-default-unlock-gesture-3">デフォルト解除ジェスチャー</a>によって両方を解除した場合、またはウィンドウやタブのフォーカスが失われた場合を除き、ポインターロックは解除してはならない。
        </p>
    </section>
    <section class="informative" id="use-cases">
        <div class="header-wrapper">
            <h2 id="x9-use-cases"><bdi class="secno">9. </bdi>
                ユースケース
            </h2><a class="self-link" href="#use-cases" aria-label="Permalink for Section 9."></a>
        </div>
        <p><em>このセクションは規範的ではありません。</em></p>

        <section id="relative-view-port-rotation-of-free-moving-virtual-actors">
            <div class="header-wrapper">
                <h3 id="x9-1-relative-view-port-rotation-of-free-moving-virtual-actors"><bdi class="secno">9.1 </bdi>
                    自由に動く仮想アクターの相対的なビューポート回転
                </h3><a class="self-link" href="#relative-view-port-rotation-of-free-moving-virtual-actors"
                    aria-label="Permalink for Section 9.1"></a>
            </div>

            <p>
                一人称/三人称ゲームのプレイヤーは、ビューポートの向きを制御する必要があります。広く使われている方法は、マウス操作による視点の角度制御です。この種のアプリケーションは、Pointer Lock
                APIを利用することで、ユーザーがマウスボタンを押していなくてもビューポートのヨーやピッチを完全に自由に制御できます。マウスボタンは他のアクションにも利用でき、マウス移動によるナビゲーションが常に提供されます。
            </p>
        </section>
        <section id="free-rotation-of-3d-models-or-panning-of-2d-layers">
            <div class="header-wrapper">
                <h3 id="x9-2-free-rotation-of-3d-models-or-panning-of-2d-layers"><bdi class="secno">9.2 </bdi>
                    3Dモデルの自由回転または2Dレイヤーのパン
                </h3><a class="self-link" href="#free-rotation-of-3d-models-or-panning-of-2d-layers"
                    aria-label="Permalink for Section 9.2"></a>
            </div>

            <p>
                三次元モデリングアプリケーションの利用者は、モデルを回転させる必要があります。アプリケーションはPointer Lock
                APIを使うことで、ドラッグ操作中に制限なくモデルを自由に回転させることができます。ポインターロックがなければ、ドラッグは画面端でカーソル位置が制限されることで動作が止まります。
            </p>
            <p>
                同様に、二次元画像の絶対的なパンも、カーソルや画面の制限なく一回のドラッグ操作で可能となります。
            </p>
        </section>
        <section id="relative-movement-of-actors">
            <div class="header-wrapper">
                <h3 id="x9-3-relative-movement-of-actors"><bdi class="secno">9.3 </bdi>
                    アクターの相対移動
                </h3><a class="self-link" href="#relative-movement-of-actors"
                    aria-label="Permalink for Section 9.3"></a>
            </div>

            <p>
                反射神経が要求されるゲームでは、プレイヤーがパドルを操作してボールを相手に返します。同じパドルで、異なるマウスボタンの押下によって様々なアクションを実行できます。アプリケーションはPointer Lock
                APIを使うことで、カーソルがゲームプレイ領域から外れて他のアプリケーションをクリックしてしまい、ゲームの流れが途切れることを心配せずに素早い反応を可能にします。
            </p>
        </section>
        <section id="jog-movement-over-spinner-controls">
            <div class="header-wrapper">
                <h3 id="x9-4-jog-movement-over-spinner-controls"><bdi class="secno">9.4 </bdi>
                    スピナーコントロール上でのジョグ移動
                </h3><a class="self-link" href="#jog-movement-over-spinner-controls"
                    aria-label="Permalink for Section 9.4"></a>
            </div>

            <p>
                アプリケーションで数値を変更する際、ユーザーは数値コントロールのボタンハンドルをドラッグして数値を増減したいことがあります。例えば、数値入力ボックスと上下の矢印があるスピナーで、クリックやドラッグで値を変更できます。アプリケーションはPointer
                Lock APIを使うことで、論理的な画面境界を超えて数値を変更できるようになります。同様に、ビデオやオーディオの「ジョグ」コントロールにも適用できます。
            </p>
        </section>
        <section id="synthetic-cursor-interaction-with-html-dom-ui">
            <div class="header-wrapper">
                <h3 id="x9-5-synthetic-cursor-interaction-with-html-dom-ui"><bdi class="secno">9.5 </bdi>
                    HTML DOM UIとの合成カーソル操作
                </h3><a class="self-link" href="#synthetic-cursor-interaction-with-html-dom-ui"
                    aria-label="Permalink for Section 9.5"></a>
            </div>

            <p>
                一部のゲームでは従来型カーソルを利用しますが、カーソルをゲーム領域に限定したり、ゲーム側で操作したい場合があります。ポインターロックを使えば、アプリケーションが独自のカーソルを作成し、それを制御できます。ただしHTMLとDOMはUIとして利用可能でなければなりません。アプリケーション独自カーソルがDOMとやり取りできるよう、合成マウスイベントも許可されるべきです。例えば、次のコードでポインターロック中にカスタムカーソルからクリックイベントを送信できます：
            </p>
            <div class="example" id="example-3">
                <div class="marker">
                    <a class="self-link" href="#example-3">例<bdi> 3</bdi></a>
                </div>
                <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
  <span class="hljs-keyword">if</span> (e._isSynthetic)
    <span class="hljs-keyword">return</span>;
  <span class="hljs-comment">// send a synthetic click</span>
  <span class="hljs-keyword">var</span> ee = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">"MouseEvents"</span>);
  ee._isSynthetic = <span class="hljs-literal">true</span>;
  x = myCursor.x;
  y = myCursor.y;
  ee.initMouseEvent(<span class="hljs-string">"click"</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">1</span>,
                    x + e.screenX - e.clientX,
                    y + e.screenY - e.clientY,
                    x,
                    y);
  <span class="hljs-keyword">var</span> target = <span class="hljs-built_in">document</span>.elementFromPoint(x, y);
  <span class="hljs-keyword">if</span> (target)
    target.dispatchEvent(ee);
});</code></pre>
            </div>
            <p>
                合成クリックは、<a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-13">ユーザーエージェント</a>によって、非合成クリックと同じデフォルト動作が許可されない場合がありますが、アプリケーション側のハンドラは既存のHTMLやDOMの仕組みでUIを提供できます。
            </p>
        </section>
        <section id="view-port-panning-by-moving-a-mouse-cursor-against-the-bounds-of-a-view-port">
            <div class="header-wrapper">
                <h3 id="x9-6-view-port-panning-by-moving-a-mouse-cursor-against-the-bounds-of-a-view-port"><bdi
                        class="secno">9.6 </bdi>
                    ビューポート境界に対してマウスカーソルを動かすことによるビューポートのパン
                </h3><a class="self-link"
                    href="#view-port-panning-by-moving-a-mouse-cursor-against-the-bounds-of-a-view-port"
                    aria-label="Permalink for Section 9.6"></a>
            </div>

            <p>
                リアルタイムストラテジーゲームでは、この手法がよく使われます。プレイヤーがポインターをビューポートの端に動かし、マウス操作で端を「押す」と、マウスの動きに応じてゲーム領域上でビューポートがパンされます。ビューポート内でカーソルを動かす場合は、通常のシステム動作になります。アプリケーションは、ポインターロックと前述の「HTML
                DOM UIとの合成カーソル操作」を使い、カーソル動作を完全に制御することもできます。
            </p>
        </section>
        <section id="game-lobby-timer-based-pointer-lock">
            <div class="header-wrapper">
                <h3 id="x9-7-game-lobby-timer-based-pointer-lock"><bdi class="secno">9.7 </bdi>
                    ゲームロビー、タイマーによるポインターロック
                </h3><a class="self-link" href="#game-lobby-timer-based-pointer-lock"
                    aria-label="Permalink for Section 9.7"></a>
            </div>

            <p>
                ポインターロックを使うゲームでは、プレイヤーがロビーで準備中は従来のUIやシステムカーソルを使いたいことがあります。ゲームは通常、全員が準備できると短いタイマー後に開始します。理想的には、ユーザーアクティベーションなしにゲーム開始時にポインターロックモードへ切り替えられるべきです。プレイヤーはロビーからゲームナビゲーションへシームレスに移行できる必要があります。
            </p>
        </section>
        <section id="game-portal">
            <div class="header-wrapper">
                <h3 id="x9-8-game-portal"><bdi class="secno">9.8 </bdi>
                    ゲームポータル
                </h3><a class="self-link" href="#game-portal" aria-label="Permalink for Section 9.8"></a>
            </div>

            <p>
                ゲームポータルやFacebook、Google
                Plusなどのサイトは、ユーザー向けにゲームを提供しています。これらのゲームは、ポータルサイトとは異なるオリジンから配信される場合があります。埋め込みゲームは、フルスクリーンでなくてもポインターロックを利用できるべきです。
            </p>
        </section>
    </section>
    <section class="informative" id="security">
        <div class="header-wrapper">
            <h2 id="x10-security"><bdi class="secno">10. </bdi>
                セキュリティ
            </h2><a class="self-link" href="#security" aria-label="Permalink for Section 10."></a>
        </div>
        <p><em>このセクションは規範的ではありません。</em></p>

        <p>
            セキュリティ上の懸念点:
        </p>
        <ul>
            <li>ユーザーの操作が、意図しない要素に誘導される可能性があります。
            </li>
            <li>ポインターロックにより、ユーザーが<a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-14">ユーザーエージェント</a>や
                オペレーティングシステムのコントロールにアクセスできなくなります。
            </li>
            <li>ユーザーがポインターロックを解除した後、スクリプトが繰り返しポインターロックを呼び出すことで、ユーザーの操作進行を妨げることができます。
            </li>
            <li>全画面解除の案内は、一部の<a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-15">ユーザーエージェント</a>で
                ポインターを画面上部に移動した時に表示されますが、ポインターロック中はそのジェスチャーが不可能となります。
            </li>
        </ul>
        <p>
            対策:
        </p>
        <ul>
            <li><a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-16">ユーザーエージェント</a>は、どのセキュリティオリジンがポインターをロックできるかを制限する場合があります。
            </li>
            <li><a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-17">ユーザーエージェント</a>は、ロック前に確認ダイアログを表示する場合があり、この設定はコンテンツ設定として保存できます。
            </li>
            <li>Escキーなどによる<a data-link-type="dfn|abstract-op" href="#dfn-default-unlock-gesture" class="internalDFN"
                    id="ref-for-dfn-default-unlock-gesture-4">デフォルト解除ジェスチャー</a>による解除手段が常に提供されます。
            </li>
            <li>解除方法の案内を常時表示することができます。
            </li>
            <li>ポインターロックの解除が繰り返された場合、<a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-18">ユーザーエージェント</a>は、特定のユーザー操作がない限り再ロックしないようにできます（Chromeのalert()の繰り返し抑制と同様）。
            </li>
            <li>新しいタブやウィンドウへの切替などでページのフォーカスが失われた場合は、<a data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock"
                    class="internalDFN" id="ref-for-dfn-exit-pointer-lock-4">ポインターロック解除</a>が、<a
                    data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-19">ユーザーエージェント</a>の
                <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-target-13">pointer-lock target</a>に対して行われます。
            </li>
            <li>ウィンドウが<a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-20">ユーザーエージェント</a>とOSでフォーカスされている場合のみ、ポインターロックを有効化できます。
            </li>
        </ul>
        <p>
            推奨事項:
        </p>
        <ul>
            <li>Escキーは、ユーザーエージェントの<a data-link-type="dfn|abstract-op" href="#dfn-exit-pointer-lock" class="internalDFN"
                    id="ref-for-dfn-exit-pointer-lock-5">ポインターロック解除</a>を<a data-link-type="dfn|abstract-op"
                    href="#dfn-pointer-lock-target" class="internalDFN"
                    id="ref-for-dfn-pointer-lock-target-14">pointer-lock target</a>で行うべきです。
            </li>
            <li>ポップアップや位置情報、フルスクリーン同様、サブドメインごとにポインターロックの許可・ブロック設定を利用できます。
            </li>
        </ul>
        <p>
            ポインターロックは特定のアプリケーションタイプに必須のユーザー操作モードですが、悪意ある利用の場合はユーザビリティ上の懸念があります。攻撃者はユーザーがシステム上のマウスカーソルを操作できなくすることも可能です。<a
                data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                id="ref-for-dfn-user-agent-21">ユーザーエージェント</a>は、必ず解除手段を提供し、解除方法を案内し、ポインターロックの開始方法を制限することで、これを防ぎます。
        </p>
        <p>
            <a data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                id="ref-for-dfn-user-agent-22">ユーザーエージェント</a>は、端末ごと・ユーザー設定ごとに適切なポリシーを独自に決定します。
        </p>
    </section>
    <section class="informative" id="frequently-asked-questions">
        <div class="header-wrapper">
            <h2 id="x11-frequently-asked-questions"><bdi class="secno">11. </bdi>
                よくある質問
            </h2><a class="self-link" href="#frequently-asked-questions" aria-label="Permalink for Section 11."></a>
        </div>
        <p><em>このセクションは規範的ではありません。</em></p>

        <section id="why-not-merge-with-mouse-capture-setcapture">
            <div class="header-wrapper">
                <h3 id="x11-1-why-not-merge-with-mouse-capture-setcapture"><bdi class="secno">11.1 </bdi>
                    Mouse Capture: setCapture()と統合しない理由
                </h3><a class="self-link" href="#why-not-merge-with-mouse-capture-setcapture"
                    aria-label="Permalink for Section 11.1"></a>
            </div>

            <p>
                Mouse Capture［<cite><a class="bibref" data-link-type="biblio" href="#bib-mdn-setcapture"
                        title="Element.setCapture()">MDN-SETCAPTURE</a></cite>］は、マウスドラッグ中のみ低リスクでマウスイベントターゲットのロックを行います。ポインターロックはカーソルの概念を消し、すべてのイベントを指定ターゲットに送ります。両者は関連していますが異なる機能です。
            </p>
            <p>
                両方を実装する場合、「マウスボタン離しで自動解除」というセキュリティのシンプルさと、マウス入力を完全制御・カーソル非表示という機能拡張の組み合わせが合理的です。短時間だけドラッグ中ポインターロックする用途には、より許容的な利用が可能になります。
            </p>
            <p>
                本仕様の初期バージョンでは、この機能は省略されています。ウィンドウモードの一部小さなユースケースには有用ですが、主要ユースケースにはまだ十分な実装がありません。実装には両方のAPIが必要ですが、現時点で両方を実装しているブラウザはありません。また、この機能が.lockと.setCaptureのどちらに属するかも未定です。どちらも実装されれば、どちらのAPIも簡単に拡張してハイブリッド機能を提供できます。
            </p>
        </section>
        <section id="why-not-repurpose-mouseevent-s-clientx-y-screenx-y">
            <div class="header-wrapper">
                <h3 id="x11-2-why-not-repurpose-mouseevent-s-clientx-y-screenx-y"><bdi class="secno">11.2 </bdi>
                    MouseEventの.clientX/Y .screenX/Yを再利用しない理由
                </h3><a class="self-link" href="#why-not-repurpose-mouseevent-s-clientx-y-screenx-y"
                    aria-label="Permalink for Section 11.2"></a>
            </div>

            <p>
                ロックされていない状態でも、マウス移動のデルタ値は有用です。ロック状態によって.clientや.screenの意味を変更すると、ロック状態を十分に考慮しないコードで簡単にエラーが生じます。
            </p>
        </section>
        <section id="why-use-movementx-y-instead-of-deltax-y">
            <div class="header-wrapper">
                <h3 id="x11-3-why-use-movementx-y-instead-of-deltax-y"><bdi class="secno">11.3 </bdi>
                    .movementX/Yを.deltaX/Yの代わりに使う理由
                </h3><a class="self-link" href="#why-use-movementx-y-instead-of-deltax-y"
                    aria-label="Permalink for Section 11.3"></a>
            </div>

            <p>
                ポインターロック中は 'wheel' イベントも <a data-link-type="dfn|abstract-op" href="#dfn-pointer-lock-target"
                    class="internalDFN" id="ref-for-dfn-pointer-lock-target-15">pointer-lock target</a> 要素に送るべきです。しかし
                .deltaX/Y/Z は <a href="https://w3c.github.io/uievents/#events-wheelevents">DOM 3 'wheel'
                    イベント</a>で定義済みの名前と競合するためです。
            </p>
        </section>
        <section id="why-bundle">
            <div class="header-wrapper">
                <h3
                    id="x11-4-why-bundle-all-functionality-hiding-cursor-providing-mouse-deltas-instead-of-using-css-to-hide-the-cursor-always-providing-delta-values-and-offering-an-api-to-restrict-the-cursor-movement-to-a-portion-of-the-web-page">
                    <bdi class="secno">11.4 </bdi>
                    すべての機能（カーソル非表示、マウスデルタの提供）をまとめている理由（CSSでカーソルを非表示にしたり、常にデルタ値を提供したり、カーソル移動をウェブページの一部に制限するAPIを提供するのではなく）
                </h3><a class="self-link" href="#why-bundle" aria-label="Permalink for Section 11.4"></a>
            </div>

            <p>
                より細やかな制御を提供する動機は十分あります。例えば「ビューポート境界へのマウスカーソル移動によるパン」ユースケースは、カーソル非表示は不要で、境界制限と常時デルタ値だけが必要です。また、この仕様はマウスカーソルの動きに基づいたmovement
                deltasを定義していますが、これはOSによるフィルタリングや加速が含まれます。アプリケーションは、マウスカーソル向け調整前のより生の移動データを取得したい場合があります。生データはピクセル以上の精度や高頻度更新も可能です。生のデルタ取得には特別な許可やモードが不要で、カーソルの境界制限不要なアプリにはセキュリティ障壁やプロンプトを減らせます。
            </p>
            <p>
                この細粒度のアプローチを延期する理由は2つあります。第一は、マウス移動データの単位をどう規定するかという懸念です。本仕様は.movementX/Yを、ロックされていない時の.screenX/Yの変化値とまったく同じ値として定義しています。これにより、複数の<a
                    data-link-type="dfn|abstract-op" href="#dfn-user-agent" class="internalDFN"
                    id="ref-for-dfn-user-agent-23">ユーザーエージェント</a>やOS間でも、アプリ開発者と利用者に一貫した体験を提供できます。さらに、ユーザーはすでにハードウェア入力やOSの設定を好みに調整済みであり、.movementX/Yの単位を同じにすることで、APIアプリがすぐ使えるようになります。
            </p>
            <p>
                第二に、細粒度アプローチで移動データの提供とカーソルの境界制限を実装するのはより困難です。機能をまとめることで、各OSに応じた様々な技術を自由に使える実装が可能となり、実装面でも現実的です。主要なデスクトッププラットフォーム（Windows、Mac
                OS
                X、Linux）には、カーソルを特定矩形に制限する直接APIがなく、Xlibによる不可視ウィンドウやMacの手動カーソル移動の試作も未開発です。未調整デルタ値は生のHIDデータ読み取り（例：WindowsのWM_INPUT、Mac
                OS X/LinuxのUSBデバイスAPI）で提案されていますが、単位の解釈と正規化が課題です。さらに、これまで検討されたAPIはUSBデバイスに限られます。
            </p>
            <p>
                将来的にこれらの機能追加は妥当であり、現行のポインターロックAPIは細粒度のデルタや境界制限が実装されても簡単に拡張できます。
            </p>
            <p>
                現仕様は、実装の現実性・要求ユースケースへの対応・将来改善との衝突回避のため、バンドル型APIを採用しています。
            </p>
        </section>
        <section id="high-resolution-deltas-high-frequency-updates">
            <div class="header-wrapper">
                <h3 id="x11-5-high-resolution-deltas-high-frequency-updates"><bdi class="secno">11.5 </bdi>
                    高解像度デルタ／高頻度アップデート？
                </h3><a class="self-link" href="#high-resolution-deltas-high-frequency-updates"
                    aria-label="Permalink for Section 11.5"></a>
            </div>

            <p>
                まだ対応していません。理由は前問「すべての機能（カーソル非表示、マウスデルタの提供）をまとめている理由（CSSでカーソルを非表示にしたり、常にデルタ値を提供したり、カーソル移動をウェブページの一部に制限するAPIを提供するのではなく）」と同じです。
            </p>
        </section>
        <section id="why-modify-mouseevent-and-reuse-existing-mouse-events-instead-of-creating-a-mouse-delta-event">
            <div class="header-wrapper">
                <h3
                    id="x11-6-why-modify-mouseevent-and-reuse-existing-mouse-events-instead-of-creating-a-mouse-delta-event">
                    <bdi class="secno">11.6 </bdi>
                    MouseEventを修正して既存のマウスイベントを再利用し、マウスデルタイベントを新たに作成しない理由
                </h3><a class="self-link"
                    href="#why-modify-mouseevent-and-reuse-existing-mouse-events-instead-of-creating-a-mouse-delta-event"
                    aria-label="Permalink for Section 11.6"></a>
            </div>

            <p>
                ポインターロック中も多くのマウスイベント（クリック、mousedownなど）は有効です。これらはMouseEventという同じイベントデータ構造を共有します。移動データを新しいデータ構造で報告する場合、新しいイベントが必要となり、ボタンや修飾キー状態などの利便性もMouseEventと並ぶ構造が必要です。クリックやdown/upイベントは既存のmousedown/mouseupを使うのか？その場合.clientX/Yや.screenX/Yは有用なデータを持たず、現在の移動データも含まれません。あるいはロック時用に新しいイベントが必要になります。
            </p>
            <p>
                また、movementX/Yはマウスロックしていない時でも便利です。本仕様は、マウスカーソルが存在する場合でもmovement属性が常に有効であることを求めます。これにより、アプリがマウスデルタを利用する場合、カーソル状態やmouseover/mouseout遷移の追跡コードを削減できます。
            </p>
            <p>
                唯一のデメリットは、ロック中にclientX/YとscreenX/Y値が未使用になることですが、これは重大な問題ではありません。
            </p>
            <p>
                よって、MouseEventへのmovementX/Y追加という最小限の変更が、APIと実装の複雑さを減らすために選択されています。
            </p>
        </section>
        <section id="why-separate-targets-for-mouse-events-under-pointer-lock-and-keyboard-input-focus">
            <div class="header-wrapper">
                <h3 id="x11-7-why-separate-targets-for-mouse-events-under-pointer-lock-and-keyboard-input-focus"><bdi
                        class="secno">11.7 </bdi>
                    ポインターロック下のマウスイベントとキーボード入力フォーカスのターゲットを分ける理由
                </h3><a class="self-link"
                    href="#why-separate-targets-for-mouse-events-under-pointer-lock-and-keyboard-input-focus"
                    aria-label="Permalink for Section 11.7"></a>
            </div>

            <p>
                例えば、ユーザーがテキストコンソールでチャットしながら、マウス操作で3Dビューを制御するゲームを考えてみましょう。アプリケーションがマウスイベントの送信先とテキスト入力先を異なる要素に分けて受け付けるのは合理的です。これは、ページ上の任意要素でmousemoveイベントを受け取る一方で、フォーム入力を行う既存の動作と同様です。
            </p>
        </section>
    </section>
    <section id="conformance">
        <div class="header-wrapper">
            <h2 id="x12-conformance"><bdi class="secno">12. </bdi>適合性</h2><a class="self-link" href="#conformance"
                aria-label="Permalink for Section 12."></a>
        </div>
        <p>非規範的と明記されたセクションだけでなく、この仕様書のすべての執筆ガイドライン、図、例、注記も非規範的です。それ以外はすべて規範的です。</p>
        <p>
            この仕様は、ひとつの製品、すなわち本仕様に含まれるインターフェースを実装する<dfn data-plurals="user agents" id="dfn-user-agent" tabindex="0"
                aria-haspopup="dialog" data-dfn-type="dfn">ユーザーエージェント</dfn>に適用される適合性基準を定義します。
        </p>
    </section>
    <section class="appendix informative" id="acknowledgments">
        <div class="header-wrapper">
            <h2 id="a-acknowledgments"><bdi class="secno">A. </bdi>
                謝辞
            </h2><a class="self-link" href="#acknowledgments" aria-label="Permalink for Appendix A."></a>
        </div>
        <p><em>このセクションは規範的ではありません。</em></p>

        <p>
            この仕様の議論に貢献してくださった多くの方々に感謝します:
        </p>
        <ul>
            <li>Adam Barth
            </li>
            <li>Alexey Proskuryakov
            </li>
            <li>Aryeh Gregor
            </li>
            <li>Boris Zbarsky
            </li>
            <li>Brandon Andrews
            </li>
            <li>Darin Fisher
            </li>
            <li>Dimitri Glazkov
            </li>
            <li>Ella Ge
            </li>
            <li>Glenn Maynard
            </li>
            <li>Gregg Tavares
            </li>
            <li>Janice Shiu
            </li>
            <li>John Villar
            </li>
            <li>Jonas Sicking
            </li>
            <li>Kagami Sascha Rosylight
            </li>
            <li>Klaas Heidstra
            </li>
            <li>Léonie Watson
            </li>
            <li>Marcos Cáceres
            </li>
            <li>Ms2ger
            </li>
            <li>Mustaq Ahmed
            </li>
            <li>Navid Zolghadr
            </li>
            <li>Olli Pettay
            </li>
            <li>Patrick H. Lauke
            </li>
            <li>Philip Jägenstedt
            </li>
            <li>Philippe Le Hegaret
            </li>
            <li>Robert O'Callahan
            </li>
            <li>Tab Atkins Jr.
            </li>
            <li>Takayoshi Kochi
            </li>
            <li>Timeless
            </li>
            <li>Vincent Scheib
            </li>
            <li>Xiaoqian Wu
            </li>
            <li>Yves Lafon
            </li>
        </ul>
    </section>


    <section id="references" class="appendix">
        <div class="header-wrapper">
            <h2 id="b-references"><bdi class="secno">B. </bdi>参考文献</h2><a class="self-link" href="#references"
                aria-label="Permalink for Appendix B."></a>
        </div>
        <section id="normative-references">
            <div class="header-wrapper">
                <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>規範的参考文献</h3><a class="self-link"
                    href="#normative-references" aria-label="Permalink for Appendix B.1"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-dom">[dom]</dt>
                <dd>
                    <a href="https://dom.spec.whatwg.org/"><cite>DOM標準</cite></a>. Anne van Kesteren. WHATWG.
                    現行標準. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-fullscreen">[FULLSCREEN]</dt>
                <dd>
                    <a href="https://fullscreen.spec.whatwg.org/"><cite>Fullscreen API標準</cite></a>. Philip
                    Jägenstedt. WHATWG. 現行標準. URL: <a
                        href="https://fullscreen.spec.whatwg.org/">https://fullscreen.spec.whatwg.org/</a>
                </dd>
                <dt id="bib-html">[html]</dt>
                <dd>
                    <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML標準</cite></a>. Anne van Kesteren;
                    Domenic Denicola; Ian Hickson; Philip Jägenstedt; Simon Pieters. WHATWG. 現行標準. URL: <a
                        href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
                </dd>
                <dt id="bib-ui-events">[ui-events]</dt>
                <dd>
                    <a href="https://www.w3.org/TR/uievents/"><cite>UI Events</cite></a>. Gary Kacmarcik; Travis
                    Leithead. W3C. 2024年2月21日. W3C作業草案. URL: <a
                        href="https://www.w3.org/TR/uievents/">https://www.w3.org/TR/uievents/</a>
                </dd>
                <dt id="bib-webidl">[WEBIDL]</dt>
                <dd>
                    <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL標準</cite></a>. Edgar Chen; Timothy Gu.
                    WHATWG. 現行標準. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
                </dd>
            </dl>
        </section>
        <section id="informative-references">
            <div class="header-wrapper">
                <h3 id="b-2-informative-references"><bdi class="secno">B.2 </bdi>参考情報文献</h3><a class="self-link"
                    href="#informative-references" aria-label="Permalink for Appendix B.2"></a>
            </div>

            <dl class="bibliography">
                <dt id="bib-mdn-setcapture">[MDN-SETCAPTURE]</dt>
                <dd>
                    <a
                        href="https://developer.mozilla.org/en-US/docs/Web/API/Element/setCapture"><cite>Element.setCapture()</cite></a>.
                    Eric Shepherd; 他. URL: <a
                        href="https://developer.mozilla.org/en-US/docs/Web/API/Element/setCapture">https://developer.mozilla.org/en-US/docs/Web/API/Element/setCapture</a>
                </dd>
            </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="トップに戻る">↑</abbr></a>
    </p>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointer-lock-state"
        aria-label="Links in this document to definition: pointer lock state">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointer-lock-state"
                aria-label="Permalink for definition: pointer lock state. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointer-lock-state-1" title="§ 2.1 The pointer lock state definition">§ 2.1 The
                    pointer lock state definition</a> <a href="#ref-for-dfn-pointer-lock-state-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-pointer-lock-state-3" title="Reference 3">(3)</a>
                <a href="#ref-for-dfn-pointer-lock-state-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-pointer-lock-state-5" title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-state-6" title="§ 2.4 Exit Pointer Lock">§ 2.4 Exit Pointer Lock</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-state-7" title="§ 3. Extensions to the Element Interface">§ 3.
                    Extensions to the Element Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointer-lock-target"
        aria-label="Links in this document to definition: pointer-lock target">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointer-lock-target"
                aria-label="Permalink for definition: pointer-lock target. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-1" title="§ 2.1 The pointer lock state definition">§ 2.1 The
                    pointer lock state definition</a> <a href="#ref-for-dfn-pointer-lock-target-2"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-3" title="§ 2.4 Exit Pointer Lock">§ 2.4 Exit Pointer Lock</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-4" title="§ 3. Extensions to the Element Interface">§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dfn-pointer-lock-target-5"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-pointer-lock-target-6" title="Reference 3">(3)</a>
                <a href="#ref-for-dfn-pointer-lock-target-7" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-pointer-lock-target-8" title="Reference 5">(5)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-9" title="§ 4. Extensions to the Document Interface">§ 4.
                    Extensions to the Document Interface</a> <a href="#ref-for-dfn-pointer-lock-target-10"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-11" title="§ 8. Requirements">§ 8. Requirements</a> <a
                    href="#ref-for-dfn-pointer-lock-target-12" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-13" title="§ 10. Security">§ 10. Security</a> <a
                    href="#ref-for-dfn-pointer-lock-target-14" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-target-15"
                    title="§ 11.3 Why use .movementX/Y instead of .deltaX/Y?">§ 11.3 Why use .movementX/Y instead of
                    .deltaX/Y?</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointer-lock-options"
        aria-label="Links in this document to definition: pointer-lock options">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointer-lock-options"
                aria-label="Permalink for definition: pointer-lock options. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointer-lock-options-1" title="§ 2.1 The pointer lock state definition">§ 2.1 The
                    pointer lock state definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-options-2" title="§ 2.4 Exit Pointer Lock">§ 2.4 Exit Pointer
                    Lock</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointer-lock-options-3" title="§ 3. Extensions to the Element Interface">§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dfn-pointer-lock-options-4"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-pointer-lock-options-5"
                    title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-cursor-position"
        aria-label="Links in this document to definition: cursor position">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-cursor-position"
                aria-label="Permalink for definition: cursor position. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-cursor-position-1" title="§ 2.4 Exit Pointer Lock">§ 2.4 Exit Pointer Lock</a> <a
                    href="#ref-for-dfn-cursor-position-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-cursor-position-3" title="§ 3. Extensions to the Element Interface">§ 3.
                    Extensions to the Element Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-pointerlockoptions"
        aria-label="Links in this document to definition: PointerLockOptions">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-pointerlockoptions"
                aria-label="Permalink for definition: PointerLockOptions. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1846476394">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-1" title="§ 2.1 The pointer lock state definition">§ 2.1 The
                    pointer lock state definition</a> <a href="#ref-for-dom-pointerlockoptions-2"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-3" title="§ 2.2 PointerLockOptions dictionary">§ 2.2
                    PointerLockOptions dictionary</a>
            </li>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-4" title="§ 3. Extensions to the Element Interface">§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dom-pointerlockoptions-5"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-pointerlockoptions-unadjustedmovement"
        aria-label="Links in this document to definition: unadjustedMovement">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-pointerlockoptions-unadjustedmovement"
                aria-label="Permalink for definition: unadjustedMovement. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1846476394">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-unadjustedmovement-1"
                    title="§ 2.1 The pointer lock state definition">§ 2.1 The pointer lock state definition</a> <a
                    href="#ref-for-dom-pointerlockoptions-unadjustedmovement-2" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-unadjustedmovement-3"
                    title="§ 2.2 PointerLockOptions dictionary">§ 2.2 PointerLockOptions dictionary</a>
            </li>
            <li>
                <a href="#ref-for-dom-pointerlockoptions-unadjustedmovement-4"
                    title="§ 3. Extensions to the Element Interface">§ 3. Extensions to the Element Interface</a> <a
                    href="#ref-for-dom-pointerlockoptions-unadjustedmovement-5" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointerlockchange"
        aria-label="Links in this document to definition: pointerlockchange">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointerlockchange"
                aria-label="Permalink for definition: pointerlockchange. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointerlockchange-1" title="§ 2.3 pointerlockchange and pointerlockerror Events">§
                    2.3 pointerlockchange and pointerlockerror Events</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointerlockchange-2" title="§ 2.4 Exit Pointer Lock">§ 2.4 Exit Pointer Lock</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointerlockchange-3" title="§ 3. Extensions to the Element Interface">§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dfn-pointerlockchange-4"
                    title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointerlockchange-5" title="§ 4. Extensions to the Document Interface">§ 4.
                    Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-pointerlockerror"
        aria-label="Links in this document to definition: pointerlockerror">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-pointerlockerror"
                aria-label="Permalink for definition: pointerlockerror. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-pointerlockerror-1" title="§ 3. Extensions to the Element Interface">§ 3.
                    Extensions to the Element Interface</a> <a href="#ref-for-dfn-pointerlockerror-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dfn-pointerlockerror-3" title="Reference 3">(3)</a> <a
                    href="#ref-for-dfn-pointerlockerror-4" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-pointerlockerror-5" title="Reference 5">(5)</a> <a
                    href="#ref-for-dfn-pointerlockerror-6" title="Reference 6">(6)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-pointerlockerror-7" title="§ 4. Extensions to the Document Interface">§ 4.
                    Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-exit-pointer-lock"
        aria-label="Links in this document to definition: Exit Pointer Lock">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-exit-pointer-lock"
                aria-label="Permalink for definition: Exit Pointer Lock. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-exit-pointer-lock-1" title="§ 4. Extensions to the Document Interface">§ 4.
                    Extensions to the Document Interface</a>
            </li>
            <li>
                <a href="#ref-for-dfn-exit-pointer-lock-2" title="§ 8. Requirements">§ 8. Requirements</a> <a
                    href="#ref-for-dfn-exit-pointer-lock-3" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-exit-pointer-lock-4" title="§ 10. Security">§ 10. Security</a> <a
                    href="#ref-for-dfn-exit-pointer-lock-5" title="Reference 2">(2)</a> <a
                    href="#ref-for-dfn-exit-pointer-lock-6" title="Reference 3">(3)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-lock-requests-queue"
        aria-label="Links in this document to definition: lock requests queue">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-lock-requests-queue"
                aria-label="Permalink for definition: lock requests queue. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-lock-requests-queue-1" title="§ 3. Extensions to the Element Interface">§ 3.
                    Extensions to the Element Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-element-requestpointerlock"
        aria-label="Links in this document to definition: requestPointerLock()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-element-requestpointerlock"
                aria-label="Permalink for definition: requestPointerLock(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1328413902">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-element-requestpointerlock-1" title="§ 3. Extensions to the Element Interface">§
                    3. Extensions to the Element Interface</a> <a href="#ref-for-dom-element-requestpointerlock-2"
                    title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-document-onpointerlockchange"
        aria-label="Links in this document to definition: onpointerlockchange">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-document-onpointerlockchange"
                aria-label="Permalink for definition: onpointerlockchange. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-131603804">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-document-onpointerlockchange-1"
                    title="§ 4. Extensions to the Document Interface">§ 4. Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-document-onpointerlockerror"
        aria-label="Links in this document to definition: onpointerlockerror">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-document-onpointerlockerror"
                aria-label="Permalink for definition: onpointerlockerror. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-131603804">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-document-onpointerlockerror-1" title="§ 4. Extensions to the Document Interface">§
                    4. Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-document-exitpointerlock"
        aria-label="Links in this document to definition: exitPointerLock()">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-document-exitpointerlock"
                aria-label="Permalink for definition: exitPointerLock(). Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-131603804">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-document-exitpointerlock-1" title="§ 3. Extensions to the Element Interface">§ 3.
                    Extensions to the Element Interface</a>
            </li>
            <li>
                <a href="#ref-for-dom-document-exitpointerlock-2" title="§ 4. Extensions to the Document Interface">§ 4.
                    Extensions to the Document Interface</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true"
        id="dfn-panel-for-dom-documentorshadowroot-pointerlockelement"
        aria-label="Links in this document to definition: pointerLockElement">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-documentorshadowroot-pointerlockelement"
                aria-label="Permalink for definition: pointerLockElement. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-748339506">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-documentorshadowroot-pointerlockelement-1"
                    title="§ 5. Extensions to the DocumentOrShadowRoot Mixin">§ 5. Extensions to the
                    DocumentOrShadowRoot Mixin</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-mouseevent-movementx"
        aria-label="Links in this document to definition: movementX">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-mouseevent-movementx"
                aria-label="Permalink for definition: movementX. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1698756137">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-mouseevent-movementx-1" title="§ 6. Extensions to the MouseEvent Interface">§ 6.
                    Extensions to the MouseEvent Interface</a> <a href="#ref-for-dom-mouseevent-movementx-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-mouseevent-movementx-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dom-mouseevent-movementx-4"
                    title="Reference 4">(4)</a> <a href="#ref-for-dom-mouseevent-movementx-5"
                    title="Reference 5">(5)</a> <a href="#ref-for-dom-mouseevent-movementx-6"
                    title="Reference 6">(6)</a> <a href="#ref-for-dom-mouseevent-movementx-7"
                    title="Reference 7">(7)</a> <a href="#ref-for-dom-mouseevent-movementx-8"
                    title="Reference 8">(8)</a> <a href="#ref-for-dom-mouseevent-movementx-9"
                    title="Reference 9">(9)</a> <a href="#ref-for-dom-mouseevent-movementx-10"
                    title="Reference 10">(10)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-mouseevent-movementy"
        aria-label="Links in this document to definition: movementY">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-mouseevent-movementy"
                aria-label="Permalink for definition: movementY. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-1698756137">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-mouseevent-movementy-1" title="§ 6. Extensions to the MouseEvent Interface">§ 6.
                    Extensions to the MouseEvent Interface</a> <a href="#ref-for-dom-mouseevent-movementy-2"
                    title="Reference 2">(2)</a> <a href="#ref-for-dom-mouseevent-movementy-3"
                    title="Reference 3">(3)</a> <a href="#ref-for-dom-mouseevent-movementy-4"
                    title="Reference 4">(4)</a> <a href="#ref-for-dom-mouseevent-movementy-5"
                    title="Reference 5">(5)</a> <a href="#ref-for-dom-mouseevent-movementy-6"
                    title="Reference 6">(6)</a> <a href="#ref-for-dom-mouseevent-movementy-7"
                    title="Reference 7">(7)</a> <a href="#ref-for-dom-mouseevent-movementy-8"
                    title="Reference 8">(8)</a> <a href="#ref-for-dom-mouseevent-movementy-9"
                    title="Reference 9">(9)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-mouseeventinit-movementx"
        aria-label="Links in this document to definition: movementX">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-mouseeventinit-movementx"
                aria-label="Permalink for definition: movementX. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-788447252">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-mouseeventinit-movementx-1"
                    title="§ 7. Extensions to the MouseEventInit Dictionary">§ 7. Extensions to the MouseEventInit
                    Dictionary</a> <a href="#ref-for-dom-mouseeventinit-movementx-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-mouseeventinit-movementy"
        aria-label="Links in this document to definition: movementY">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dom-mouseeventinit-movementy"
                aria-label="Permalink for definition: movementY. Activate to close this dialog.">Permalink</a>
            <span class="marker dfn-exported"
                title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block"
                title="Jump to IDL declaration" href="#webidl-788447252">IDL</a>
        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dom-mouseeventinit-movementy-1"
                    title="§ 7. Extensions to the MouseEventInit Dictionary">§ 7. Extensions to the MouseEventInit
                    Dictionary</a> <a href="#ref-for-dom-mouseeventinit-movementy-2" title="Reference 2">(2)</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-default-unlock-gesture"
        aria-label="Links in this document to definition: default unlock gesture">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-default-unlock-gesture"
                aria-label="Permalink for definition: default unlock gesture. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-default-unlock-gesture-1" title="§ 1. Introduction">§ 1. Introduction</a>
            </li>
            <li>
                <a href="#ref-for-dfn-default-unlock-gesture-2" title="§ 8. Requirements">§ 8. Requirements</a> <a
                    href="#ref-for-dfn-default-unlock-gesture-3" title="Reference 2">(2)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-default-unlock-gesture-4" title="§ 10. Security">§ 10. Security</a>
            </li>
        </ul>
    </div>
    <div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-user-agent"
        aria-label="Links in this document to definition: user agent">
        <span class="caret"></span>
        <div>
            <a class="self-link" href="#dfn-user-agent"
                aria-label="Permalink for definition: user agent. Activate to close this dialog.">Permalink</a>

        </div>
        <p><b>Referenced in:</b></p>
        <ul>
            <li>
                <a href="#ref-for-dfn-user-agent-1" title="§ 2.1 The pointer lock state definition">§ 2.1 The pointer
                    lock state definition</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-2" title="§ 6. Extensions to the MouseEvent Interface">§ 6. Extensions
                    to the MouseEvent Interface</a> <a href="#ref-for-dfn-user-agent-3" title="Reference 2">(2)</a> <a
                    href="#ref-for-dfn-user-agent-4" title="Reference 3">(3)</a> <a href="#ref-for-dfn-user-agent-5"
                    title="Reference 4">(4)</a> <a href="#ref-for-dfn-user-agent-6" title="Reference 5">(5)</a> <a
                    href="#ref-for-dfn-user-agent-7" title="Reference 6">(6)</a> <a href="#ref-for-dfn-user-agent-8"
                    title="Reference 7">(7)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-9" title="§ 8. Requirements">§ 8. Requirements</a> <a
                    href="#ref-for-dfn-user-agent-10" title="Reference 2">(2)</a> <a href="#ref-for-dfn-user-agent-11"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-user-agent-12" title="Reference 4">(4)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-13" title="§ 9.5 Synthetic cursor interaction with HTML DOM UI">§ 9.5
                    Synthetic cursor interaction with HTML DOM UI</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-14" title="§ 10. Security">§ 10. Security</a> <a
                    href="#ref-for-dfn-user-agent-15" title="Reference 2">(2)</a> <a href="#ref-for-dfn-user-agent-16"
                    title="Reference 3">(3)</a> <a href="#ref-for-dfn-user-agent-17" title="Reference 4">(4)</a> <a
                    href="#ref-for-dfn-user-agent-18" title="Reference 5">(5)</a> <a href="#ref-for-dfn-user-agent-19"
                    title="Reference 6">(6)</a> <a href="#ref-for-dfn-user-agent-20" title="Reference 7">(7)</a> <a
                    href="#ref-for-dfn-user-agent-21" title="Reference 8">(8)</a> <a href="#ref-for-dfn-user-agent-22"
                    title="Reference 9">(9)</a>
            </li>
            <li>
                <a href="#ref-for-dfn-user-agent-23"
                    title="§ 11.4 Why bundle all functionality (hiding cursor, providing mouse deltas) instead of using CSS to hide the cursor, always providing delta values, and offering an API to restrict the cursor movement to a portion of the web page?">§
                    11.4 Why bundle all functionality (hiding cursor, providing mouse deltas) instead of using CSS to
                    hide the cursor, always providing delta values, and offering an API to restrict the cursor movement
                    to a portion of the web page?</a>
            </li>
        </ul>
    </div>
    <script id="respec-dfn-panel">(() => {
            // @ts-check
            if (document.respec) {
                document.respec.ready.then(setupPanel);
            } else {
                setupPanel();
            }

            function setupPanel() {
                const listener = panelListener();
                document.body.addEventListener("keydown", listener);
                document.body.addEventListener("click", listener);
            }

            function panelListener() {
                /** @type {HTMLElement} */
                let panel = null;
                return event => {
                    const { target, type } = event;

                    if (!(target instanceof HTMLElement)) return;

                    // For keys, we only care about Enter key to activate the panel
                    // otherwise it's activated via a click.
                    if (type === "keydown" && event.key !== "Enter") return;

                    const action = deriveAction(event);

                    switch (action) {
                        case "show": {
                            hidePanel(panel);
                            /** @type {HTMLElement} */
                            const dfn = target.closest("dfn, .index-term");
                            panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
                            const coords = deriveCoordinates(event);
                            displayPanel(dfn, panel, coords);
                            break;
                        }
                        case "dock": {
                            panel.style.left = null;
                            panel.style.top = null;
                            panel.classList.add("docked");
                            break;
                        }
                        case "hide": {
                            hidePanel(panel);
                            panel = null;
                            break;
                        }
                    }
                };
            }

            /**
             * @param {MouseEvent|KeyboardEvent} event
             */
            function deriveCoordinates(event) {
                const target = /** @type HTMLElement */ (event.target);

                // We prevent synthetic AT clicks from putting
                // the dialog in a weird place. The AT events sometimes
                // lack coordinates, so they have clientX/Y = 0
                const rect = target.getBoundingClientRect();
                if (
                    event instanceof MouseEvent &&
                    event.clientX >= rect.left &&
                    event.clientY >= rect.top
                ) {
                    // The event probably happened inside the bounding rect...
                    return { x: event.clientX, y: event.clientY };
                }

                // Offset to the middle of the element
                const x = rect.x + rect.width / 2;
                // Placed at the bottom of the element
                const y = rect.y + rect.height;
                return { x, y };
            }

            /**
             * @param {Event} event
             */
            function deriveAction(event) {
                const target = /** @type {HTMLElement} */ (event.target);
                const hitALink = !!target.closest("a");
                if (target.closest("dfn:not([data-cite]), .index-term")) {
                    return hitALink ? "none" : "show";
                }
                if (target.closest(".dfn-panel")) {
                    if (hitALink) {
                        return target.classList.contains("self-link") ? "hide" : "dock";
                    }
                    const panel = target.closest(".dfn-panel");
                    return panel.classList.contains("docked") ? "hide" : "none";
                }
                if (document.querySelector(".dfn-panel:not([hidden])")) {
                    return "hide";
                }
                return "none";
            }

            /**
             * @param {HTMLElement} dfn
             * @param {HTMLElement} panel
             * @param {{ x: number, y: number }} clickPosition
             */
            function displayPanel(dfn, panel, { x, y }) {
                panel.hidden = false;
                // distance (px) between edge of panel and the pointing triangle (caret)
                const MARGIN = 20;

                const dfnRects = dfn.getClientRects();
                // Find the `top` offset when the `dfn` can be spread across multiple lines
                let closestTop = 0;
                let minDiff = Infinity;
                for (const rect of dfnRects) {
                    const { top, bottom } = rect;
                    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
                    if (diffFromClickY < minDiff) {
                        minDiff = diffFromClickY;
                        closestTop = top;
                    }
                }

                const top = window.scrollY + closestTop + dfnRects[0].height;
                const left = x - MARGIN;
                panel.style.left = `${left}px`;
                panel.style.top = `${top}px`;

                // Find if the panel is flowing out of the window
                const panelRect = panel.getBoundingClientRect();
                const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
                if (panelRect.right > SCREEN_WIDTH) {
                    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
                    const newCaretOffset = left - newLeft;
                    panel.style.left = `${newLeft}px`;
                    /** @type {HTMLElement} */
                    const caret = panel.querySelector(".caret");
                    caret.style.left = `${newCaretOffset}px`;
                }

                // As it's a dialog, we trap focus.
                // TODO: when <dialog> becomes a implemented, we should really
                // use that.
                trapFocus(panel, dfn);
            }

            /**
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function trapFocus(panel, dfn) {
                /** @type NodeListOf<HTMLAnchorElement> elements */
                const anchors = panel.querySelectorAll("a[href]");
                // No need to trap focus
                if (!anchors.length) return;

                // Move focus to first anchor element
                const first = anchors.item(0);
                first.focus();

                const trapListener = createTrapListener(anchors, panel, dfn);
                panel.addEventListener("keydown", trapListener);

                // Hiding the panel releases the trap
                const mo = new MutationObserver(records => {
                    const [record] = records;
                    const target = /** @type HTMLElement */ (record.target);
                    if (target.hidden) {
                        panel.removeEventListener("keydown", trapListener);
                        mo.disconnect();
                    }
                });
                mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
            }

            /**
             *
             * @param {NodeListOf<HTMLAnchorElement>} anchors
             * @param {HTMLElement} panel
             * @param {HTMLElement} dfn
             * @returns
             */
            function createTrapListener(anchors, panel, dfn) {
                const lastIndex = anchors.length - 1;
                let currentIndex = 0;
                return event => {
                    switch (event.key) {
                        // Hitting "Tab" traps us in a nice loop around elements.
                        case "Tab": {
                            event.preventDefault();
                            currentIndex += event.shiftKey ? -1 : +1;
                            if (currentIndex < 0) {
                                currentIndex = lastIndex;
                            } else if (currentIndex > lastIndex) {
                                currentIndex = 0;
                            }
                            anchors.item(currentIndex).focus();
                            break;
                        }

                        // Hitting "Enter" on an anchor releases the trap.
                        case "Enter":
                            hidePanel(panel);
                            break;

                        // Hitting "Escape" returns focus to dfn.
                        case "Escape":
                            hidePanel(panel);
                            dfn.focus();
                            return;
                    }
                };
            }

            /** @param {HTMLElement} panel */
            function hidePanel(panel) {
                if (!panel) return;
                panel.hidden = true;
                panel.classList.remove("docked");
            }
        })()</script>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
    <script src="https://htmlspecs.com/dropdown.js"></script>
</body>

</html>